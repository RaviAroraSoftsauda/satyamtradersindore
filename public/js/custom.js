var glbidx;
var lstidx;
var glbitidx = 1;

$(document).ready(function () {
    // $('table.display').DataTable();
    $("input").focus(function () {
        $(this).select();
    });
    var table = $('#soprint').DataTable({
        "searching": false,
        "paging": false,
        "info": false,
        "columnDefs": [
            { "visible": false, "targets": 11 }
        ],
        "order": [[11, 'asc']], //grouping
        "displayLength": 25,
        "drawCallback": function (settings) {
            var api = this.api();
            var rows = api.rows({ page: 'all' }).nodes();
            var last = null;

            // Remove the formatting to get integer data for summation
            var intVal = function (i) {
                return typeof i === 'string' ?
                    i.replace(/[\$,]/g, '') * 1 :
                    typeof i === 'number' ?
                        i : 0;
            };

            total = [];
            api.column(11, { page: 'all' }).data().each(function (group, i) {
                //   group_assoc=group.replace(' ',"_");
                group_assoc = group;
                if (typeof total[group_assoc] != 'undefined') {

                    total[group_assoc] = total[group_assoc] + intVal(api.column(10).data()[i]);
                    // total['qty'+i]  =total['qty'+i] +intVal(api.column(7).data()[i]);
                } else {

                    total[group_assoc] = intVal(api.column(10).data()[i]);
                    // total['qty'+i]  =intVal(api.column(7).data()[i]);
                }

                if (last !== group) {
                    // console.log('last'+last);
                    // console.log('group'+group);
                    console.log('group_assoc' + group_assoc);

                    // console.log('ravi'+i+'tot'+total[group_assoc]);
                    $(rows).eq(i).after(
                        '<tr style="font-family:bold;;font-size: large;" class="group"><td  colspan="9">' + group + '</td><td align="right" class="r' + i + ' "></td></tr>'


                    );

                    last = group;
                }
            });
            var r = 0;
            for (var key in total) {

                $('.r' + r).html(total[key]);
                r++;

            }
        }
    });
});
//#########################################################################
$(document).ready(function () {
    // $('table.display').DataTable();
    var table = $('#outwardprint').DataTable({
        "searching": false,
        "paging": false,
        "info": false,

        "columnDefs": [
            { "visible": false, "targets": 12 }
        ],
        "order": [[12, 'asc']], //grouping
        "displayLength": 25,
        "drawCallback": function (settings) {
            var api = this.api();
            var rows = api.rows({ page: 'all' }).nodes();
            var last = null;

            // Remove the formatting to get integer data for summation
            var intVal = function (i) {
                return typeof i === 'string' ?
                    i.replace(/[\$,]/g, '') * 1 :
                    typeof i === 'number' ?
                        i : 0;
            };

            total = [];
            api.column(12, { page: 'all' }).data().each(function (group, i) {
                //   group_assoc=group.replace(' ',"_");
                group_assoc = group;
                if (typeof total[group_assoc] != 'undefined') {

                    total[group_assoc] = total[group_assoc] + intVal(api.column(11).data()[i]);
                    // total['qty'+i]  =total['qty'+i] +intVal(api.column(7).data()[i]);
                } else {

                    total[group_assoc] = intVal(api.column(11).data()[i]);
                    // total['qty'+i]  =intVal(api.column(7).data()[i]);
                }

                if (last !== group) {
                    // console.log('last'+last);
                    // console.log('group'+group);
                    console.log('group_assoc' + group_assoc);

                    // console.log('ravi'+i+'tot'+total[group_assoc]);
                    $(rows).eq(i).after(
                        '<tr style="font-family:bold;;font-size: large;" class="group"><td  colspan="11">' + group + '</td><td align="right" class="r' + i + ' "></td></tr>'


                    );

                    last = group;
                }
            });
            var r = 0;
            for (var key in total) {

                $('.r' + r).html(total[key]);
                r++;

            }
        }
    });
});
//#########################################################################
$(document).ready(function () {
    $('#searchmenu').on('change', function () {
        var val = this.value;
        var link = '';
        var addresss = $('#query option').filter(function (counter, option) {
            if (option.value.toUpperCase() == val.toUpperCase()) {
                link = $(this).attr('data-address');
            }
        })
        window.location.href = link;
    });

    $('.search-form').on('submit', function (event) {
        event.preventDefault();
    });

    $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
        var title = $(this).text();
        $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
        function resizeInput() {

            var content =
                $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
            var widthTester = $("<span>" + content + "</span>").hide();

            widthTester.insertAfter($(this));

            $(this).css("width", widthTester.width() + "px");

            //Remove the element from the DOM
            widthTester.remove();
        }

        $('.resizing-input').focusout(resizeInput).each(resizeInput);
    });

    // moving tfoot below head th row
    $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');

    $('#product_detail_table2 tfoot th').not('.excludesearch').each(function () {
        var title = $(this).text();
        $(this).html('<input type="text" class="form-control" placeholder="Search ' + title + '" autocomplete="false" />');
    });

    // moving tfoot below head th row
    $('#product_detail_table2 tfoot').insertBefore('#product_detail_table2 thead');

    var table;
    table = jQuery('.product_detail_table').DataTable({
        // "dom": "<'row' <'col-md-12'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "lengthChange": true,
        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        "colReorder": true,
        // "ajax": "",
        "buttons": [
            {
                extend: 'excel',
                className: 'btn-default btn-excel'
            },
            {
                extend: 'pdf',
                className: 'btn-default btn-pdf'
            },
            {
                extend: 'print',
                className: 'btn-default btn-print'
            },
        ],
        "columnDefs": [
            {
                "className": "actioncell",
                "orderable": false,
                "searchable": false,
                "sortable": false,
                "targets": [0]
            }
        ],
        "order": [1, 'asc'],
        initComplete: function () {
            var api = this.api();

            // Apply the search
            api.columns().every(function () {
                var that = this;

                $('input', this.footer()).on('keyup change', function () {
                    if (that.search() !== this.value) {
                        that
                            .column($(this).parent().index() + ':visible')
                            .search(this.value)
                            .draw();
                    }
                });
            });
        }
    });
    if ($('.party_detail_table').length == 1) {
        $.ajax({
            'url': "/party/getpartylist",
            'dataType': 'json',
            'method': 'GET',
            'beforeSend': function () {
                $('.overlaybody').css('display', 'block');
            },
            'success': function (data) {
                var htl = '';
                $(data.data).each(function (x, z) {
                    htl += '<tr>';
                    $.each(z, function (key, value) {
                        if (key == 'Action') {
                            htl += '<td>';
                            htl += z['Action']['edit'] + '_splitit_' + z['Action']['delete'];
                            htl += '</td>';
                        } else if (key == 'check') {
                            htl += '<td>';
                            htl += '<input type="checkbox" value="' + value + '" class="trowcheck">';
                            htl += '</td>';
                        } else {
                            htl += '<td>';
                            htl += value;
                            htl += '</td>';
                        }
                    });

                    htl += '</tr>';
                })
                $('table tbody').html(htl);
                drawpartytable();
                $('.overlaybody').css('display', 'none');
            }
        });
    }

    $('.submitn').click(function (event) {
        event.preventDefault();
        var action = $(this).attr('data-act');
        // alert(action);
        $('#printormessage').val(action);
        $('.submitn').removeClass('activeevent');
        $(this).addClass('activeevent');
    })

    $('.animatescroll').click(function () {
        var href = $(this).attr('href');
        var pos = $(href).offset();
        $("html, body").animate({ scrollTop: pos.top }, 1000);
    })

});
//#########################################################################
var tablename;
function basicdatatable(table) {
    $('.adsearch tbody').off();
    tablename = jQuery(table).DataTable({
        // "dom": "<'row' <'col-md-12'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "lengthChange": true,
        "processing": false,
        "serverSide": false,
        "colReoder": true,
        "buttons": [
            {
                extend: 'excel',
                className: 'btn-default btn-excel',
                exportOptions: {
                    columns: "thead th:not(.noExport)"
                }
            },
            {
                extend: 'pdf',
                className: 'btn-default btn-pdf',
                exportOptions: {
                    modifier: {
                        page: 'current'
                    },
                    columns: "thead th:not(.noExport)"
                },
                orientation: 'landscape',
                customize: function (doc) {
                    // Splice the image in after the header, but before the table
                    doc.content.splice(0, 0, {
                        margin: [0, 0, 0, 12],
                        alignment: 'center',
                        // image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA9lpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wUmlnaHRzPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvcmlnaHRzLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcFJpZ2h0czpNYXJrZWQ9IkZhbHNlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDoxN2FlYzk4Yy0zMjgzLTExZGEtYTIzOC1lM2UyZmFmNmU5NjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QUYzODU5RTYxNDNCMTFFNTlBNjVCOTY4NjAwQzY5QkQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QUYzODU5RTUxNDNCMTFFNTlBNjVCOTY4NjAwQzY5QkQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowODgwMTE3NDA3MjA2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'
                        text: 'Soft Sauda'
                    });
                },
                messageBottom: 'Exported from Soft Sauda'
            },
            {
                extend: 'print',
                className: 'btn-default btn-print',
                exportOptions: {
                    columns: "thead th:not(.noExport)"
                }
            },
        ],
        "order": [],
        "columnDefs": [{
            "targets": [0],
            "orderable": false,
            "searchable": false
        }
        ],
        initComplete: function () {
            var api = this.api();

            // Apply the search
            api.columns().every(function () {
                var that = this;

                $('input', this.footer()).on('keyup change', function () {
                    if (that.search() !== this.value) {
                        that
                            .search(this.value)
                            .draw();
                    }
                });
            });
        }
    })
    $('.adsearch tbody').on('click', 'td.details-control', function () {

        var tr = $(this).closest('tr');
        var row = tablename.row(tr);
        var child = $(this).data('child');
        var pchild = JSON.parse(decodeURI(child));
        if (row.child.isShown()) {
            $(this).find('i').attr('class', 'fa fa-plus-square');
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            $(this).find('i').attr('class', 'fa fa-minus-square');
            row.child(format(pchild)).show();
            tr.addClass('shown');
        }
    });
    function format(d) {
        // `d` is the original data object for the row
        var prepare = '<table class="table table-striped table-bordered">';
        prepare += '<thead><tr>';
        prepare += '<th>Item Name</th><th>OrderPrice</th><th>percartonCBM</th><th>OrderQty</th><th>Discount</th><th>Total amount($)</th><th>QtyBal</th>'
        prepare += '</tr></thead>';
        var row = '';
        $.each(d, function (index, value) {
            if (row != index) {
                prepare += '<tr>';
            }
            prepare += '<td>';
            prepare += value.ItemName;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.OrderPrice;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.PackPerCarten;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Qty;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Discount;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Valuet;
            prepare += '</td>';
            prepare += '<td>';
            prepare += value.QtyBal;
            prepare += '</td>';
            if (row != index) {
                prepare += '</tr>';
            }
        })

        return prepare + '</table>';
    }
    $('.adsearch tbody').on('click', 'td.outward-control', function () {
        var tr = $(this).closest('tr');
        var row = tablename.row(tr);
        var child = $(this).data('child');
        var pchild = JSON.parse(decodeURI(child));
        if (row.child.isShown()) {
            $(this).find('i').attr('class', 'fa fa-plus-square');
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            $(this).find('i').attr('class', 'fa fa-minus-square');
            row.child(formatm(pchild)).show();
            tr.addClass('shown');
        }
    });
    function formatm(d) {
        // `d` is the original data object for the row
        var prepare = '<table class="table table-striped table-bordered">';
        prepare += '<thead><tr>';
        prepare += '<th>Description</th><th>Innerqty</th><th>OrderQty</th><th>Rate</th><th>Discount</th><th>Total amount</th>'
        prepare += '</tr></thead>';
        var row = '';
        $.each(d, function (index, value) {
            if (row != index) {
                prepare += '<tr>';
            }
            prepare += '<td>';
            prepare += value.Description;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.innerqty;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Qty;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Rate;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Discount;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Valuet;
            prepare += '</td>';
            if (row != index) {
                prepare += '</tr>';
            }
        })

        return prepare + '</table>';
    }
    $('.adsearch tbody').on('click', 'td.domestic-control', function () {
        var tr = $(this).closest('tr');
        var row = tablename.row(tr);
        var child = $(this).data('child');
        var pchild = JSON.parse(decodeURI(child));
        if (row.child.isShown()) {
            $(this).find('i').attr('class', 'fa fa-plus-square');
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            $(this).find('i').attr('class', 'fa fa-minus-square');
            row.child(formatn(pchild)).show();
            tr.addClass('shown');
        }
    });
    function formatn(d) {
        // `d` is the original data object for the row
        var prepare = '<table class="table table-striped table-bordered">';
        prepare += '<thead><tr>';
        prepare += '<th>Description</th><th>Innerqty</th><th>OrderQty</th><th>Rate</th><th>Discount</th><th>Total amount</th>'
        prepare += '</tr></thead>';
        var row = '';
        $.each(d, function (index, value) {
            if (row != index) {
                prepare += '<tr>';
            }
            prepare += '<td>';
            prepare += value.Description;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.innerqty;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Qty;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Rate;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Discount;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Valuet;
            prepare += '</td>';
            if (row != index) {
                prepare += '</tr>';
            }
        })

        return prepare + '</table>';
    }
    $('.adsearch tbody').on('click', 'td.delivery-control', function () {
        var tr = $(this).closest('tr');
        var row = tablename.row(tr);
        var child = $(this).data('child');
        var pchild = JSON.parse(decodeURI(child));
        if (row.child.isShown()) {
            $(this).find('i').attr('class', 'fa fa-plus-square');
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            $(this).find('i').attr('class', 'fa fa-minus-square');
            row.child(delveryformat(pchild)).show();
            tr.addClass('shown');
        }
    });
    function delveryformat(d) {
        // `d` is the original data object for the row
        var prepare = '<table class="table table-striped table-bordered">';
        prepare += '<thead><tr>';
        prepare += '<th>Product</th><th>Bag</th><th>Packet</th><th>Weight</th><th>Sauda Rate</th><th>Amount</th>'
        prepare += '</tr></thead>';
        var row = '';
        $.each(d, function (index, value) {
            if (row != index) {
                prepare += '<tr>';
            }
            prepare += '<td>';
            prepare += value.product;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.bag;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.pckt;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.wght;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.sd_rate;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.amount;
            prepare += '</td>';
            if (row != index) {
                prepare += '</tr>';
            }
        })

        return prepare + '</table>';
    }
    $('.adsearch tbody').on('click', 'td.payment-control', function () {
        var tr = $(this).closest('tr');
        var row = tablename.row(tr);
        var child = $(this).data('child');
        var pchild = JSON.parse(decodeURI(child));
        if (row.child.isShown()) {
            $(this).find('i').attr('class', 'fa fa-plus-square');
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            $(this).find('i').attr('class', 'fa fa-minus-square');
            row.child(paymentformat(pchild)).show();
            tr.addClass('shown');
        }
    });
    function paymentformat(d) {
        // `d` is the original data object for the row var obj =  var obj = {"vouc_code":vouc_code,"sd_date":sd_date,"barg_amt":barg_amt,"tot_ammount":tot_ammount,"outs_rec": outs_rec,"dtcton_amt": dtcton_amt,"outs_bal": outs_bal,"rmks": rmks};
        var prepare = '<table class="table table-striped table-bordered">';
        prepare += '<thead><tr>';
        prepare += '<th>Bill No</th>';
        prepare += '<th>Bill Date</th>';
        prepare += '<th>Bargain Amount</th>';
        prepare += '<th>Current Bal</th>';
        prepare += '<th>Rec Amt</th>';
        prepare += '<th>Deduction Amt</th>';
        prepare += '<th>Balance</th>';
        prepare += '<th>Remarks</th>';
        prepare += '</tr></thead>';
        var row = '';
        $.each(d, function (index, value) {
            if (row != index) {
                prepare += '<tr>';
            }
            prepare += '<td>';
            prepare += value.vouc_code;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.sd_date;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.barg_amt;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.tot_ammount;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.outs_rec;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.dtcton_amt;
            prepare += '</td>';
            prepare += '<td>';
            prepare += value.outs_bal;
            prepare += '</td>';
            prepare += '<td>';
            prepare += value.rmks;
            prepare += '</td>';
            if (row != index) {
                prepare += '</tr>';
            }
        })

        return prepare + '</table>';
    }
    $('.adsearch tbody').on('click', 'td.dealdetails-control', function () {
        var tr = $(this).closest('tr');
        var row = tablename.row(tr);
        var child = $(this).data('child');
        var pchild = JSON.parse(decodeURI(child));
        if (row.child.isShown()) {
            $(this).find('i').attr('class', 'fa fa-plus-square');
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            $(this).find('i').attr('class', 'fa fa-minus-square');
            row.child(dealformat(pchild)).show();
            tr.addClass('shown');
        }
    });
    function dealformat(d) {
        // `d` is the original data object for the row
        var prepare = '<table class="table table-striped table-bordered">';
        prepare += '<thead><tr>';
        prepare += '<th>Item Name</th><th>innerqty</th><th>percartonCBM</th><th>OrderQty</th><th>Total cbm(p/i)</th><th>Carton price$</th><th>Total amount($)</th>'
        prepare += '</tr></thead>';
        var row = '';
        $.each(d, function (index, value) {
            if (row != index) {
                prepare += '<tr>';
            }
            prepare += '<td>';
            prepare += value.ItemName;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.OrderPrice;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.PackPerCarten;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Qty;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Discount;
            prepare += '</td>';

            prepare += '<td>';
            prepare += value.Valuet;
            prepare += '</td>';
            if (row != index) {
                prepare += '</tr>';
            }
        })

        return prepare + '</table>';
    }
}
//#########################################################################
function drawpartytable() {
    var partytable = jQuery('.party_detail_table').DataTable({
        // "dom": "<'row' <'col-md-12'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "lengthChange": true,
        "colReoder": true,
        "processing": false,
        "serverSide": false,

        //  "ajax": {
        //      "url" : "/party/getpartylist"
        //  },
        "buttons": [
            {
                extend: 'excel',
                className: 'btn-default btn-excel',
                exportOptions: {
                    columns: "thead th:not(.noExport)"
                }
            },
            {
                extend: 'pdf',
                className: 'btn-default btn-pdf',
                exportOptions: {
                    modifier: {
                        page: 'current'
                    },
                    columns: "thead th:not(.noExport)"
                },
                orientation: 'landscape',
                customize: function (doc) {
                    // Splice the image in after the header, but before the table
                    doc.content.splice(0, 0, {
                        margin: [0, 0, 0, 12],
                        alignment: 'center',
                        // image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA9lpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wUmlnaHRzPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvcmlnaHRzLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcFJpZ2h0czpNYXJrZWQ9IkZhbHNlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDoxN2FlYzk4Yy0zMjgzLTExZGEtYTIzOC1lM2UyZmFmNmU5NjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QUYzODU5RTYxNDNCMTFFNTlBNjVCOTY4NjAwQzY5QkQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QUYzODU5RTUxNDNCMTFFNTlBNjVCOTY4NjAwQzY5QkQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowODgwMTE3NDA3MjA2ODExOTJCMDk2REE0QTA5NjJFNCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjE3YWVjOThjLTMyODMtMTFkYS1hMjM4LWUzZTJmYWY2ZTk2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pu9vBW8AADRxSURBVHja3H0JmFxXdea79y21967uVi+SbLXUkiVZso2NZWJjsyQEAsYZlnHIJCyZJPARMsnnyZedBJjJB5kMA5kQCAkhkECCweAVbxjvtmRsy7YWS+puLb13V3fXvrzl3jnn3HtfVRsbwsQ2JKXncnUtr97731n+s9xTTEpp/bhvQRDU6dZoNHzfD8PIsiS3bc91E8lkOpVKp9Oe5/3Yj9N5+b8SLs/KyurCwvzM7Ozc3Nzi4tLKykqxWKxWa00AK/CjSEgpGAO4uOclUqlkLpvr7u7u798wPDK8aXTT6OjowEC/bdv/YcECOCYnJ48de/b4ieOnT51ZWFhYKxSq1Wqz2QTJiqJImlv8EcYY3HP4HwfgbMdxQL4ymUxvb+/o6MjOnTv37du7e/fugf7+l+cU2EuthuVy5eixo48//vjTTz8zNTm1uLRUKpUAIIWOQiS+vZAkqvv29wN2rutms9mhoaHzz99zxeWX799/aV9f379XsE6fPvPIo488+uiBY8eOgcKBZIE9QknhvB0dif/gJuBmSaH+tFgMC1eb+vP7seModE4mk968edNP/dRP/dyb3nTBBfv+PYEF6Nzz3e8+/PAjJ06cWFpaBssNT4IsxAAJEUVhEEZgniIAx2KObSc4T9g8wbjHLBuQQfRkIIUvREPIBrgBxgSpo8vhPQz31q65gBroaU9Pz6WXvvKd73jHlVe++oVE9ScFrBMnTt5xxx33P/DA8eMn8vk8GCM4OSVK8EVhCOa7AQABLolkbzqzMZMdTqcGvWSv63RxnuEsaUlPWo6UtowYoBXCu8NmGFR8f6XRnGs2zjaap4NwXsiSzUEZk+AzQe5i1Mi+8VwuB1r5nne/+4orLv9JBGtpaem2226/8667jhw+vLS8DOeoYIKXwjBoNmtRGCUS3Z3d53b3jnd0bkmm+l0nyyxXWrYUsMEJcwswklzAY3hGgnDZ8BifxD9pE1YYAb1YqtdPVKtPVOuHgnCac+E4ac7ddhsHqAFkP/3613/wgx8YHx//SQEL1OW+++674ZvfOnjg4PTMTBiGCibYM8hRo1EDk9LTNz4weEFXz9ZksocxOCuAAHC0yR3TRjARKHCv8EL4RMQINZAycy8ZvNmSIH0sjAq12pFS+Z5y9aFQLLgOCFrKQoPX8qoDAwPve997f/W//koikfgxgzU/P3/99V+//Y47gBNUKhWwGkqaQJQa9VoqPbBx5OLBoQuz2QEwNEQDwNa4tIFhctA84WnHMmUECjBCyBihhhgRahY9hnuLHpMAWShQfjBfLH93tXBj0z8GRg0ErV3K4LZ///4P//Ef7d17/o8NrAMHDv7TV77y4IMPzc7Okgl34Nh9H1AqpzKDm865YuPwhclkN7kzm4NhZmCbNVIIE22kX0rX4GBskiAEKIL7iGAipERkCS1fVgsvqf0iw8vgRqJUKt+7vPqP9cYzjpMCixbDBZYP2Nnv/Pfr3vOed7/cYIGufevGG//lX772xBNPAm8CygM2AnxctVKwndyWrVeNbN6fSnXB/gEjsME2JxfGQawcpgTKUmqoZIop7SPhYoQRjwCaEEUpUlIWWZGSL0BNGsiIdRidExgkcU+Iylrx1sXlLwThGdfNwdcZpoEE5dprr/0fH/soMNuXCaxyufylL335W9+6EdgmxHGKEzQa1Ua9MTRy8diON+Q6NiJtdFzH9lCgtEw5pIO0WVxqvNB4kUyxNqSMNOE9jyIjWfoZS90b4UKnaVlazECGKK5MhMHCwvLf5le/xmzh2Bl6CW9gRF/1qld95jP/d3Rk5CUHa3l5+W8+//lbb7ltcmpKMWnYQ6W85npdO3ZfMzRyAYkS2K6E7STwMXcRTe5wy1b6iJ5ewYRIkcEGmbKMCQdE8PwJmpArgBCvkCnUSNAsBRnhBfcx2ZIkX7BFeGzcKVUemp7/RL1x3PM6yPDjDQL2bdvGvvB3f7t7966XEKy5ufnPfOYz3779jrNnzypbDrSgUi70b9y36/y3ZTr6OaDiJkCgbMdD7bPhPbDZSH6YTQaeW0THcZO0WZxsUMvrtdkpZsSKR6H+Ex8oKNWnyH4p2SLhEjFkjIWglWG0Mj3/yfzqDa6bIkcslXwNDgz8w5e+ePErXvGSgAWO79Of/stv3347xC7KSPnNeq1W27bzjWM7fsZxkxSuJQAjCHgBI0JKMVJO1ooBTPAf3iFGjOy6pYRLmSEES2qbJSKDl0CAgMkKgxdIXGREjNQQwdGSpWw+IAVPwc6skGgqW8p/dWb+kyBxyuqTv252d3d/9Sv/ePHFF7/IYIH2/Z9PffqWW26dm1NI8Xq9HAZyz4W/MLL5UkAEYEKZUqqHGxBsTlFdHNmpO9zUV5NkwT9FnUi5SLikQkoiQDLSuGikDEyxrBFYTAuXUOeyTr4sFgJGcGCF0n2nzvxxJFZtY8JAvsBF3vCNr+/Zs/tFAwss+qc+9Zc3fPOb09PTCqlarSSld+Er3zuwcTeg4bgp1006jova56Ah55hV4QocRsGOgogBHJaijZY2ItJYd8kMBeWKZ5HL40olI7JfSg1JyhA1SaihVmoXIYl8aZ0E/2xMPmwQeCVqtWdOnvkdP5hx7Cy9gVWr1c2bNt18y02bRkdfBLCAJXz2s5/7p698dWJy0kUgECnLSl582a/19W8DSFxPIeWBuVKqB7pnKbEinYtTLQojrSp4egqyyOYCNxvuLU7vAZIVBjzw7abv+L4X+G4YOhQVWcqEhaGGTyksokae0ewTZYwpy7UOL7fenDh56rqGf1q5SDhCoD6XXHLxjd/6Zjab/beCdf313/js5z53+PBhjje7US9H0r3ksvf3DWyHPz0vjQroKIvucKIRKFOkcpx0Dq82U9YXtYIeRJ7TSCf9jozI5Xg246ZTrge2ToeTeFSRkEEQNRpRtRoVi3J11V5Z8QqFTL2eFBHwfmQPIWqirTymjJgyecZyaeZloSgDZBovbjuN5sSJqd9u+jO2nVZ4ra2tvetdv/D5v/ncvwmsgwcPfvwTf/7II49CAAhmCCx60w8vedX7BzbuQaQSKbDrLrAE2wFWRSJFGQZusiPMUhaKiCOYc+E69c5Mra/H2tCb6urMpNJpAFoZNeX+NQnQd5pOAt0Ft1urNVdXfQgWTp9OLS1mm80ks5Rn1MKl7BfptdZEVHutlQAcGi+LBUApqvUjx6d+K4rWONcBY6FQ+F9//okPfOD9/59gLSwsfvRjH/v2t28HxQaigCyhUrrwkvduOucyDF4SSqYS4APh6zlFz2jOufJ5xiThKQNpECm30tdTGx5M9m/oymRzoBFwCpiz0hi1Z/TwodA5QdAokx+0yCGIsFZvzM02jx3zpqY669UUfB28GSAj50DuQhkuy8gXW48X6WOx/ODJU79DjMxR1gbuv33bLRdddNGPDBacBri/L3/5yzMzs64LMbAsFpbHd7115563kEylwVSR9gFNJzKl01YoVaR+lrLqcOWTbnWgt7p5ND3QvyGVyhBRiNSJGCZpApc2wGKklJsj+ZKaiCJhk2HYnJtrHHoyceLZbrBrmOZANeSWUOelz6+N3MPhKGUEXAKHu4v5fzk983GVqIBbpVI5f8+eO++8PZVKPS8m9p/8yZ887wvf/e53v/gPX5qYmHDQqLNyeW1g6IK9F/5nsE1uIuWBRXeRTznAEhyFFMkUck/1CPUOSGt/9+p529h546P9GwZADBUS5CQVtkYGdQ617Zk2LdZPoWAxLXeIiN3Rkdi6NeofKBcKsriWUEJtqSuldtX6gx61BAOugZ/N7gqDfKX6FGVELM8DUZ2C03n1FVf8CJKVz+f/6I8+DPwTmAioF8R9jGcuf8112dwAqB6A5ToIFogV6CMjpGzeVnRAI85TXmnzxurY1oHu7g1kXISJN8xRm7wTY9KUcozGoUCRKEVS1X1QK4UkdTMSh6/imyHiqlabBx91Hn+sJ4ocNIBER5gVO5ZYgnUwpIQLDyoqHZ/6jVr9BOdJSk5gaHn33Xft2b37XytZX/3qP994081ARB3XhSOqVav7Lv6lDQPjgDoqIBEFRArMlEkbc25oJ7m7ruzKrm1i5/g5uVy3Tl2qkhbXgCI7A02gWAiOsFaPCqVgZS3Ir/pwXyyHtVoUhAJO3HU5CDfnJp6RWt6kEjU8Q9iVc845orevPDPj1utwYNKKE/Ca6sVP6MtJ/49sJ51Kjq4W7iEQ8fiq1cr02Zl3vvMd/6q64cmTE7ffcQcwdVRAy6pUCiOb94+MXgQyrmAiSuWQ79OGinMl8RTEWGKgO79rPDs8NAqvCCyX6kqNqQZaDtAqIQvlcGGpAdta0a/WQt+H64wWnwI9oeD1PDuXcXq7vYF+r6/HSXgcEAwDtUNpaRRQAEPpbB9nnV1rt90iFheycJVbWqw4HmXoCWVOYgaIOkL4uewrBvvfNr/0ZWahqcpmO+64887bbvv2G9/4sz9cDf/3Jz/5hS98cWlpCci6j/UF+9Wv/91c50ZAClmVRx4QGBHmEmySqVbtD+jkxp7lPef19g8MKUkw11T/H0QJQDk7V588U13MNxpNtPS4B0vzBUqBCm3dBepgRBwKzg1QGx1KnLPF6+6CWEf6Ab2R3kZJCPw4MNtiKbz1ps6Zs1nPE5TbkFQtYbEuEs1XmYlQWgFQsFCsTZz6ULV2RkkPBLz79u29+647QVx+kBoeO/bs3/3d34Nd5xT6VsqFHbvePLTpIiAHxNQTJFkkVrZCSisgISU39ub37t7Q3z+k6DozhgzgAG2C/U+eqT3y+NqzE5VSJeQkYo5tEZGNjbjRFxYrr6ToyWo0xdx8ODEVlkqys4NnMpgRNPaaKbYLzyST/Jxz6/NzdrEARytbfsPSRoy+w9ImEu8gugYqkyxXH8T6CCq+Ozk5tXv37p07d7SDw58jVnfccefkxARVq1izUcvmhraMXQ57xiDZpQgZUy6cazul0i36QPu78nt29vRt2Iiq13JIiCZoE1iiu+/PP3hgpVD0PZclXCWSClQjm1yfBmGn3qB2goEeWCIP3Wn07PHmTbfWDz0VwNvIVDBFPnFvHEyYlcnYb3pzsW9DA8gT0yQrdrn60Ag3uF6YvLVk0NVxVWfHBeC+FQ6A11995q8FOd3nB+vMmbMPPfTQ6toa9VzIRrO+dfy1qVSXynlidRMkwdaypLQPjxAdmN2ZWQM7BdqHbMegBAcE8geCeORE+c77lhaWG16CKcauUICd2G2yiRfA1gEAM2YQTohz4uK0weNEUoaReOSAf/sdQbksPc8YcE0/MAzq6GQ/87OFVBqsoEp+6DjeiJcizpwpvOA4Wbqv++c9UwFKp9MHDhx44IEHXhCs+++/f2JyArgsyE2z2chkB0c2vQL2TOkEh2TK5lyTKm2K0EnxpFceP9faODRianaaNgFM8OfDj68dPFSAl1yPsbbz4sZPWa0/LSWp2mvoLGG8Twn0jRkpSyblzEx0083h7KxIJCRrUTLcZxDwwSFx+ZUFEWc52HrXqPeutMOBSDSTvqQjuxusnirWglj9/d9/8fnBgpjmoYcfXllZ1bWsRm3zOZel0l0Y92EeXWsf047PilNTnAXApzZv3sQUwzEaaDvACeT9B1ZOTFU8VawwYQhr34M2bMaOmOc57YorleStrAs4WHyeCxSxlKzV5W3fFpOTFuBlKUCJtcGbfZ/tPK9x3u5y4GsJNdeqJV/mK0mmeaar42cSCV2szWazd3/nnpmZmecB6+mnnwHrDv5JJYtdL4dihQUutFOofoqaG+attB6IZm9HYevWAQiqFb9UhwPKBX89+Njqmdm65+nsA5w2XAgtLkyaZBdqGSGyXur4OsahPqJcm0lUoVNzXTQsd91lTU1ZCa8VkCotloLv31/u7vExwGZxgKWPPvY+qjggrTCTuiSb2WI7FNDaNpDzm2++5XnAAhVdXFxUh9ps1voHz8t1DOhGDMOqDKlUVwMVMOHUzt3sdnX2wiG3zCcgYrODTxUAqQQiJVmbirVtzHipFhXjrHVMLUGjfco4fwDyRSrJCT5weSDCd93J5+el28KL/FzEsrnoootL2lKv+3ZL9+q0KgPSsXtz2VfCMSsNSCS8m26++blglUqlQ089BZGkKrsDORwGFmpTHl2l0nXrT9z8o3CRg72V4aFBy2RzybwgSzg+UTkxVU14dP50IOakKRGviju0h3XgM7mOc3PLgEnHuu5UpRFPwsuVzSb7zt1OvSYwpRbTdPBzAd8+Xh8aaooI5F3G8ZjpaorpBKdqpkwnL0mnOtXbUqn0k08eOnXq1DqwTpw4AU8FQQCfDkM/me7t3TBGvkwhZVttehJf+KRb3TScTiYzQLoVJZVIO1l+xT90pOg6yjoLY6ekEX+pDRGKhja9baTBxEOW9X05KZVmp3oOaCKL6B6+GjirBH1cztsPPgCXO2K8JZtgrF3X2ntB2QQQ0moFQjpYj78bdu4652Yy5wIjoUyAXSgU7rvv/nVgPfPMkeXlvPICgd/o7RtLp7vJoCsPaLJ6+qvwbIAx93XV+/v7ZJxfp6sDAv/k4aIfCJXybJltI1vciIzOKjBdEWNtMbYOZeiNVhzX6V42LYA6ga85FIpYwhPPHktMTABwMrYJ8C8I2aYtjQ0DPmglWxccGuOljD2hwVk2ldyTTDqK8IMZuvfee1tgwWkfO3YMvKHyg8BMNgzsYLreR3le1v7VFDjA5bIbQ4PYHytU2phYAxi3MzP1+cUGyJdlyLP5VIudG9lXUqNIZXwGTGGnX1KWShFOdcSsZbniQo62/aRljx306o2QTsVUE6XluWL7eJXMvHGslmylbFjMOvBjnrszlcqo55LJJGhio9HQYK2urigdBFwglgXi3927meifw3XBvS3406olc5nahr5O83VSUQCI+46dLHNTRTXmxYqxttZ5OBk7OtmyuCoh2mIZdCSknpbykJau3OjcC+mm0PlW2xFLS96J45YWLkNMwohv2lLPZCIVGOmviK8cfQ/XTkg4fFMq2Q+2TyW5ZmZnIPrRWYfZ2dmFxUXVfgakIZ3pzWT6yKlx4/14nJxTmsJZONAn0+ksHCQcDnWxgMTyucXmaiEAjq5DLzwwIVvpEe0GWnG8FSd/mTAxniTvSaYfQ2WQ9CgQAWxhFAUyCEUUYhI5DOzQt+neCfwoDBwIiCPhhr714P32pk01iGRVvEIXS3Z0BIMbG6emMhAdUzrMXJOYB+G7yPCyrkRyFALERgP0llertSNHjuzadR6Cdfbs2WKxqEgSfGfHho2elyb6YZsgLZaGVoY8lcqBswypY5ZR9gKOrKvDyWScejOyudWuWi0R0n+sy5MzEwjDvxBcMSZhhB9EgE6ImxDwDGIGL1EukPq2BD62wgikBl6Fx4CmhHeKKJqe9iZOFsd32CDp0qTzPS/KdZbz+VQqBWzDAjIFMTy345KKFedwGbzX2ZRIOPW6UmcLwLKst+PD6ZnZer2uwIDjyXUOKb5OZfe4/qA8uzEolj09z5X3jH1LJKxcxtm6OQ2nFNt0DZX+rLVOwKSWvkha4BDqtaBU9otlH+7LtaDRDEGaCBop9ZdaZi+SxUZHCpNit1QsDZdYSufEcQ/TL1odEK0oZP39dVCgQkGs5KPlxWh5KVpbFdWqCEPJDNtWh+3YQ2CtlENxHOfkyZPaZi3ML6jTJrW3srmBlrK3bLsSV31cYPqXV625xToEf6Z0hfdwkQGsbNoWQmp7EtvTuEmK6WorvBlksFINiqVmpdKsNVCUUAyM5YptsJSqmUHGiedWDcIylTZF08i3gsGanU2WSwFv1XgxG9HZFXR1B2jGKe8aBLJaEYDX8pJYXg6LReE3cYdAx2zel0hkFNau60LQg0wCYAJSD8GzSiKCUQfSoA41tlYmhGh5XDpYPnm6iR/UdVM83kjITMbeMpoKIkGF+rgVSMYGFeSuXo/KFb9Y8au1ABOk6kxNwcdUwVqtahoOKu+oLJ8wfUbPWZOhBBrC7EolubwsuB37OzyCREL09ARCmKSWCr9oVUvgy3JJ5JfDxaVgdc1vNnOel1VYAzfPr6wUSyVeq9XAYClDiJVUJ5FI5GjvcW9QW5ig4zPEARR+acVaWKqh14h9NEq7HNuSTiV4JGIZILkSVrMpShWQI8IoIMphCsiaAkiDDFXgRQyIgkmvLSCkcI0BIdaCrT1tBXLkLC0xqqoa/oKJfwlxopQmNLRMDcgEvZjeCWSpHK7kIRzOwqlhQYTbENsU1tYQrGqtqugovuAkHDclZWsNBGu5cUN/WWzl+cTpBrioWCqwTSESuay7eSQFRlq9F+sRNdQ1kCbfjzSJNTKn9VXVc3RdR1jtcmMwMz1rCjWrrXxtSU1spU7FINvga6sOeARd3NAqzMAnqtxWG2+PIweVYsOoSEqX84xtc7UcAXgWiBSv0cI107ohVJKPtVL9rfRifIjaAKFuWwt5ubRcQ/bQKr6jYxrbkoFwtOkLVLdSs9pAnxabF9UhFBe82pDRKLXERZgamDCSJto/EUOmYVK8jnKKslq1A0yVUlOT9gZAdyKkOogKxuFcJRRZnFxsJdw5T9oIm17kVyqVOWin7wda77EGB4jaUlGTdtYWN1vEHJQuYRTyiVMN8O3tVWUAqzNn9/W4K2uNho+CwmLHZbUh0q5byuuJuGSo9U2t6YlfEgoyoUsVcVup4cZauzAmti3fd1C6W5ESvtlLRHB+rQQNb2UF1p0xAGh5ZLN0IhAIAw9xwUfUcudIPFr9ZhpC0aKQOjBT7WeY7WJzSzKfr3FuTI0AAhk1m9H2c9IQ9GjzYmwMgIK4RKIlJSRoRoyIgyoo9Ge0TIkYtZbqWaaTLY5YdQEF4zTMSTE4tXYGTDwAi7Kcq2w1cmkKDyR9UOrMmg5pnbhhChdAQITzHHfSngySsRDFLlowXdPV8Ri+FEb25OkGVYphjyGtRAV+KPp6vM3DKU0LjR8T6wVIKZyBpR0UJV1R6zVj0YUxBaoHVcXgsWTAaYNMgX2wiVC3+kws+dwzJNWjBLbUkZyiKCa9wXh7ioXCUtWY3Sqrm5YNkyBhOufW7vwxhmH6iKkkMbMgF5crId6iliwIsWs7OBSK3ITmBKYqr4VI26yohYb+bBSpZyP610JK3wNHQb8RqTZv1fJstVLUHKk5EEvJDKeLV1ugJCqDxbVkmfB13WnDGzkTsoUvc12He55r26afCpQzwnihLRSRravSKrQx06OPz4JdWF6Jnj5aBqANrJKkTPT3eaNDSSVcUdSuWKSPhAk9r57Rd5GyYOqmnozMC6q/Qfed6iU+tAyItApbzTlKlgMPmJcIua1rq7EEAPumsq5KZFOigtOf2gmIuN+G8ZCK48o6sWQqxSFSAoZqsh88ivxI+Po6qH+KL0iSJkHNn6plFhtleK0qikWIX9npabmyUudtawCVGIFwEeshnYti2y1iY61j5RioiESJ7iP1QLSrqVI9WhIlzGoxygur7hSAyaHeCNhSKd9xuGwJC55Ko2FTjoBx7TQZj9OnrTQ9PAPsP4AvV70bEPHksjmeTmeSyVS8JjmKICRrtARS6hioFb1gzxVmisPAKhTDSjWivAOr1Z1nT9YwuDSqBv8FvhjsTwwPoHBp7TSSEwNB/4+M1AiDVBRFBiDlDVTaitboQAQCPAg2y3Kwqk3LN4Bnuy52mrguU1s223RoTUN7FaNadWLiji2stlRgPacOYtsQ/zXhGJTLAqbe1dXpZLOZXDarGCmAHAVNv1khNy+0ZSYzScUaZQoR1Fo9qtSw34dhCkx5E3vyjNi5vd7ZmYnZNLJcyXeNZ8/M1ISxzHFLgyXbpdAy4tZum0S8Mpqjm4YQ2ZXMjaSHyUfu4pIw7NvDvBuu/nWwV4wWM2BnW2dn07ZTEG62IkkJMY2rPIDyesquCyG1Spg4wnYaUtaBHJIARd1dnd1d3bievaenW0fR2LAU1msFzRfUimV9ciZ+F6xcDesNQdlhUgqVAgISWHOPTzReeVFSCa9CFizX8GByaCA5M193bCsOuVUuQdNPS9P0dnqqIm50QVxl/RwUKOFGIeDlAFhomQAp7qC1wuomaZ9LQKCkVDs6gZHaSiYVsQ8DXiwC66bKkDJbKjGDkYc0SVR0665bDQWmKODEwG319PZ2dHYgnR8cHFRFHRVLV6vLxnVp8qPDCjQ9cq0Q1GqYR6YVNpx6Hrmg5adweSdOsWKxQVk7/SH4NMj87vEOrtYY4gJDtbLJiiM74z9lzD+VxnFc9+Nh946bcZ2MzTOWTFsyZcmkZXmwceaohnviCpLbcJUo34N1z+VcjouYquDqFFGt8lLJwYoGFtMEY60qpGk5p4KIJRLJst+sksQxYFgjw8NYjwCwRkdHgUDAU5hJ4LxcmgezgaKizgAZP/obvynLZSSwgIoQtKhEaiKsVpfA+ZXLiROT/iv2JUOp+5lw1YovR4YSQwPZ5XxgO0TgVZRsRZpPtTXhkvjqFfe0dBNNuIicKLJDn4NDB3uCzRwWFqZVDMsJKWCbqiVCksHr7FxJpztE1Ao4bUes5NONOnc9oXiDAsvYB2Eqkril0oXlfC2Odca2jem08jnnnJNMJilCxHCnUpoP/DpPOqLtNOqNqFKh9AHjqpwqTLOYNHG7Sh+fmLC3b22m00m0ZQQo3Hse27ktk1/xadWBSqWrAoxs1X7ayi2q6ZgWVrAQNtDIsFUYZaapA3fCBQiUjTIlkJ9EIaYeWaO/37ftJEakcbxtydmZFF0/RbIka6VI4/ZJDC/AtCe81XK5pkpqgPTuXbtisLZ0dXdBVK1Wo9ZqK7B5iayKTWAvtVpQqaq1AHbcEsZM3MNM7lL507WCd2KiccH5Xhi1mhObTWtokHVk7NWCpIZei7XXODXqOoJRa3vN4hOLFlOg84WgmLLvqjVQUvZN2Fi5iDDxbGH6GR1p6PRvWOzrS+vcFxkE+CKI7WZnk44rKKyxVI8J6byS7gglXYbwwPUqjOerVWBCIBkinUrtphZTR9msTaObzpw+QzsFe1YprJ3t6t6suGGl4sPXcNuD66FoV5wwlazVSxtHAeA5jx23t53bBHdLwkVMTWBj0Ni5/L6HBDxoTU+RJgIVFHXq9YMGqQjRweY/YOr0QJ05LY9DmaJ1E6GAMwyBE4Vk82zO/ZGRSjo1SkNJtFg5jjh7Nl0qeYkE6KO0FVgIs5YsGReKpMhkio1mvtEIqJuoOTQ0NDa2TaeVwWDt3r1LrUZSRii/fAJ5vIzK5UahWDchnWGq6vpb8aJ4jP4p+EDFgTfkV5InJwMkFSqkoftmU24esToyvF7jfhO3ZoO2OoOt0eCNGgODUq+xWg3v6/AkvdRsML+JKeBI90LSihweOTZsIbWfBUDpUDTQadj9fYvDwzmagBDbQQRsaiIH9MNxsP/NdnTwaOg3iqclYVcgWWGuY6lQWFHdG7Vabe++fel0qlWRvuTii0EQlD45jre2Muk3SyVAqlDTqYE4plM96Dq7q1o6TegvtOKAcB055lSrPrVNEF6RBPPheXL7mAUQBE04f+Y3WLNJG0KmsGP4ALGDV8GlgCdSqmep6BJbJm3peiCnwksI1Ckb5YtyUvAvkU7Xto41M5meyMiM6v1eWUnMz2dSSfys46rcg5J6Za2UE0Q15HY9lZ5bWSmoknMQ+FdddeW68v2FF14wMDCgs162W6/nZ6aPAwlAW0DRog7XVC7KUpZfaQ19j04qWAo7OIalpeTklBauOI8AwrX1HJHLoBwFPmyAmpYyeIzw0QMI38KAkamiReRCpz5QLlyACTc4Z9uOgAQQQZIU63hAtTZvnhsa6lfLw0zGDx37ieNdAFoiaRG5R/nivG39AFqBiEoIIpsrhNF8sYj1eVDkXC531VVXrQOrv79/7969ijGrVoPZmSejKIhEIKgUR6u0ItnSQyXaOhjSi2Y0Xkox7cNHvUbdp74fvYFwwbXdsT0CCUIfF9JKOAVNjA7psvKGKjdnE0ZuArsjk0npJQksF0wPRS3gdCBys5OcpQcGzo6NZVw3EwkRF5bAWuWXk2fPZpNpgdZK+U1LV28xqpJk11EB8WR7eufz+fkgCNVqxL3nn79927bn9me9/nWvjTuZHTtRLZ9s1lfUhB2FF00hUqGwqTFIqadSaO6k1mWRcHE5v5CaOh0iJxNx7GQ1fTm+PcxlLSBN8apevfTNNIgY6oTXH6QAHAJYCNrwsecSTbctVdPHiNBJWSzX1TUzPh52dvRjQBeXGTG6sA4/02NhjgVXNWLvjVR+E5h5QBtWugVOCAJmU05npufmlpQO1mrVq69+y/M0s1155atHRoZNJGaHYamwdoQC3QD3hb5GR7SxkZct4it11lhI7VoQAvuZI16zGVgmcQ63MJSZtNi5AwuVyveZFRM6yYsYIcO0XI2U5SXoHjYVIXtMtbjiCn8v6XkZxjo6cjM7dqz19w8TCbXiBD0Ytamp3Px8KpGIXYEfRD5gFPhwDIhXFPqYa4ma8FR3z2K1erZYrFD7Y9jV1XXNNdc8D1h9fX1XXXllPAMM4oy1lSf9Zjmi3cXKSJtuw7BatT7W6kc3tWEwq2BTz5wFk2niPoLMDySAlctS5K5zu5bKlmCIiwKFCRbXQEP3HDMKHq7WA4xwIZrjgUAxlgnDdCY9Nb59aWhoE7maVlUMDqBYcJ9+utv14BhwfUAk/DDCKXBBgBvJFKZ14flINEGSNmyYPnNmWvnBUrH4mquu2rJly/N3K7/97W+PR2mAmW/WF4pKuCISLqWMcVpYyVKrJhwnCOPuIDh05/DRBAZSVpxvB8slO3LhjvFmFLX1kKqcid4YJQ9Aggg1fAwhIuobxP2uC4Y8afOUiLJhaHd3PbNz58rQ8CZaTW1oAPlNoBqPHewBr2LbcLEx9RQETVI+QCoksaI/QAGlT9FyPohOzc/nbQzKJIQCv/Ir73vB1u6LLrpw//5L4WN6fJdtryw/6vvlMIR9+YLwokwlypclTE5iXTbWtAGpMroj5uYyMzOgAnFEi5gBejt3NjIZYVmmcEDxh36gsgK2fknV9dTSRfAAgQ9c3C6X3SBYGuh/ZOfOoL9/hFheKzONSWEePf69zvkFkMF6FAFMjQDVDdtMAurJoUpNSPPMcKSZxWpDw9NTU5PU2c7K5fJFF130ute97getsHjfe98TZ+VBExv1ubWVQyRczTDSeJm61boyy7oFQcz0aGCY6hw7lgRd1pbECFdXZ7htrAnWHUHB3gLya7ay3EzZb3pJL04CpMBdNht2pQJHVctln9wxfvi8nT0dHf2hkvhWLR9Mnjj8TMfERCaRDC3MQ4Q0nhLrEzglIlIxk9BWxUIZGxjIB+Hk9PSCGlJZrVZ+44MffM7AyueC9ZrXvAaEq9n0Y2VcWXqw0VhGyxU1SRkDbbx0SKXSGrGlb1+phqcJPmh2LjO/EFKZt3VKYQSWqwZMgiQYIDMVKoOU2g9hBKGlXau6lbLtN4u57NPbtz+2b5+/afNmx8mgGom4OwIvEhj1Y0c7jh7tSqeFq/0mpwEKNKWLJiCY6xYRXfAdtzI8cubYseMgbph3KZcuuGDf29/+th+yhA7e+qEP/cZDDz1s/nSCYG154YHhTVdbQYNmFFFOynThx+1tuolIyucWnLCl03v2eHJwoEmJYGkmIFidXeH4eAXkTgjP9BeaRIWl5jSoOAH0opxKrnZ15fv767296UxmBI4cTXOcNiMJx7S6LY8c7jpytCuRjLgphWHZWGDWispCpqImSQdlEyzM1rH51dVngTGA98DROpXK7/3u737/GNnnX8n6S7/87ptuujmdTitXB5H86JZrO7t34zJWL4OjqXiSc8y9WTjry7bMyCLMP1umMGXFjbWYQfvp1y319yfCsPV1HCu94dx8eXUVbASEDV4QODglhAQE/JfrNBPJRjbT6OiIOnIugOQ4aUrdRHG+2ZQGpWODLlqHDvWeOpVLYNmZ8i3aOyLpBS8c+IK640LFFYSoB0Et17G8deyJe+75TrVaAwFcXVl51WX777rrzu+fr/j8Q11///d+795774OA26YICpR9cf6OZGqIsR49J0x19nGzyiPu8tNXmenCkKkUBH4ChKuvD4TLMc3NFvZ3MntkpGt4GKlvEDaQIUZqdaal61o41gaYlEN0F05VtK03j9tOgdBHxaL35BP9EMOn0iG1gyLguHglUkE+9sWZQlJIqRh0kdyujm07e+TIU6VSBTxtSJWyP/uz//m8kyiff9kvcC7w93fddbfqfoPDDv1iGNYy2W2m00SvhIllx4ClMi3MjMRSI4jwbcWiM7SxnE7ZMeNXgSaxXYarPzhQAyCZKbU5bpLbCVyChCZZFaefgxJdbQe7GU6d6vze9wZrtUQqJRzbtI5jHgWnsEA0TukwDEfQA+pxnihW27ZPl8uPHzp0FBdRMr6wMP+bH/rQC01ve8FRBY1G441v+rknnngyk0mbSXDN/sE39PVf7rg4tdex07adgECfMY9ZDgORMfpIY9bowurmPTxoP+Dn7Vx81WVNHJSiVafVJBeff7tuyfgZ8wEts4QDRXkyn089+2zf8nLG8wRE11hh5rofCtAh1Yt8nygoMisgpU0RNYSoNv3a0ND8wMChu+6+FxwaKGCxUNiyZdMjDz8MwfOPPATj0KGnfvaNbwI2omJG4i9s48jbOrv3uHjL2DbO1eMAFvPIeOF8UVUfxkKxRZPW9EQx7C92Xf/Nb5rt7vZoEm5bs1+rsyLuDzWltPbhD/Q08gwMCazV1dTERNfcHE4RSySEqtmoJQgRIoUWCjYfYSL9VkiJuhA136+CuxgfP37f/d9ZXl6Fk6GmouKdd95xxeUvONr0Bec6qAwqYHzLLbcYZcQWo1plKpkacZxOSlcahxinh/VgLHUZzBAjoRuUm02w4lZnp0gmBaiPAkO0UnQtUYpb46QpjlJJAnPtYEjn5rJPP73hyNENxUISc1uuMK0vuvUQBMoHmJrC90OMbDBiA4qhkQqCajq9tmvXqcefeGhmZkEV5BcX5j7ykT/9xXf94r9pcM+v//oHvvTlL3d3d5tOvcDxuodG3pHJbgJ9xAoVOkdQxgRNwdTypUQM9VGNeJJ6SFYQcIiT+/r84eHG4ECjszMAH2/zlvxI2erZUe07ACZ8qlp1VteSiwvp5eV0reYCXwW9s22dwyPOQSwDc/bYGY4cnaK/EO0U2nK0U4BUWE0kCnv3njl69MEjR04AUsCW5ufnrr76Ld/4+td/8IThHw5WtVq9+uprDhw82NHRYdQi8BJ9g0P/KZMdhcjfdcF4pTiRCYblPBdcnqWqWGpApORxhxBNQYTzQSYN55lJRbmOoLMjyObCVCry3Ai1iSkuajeavF51yxXYvFoNGJ9NC9MxitLlGV1P1RwTiC5EChj6hTqaCUNlzkmmsMJMSJ0/fXLi0UNPHXWpeL2Sz28f3/bde+7p6el5EYaNTU/PvOnn3nzmzJlsNmveHyYSvRsGr85kz8HIlvBC8gXGC+29SwNIzVxbGq5paqtcmkFXYM70mEg1z661CFHGky7QE3PM86myoCq76+4ErvVcTTQAI4WrDULFpCgIpHQCIiXrUirtA6TmTpw88NRTR226FYuFzo4OIFnbt29/0cbYHT58+K1v/fmV1VVgqiabGiUSXb0b3pDJ7VB4OYQX+EfOtD5a5CLXqaRylPHoOkM4Wk10jLVXBmPZURG1Cq310BTsJRDEobDNJKQEuGpkhEeR9GniNzC7umXV/KDW3bW6Y+fskSMHDh8+4dBcCghrgLDcduutl1566Ys8IPHgwcfe8c53FoulGC9cpZxId3ZfkcldQEX2pO2k0T9qPuFazGVqbrKl8dL3huVLXaTV/YWtOT087ns0qDHJ2hqlsedeZ6uRbeKqHXPTiQTknA1pNVCmwsrw8Oqm0bPfe+zRyakzyk4BUrCzG274BoTDL8nozYMHD1577bvyKyuxPsJ1Tia8TG5POrc/keimKRkpUkmc7M41ZA61deiptwQWbw+G4tEwpk+KStxW7GZ1oya19qjFA7jyALl4KDRe9EhRcwEyJZuWbEqrHkU1xsvbxlZSqcmHHz6wtJRXSIH2gW/62teuf+1rX/OvP/0feajr008//Qvv+i+nT5/u7OyMP5tM2tnsaCqzP5Hc4npJmp6NG5ZmLc9Mnka8WBxImkkBrLVCMu74b/9NBtMrT9UQPfeImraI1qskFlYcCKlAWj7AZDEQqAaEHJ0da2PblvP5IwcPHqrXGw5NAFrN53t7e66//mv79+9/yccFg6X/5Xe/99FHH43dB+wkkXCy2Y5UerebON9L9LgOjaxBlUzS8GmPmtBoYrCRMlpvbYYrtBYjMNNqr1IOTMh44Ixs61fVbakqJ2UhTIFl+Yw1IPoIo4ZtVzaNrnR1Tj/9zKGTJ0/Fw3oXFxf27N79z//81R07drxMg6jL5fJv/rff+spXvgp8AgRbpajAWGYziUx2CPBy3HNdNweGX5kw1Eeu8HINWK1chQJLmj7alrvUjfJWnJKWps5rMKIaMq7+AqSaABNadKu6oa8wNLScXz7+5KHDxWJZjaAFjr68tHjNNW/9/Oc/39vb+3KPOP/0p//yIx/9mO/7QPTjtBKIWEdHLp0Zte2d3AEiliUR81pWnww/DsC3aBK8smLaV2ovGY+WjhdixC1jVA3FihZDUQo5B6TQSAFLYKza1VkaHFxuNE4fOXx0emYeMFKxWqlYDMPgD/7g9//wD//wxzY8/8CBA7/929d97/HHu7q6VOZM9WSlUx4YtWR6mNtbLTZi250EmRsTV8MtzO8ttHMLs2hCrkvHqAnAEY1yikiUcBPo9XxQuu7uUl/vSrMxfeLkyTNnZoGOqgF88GB5aWnXrvM+/elPxbXlH9vPMtRqtY9//BN/9Zm/rtfroJWqiVBDlk50duYymQHbGZFshLFezjOIGloxR1kxIhYOShbSCwXW+gC71ZGgxxvielVKB4OFSqUqXZ2FVCpfKs1MTZ2enV1s/12ItbU18CC/9mu/+uEPfxgu3k/KD348+eSTf/qnH73zrrswHZHJqCZVajO0Egm3oyOTy3WnUhtsZ1BaGyzWzVmWI4M1c+LVDAqmmtrbMjZW24IorIeDkQI5qicS1XSq5CXW/ObS4uLc9PTc6mqR7Kb+lZFSqVSrVa668sqPfOQjl1122U/KD36032688aa/+Iu/OPjY99TvVMVSpkZLppJeLpfO5TpT6W7P62Z2N2NwtbM4P44lNYPFfrnYMyqBCjkLbLvpOHXXqQHxFqJYra6srOSBNxUKJd8P6KeK9C/xgPOpVSv79u297rrrrr322hfx7F78HykCDv2Nb9zw2c9+9sDBx2DnQF/JXZrJo9SoC9YklUqk00kIBlKpTCKR8dwUR3bm0W8SqBlaegwrWiX8+RjQ8mqlXC6W4K6KA/AiwVX7LS1HCoOgWCpBTHjRhRe8//3vB5he9B+uewl//uruu+/+4j986Z7v3AOMP5lMplIpk0SU63+JiVGlCn+PydajlDjVeFDxQr0AX68K0gMYzA9oqWtTrVZrNfCDnVdedeV73/OeN7zhDS/RD9S95D+sBlz/5ptvufnmmw899VSxULRRplKuhwNOY0K7flJw6/df2ue8srZWTGyY8H1wLL7fBNZy/p49b3nLm6+++q3bqKf4pbuxl+3HIE+ePHnfffffe9+9hw49NTszC6eqZr652MLgkMXhbH20Y9ZxCZWaCvCGy89TqeTQxo179+69Cgz4lVfu3Lnz5TkF9vL/cibANDk5efjwEbidnDg5MzMLthrsUKPZxB9b0w11+le/sK8okcjibxr2DA8Pj41t27V7F8QrY2NjP3R8+38EsJ5zgwMo6FuxXCmDGQ98YJsSJA4UNpvNdeK6Gbxxzn+8h/r/BBgA16kwIwArdGsAAAAASUVORK5CYII='
                        text: 'Soft Sauda'
                    });
                },
                messageBottom: 'Exported from Soft Sauda'
            },
            {
                extend: 'print',
                className: 'btn-default btn-print',
                exportOptions: {
                    columns: "thead th:not(.noExport)"
                }
            },
        ],
        "columns": [
            { "data": "check" },
            { "data": "id" },
            { "data": "partshortname" },
            { "data": "PartyName" },
            { "data": "Address" },
            { "data": "AreaName" },
            { "data": "CityName" },
            { "data": "PinCode" },
            { "data": "CreditLimits" },
            { "data": "PAN" },
            { "data": "GSTIN" },
            { "data": "Phoneoffice" },
            { "data": "PhoneResi" },
            { "data": "FSSAI" },
            { "data": "FAX" },
            { "data": "MobileNo" },
            //{ "data": 'Action'}
        ],
        //  "columnDefs": [ {
        //      "targets": -1,
        //      "orderable": false,
        //      "data": null,
        //      "searchable": false,
        //      "render": function(data){
        //         var action = data.split('_splitit_');
        //          var j  = `
        //          <div class="btn-group dropdown">
        //               <button class="btn btn-xs blue dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false"> Actions
        //                   <i class="fa fa-angle-down"></i>
        //               </button>
        //               <ul class="dropdown-menu pull-right" role="menu">
        //                   <li>
        //                       <a href="${action[0]}">
        //                           <i class="icon-pencil"></i> Edit </a>
        //                   </li>
        //                   <li class="divider"> </li>
        //                   <li>
        //                       <a href="${action[1]}" class="delbutton">
        //                           <i class="icon-trash"></i> Delete
        //                       </a>
        //                   </li>
        //               </ul>
        //           </div>`;
        //           return j;
        //      }
        //  },
        //  {
        //     "orderable": false,
        //     "searchable": false,     
        //     "targets": 0
        //  } ],
        "order": [1, 'asc'],
        initComplete: function () {
            var api = this.api();

            // Apply the search
            api.columns().every(function () {
                var that = this;

                $('input', this.footer()).on('keyup change', function () {
                    if (that.search() !== this.value) {
                        that
                            .search(this.value)
                            .draw();
                    }
                });
            });
        }
    })
}
//#########################################################################
$(function () {
    var todaydate = new Date();
    $(".datep").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy",
        autoclose: true,
        startDate: new Date

    });
    //#########################################################################
    $(".datepicker").datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
    });
    //#########################################################################
    $("#ratechangedate").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd/mm/yy',
        maxDate: new Date,
        minDate: new Date(2000, 6, 12)
    });
    //#########################################################################
    $(".BillDate").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy",
        startDate: from,
        endDate: to,
        autoclose: true,
    });
    //#########################################################################
    var from = $("#offerstartdate").data("fromdate");
    var to = $("#offerstartdate").data("todate");
    $("#offerstartdate").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy",
        startDate: from,
        endDate: to,
        autoclose: true,
    })
        .on('changeDate', function (e) {
            var dat = $('#offerstartdate').datepicker('getFormattedDate');
            // $('#podt').datepicker('clearDates');
            $('#podt').datepicker('setStartDate', dat);
            $('.datep').datepicker('clearDates');
            $('.datep').datepicker('setStartDate', dat);

        });
    //#########################################################################
    $('#offerstartdate,.datep, #podt, .datepicker,#due_On,.BillDate').on('changeDate', function (ev) {
        $(this).datepicker('hide');
    });
    //#########################################################################
    $('body').on('keydown', 'button[type="submit"]', function (e) {
        if (e.keyCode == 13) {
            $(this).parents('form').submit();
        }
    })
    //#########################################################################
    $('.datemask').inputmask("99/99/9999");
    $("#offerenddate").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy"
        // minDate: new Date
    });
    var contrperiod = $('#orderrange').daterangepicker(
        {
            opens: 'right',
            "locale": {
                "format": "DD/MM/YYYY",
                "separator": " to "
            },
            ranges: {
                'Today': [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            },
            //   startDate: moment(),
            // endDate: moment().add(1,'days'),
        },
        function (start, end) {
            $('#contractrange input').html(start.format('DD-MM-YYYY') + ' - ' + end.format('DD-MM-YYYY'))
        }
    )
    //#########################################################################
    $("#filterstartdate").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy"
    });
    //#########################################################################
    $("#from_dt").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy"
    });
    //#########################################################################
    $("#to_dt").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy"
    });
    //#########################################################################
    $("#bill_dt").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy"
    });
    //#########################################################################
    $("#filterenddate").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy"
    });
    //#########################################################################
    $('#offerstarttime').timepicker({
        'timeFormat': 'h:i A'
    });
    //#########################################################################
    $('#offerendtime').timepicker({
        'timeFormat': 'h:i A'
    });
    //#########################################################################
});
//#########################################################################
$(document).ready(function () {
    $('body').on('focusin', '.form-control:not(".select2")', function () {
        $(this).css({ 'background-color': "#FCFE8F", 'color': '#333' });
    })

    $('body').on('focusin', '.select2.select2-container', function () {
        $(this).find('.select2-selection').css({ 'background-color': "#FCFE8F", 'color': '#333' });
    })

    $('body').on('focusout', '.form-control:not(".select2")', function () {
        if ($(this).valid())
            $(this).css({ 'background-color': "#D3FD7A", 'color': "#333" });
        else
            $(this).css({ 'background-color': "#FB652D", 'color': "#fff" });
    })

    $('body').on('focusout', '.select2.select2-container', function () {
        if ($(this).closest('.form-group').find('select').valid())
            $(this).find('.select2-selection').css({ 'background-color': "#D3FD7A", 'color': "#333" });
        else
            $(this).find('.select2-selection').css({ 'background-color': "#FB652D", 'color': "#fff" });
    })
    var contrperiod = $('#contractrange').daterangepicker({
        opens: 'right',
        "locale": {
            "format": "DD/MM/YYYY",
            "separator": " to "
        },
        ranges: {
            'Today': [moment(), moment()],
            'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        },
        // startDate: moment(),
        // endDate: moment().add(1,'days'),
        autoApply: true
        // minDate: '01/01/2012',
        // maxDate: '1/31/2019',
    },
        function (start, end) {
            $('#contractrange input').val(start.format('DD-MM-YYYY') + ' - ' + end.format('DD-MM-YYYY'));
        }
    );

    var contrperiod = $('.contractrange').daterangepicker({
        opens: 'right',
        "locale": {
            "format": "DD/MM/YYYY",
            "separator": " to "
        },
        ranges: {
            'Today': [moment(), moment()],
            'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        },
        startDate: moment(),
        endDate: moment().add(1, 'days'),
        autoApply: true
        // minDate: '01/01/2012',
        // maxDate: '1/31/2019',
    },
        function (start, end) {
            $('#contractrange input').val(start.format('DD-MM-YYYY') + ' - ' + end.format('DD-MM-YYYY'));
        }
    );


    $("#podt").datepicker({
        changeMonth: true,
        changeYear: true,
        format: "dd/mm//yyyy",
        startDate: '',
        endDate: ''
    }).on('change', function () {
        var dat = $('#podt').datepicker('getFormattedDate');
        $('#contractrange').daterangepicker({
            opens: 'right',
            "locale": {
                "format": "DD/MM/YYYY",
                "separator": " to "
            },
            minDate: dat,
            ranges: {
                'Today': [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            },
            startDate: moment(),
            endDate: moment().add(1, 'days'),
            autoApply: true
            // minDate: '01/01/2012',
            // maxDate: '1/31/2019',
        },
            function (start, end) {
                $('#contractrange input').val(start.format('DD-MM-YYYY') + ' - ' + end.format('DD-MM-YYYY'));
            }
        );
        $('#contractrange').data('daterangepicker').setStartDate(dat);
        $('#contractrange').data('daterangepicker').setEndDate(dat);
        $('#contractrange input').val('');
    });


    $('#addparty').on('show.bs.modal', function () {
        $(this).find('.select2').width('100%');
    })

    $('#addcity').on('show.bs.modal', function () {
        $(this).find('.select2').width('100%');
    })


    $('.repeat').repeater({
        isFirstItemUndeletable: true,
        show: function () {
            $(this).slideDown();
        },
        hide: function (deleteElement) {
            var th = $(this);
            swal({
                title: "Confirm",
                text: "Are you Sure you want to delete it?",
                icon: "warning",
                buttons: ["Cancel", "Confirm"],
                dangerMode: true
            }).then(function (isConfirm) {
                if (isConfirm)
                    th.slideUp(deleteElement);
            })
        },
        ready: function (setIndexes) { }
    });

});
//#########################################################################

'use strict';
$.urlParam = function (name) {
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results == null) {
        return null;
    } else {
        return decodeURI(results[1]) || 0;
    }
}

function datatablesearch() {
    var whatsSelected = [];
    var filterValue = $("input[name='formfilter']:checked").val();
    //console.log(filterValue);
    if (filterValue != 'all') {
        whatsSelected.push(filterValue);
        table.columns(7).search(whatsSelected.join('|'), true).draw();
    } else {
        $('.product_detail_table').DataTable().destroy();
        table = '';
        table = jQuery('.product_detail_table').DataTable({
            "dom": "<'row' <'col-md-12'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>", // horizobtal scrollable datatable
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
            buttons: [
                'excel',
                'print',
                'pdf',

            ]
        });
    }
}
var para, checkpass;
para = $.urlParam('success');
if (para == 1) {
    setTimeout(function () {
        window.location.href = '/products/all';
    }, 10000);
}

checkpass = $.urlParam('pass');
if (checkpass == 1) {
    setTimeout(function () {
        window.location.href = '/settings/passwordsetting';
    }, 10000);
}

// var table;
// table = jQuery('.product_detail_table').DataTable({
//     dom: 'lrtip',
//     "lengthChange": false,
//      initComplete: function () {
//     }
//  });

function datatablesearch() {
    var whatsSelected = [];
    var filterValue = $("input[name='formfilter']:checked").val();
    //console.log(filterValue);
    if (filterValue != 'all') {
        whatsSelected.push(filterValue);
        table.columns(7).search(whatsSelected.join('|'), true).draw();
    } else {
        $('.product_detail_table').DataTable().destroy();
        table = '';
        table = jQuery('.product_detail_table').DataTable({
            dom: 'lrtip',
            "lengthChange": false,
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
            initComplete: function () { }
        });
    }
}

$(document).on("click", "input[name='formfilter']", function () {
    datatablesearch();
});
///party
$(document).on("change.select2", "#ac_city", function () {

    $('.loader').show();
    var cityid = $("#ac_city option:selected").val();
    // alert(cityid); 
    $.ajax({
        type: 'GET',
        url: '/customer/getcitybyid',
        dataType: 'json',
        data: {
            id: cityid
        },
        success: function (data) {
            if (data['success']) {
                var statArray = data['state_name'];
                //
                //alert(statArray.city_code)
                var i;
                // var result = '<select class="form-control" name="state_name" id="state_name">';
                // result += '<option value="' + statArray._id + '">' + statArray.state_name.state_name + '</option>';
                // result += '</select>';
                $("#ac_pin").val(statArray.city_code);

                $('.loader').hide();
            }
        }
    });
});
$(document).on("change.select2", "#ac_city1", function () {
    $('.loader').show();
    var cityid = $("#ac_city1 option:selected").val();
    // alert(cityid); 
    $.ajax({
        type: 'GET',
        url: '/customer/getcitybyid',
        dataType: 'json',
        data: {
            id: cityid
        },
        success: function (data) {
            if (data['success']) {
                var statArray = data['state_name'];
                // alert(statArray.city_code)
                var i;
                // var result = '<select class="form-control" name="state_name" id="state_name">';
                // result += '<option value="' + statArray._id + '">' + statArray.state_name.state_name + '</option>';
                // result += '</select>';
                $("#fac_pin").val(statArray.city_code);

                $('.loader').hide();
            }
        }
    });
});
$(document).on("change.select2", "#bank_city", function () {
    $('.loader').show();
    var cityid = $("#bank_city option:selected").val();
    // alert(cityid); 
    $.ajax({
        type: 'GET',
        url: '/customer/getcitybyid',
        dataType: 'json',
        data: {
            id: cityid
        },
        success: function (data) {
            if (data['success']) {
                var statArray = data['state_name'];
                //alert(statArray.city_code)
                var i;
                // var result = '<select class="form-control" name="state_name" id="state_name">';
                // result += '<option value="' + statArray._id + '">' + statArray.state_name.state_name + '</option>';
                // result += '</select>';
                $("#bank_pin").val(statArray.city_code);
                $('.loader').hide();
            }
        }
    });
});
$(document).on("change.select2", "#city_name", function () {
    $('.loader').show();
    var cityid = $("#city_name option:selected").val();
    // alert(cityid); 
    $.ajax({
        type: 'GET',
        url: '/party/getcitybyid',
        dataType: 'json',
        data: {
            id: cityid
        },
        success: function (data) {
            if (data['success']) {
                var statArray = data['state_name'];
                var i;
                // var result = '<select class="form-control" name="state_name" id="state_name">';
                // result += '<option value="' + statArray._id + '">' + statArray.state_name.state_name + '</option>';
                // result += '</select>';
                var option = new Option(statArray.state_name.state_name, statArray.state_name._id, true, true);
                $('#state_name').append(option).trigger('change');
                $('#state_name').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": statArray.state_name._id, "text": statArray.state_name.state_name }
                    }
                });
                // $('.state_name_div').html(result);
                $('.loader').hide();
            }
        }
    });
});
$(document).on("change", "#dis_name", function () {
    $('.loader').show();
    var districtID = $("#dis_name option:selected").attr("data-dis_id");
    $.ajax({
        type: 'GET',
        url: '/add_city/getdistrictbyid',
        dataType: 'json',
        data: {
            id: districtID
        },
        success: function (data) {
            if (data['success']) {
                var statArray = data['state_name'];
                var i;
                var result = '<select class="form-control" name="state_name" id="state_name">';
                result += '<option value="' + statArray._id + '">' + statArray.state_name + '</option>';
                result += '</select>';

                $('.state_name_div').html(result);
                $('.loader').hide();
            }
        }
    });
});

$(document).on("change.select2", "#kind", function () {
    // $('.loader').show();
    var partyID = $("#kind option:selected").val();
    // alert(partyID);
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/kindname',
        dataType: 'json',
        data: {
            id: partyID
        },
        success: function (data) {
            if (data['success']) {
                var sta = data['party'];
                var kindArray = data['party']['contact_group'];
                var j;

                var staton = '';
                var result = '<input class="form-control" name="sl_cont" id="sl_cont"';
                for (j = 0; j < kindArray.length; j++) {
                    result += 'value="' + kindArray[0]['contact_no'] + '"';
                }
                result += 'type="text"/>';


                var resultmob = '<input class="form-control" name="sl_mob"';
                resultmob += 'value="' + data['party']['mob_no'] + '"';
                // }
                resultmob += 'type="text"/>';

                var option = new Option(sta.city_name['city_name'], sta.city_name._id, true, true);
                $('#station1').append(option).trigger('change');
                $('#station1').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": sta.city_name._id, "text": sta.city_name['city_name'] }
                    }
                });
                // $('.staion_div').html(staton);
                $('.kind_name_div').html(result);
                $('.kind_name_divmob').html(resultmob);

                $('.loader').hide();
            }
        }
    });
});
$(document).on("change", "#sb_code", function () {
    // $('.loader').show();
    var partyID = $("#sb_code option:selected").val();
    // alert(partyID); 
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/kindname',
        dataType: 'json',
        data: {
            id: partyID
        },
        success: function (data) {
            if (data['success']) {
                var kindArray = data['party']['contact_group'];
                // alert(kindArray);
                var j;
                var result = '<input class="form-control" name="sb_cont" id="sb_cont"';
                for (j = 0; j < kindArray.length; j++) {
                    result += 'value="' + kindArray[0]['contact_no'] + '"';
                }
                result += 'type="text"/>';
                // console.log(result)
                // for (j = 0; j < kindArray.length; j++) {
                //     result += '<input class="form-control" name="sb_cont" value="' + kindArray[j]['contact_no'] + '" type="text" autocomplete="off"/>';
                // }

                $('.sb_cont_div').html(result);
                $('.loader').hide();
            }
        }
    });
});
$(document).on("change", "#brcont", function () {
    //  $('.loader').show();
    var partyID = $("#brcont").val();
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/kindname',
        dataType: 'json',
        data: {
            id: partyID
        },
        success: function (data) {
            if (data['success']) {
                var sta = data['party'];
                var kindArray = data['party']['contact_group'];
                // alert(kindArray);
                var j;
                var staton = '';
                var result = '<input class="form-control" name="br_cont"';
                for (j = 0; j < kindArray.length; j++) {
                    result += 'value="' + kindArray[0]['contact_no'] + '"';
                }
                result += 'type="text" autocomplete="off"/>';
                // for (j = 0; j < kindArray.length; j++) {
                //     result += '<input class="form-control" name="br_cont" value="' + kindArray[j]['contact_no'] + '" type="text" autocomplete="off"/>';
                // }
                var resultmob = '<input class="form-control" name="br_mob"';
                resultmob += 'value="' + data['party']['mob_no'] + '"';
                // }
                resultmob += 'type="text"/>';

                // var staton = '<select class="form-control" name="to_ct" id="to_ct" style="width: 144px;margin-left: 3px;">';
                // staton += '<option value="' + sta.city_name._id + '">' + sta.city_name['city_name'] + '</option>';
                // staton += '</select>';

                var option = new Option(sta.city_name['city_name'], sta.city_name._id, true, true);
                $('#station2').append(option).trigger('change');
                $('#station2').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": sta.city_name._id, "text": sta.city_name['city_name'] }
                    }
                });
                $('.br_cont_div').html(result);
                $('.br_cont_mob').html(resultmob);
                $('.loader').hide();
            }
        }
    });
});
$(document).on("change.select2", "#bbcount", function () {
    // $('.loader').show();
    var partyID = $("#bbcount option:selected").val();
    // alert(partyID); 
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/kindname',
        dataType: 'json',
        data: {
            id: partyID
        },
        success: function (data) {
            if (data['success']) {
                var kindArray = data['party']['contact_group'];
                // alert(kindArray);
                var j;
                var result = '';
                // for(j = 0; j < kindArray.length; j++) {
                result += '<input class="form-control" name="bb_cont" value="' + kindArray[0]['contact_no'] + '" type="text" autocomplete="off"/>';
                // }
                $('.bb_cont_div').html(result);
                $('.loader').hide();
            }
        }
    });
});
///direct Delivery
$(document).on("change.select2", "#slcount", function () {
    // $('.loader').show();
    var partyID = $("#slcount option:selected").attr("data-party_id");
    //  alert(partyID); 
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/kindname',
        dataType: 'json',
        data: {
            id: partyID
        },
        success: function (data) {
            if (data['success']) {
                var kindArray = data['party']['contact_group'];
                var j;
                var result = '';
                // for(j = 0; j < kindArray.length; j++) {
                result += '<input class="form-control" name="sl_cont" value="' + kindArray[0]['contact_no'] + '" type="text"/>';
                // }
                $('.kind_name_div').html(result);
                $('.loader').hide();
            }
        }
    });
});
$(document).on("change.select2", "#sbcount", function () {
    // $('.loader').show();
    var partyID = $("#sbcount option:selected").attr("data-party_id");
    // alert(partyID); 
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/kindname',
        dataType: 'json',
        data: {
            id: partyID
        },
        success: function (data) {
            if (data['success']) {
                var kindArray = data['party']['contact_group'];
                // alert(kindArray);
                var j;
                var result = '';
                // for(j = 0; j < kindArray.length; j++) {
                result += '<input class="form-control" name="sb_cont" value="' + kindArray[0]['contact_no'] + '" type="text" autocomplete="off"/>';
                // }

                $('.sb_cont_div').html(result);
                $('.loader').hide();
            }
        }
    });
});
$(document).on("change", "#brcount", function () {
    // $('.loader').show();
    var partyID = $("#brcount option:selected").attr("data-party_id");
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/kindname',
        dataType: 'json',
        data: {
            id: partyID
        },
        success: function (data) {
            if (data['success']) {
                var sta = data['party'];
                var kindArray = data['party']['contact_group'];
                // alert(kindArray);
                var j;
                var result = '';
                // for(j = 0; j < kindArray.length; j++) {
                result += '<input class="form-control" name="br_cont" value="' + kindArray[0]['contact_no'] + '" type="text" autocomplete="off"/>';
                // }
                $('.br_cont_div').html(result);
                $('.loader').hide();
            }
        }
    });
});
$(document).on("change", "#bbcunt", function () {
    // $('.loader').show();
    var partyID = $("#bbcunt option:selected").attr("data-party_id");
    // alert(partyID); 
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/kindname',
        dataType: 'json',
        data: {
            id: partyID
        },
        success: function (data) {
            if (data['success']) {
                var kindArray = data['party']['contact_group'];
                // alert(kindArray);
                var j;
                var result = '';
                // for(j = 0; j < kindArray.length; j++) {
                result += '<input class="form-control" name="bb_cont" value="' + kindArray[0]['contact_no'] + '" type="text" autocomplete="off"/>';
                // }
                $('.bb_cont_div').html(result);
                $('.loader').hide();
            }
        }
    });
});


$(document).on("change", "#productbrand", function () {
    $('.loader').show();
    var productID = $("#offerproductname option:selected").attr("data-productid");
    var productBrand = $(this).val();
    $.ajax({
        type: 'GET',
        url: '/offers/getproductbrandbyid',
        dataType: 'json',
        data: {
            id: productID
        },
        success: function (data) {
            if (data['success']) {
                var productArray = data['product']['productbrand'];
                var i, j;
                var packVariation = '<select class="form-control" name="pack" id="pack">';
                packVariation += '<option value="all" selected="">All</option>';
                for (i = 0; i < productArray.length; i++) {
                    if (productArray[i]['productbrand'] == productBrand) {
                        var brandPackVariationArray = productArray[i]['bank_variation'];
                        for (j = 0; j < brandPackVariationArray.length; j++) {
                            //console.log(brandPackVariationArray[j]['packvalue']);
                            packVariation += '<option value="' + brandPackVariationArray[j]['packvalue'] + '">' + brandPackVariationArray[j]['packvalue'] + '</option>';
                        }
                    }
                }
                packVariation += '</select>';
                $('.product_variation_div').html(packVariation);
                $('.loader').hide();
            }
        }
    });
});
// //sauda register
$(document).on("click", "#salesorderdetailsubmit", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var qty_bal = $('#qty_baldetails').prop('checked');
    //  alert(qty_bal)
    //  alert(end_date)
    var buy_cus_name = $('#buy_cus_name').val();

    $.ajax({
        type: "POST",
        url: '/salesorder_register/salesorderdetails',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            buy_cus_name: buy_cus_name,
            qty_bal: qty_bal
        },
        success: function (data) {
            if (data['success'] == true) {
                var contract = data['hhtml'];
                console.log(contract);
                //  alert("prabak")
            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.contract_detail_body').html(contract);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                function resizeInput() {

                    var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                    var widthTester = $("<span>" + content + "</span>").hide();
                    widthTester.insertAfter($(this));
                    $(this).css("width", widthTester.width() + "px");
                    widthTester.remove();
                }

                $('.resizing-input').focusout(resizeInput).each(resizeInput);
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});
$(document).on("click", "#outwarddetailsubmit", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var buy_cus_name = $('#buy_cus_name').val();

    $.ajax({
        type: "POST",
        url: '/outward_register/outwarddetails',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            buy_cus_name: buy_cus_name,

        },
        success: function (data) {
            if (data['success'] == true) {
                var contract = data['hhtml'];
                console.log(contract);
                // alert("prabak")
            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.contract_detail_body').html(contract);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                function resizeInput() {

                    var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                    var widthTester = $("<span>" + content + "</span>").hide();
                    widthTester.insertAfter($(this));
                    $(this).css("width", widthTester.width() + "px");
                    widthTester.remove();
                }

                $('.resizing-input').focusout(resizeInput).each(resizeInput);
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});
$(document).on("click", "#domesticdetailsubmit", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var buy_cus_name = $('#buy_cus_name').val();

    $.ajax({
        type: "POST",
        url: '/domestic_register/domesticdetails',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            buy_cus_name: buy_cus_name,

        },
        success: function (data) {
            if (data['success'] == true) {
                var contract = data['hhtml'];
                console.log(contract);
                //  alert("prabak")

            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.contract_detail_body').html(contract);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                function resizeInput() {

                    var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                    var widthTester = $("<span>" + content + "</span>").hide();
                    widthTester.insertAfter($(this));
                    $(this).css("width", widthTester.width() + "px");
                    widthTester.remove();
                }

                $('.resizing-input').focusout(resizeInput).each(resizeInput);
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});

// Stock Ladger #####################################################################################################################################################
$(document).on("keydown", "#STladger", function (e) {
    if (e.keyCode == 13) StockLadger();
});

function StockLadger() {
    // event.preventDefault();
    $('.loader').show();
    var period = $('#orderrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var Product = $('#product').val();
    var location = $('#location').val();

    // alert(Product)
    // $('#stladgerbody > tr').remove();
    $('#stladgerbody > tr > td').remove();
    // alert('removing table');
    $.ajax({
        type: "POST",
        url: '/st_ladger/stockladgerdetails',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            Product: Product,
            location: location,

        },
        success: function (data) {
            // console.log(data);
            if (data['success'] == true) {
                var ladger = data['ladger'];
                var last = data['laststock'];
                var op_net_Wt = data['op_net_Wt'];
                var html = '<div class="showsearchdata">';
                html += '<div class="row">';
                html += '<div class="col-md-12">';
                html += '<div class="table-responsive">';
                html += '<table id="userTable" class="userTable table table-striped table-bordered table-hover adsearch">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>Sno</th>';
                html += '<th>Date</th>';
                html += '<th>Entry No</th>';
                html += '<th>Party Name</th>';
                html += '<th>Location</th>'; //location here
                html += '<th>Qty +</th>';
                html += '<th>Weight + </th>';
                html += '<th>Rate + </th>';
                html += '<th>Qty -</th>';
                html += '<th>Weight - </th>';
                html += '<th>Rate - </th>';
                html += '<th>Qty Balance</th>';
                html += '<th>Weight Balance</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                html += '<tr>';
                html += '<td></td>';
                html += '<td></td>';
                html += '<td></td>';
                html += '<td></td>';
                html += '<td></td>'; // location here
                html += '<td id="mrn" style="text-align: right"></td>';
                html += '<td id="net_Wt_plus" style="text-align: right"></td>';
                html += '<td></td>';
                html += '<td id="chl" style="text-align: right"></td>';
                html += '<td id="net_Wt_min" style="text-align: right"></td>';
                html += '<td></td>';
                html += '<td></td>';
                html += '<td></td>';
                html += '</tr>';
                if (ladger == null || ladger == '' || ladger == []) {
                    //loki              
                    // html+="<hr>";
                } else {
                    $.each(data.ladger, function (index, value) {
                        // console.log('value : '+value.location);

                        var sn = index + 1;
                        html += "<tr>";
                        html += "<td style='text-align: center'>" + sn + "</td>";
                        var a = moment(value.Date).format('DD/MM/YYYY');
                        html += "<td style='text-align: center'>" + a + "</td>";
                        if (value.challan == 'GAE') html += "<td style='text-align: center'><a href='/Garu_Aavak_Entry/Garu_Aavak_Entry_Update/" + value._id + "'target='_blank'>" + value.challan + "/" + value.EntryNo + "</a></td>";
                        else if (value.challan == 'Sale') html += "<td style='text-align: center'><a href='/Sales_Entry/Sales_Entry_Update/" + value._id + "' target='_blank'>" + value.challan + "/" + value.EntryNo + "</a></td>";
                        //loki
                        else html += "<td style='text-align: center'><a href='/Purchase_Return_Entry/Purchase_Return_Entry_Update/" + value._id + "' target='_blank'>" + value.challan + "/" + value.EntryNo + "</a></td>";
                        // else html+="<td></td>";
                        // loki ^ 
                        html += "<td style='text-align: left'>" + value.Party + "</td>";
                        // html += "<td style='text-align: left'>" + location + "</td>"; //loki here
                        html += "<td style='text-align: left'>" + value.location + "</td>"; //loki here
                        // alert('1877 custom location '+location);
                        if (value.plus == null || value.plus == undefined || value.plus == '') value.plus = 0
                        html += "<td style='text-align: right'>" + value.plus.toFixed(2) + "</td>";
                        if (value.net_Wt_plus == null || value.net_Wt_plus == undefined || value.net_Wt_plus == '') value.net_Wt_plus = 0
                        html += "<td style='text-align: right'>" + value.net_Wt_plus.toFixed(2) + "</td>";
                        if (value.Rate_minus == null || value.Rate_minus == undefined || value.Rate_minus == '') value.Rate_minus = 0
                        html += "<td style='text-align: right'>" + value.Rate_minus.toFixed(2) + "</td>";

                        if (value.minus == null || value.minus == undefined || value.minus == '') value.minus = 0
                        html += "<td style='text-align: right'>" + value.minus.toFixed(2) + "</td>";
                        if (value.net_Wt_min == null || value.net_Wt_min == undefined || value.net_Wt_min == '') value.net_Wt_min = 0
                        html += "<td style='text-align: right'>" + value.net_Wt_min.toFixed(2) + "</td>";
                        if (value.Rate_plus == null || value.Rate_plus == undefined || value.Rate_plus == '') value.Rate_plus = 0
                        html += "<td style='text-align: right'>" + value.Rate_plus.toFixed(2) + "</td>";
                        if (value.Balance == null || value.Balance == undefined || value.Balance == '') value.Balance = 0
                        if (value.Balance < 0) html += "<td style='text-align: right'>" + (value.Balance).toFixed(2) + "</td>";
                        if (value.Balance >= 0) html += "<td style='text-align: right'>" + (value.Balance).toFixed(2) + "</td>";
                        if (value.balance_net_Wt == null || value.balance_net_Wt == undefined || value.balance_net_Wt == '') value.balance_net_Wt = 0
                        if (value.balance_net_Wt < 0) html += "<td style='text-align: right'>" + (value.balance_net_Wt ).toFixed(2) + "</td>";
                        if (value.balance_net_Wt >= 0) html += "<td style='text-align: right'>" + (value.balance_net_Wt).toFixed(2) + "</td>";
                        html += "</tr>"
                    });
                }
                html += '<tfoot>';
                html += '<tr>';
                html += '<th class="excludesearch"></th>';
                html += '<th>Date</th>';
                html += '<th>Entry No</th>';
                html += '<th>Party Name</th>';
                html += '<th>Location</th>'; //loki here
                html += '<th>Qty +</th>';
                html += '<th>Weight + </th>';
                html += '<th>Rate + </th>';
                html += '<th>Qty -</th>';
                html += '<th>Weight - </th>';
                html += '<th>Rate - </th>';
                html += '<th>Qty Balance</th>';
                html += '<th>Weight Balance</th>';
                html += '</tr>';
                html += '</tfoot>';
                html += '</table>';
                $("#stladgerbody").html(html);
                // loki
                if (last >= 0) $("#mrn").html(last);
                if (last >= 0) $("#mrn").html(last);
                if (last < 0) $("#chl").html(last);
                if (op_net_Wt >= 0) $("#net_Wt_plus").html(op_net_Wt);
                if (op_net_Wt < 0) $("#net_Wt_min").html(op_net_Wt);
                // $('.loader').hide() // something from gangour
                dattable = jQuery('#userTable').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "processing": false,
                    "serverSide": false,
                    "colReorder": false,
                    "ordering": false,
                    "autoWidth": false,
                    "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf',
                            exportOptions: {

                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                            footer: true,
                            orientation: 'landscape',
                            customize: function (doc) {
                                doc.content.splice(0, 0, {
                                    margin: [0, 0, 0, 12],
                                    alignment: 'center',
                                    text: 'Soft Sauda'
                                });
                            },
                            messageBottom: 'Exported from Soft Sauda'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                    ],
                    "order": [1, 'asc'],
                    "columnDefs": [{
                        "className": "actioncell",
                        "orderable": false,
                        "searchable": false,
                        "sortable": false,
                        "targets": [0],
                        "width": "5%"
                    }],
                })
                $('#userTable tfoot th').not('.excludesearch').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                    function resizeInput() {
                        var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }
                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });
                $('#userTable tfoot').insertBefore('#userTable thead');
                dattable.columns().every(function () {
                    var that = this;
                    $('input', this.footer()).on('keyup change clear', function () {
                        if (that.search() !== this.value) {
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                });
            }
            // else
            // {
            //     $('#stladgerbody > tr > td').remove();                
            // }
        }
    });
}
// });
function ShowStLadger(id, ItemName) {
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    // alert(id+" "+ItemName)
    if (id != undefined) {
        window.open(
            '/st_ladger/stock_ladger?accid=' + id + '&stdate=' + start_date + '&Eddate=' + end_date + '&ItemName=' + ItemName + '',
            '_blank' // <- This is what makes it open in a new window.
        );
    }
}
function AfterBillCollectionPrint() {
    var getUrlVarsLadger = getUrlVarsLadger();
    // For Bill Collection Print
    if (getUrlVarsLadger.PrintBillCollection == null || getUrlVarsLadger.PrintBillCollection == '' || getUrlVarsLadger.PrintBillCollection == undefined) flag = 1
    else {
        var aa = (getUrlVarsLadger.PrintBillCollection).replace(/%27/g, '');
        if (aa == 'Print') window.location.href = '/Bill_CollectionEntry/Bill_CollectionEntry';
    }
    // For Sale Bill Print
    if (getUrlVarsLadger.PrintSaleBill == null || getUrlVarsLadger.PrintSaleBill == '' || getUrlVarsLadger.PrintSaleBill == undefined) flag = 1
    else {
        var aa = (getUrlVarsLadger.PrintSaleBill).replace(/%27/g, '');
        if (aa == 'Print') window.location.href = '/Sales_Entry/Sales_Entry_Add';
    }
    // For Daily Groccery Entry Print
    if (getUrlVarsLadger.toliCodeInGrocceryEntry == '' || getUrlVarsLadger.toliCodeInGrocceryEntry == undefined || getUrlVarsLadger.toliCodeInGrocceryEntry == null) flag = 1;
    else window.location.href = '/daily_grocery_entry/daily_grocery_entry';

    function getUrlVarsLadger() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
            vars[key] = value;
        });
        return vars;
    }
}
function setProductSetupValue() {
    setTimeout(function () {
        $.ajax({
            type: "GET",
            url: '/product_mast/GetLastProductMastEntry',
            dataType: 'json',
            data: {
                Product: 'Product',
            },
            success: function (data) {
                // console.log(data)
                if (data['success']) {
                    var LastSetupEntry = data['LastSetupEntry'];
                    var LastPostingEntry = data['LastPostingEntry'];
                    console.log('LastPostingEntry', LastPostingEntry);

                    for (let i = 0; i < LastSetupEntry.length; i++) {
                        if ($('#module' + i).val() == LastSetupEntry[i].moduleid) {
                            $('#qty' + i).val(LastSetupEntry[i].qty);
                            $('#qtyrane' + i).val(LastSetupEntry[i].qtyrane)
                            $('#wght' + i).val(LastSetupEntry[i].wght)
                            $('#wghtrange' + i).val(LastSetupEntry[i].wghtrange)
                            $('#rate' + i).val(LastSetupEntry[i].rate)
                            $('#raterange' + i).val(LastSetupEntry[i].raterange)

                            if (LastSetupEntry[i].qtytyp == 'on') $('#qtytyp' + i).prop("checked", true);
                            if (LastSetupEntry[i].wghttyp == 'on') $('#wghttyp' + i).prop("checked", true);
                            if (LastSetupEntry[i].pcktyp == 'on') $('#pcktyp' + i).prop("checked", true);
                            if (LastSetupEntry[i].unityp == 'on') $('#unityp' + i).prop("checked", true);
                            if (LastSetupEntry[i].brandtyp == 'on') $('#brandtyp' + i).prop("checked", true);
                            if (LastSetupEntry[i].amtro == 'on') $('#amtro' + i).prop("checked", true);
                            if (LastSetupEntry[i].amtedit == 'on') $('#amtedit' + i).prop("checked", true);
                        }
                    }
                    var html = '';
                    for (let j = 0; j < LastPostingEntry.length; j++) {
                        html += '<tr>';
                        html += '<td><b>' + LastPostingEntry[j].selesid.ModuleName + '</b>';
                        html += '<input type="hidden" name="selesid" value="' + LastPostingEntry[j].selesid._id + '">';
                        html += '<input type="hidden" name="selesnm" value="' + LastPostingEntry[j].selesid.ModuleName + '">';
                        html += '</td>';
                        html += '<td>' + LastPostingEntry[j].partypid.Description + '';
                        html += '<input type="hidden" name="partypid" value="' + LastPostingEntry[j].partypid._id + '" class="form-control">';
                        html += '<input type="hidden" name="partypnm" value="' + LastPostingEntry[j].partypid.Description + '" class="form-control">';
                        html += '</td>';
                        html += '<td id="setProductPostingValue">';
                        html += '<select name="accontnm" class="form-control postingProAc" placeholder="Account">';
                        if (LastPostingEntry[j].accontnm != null) html += '<option value="' + LastPostingEntry[j].accontnm._id + '" selected>' + LastPostingEntry[j].accontnm.ACName + '</option>';
                        // else html += '<option value="" selected>'+LastPostingEntry[j].accontnm.ACName+'</option>';
                        html += '</select>';
                        html += '</td>';
                        html += '</tr>';
                    }
                    $('#setProductPostingValue').html(html);
                    $('.postingProAc').select2({
                        placeholder: 'Please select Ac',
                        allowClear: true,
                        ajax: {
                            type: "GET",
                            url: '/product_mast/postingProAc',
                            dataType: 'json',
                            data: function (term) {
                                return {
                                    term: term
                                };
                            },
                            success: function (data) {
                            },
                        },
                        templateResult: formatcity,
                        templateSelection: formatcity,
                        escapeMarkup: function (m) { return m; }
                    })
                }
            }
        });
    }, 100);
}
window.onload = function () {
    YParaMeterArrInCb();
    setProductSetupValue();
    refreshAdjOutEntryInJV();
    refreshAdjOutEntryInCB();
    var getUrlVarsLadger = getUrlVarsLadger();
    var accid = getUrlVarsLadger.accid;
    if (accid) {
        var ItemName = getUrlVarsLadger.ItemName;
        ItemName = ItemName.replace(/%/g, " ");
        var stdate = getUrlVarsLadger.stdate;
        var Eddate = getUrlVarsLadger.Eddate;
        $('#orderrange').val(stdate + ' to ' + Eddate);
        var divnames = ItemName;
        var divnameids = accid;
        var option = new Option(divnames, divnameids, true, true);
        $('#product').append(option).trigger('change');
        $('#product').trigger({
            type: 'select2:select',
            params: {
                data: { "id": divnameids, "text": divnames }
            }
        });
        setTimeout(function () {
            StockLadger()
        }, 200);
    }
    function getUrlVarsLadger() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
            vars[key] = value;
        });
        return vars;
    }
    getPartyDetail()
    GetOutStInCN('Save_OutEntry')
    $('#BillCollPrintButton').click();
    $('#hideprintbtn').click();
    $('#DailyGroccPrint').click();
}
// Stock Summary #####################################################################################################################################################
$(document).on("click", "#STsummary", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var location = $('#location').val();
    // var Product = $('#Product').val();
    $("#sdate").html(start_date)
    $("#edate").html(end_date)
    $('#stsummarybody > tr > td').remove();
    $.ajax({
        type: "POST",
        url: '/st_ladger/stocksummarydetails',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            location: location,
        },
        success: function (data) {
            console.log(data);
            if (data['success'] == true) {
                var ladger = data['ladger'];
                $("#showop").show()
                $.each(data.summary, function (index, value) {
                    var sn = index + 1;
                    var tr = "<tr>";
                    tr += "<td style='text-align: center'>" + sn + "</td>"; //onclick='ShowStLadger("+value.productid+")'
                    tr += "<td style='text-align: left'>";
                    var prd = JSON.stringify(value.product)
                    tr += '<a onclick="ShowStLadger(\'' + value.productid + '\',\'' + value.product + '\');">'
                    tr += value.product;
                    tr += '</a>';
                    tr += "</td>";
                    // Opening Qty Wght
                    if (value.opstock == '' || value.opstock == null || value.opstock == undefined) value.opstock = 0;
                    tr += "<td style='text-align: right'>" + value.opstock.toFixed(2) + "</td>";
                    if (value.opStock_Wt == '' || value.opStock_Wt == null || value.opStock_Wt == undefined) value.opStock_Wt = 0;
                    tr += "<td style='text-align: right'>" + value.opStock_Wt.toFixed(2) + "</td>";
                    // Inword Qty Wght
                    if (value.mrn == '' || value.mrn == null || value.mrn == undefined) value.mrn = 0;
                    tr += "<td style='text-align: right'>" + value.mrn.toFixed(2) + "</td>";
                    if (value.Tot_Wtin == '' || value.Tot_Wtin == null || value.Tot_Wtin == undefined) value.Tot_Wtin = 0;
                    tr += "<td style='text-align: right'>" + value.Tot_Wtin.toFixed(2) + "</td>";
                    // Outword Qty Wght
                    if (value.outward == '' || value.outward == null || value.outward == undefined) value.outward = 0;
                    tr += "<td style='text-align: right'>" + value.outward.toFixed(2) + "</td>";
                    if (value.Tot_Wtout == '' || value.Tot_Wtout == null || value.Tot_Wtout == undefined) value.Tot_Wtout = 0;
                    tr += "<td style='text-align: right'>" + value.Tot_Wtout.toFixed(2) + "</td>";
                    //Closing Qty Wght
                    if (value.opstock == '' || value.opstock == null || value.opstock == undefined) value.opstock = 0;
                    var clos = value.opstock + value.mrn - value.outward;
                    tr += "<td style='text-align: right'>" + clos.toFixed(2) + "</td>";
                    if (value.opStock_Wt == '' || value.opStock_Wt == null || value.opStock_Wt == undefined) value.opStock_Wt = 0;
                    var clos_wt = value.opStock_Wt + value.Tot_Wtin - value.Tot_Wtout
                    tr += "<td style='text-align: right'>" + clos_wt.toFixed(2) + "</td>";

                    // if(value.rate == '' || value.rate == null || value.rate == undefined){
                    //     tr += "<td style='text-align: right'>" + 0 + "</td>";
                    // }else{tr += "<td style='text-align: right'>" + value.rate + "</td>";}

                    // if(value.rate == '' || value.rate == null || value.rate == undefined){
                    //     var val = clos*0;
                    // }else{var val = clos*value.rate;}
                    // tr += "<td style='text-align: right'>" + val + "</td>";

                    $("#stsummarybody").append(tr);
                });
            }
        }
    });

});
// Trail Balance #####################################################################################################################################################    
$(document).on("click", "#Trail_Balance", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);

    $("#sdate").html(start_date)
    $("#edate").html(end_date)

    $('#trsummarybody > tr > td').remove();

    $.ajax({
        type: "POST",
        url: '/Trail_Balance/Trail_Balance',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
        },
        success: function (data) {
            console.log(data.summary);
            if (data['success'] == 'true') {
                var summary = data['summary'];
                $("#showop").show()
                var baltotd = 0;
                var baltotc = 0;
                if (summary == '' || summary == null) { $('.loader').hide(); }
                $.each(summary, function (index, value) {
                    var sn = index + 1;
                    // console.log(value.GroupName) 
                    var tr = "<tr>";
                    tr += "<td style='text-align: center'>" + sn + "</td>";
                    // var a = moment(value.Date).format('DD/MM/YYYY'); 

                    tr += "<td style='text-align: left'>" + value.GroupName + "</td>";
                    tr += "<td style='text-align: left'>" + value.ACName + "</td>";
                    // baltot = baltot+value.bal;
                    if (value.bal > 0) {
                        tr += "<td style='text-align: right'>" + value.bal.toFixed(2) + "</td>";
                        tr += "<td style='text-align: right'>0.00</td>";
                        baltotd = baltotd + value.bal;

                    }
                    else {
                        tr += "<td style='text-align: right'>0.00</td>";
                        tr += "<td style='text-align: right'>" + (value.bal * -1).toFixed(2) + "</td>";
                        baltotc = baltotc + (value.bal) * -1;
                    }
                    tr += "</tr>"

                    $("#trsummarybody").append(tr);
                });
                $("#tot_debit").html(baltotd.toFixed(2));
                $("#tot_credit").html(baltotc.toFixed(2));
                var aa = baltotd.toFixed(2) - baltotc.toFixed(2)
                $("#tot_diff").html(aa.toFixed(2));

            }
            $('.loader').hide();
        }
    });
});
// Trail Balance Group Wise  #####################################################################################################################################################
$(document).on("click", "#Tr_Bal_Gr_Wis", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);

    $("#sdate").html(start_date)
    $("#edate").html(end_date)

    $('#trgrpsummarybody > tr > td').remove();

    $.ajax({
        type: "POST",
        url: '/Trail_Balance/Trail_Balance_Group_Wise',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
        },
        success: function (data) {
            console.log(data);
            if (data['success'] == 'true') {
                var summary = data['summary'];
                if (summary == '' || summary == null) { $('.loader').hide(); }
                $("#showop").show()
                var baltotd = 0;
                var baltotc = 0;
                $.each(summary, function (index, value) {

                    var sn = index + 1;
                    // console.log(value.GroupName) 
                    var tr = "<tr>";
                    tr += "<td style='text-align: center'>" + sn + "</td>";
                    // var a = moment(value.Date).format('DD/MM/YYYY'); 

                    tr += "<td style='text-align: left'>" + value.GroupName + "</td>";
                    // tr += "<td style='text-align: left'>" + value.ACName + "</td>";                      
                    // baltot = baltot+value.bal;

                    if (value.bal > 0) {
                        tr += "<td style='text-align: right'>" + value.bal.toFixed(2) + "</td>";
                        tr += "<td style='text-align: right'>0.00</td>";
                        baltotd = baltotd + value.bal;

                    }
                    else {
                        tr += "<td style='text-align: right'>0.00</td>";
                        tr += "<td style='text-align: right'>" + (value.bal * -1).toFixed(2) + "</td>";
                        baltotc = baltotc + (value.bal) * -1;
                    }
                    tr += "</tr>"

                    $("#trgrpsummarybody").append(tr);
                });
                $("#tot_debit").html(baltotd.toFixed(2));
                $("#tot_credit").html(baltotc.toFixed(2));
                var aa = baltotd.toFixed(2) - baltotc.toFixed(2);
                $("#tot_diff").html(aa.toFixed(2));
                $('.loader').hide();
            }
        }
    });
});
// Profit And Loss  #####################################################################################################################################################
$(document).on("click", "#Profit_loss", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);

    $("#sdate").html(start_date)
    $("#edate").html(end_date)

    $('#prolossbody > tr > td').remove();

    $.ajax({
        type: "POST",
        url: '/Trail_Balance/Profit_loss',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
        },
        success: function (data) {
            // console.log(data.summary);
            if (data['success'] == 'true') {
                var summary = data['summary'];
                if (summary == '' || summary == null) { $('.loader').hide(); }
                $("#showop").show()
                var baltotex = 0;
                var baltotin = 0;
                $.each(summary, function (index, value) {
                    // var sn = index+1;  
                    // console.log(value.GroupName) 
                    var tr = "<tr>";
                    tr += "<td style='text-align: center; display: none'>" + value.Liabilities + "</td>";
                    tr += "<td style='text-align: left;'>" + value.Liabilities + "</td>";
                    if (value.Amount > 0) {
                        tr += "<td style='text-align: right'>" + value.Amount.toFixed(2) + "</td>";
                        baltotin = baltotin + value.Amount;

                    }
                    else {
                        tr += "<td style='text-align: right'>" + (value.Amount * -1).toFixed(2) + "</td>";
                        baltotin = baltotin + (value.Amount) * -1;
                    }
                    tr += "<td style='text-align: left'>" + value.Assets + "</td>";
                    if (value.AmountA > 0) {
                        tr += "<td style='text-align: right'>" + value.AmountA.toFixed(2) + "</td>";
                        baltotex = baltotex + value.AmountA;

                    }
                    else {
                        tr += "<td style='text-align: right'>" + (value.AmountA * -1).toFixed(2) + "</td>";
                        baltotex = baltotex + (value.AmountA) * -1;
                    }

                    tr += "</tr>"

                    $("#prolossbody").append(tr);
                });
                $("#tot_in").html(baltotin.toFixed(2));
                $("#tot_ex").html(baltotex.toFixed(2));
                // console.log(baltotin+"__"+baltotex)
                if (baltotin > baltotex) {
                    $("#tot_loss2").html(parseFloat(baltotin).toFixed(2) - parseFloat(baltotex).toFixed(2));
                    $("#tot_ex1").html(baltotin.toFixed(2));
                    $("#tot_in1").html(baltotin.toFixed(2));
                }
                if (baltotin < baltotex) {
                    // alert(parseFloat(baltotex)-parseFloat(baltotin))
                    var tot_loss1 = parseFloat(baltotex) - parseFloat(baltotin);
                    $("#tot_loss1").html(tot_loss1.toFixed(2));
                    $("#tot_ex1").html(baltotex.toFixed(2));
                    $("#tot_in1").html(baltotex.toFixed(2));
                }
                $('.loader').hide();

            }
        }
    });
});
// Balance Sheet  #####################################################################################################################################################
$(document).on("click", "#Balance_sh", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);

    $("#sdate").html(start_date)
    $("#edate").html(end_date)

    $('#blcsheetbody > tr > td').remove();

    $.ajax({
        type: "POST",
        url: '/Trail_Balance/Balance_Sheet',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
        },
        success: function (data) {
            console.log(data.summary);
            if (data['success'] == 'true') {
                var summary = data['summary'];
                if (summary == '' || summary == null) { $('.loader').hide(); }
                $("#showop").show()
                var baltotex = 0;
                var baltotin = 0;
                $.each(summary, function (index, value) {
                    // var sn = index+1;  
                    // console.log(value.GroupName) 
                    var tr = "<tr>";
                    tr += "<td style='text-align: center; display: none'>" + value.Liabilities + "</td>";
                    tr += "<td style='text-align: left'>" + value.Assets + "</td>";
                    if (value.AmountA > 0) {
                        tr += "<td style='text-align: right'>" + value.AmountA.toFixed(2) + "</td>";
                        baltotin = baltotin + value.AmountA;

                    }
                    else {
                        tr += "<td style='text-align: right'>" + (value.AmountA * -1).toFixed(2) + "</td>";
                        baltotin = baltotin + (value.AmountA) * -1;
                    }
                    tr += "<td style='text-align: left'>" + value.Liabilities + "</td>";
                    if (value.Amount > 0) {
                        tr += "<td style='text-align: right'>" + value.Amount.toFixed(2) + "</td>";
                        baltotex = baltotex + value.Amount;

                    }
                    else {
                        tr += "<td style='text-align: right'>" + (value.Amount * -1).toFixed(2) + "</td>";
                        baltotex = baltotex + (value.Amount) * -1;
                    }

                    tr += "</tr>"

                    $("#blcsheetbody").append(tr);
                });
                $("#tot_ass").html(baltotin.toFixed(2));
                $("#tot_lib").html(baltotex.toFixed(2));

                if (baltotin > baltotex) {
                    $("#tot_loss2").html(parseFloat(baltotin).toFixed(2) - parseFloat(baltotex).toFixed(2));
                    $("#tot_ex1").html(baltotin.toFixed(2));
                    $("#tot_in1").html(baltotin.toFixed(2));
                }
                if (baltotin < baltotex) {
                    $("#tot_loss1").html(parseFloat(baltotex).toFixed(2) - parseFloat(baltotin).toFixed(2));
                    $("#tot_ex1").html(baltotex.toFixed(2));
                    $("#tot_in1").html(baltotex.toFixed(2));
                }
                $('.loader').hide();
            }
        }
    });
});
// Cash Ladger  #####################################################################################################################################################
$(document).on("keydown", "#ladgersubmit", function (event) {
    $(this).click()
})
$(document).on("click", "#ladgersubmit", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var buy_cus_name = $('#buy_cus_name').val();
    $("#op_debit").html('.');
    $("#op_credit").html('.');
    var accname = $("#buy_cus_name option:selected").attr('data-accname');
    tot_debit = 0;
    tot_credit = 0;
    total_bal = 0;
    bal = 0;
    if (buy_cus_name != '') {
        $('.loader').show();
        $.ajax({
            type: "POST",
            url: '/cash_ladger/cashladgerdetails',
            dataType: 'json',
            data: {
                start_date: start_date,
                end_date: end_date,
                buy_cus_name: buy_cus_name,
                accname: accname
            },
            success: function (data) {
                console.log(data);
                if (data['success'] == true) {
                    var outstading = data['outstanding'];
                    var outstand_opning = data['outstand_opning'];
                    if (data.ledger == '' || data.ledger == null) $('.loader').hide();
                    var html = '<div class="showsearchdata">';
                    html += '<div class="row">';
                    html += '<div class="col-md-12">';
                    html += '<div class="table-responsive">';
                    html += '<table id="userTable" class="userTable table table-bordered adsearch">';
                    html += '<thead>';
                    html += '<tr>';
                    html += '<th>Vouc_code</th>';
                    html += '<th>Date</th>';
                    html += '<th>Account Name</th>';
                    html += '<th>Narration</th>';
                    html += '<th>Debit</th>';
                    html += '<th>Credit</th>';
                    html += '<th>Balance</th>';
                    html += '</tr>';
                    html += '</thead>';
                    html += '<tbody>';
                    $.each(data.ledger, function (index, value) {
                        if (value.debit != 0 || value.credit != 0) {
                            if (value.CNCL == 'Y') html += "<tr style='background-color: red'>";
                            else html += "<tr>";
                            html += "<td style='text-align: center'>" + value.cjsp + "/" + value.vouc_code + "</td>";
                            html += "<td style='text-align: center'>" + value.Date + "</td>";
                            if (value.Narration1 == undefined || value.Narration1 == null) value.Narration1 = " ";
                            if (value.Narration2 == undefined || value.Narration2 == null) value.Narration2 = " ";
                            if (value.cash_remark == undefined || value.cash_remark == null) value.cash_remark = " ";
                            html += "<td style='text-align: left'>" + value.ACNAme + "</td>";
                            html += "<td style='text-align: left'>";
                            if (value.cash_narr == null || value.cash_narr == '' || value.cash_narr == undefined) flag = 1
                            else {
                                var NarrArr = JSON.parse(value.cash_narr);
                                html += "<table border=1 style='padding:1px'>";
                                html += "<tr>";
                                html += "<td style='padding:1px'>Entry No</td>";
                                html += "<td style='padding:1px'>Date</td>";
                                for (var i = 0; i < NarrArr.length; i++) {
                                    if (NarrArr[i] != null && NarrArr[i].Para_Array != null) {
                                        for (let j = 0; j < NarrArr[i].Para_Array.length; j++) {
                                            html += "<td style='padding:1px'>" + NarrArr[i].Para_Array[j].Ded_Par_dsc + "</td>";
                                        }
                                        break;
                                    }
                                }
                                html += "</tr>";
                                for (var i = 0; i < NarrArr.length; i++) {
                                    if (NarrArr[i] != null) {
                                        html += "<tr>";
                                        html += "<td style='padding:1px'>" + NarrArr[i].main_bk + "/" + NarrArr[i].c_j_s_p + "/" + NarrArr[i].vouc_code + "</td>";
                                        html += "<td style='padding:1px'>" + NarrArr[i].Date + "</td>";
                                        if (NarrArr[i].Para_Array != null) {
                                            for (let j = 0; j < NarrArr[i].Para_Array.length; j++) {
                                                html += "<td style='padding:1px;text-align:right'>" + NarrArr[i].Para_Array[j].Ded_Par_value + "</td>";
                                            }
                                        }
                                        html += "</tr>";
                                    }
                                }
                                html += "</table>";
                            }
                            html += "" + value.Narration1 + "/" + value.Narration2 + "/" + value.cash_remark + "";
                            html += "</td>";
                            html += "<td style='text-align: right'>" + value.debit.toFixed(2) + "</td>";
                            html += "<td style='text-align: right'>" + value.credit.toFixed(2) + "</td>";
                            if (value.Balance >= 0) html += "<td style='text-align: right'>" + value.Balance + "_DR" + "</td>";
                            if (value.Balance < 0) html += "<td style='text-align: right'>" + (value.Balance * -1) + "_CR" + "</td>";
                            if (value.CNCL != 'Y') tot_debit = tot_debit + value.debit;
                            if (value.CNCL != 'Y') tot_credit = tot_credit + value.credit;
                            total_bal = tot_debit - tot_credit;
                            html += "</tr>"
                        }
                    });

                    html += '</tbody>';
                    html += '<tfoot>';
                    html += '<tr>';
                    html += '<th class="excludesearch"></th>';
                    html += '<th>Date</th>';
                    html += '<th>Account Name</th>';
                    html += '<th>Narration</th>';
                    html += '<th>Debit</th>';
                    html += '<th>Credit</th>';
                    html += '<th>Balance</th>';
                    html += '</tr>';
                    html += '<tr>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td style="font-size: 14px;text-align: center;">Opening Balance</td>';
                    html += '<td id="op_debit" style="font-size: 14px;text-align: right"></td>';
                    html += '<td id="op_credit" style="font-size: 14px;text-align: right"></td>';
                    html += '<td></th>';
                    html += '</tr>';
                    html += '</tfoot>';
                    html += '<tr>';
                    html += '<td style="font-size: 14px;text-align: center;">Total</td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td id="tot_debit" style="font-size: 14px;text-align: right; padding-right: 7px">' + tot_debit.toFixed(2) + '</td>';
                    html += '<td id="tot_credit" style="font-size: 14px;text-align: right; padding-right: 7px">' + tot_credit.toFixed(2) + '</td>';
                    html += '<td ></td>';
                    html += '</tr>';
                    html += '</table>';
                    $("#datatableledger").html(html);
                    // $("#tot_debit").html(tot_debit.toFixed(2));
                    // $("#tot_credit").html(tot_credit.toFixed(2));
                    if (total_bal > 0) $("#total").html(total_bal.toFixed(2));
                    if (total_bal < 0) $("#total").html((total_bal * -1).toFixed(2));

                    if (data['op_bal'] >= 0) $("#op_debit").html(parseFloat(data['op_bal']).toFixed(2))
                    if (data['op_bal'] < 0) $("#op_credit").html((parseFloat(data['op_bal']).toFixed(2)) * -1)

                    if (outstading == null || outstading == '' || outstading == []) flag = 1
                    else {
                        $('#OutstandingHeading').show();
                        $('#Outstanding').show();
                    }
                    var htmlout = '';
                    var htmlout = '<div class="showsearchdata">';
                    htmlout += '<div class="row">';
                    htmlout += '<div class="col-md-12">';
                    htmlout += '<div class="table-responsive">';
                    htmlout += '<table id="userTableOut" class="userTable table table-striped table-bordered table-hover adsearch">';
                    htmlout += '<thead>';
                    htmlout += '<tr>';
                    htmlout += '<th>Date</th>';
                    htmlout += '<th>Bill No</th>';
                    htmlout += '<th>Broker</th>';
                    htmlout += '<th>Bill-Amt</th>';
                    htmlout += '<th>Recd-Amt</th>';
                    htmlout += '<th>Disc-Amt</th>';
                    htmlout += '<th>Days</th>';
                    htmlout += '<th>Balance</th>';
                    htmlout += '<th>Cumm-Balance</th>';
                    htmlout += '</tr>';
                    htmlout += '</thead>';
                    htmlout += '<tbody>';
                    var Comm_Balance = 0;
                    $.each(outstading, function (index, value) {
                        htmlout += "<tr>";
                        var data = moment(value.cash_date).format('DD/MM/YYYY');
                        htmlout += "<td style='text-align: center'>" + data + "</td>";
                        htmlout += "<td style='text-align: center'>" + value.main_bk + "/" + value.c_j_s_p + "/" + value.vouc_code + "</td>";
                        var brname = '';
                        if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) brname = '';
                        else brname = value.broker_Code.ACName
                        htmlout += "<td style='text-align: left'>" + brname + "</td>";
                        htmlout += "<td style='text-align: left'>" + value.Bill_Amount + "</td>";
                        htmlout += "<td style='text-align: right'>" + value.Rec_Amount + "</td>";
                        // if(value.main_bk == 'SB'){
                        htmlout += "<td style='text-align: right'>" + value.Add_Ded_Amt_Tot + "</td>";
                        // }
                        console.log(value.Add_Ded_Amt_Tot, value.Rec_Amount)
                        // else htmlout += "<td style='text-align: right'>" + value.Add_Ded_Amt_Tot + "</td>";
                        htmlout += "<td style='text-align: right'></td>";
                        htmlout += "<td style='text-align: right'>" + value.outstanding_balance + "</td>";
                        if (value.main_bk == 'OnAcc') {
                            Comm_Balance = parseFloat(Comm_Balance) - parseFloat(value.Rec_Amount);
                        }
                        else Comm_Balance = parseFloat(Comm_Balance) + parseFloat(value.outstanding_balance);
                        htmlout += "<td style='text-align: right'>" + Comm_Balance.toFixed(2) + "</td>";
                        htmlout += "</tr>"
                    });
                    htmlout += '</tbody>';
                    htmlout += '<tfoot>';
                    htmlout += '<tr>';
                    htmlout += '<th class="excludesearchout"></th>';
                    htmlout += '<th>Bill No</th>';
                    htmlout += '<th>Broker</th>';
                    htmlout += '<th>Bill-Amt</th>';
                    htmlout += '<th>Recd-Amt</th>';
                    htmlout += '<th>Disc-Amt</th>';
                    htmlout += '<th>Days</th>';
                    htmlout += '<th>Balance</th>';
                    htmlout += '<th>Cumm-Balance</th>';
                    htmlout += '</tr>';
                    htmlout += '</tfoot>';
                    htmlout += '</table>';
                    $("#Outstanding").html(htmlout);

                    $('#LadgerMonthlyHeading').show();
                    var htmlLadgerMont = '';
                    htmlLadgerMont = '<div class="showsearchdata">';
                    htmlLadgerMont += '<div class="row">';
                    htmlLadgerMont += '<div class="col-md-12">';
                    htmlLadgerMont += '<div class="table-responsive">';
                    htmlLadgerMont += '<table id="" class="table table-striped table-bordered table-hover adsearch">';
                    htmlLadgerMont += '<thead>';
                    htmlLadgerMont += '<tr>';
                    htmlLadgerMont += '<th>Month</th>';
                    htmlLadgerMont += '<th>Debit</th>';
                    htmlLadgerMont += '<th>Credit</th>';
                    htmlLadgerMont += '<th>Balance</th>';
                    htmlLadgerMont += '</tr>';
                    htmlLadgerMont += '</thead>';
                    htmlLadgerMont += '<tbody>';
                    var dat = moment(data.ledger[0].Date, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                    var Month = moment(dat).format('MM/YY');
                    MonthCredit = 0;
                    MonthDebit = 0;
                    TotBal = 0;
                    $.each(data.ledger, function (index, value) {
                        // if(value.debit != 0 || value.credit!= 0){
                        var date = moment(value.Date, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                        date = moment(date).format('MM/YY');
                        console.log(date, Month)

                        if (date != Month) {
                            bal = parseFloat(MonthDebit - MonthCredit);
                            TotBal = TotBal + parseFloat(bal);
                            if (bal != 0) {
                                htmlLadgerMont += "<tr>";
                                htmlLadgerMont += "<td style='text-align: center'>" + Month + "</td>";
                                htmlLadgerMont += "<td style='text-align: right'>" + MonthDebit.toFixed(2) + "</td>";
                                htmlLadgerMont += "<td style='text-align: right'>" + MonthCredit.toFixed(2) + "</td>";
                                if (bal >= 0) htmlLadgerMont += "<td style='text-align: right'>" + bal.toFixed(2) + "_DR" + "</td>";
                                if (bal < 0) htmlLadgerMont += "<td style='text-align: right'>" + (bal * -1).toFixed(2) + "_CR" + "</td>";
                                htmlLadgerMont += "</tr>";
                            }
                            MonthCredit = 0;
                            MonthDebit = 0;
                            Month = date;
                        }
                        if (value.credit == '' || value.credit == undefined || value.credit == null || isNaN(value.credit)) value.credit = 0;
                        if (value.debit == '' || value.debit == undefined || value.debit == null || isNaN(value.debit)) value.debit = 0;
                        MonthCredit = MonthCredit + parseFloat(value.credit);
                        MonthDebit = MonthDebit + parseFloat(value.debit);
                        // if(value.Balance == '' || value.Balance == undefined || value.Balance == null || isNaN(value.Balance))value.Balance = 0;
                        // MonthBal = MonthBal + parseFloat(value.Balance);
                        // }
                    });
                    bal = parseFloat(MonthDebit - MonthCredit);
                    TotBal = TotBal + parseFloat(bal);
                    if (bal != 0) {
                        htmlLadgerMont += "<tr>";
                        htmlLadgerMont += "<td style='text-align: center'>" + Month + "</td>";
                        htmlLadgerMont += "<td style='text-align: right'>" + MonthDebit.toFixed(2) + "</td>";
                        htmlLadgerMont += "<td style='text-align: right'>" + MonthCredit.toFixed(2) + "</td>";
                        if (bal >= 0) htmlLadgerMont += "<td style='text-align: right'>" + bal.toFixed(2) + "_DR" + "</td>";
                        if (bal < 0) htmlLadgerMont += "<td style='text-align: right'>" + (bal * -1).toFixed(2) + "_CR" + "</td>";
                        htmlLadgerMont += "</tr>";
                    }
                    htmlLadgerMont += '</tbody>';
                    htmlLadgerMont += '<tr>';
                    htmlLadgerMont += '<td style="font-size: 14px;text-align: center;">Total</td>';
                    htmlLadgerMont += '<td style="text-align: right;">' + tot_debit.toFixed(2) + '</td>';
                    htmlLadgerMont += '<td style="text-align: right;">' + tot_credit.toFixed(2) + '</td>';
                    if (TotBal >= 0) htmlLadgerMont += '<td style="text-align: right;">' + TotBal.toFixed(2) + '_DR</td>';
                    if (TotBal < 0) htmlLadgerMont += '<td style="text-align: right;">' + (TotBal * -1).toFixed(2) + '_CR</td>';
                    htmlLadgerMont += '</tr>';
                    htmlLadgerMont += '</table>';
                    $("#LadgerMonthly").html(htmlLadgerMont);

                    dattable = jQuery('.userTable').DataTable({
                        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                        "processing": false,
                        "serverSide": false,
                        "colReorder": true,
                        "autoWidth": false,
                        "ordering": false,
                        "paging": false,
                        // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "buttons": [
                            {
                                extend: 'excel',
                                className: 'btn-default btn-excel',
                                exportOptions: {
                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                            },
                            {
                                extend: 'pdf',
                                className: 'btn-default btn-pdf',
                                exportOptions: {

                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                                footer: true,
                                orientation: 'landscape',
                                customize: function (doc) {
                                    doc.content.splice(0, 0, {
                                        margin: [0, 0, 0, 12],
                                        alignment: 'center',
                                        text: 'Soft Sauda'
                                    });
                                },
                                messageBottom: 'Exported from Soft Sauda'
                            },
                            {
                                extend: 'print',
                                className: 'btn-default btn-print',
                                exportOptions: {
                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                            },
                        ],
                        "order": [1, 'asc'],
                        "columnDefs": [{
                            "className": "actioncell",
                            "orderable": false,
                            "searchable": false,
                            "sortable": false,
                            "targets": [0],
                            "width": "5%"
                        }],
                    })
                    $('#userTable tfoot th').not('.excludesearch').each(function () {
                        var title = $(this).text();
                        $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                        function resizeInput() {
                            var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                            var widthTester = $("<span>" + content + "</span>").hide();
                            widthTester.insertAfter($(this));
                            $(this).css("width", widthTester.width() + "px");
                            widthTester.remove();
                        }
                        $('.resizing-input').focusout(resizeInput).each(resizeInput);
                    });
                    $('#userTable tfoot').insertBefore('#userTable thead');
                    $('#userTableOut tfoot th').not('.excludesearchout').each(function () {
                        var title = $(this).text();
                        $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                        function resizeInput() {
                            var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                            var widthTester = $("<span>" + content + "</span>").hide();
                            widthTester.insertAfter($(this));
                            $(this).css("width", widthTester.width() + "px");
                            widthTester.remove();
                        }
                        $('.resizing-input').focusout(resizeInput).each(resizeInput);
                    });
                    $('#userTableOut tfoot').insertBefore('#userTableOut thead');
                    dattable.columns().every(function () {
                        var that = this;
                        $('input', this.footer()).on('keyup change clear', function () {
                            if (that.search() !== this.value) {
                                that
                                    .search(this.value)
                                    .draw();
                            }
                        });
                    });
                    $('.loader').hide();
                }
            }
        });
    }
    else {
        swal({
            title: "Ladger",
            text: "Please Select Account",
            icon: "warning",
            timer: 1000,
            buttons: false
        })
    }

});
$(document).on("keydown", "#ShowCashBankLadger", function (event) {
    $(this).click()
})
$(document).on("click", "#ShowCashBankLadger", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var buy_cus_name = $('#buy_cus_name').val();
    $("#op_debit").html('.');
    $("#op_credit").html('.');
    var accname = $("#buy_cus_name option:selected").attr('data-accname');
    tot_debit = 0;
    tot_credit = 0;
    total_bal = 0;
    bal = 0;
    if (buy_cus_name != '') {
        $('.loader').show();
        // $('#ledgerbody > tr > td').remove();
        $.ajax({
            type: "POST",
            url: '/cash_ladger/cash_bank_ladger_details',
            dataType: 'json',
            data: {
                start_date: start_date,
                end_date: end_date,
                buy_cus_name: buy_cus_name,
                accname: accname
            },
            success: function (data) {
                console.log(data);
                if (data['success'] == true) {
                    var outstading = data['outstanding'];
                    var outstand_opning = data['outstand_opning'];
                    // console.log("length",data.ledger.length);
                    if (data.ledger == '' || data.ledger == null) $('.loader').hide();
                    var html = '<div class="showsearchdata">';
                    html += '<div class="row">';
                    html += '<div class="col-md-12">';
                    html += '<div class="table-responsive">';
                    html += '<table id="userTable" class="userTable table table-striped table-bordered table-hover adsearch">';
                    html += '<thead>';
                    html += '<tr>';
                    html += '<th>Vouc_code</th>';
                    html += '<th>Date</th>';
                    html += '<th>Account Name</th>';
                    html += '<th>Narration</th>';
                    html += '<th>Cheq No</th>';
                    html += '<th>Receipt</th>';
                    html += '<th>Payment</th>';
                    html += '<th>Balance</th>';
                    html += '</tr>';
                    html += '</thead>';
                    html += '<tbody>';
                    $.each(data.ledger, function (index, value) {
                        if (value.debit != 0 || value.credit != 0) {
                            html += "<tr>";
                            html += "<td style='text-align: center'>" + value.cjsp + "/" + value.vouc_code + "</td>";
                            html += "<td style='text-align: center'>" + value.Date + "</td>";
                            if (value.Narration1 == undefined || value.Narration1 == null) value.Narration1 = " ";
                            if (value.Narration2 == undefined || value.Narration2 == null) value.Narration2 = " ";
                            if (value.cash_remark == undefined || value.cash_remark == null) value.cash_remark = " ";
                            html += "<td style='text-align: left'>" + value.ACNAme + "</td>";
                            html += "<td style='text-align: left'>";
                            html += "" + value.Narration1 + "/" + value.Narration2 + "/" + value.cash_remark + "";
                            html += "</td>";
                            if (value.Type == undefined || value.Type == null) value.Type = "";
                            if (value.ChqNo == undefined || value.ChqNo == null) value.ChqNo = "";
                            html += "<td style='text-align: center'>" + value.Type + "</br>" + value.ChqNo + "</td>";
                            html += "<td style='text-align: right'>" + value.debit.toFixed(2) + "</td>";
                            html += "<td style='text-align: right'>" + value.credit.toFixed(2) + "</td>";
                            if (value.Balance >= 0) html += "<td style='text-align: right'>" + value.Balance + "_DR" + "</td>";
                            if (value.Balance < 0) html += "<td style='text-align: right'>" + (value.Balance * -1) + "_CR" + "</td>";
                            tot_debit = tot_debit + value.debit;
                            tot_credit = tot_credit + value.credit;
                            total_bal = tot_debit - tot_credit;
                            html += "</tr>"
                        }
                    });

                    html += '</tbody>';
                    html += '<tfoot>';
                    html += '<tr>';
                    html += '<th class="excludesearch"></th>';
                    html += '<th>Date</th>';
                    html += '<th>Account Name</th>';
                    html += '<th>Narration</th>';
                    html += '<th>Cheq No</th>';
                    html += '<th>Receipt</th>';
                    html += '<th>Payment</th>';
                    html += '<th>Balance</th>';
                    html += '</tr>';
                    html += '<tr>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td style="font-size: 14px;text-align: center;">Opening Balance</td>';
                    html += '<td id="op_debit" style="font-size: 14px;text-align: right"></td>';
                    html += '<td id="op_credit" style="font-size: 14px;text-align: right"></td>';
                    html += '<td></th>';
                    html += '</tr>';
                    html += '</tfoot>';
                    html += '<tr>';
                    html += '<td style="font-size: 14px;text-align: center;">Total</td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td id="tot_debit" style="font-size: 14px;text-align: right; padding-right: 7px">' + tot_debit.toFixed(2) + '</td>';
                    html += '<td id="tot_credit" style="font-size: 14px;text-align: right; padding-right: 7px">' + tot_credit.toFixed(2) + '</td>';
                    html += '<td ></td>';
                    html += '</tr>';
                    html += '</table>';
                    $("#datatableledger").html(html);
                    // $("#tot_debit").html(tot_debit.toFixed(2));
                    // $("#tot_credit").html(tot_credit.toFixed(2));
                    if (total_bal > 0) $("#total").html(total_bal.toFixed(2));
                    if (total_bal < 0) $("#total").html((total_bal * -1).toFixed(2));

                    if (data['op_bal'] >= 0) $("#op_debit").html(parseFloat(data['op_bal']).toFixed(2))
                    if (data['op_bal'] < 0) $("#op_credit").html((parseFloat(data['op_bal']).toFixed(2)) * -1)

                    $('#LadgerMonthlyHeading').show();
                    var htmlLadgerMont = '';
                    htmlLadgerMont = '<div class="showsearchdata">';
                    htmlLadgerMont += '<div class="row">';
                    htmlLadgerMont += '<div class="col-md-12">';
                    htmlLadgerMont += '<div class="table-responsive">';
                    htmlLadgerMont += '<table id="" class="table table-striped table-bordered table-hover adsearch">';
                    htmlLadgerMont += '<thead>';
                    htmlLadgerMont += '<tr>';
                    htmlLadgerMont += '<th>Month</th>';
                    htmlLadgerMont += '<th>Debit</th>';
                    htmlLadgerMont += '<th>Credit</th>';
                    htmlLadgerMont += '<th>Balance</th>';
                    htmlLadgerMont += '</tr>';
                    htmlLadgerMont += '</thead>';
                    htmlLadgerMont += '<tbody>';
                    var dat = moment(data.ledger[0].Date, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                    var Month = moment(dat).format('MM/YY');
                    MonthCredit = 0;
                    MonthDebit = 0;
                    TotBal = 0;
                    $.each(data.ledger, function (index, value) {
                        var date = moment(value.Date, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                        date = moment(date).format('MM/YY');
                        console.log(date, Month)
                        if (date != Month) {
                            bal = parseFloat(MonthDebit - MonthCredit);
                            TotBal = TotBal + parseFloat(bal);
                            if (bal != 0) {
                                htmlLadgerMont += "<tr>";
                                htmlLadgerMont += "<td style='text-align: center'>" + Month + "</td>";
                                htmlLadgerMont += "<td style='text-align: right'>" + MonthDebit.toFixed(2) + "</td>";
                                htmlLadgerMont += "<td style='text-align: right'>" + MonthCredit.toFixed(2) + "</td>";
                                if (bal >= 0) htmlLadgerMont += "<td style='text-align: right'>" + bal.toFixed(2) + "_DR" + "</td>";
                                if (bal < 0) htmlLadgerMont += "<td style='text-align: right'>" + (bal * -1).toFixed(2) + "_CR" + "</td>";
                                htmlLadgerMont += "</tr>";
                            }
                            MonthCredit = 0;
                            MonthDebit = 0;
                            Month = date;
                        }
                        if (value.credit == '' || value.credit == undefined || value.credit == null || isNaN(value.credit)) value.credit = 0;
                        if (value.debit == '' || value.debit == undefined || value.debit == null || isNaN(value.debit)) value.debit = 0;
                        MonthCredit = MonthCredit + parseFloat(value.credit);
                        MonthDebit = MonthDebit + parseFloat(value.debit);
                    });
                    bal = parseFloat(MonthDebit - MonthCredit);
                    TotBal = TotBal + parseFloat(bal);
                    if (bal != 0) {
                        htmlLadgerMont += "<tr>";
                        htmlLadgerMont += "<td style='text-align: center'>" + Month + "</td>";
                        htmlLadgerMont += "<td style='text-align: right'>" + MonthDebit.toFixed(2) + "</td>";
                        htmlLadgerMont += "<td style='text-align: right'>" + MonthCredit.toFixed(2) + "</td>";
                        if (bal >= 0) htmlLadgerMont += "<td style='text-align: right'>" + bal.toFixed(2) + "_DR" + "</td>";
                        if (bal < 0) htmlLadgerMont += "<td style='text-align: right'>" + (bal * -1).toFixed(2) + "_CR" + "</td>";
                        htmlLadgerMont += "</tr>";
                    }
                    htmlLadgerMont += '</tbody>';
                    htmlLadgerMont += '<tr>';
                    htmlLadgerMont += '<td style="font-size: 14px;text-align: center;">Total</td>';
                    htmlLadgerMont += '<td style="text-align: right;">' + tot_debit.toFixed(2) + '</td>';
                    htmlLadgerMont += '<td style="text-align: right;">' + tot_credit.toFixed(2) + '</td>';
                    if (TotBal >= 0) htmlLadgerMont += '<td style="text-align: right;">' + TotBal.toFixed(2) + '_DR</td>';
                    if (TotBal < 0) htmlLadgerMont += '<td style="text-align: right;">' + (TotBal * -1).toFixed(2) + '_CR</td>';
                    htmlLadgerMont += '</tr>';
                    htmlLadgerMont += '</table>';
                    $("#LadgerMonthly").html(htmlLadgerMont);

                    dattable = jQuery('.userTable').DataTable({
                        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                        "processing": false,
                        "serverSide": false,
                        "colReorder": true,
                        "autoWidth": false,
                        "ordering": false,
                        "paging": false,
                        // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "buttons": [
                            {
                                extend: 'excel',
                                className: 'btn-default btn-excel',
                                exportOptions: {
                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                            },
                            {
                                extend: 'pdf',
                                className: 'btn-default btn-pdf',
                                exportOptions: {

                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                                footer: true,
                                orientation: 'landscape',
                                customize: function (doc) {
                                    doc.content.splice(0, 0, {
                                        margin: [0, 0, 0, 12],
                                        alignment: 'center',
                                        text: 'Soft Sauda'
                                    });
                                },
                                messageBottom: 'Exported from Soft Sauda'
                            },
                            {
                                extend: 'print',
                                className: 'btn-default btn-print',
                                exportOptions: {
                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                            },
                        ],
                        "order": [1, 'asc'],
                        "columnDefs": [{
                            "className": "actioncell",
                            "orderable": false,
                            "searchable": false,
                            "sortable": false,
                            "targets": [0],
                            "width": "5%"
                        }],
                    })
                    $('#userTable tfoot th').not('.excludesearch').each(function () {
                        var title = $(this).text();
                        $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                        function resizeInput() {
                            var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                            var widthTester = $("<span>" + content + "</span>").hide();
                            widthTester.insertAfter($(this));
                            $(this).css("width", widthTester.width() + "px");
                            widthTester.remove();
                        }
                        $('.resizing-input').focusout(resizeInput).each(resizeInput);
                    });
                    $('#userTable tfoot').insertBefore('#userTable thead');
                    $('#userTableOut tfoot th').not('.excludesearchout').each(function () {
                        var title = $(this).text();
                        $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                        function resizeInput() {
                            var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                            var widthTester = $("<span>" + content + "</span>").hide();
                            widthTester.insertAfter($(this));
                            $(this).css("width", widthTester.width() + "px");
                            widthTester.remove();
                        }
                        $('.resizing-input').focusout(resizeInput).each(resizeInput);
                    });
                    $('#userTableOut tfoot').insertBefore('#userTableOut thead');
                    dattable.columns().every(function () {
                        var that = this;
                        $('input', this.footer()).on('keyup change clear', function () {
                            if (that.search() !== this.value) {
                                that
                                    .search(this.value)
                                    .draw();
                            }
                        });
                    });
                    $('.loader').hide();
                }
            }
        });
    }
    else {
        swal({
            title: "Ladger",
            text: "Please Select Account",
            icon: "warning",
            timer: 1000,
            buttons: false
        })
    }
});
// Cash Ladger End  #####################################################################################################################################################

$(document).on("click", "#salesordersummarysubmit", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var buy_cus_name = $('#buy_cus_name').val();
    var qty_bal = $('#qty_baldetails').prop('checked');
    $.ajax({
        type: "POST",
        url: '/salesorder_register/salesordersummary',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            buy_cus_name: buy_cus_name,
            qty_bal: qty_bal
        },
        success: function (data) {
            if (data['success'] == true) {
                var contract = data['hhtml'];
                console.log(contract);
                // alert("prabak")
            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.contract_detail_body').html(contract);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search" autocomplete="false" />');
                function resizeInput() {

                    var content = $(this).val().length;
                    var widthTester = $("<span>" + content + "</span>").hide();
                    widthTester.insertAfter($(this));
                    $(this).css("width", widthTester.width() + "px");
                    widthTester.remove();
                }

                $('.resizing-input').focusout(resizeInput).each(resizeInput);
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});
$(document).on("click", "#outwardsummarysubmit", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var buy_cus_name = $('#buy_cus_name').val();

    $.ajax({
        type: "POST",
        url: '/outward_register/outwardsummary',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            buy_cus_name: buy_cus_name,

        },
        success: function (data) {
            if (data['success'] == true) {
                var contract = data['hhtml'];
                console.log(contract);
                //alert("prabak")
            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.contract_detail_body').html(contract);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                function resizeInput() {

                    var content = $(this).val().length;
                    var widthTester = $("<span>" + content + "</span>").hide();
                    widthTester.insertAfter($(this));
                    $(this).css("width", widthTester.width() + "px");
                    widthTester.remove();
                }

                $('.resizing-input').focusout(resizeInput).each(resizeInput);
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});
$(document).on("click", "#domesticsummarysubmit", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var buy_cus_name = $('#buy_cus_name').val();

    $.ajax({
        type: "POST",
        url: '/domestic_register/domesticsummary',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            buy_cus_name: buy_cus_name,

        },
        success: function (data) {
            if (data['success'] == true) {
                var contract = data['hhtml'];
                console.log(contract);
                // alert("prabak")
            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.contract_detail_body').html(contract);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search" autocomplete="false" />');
                function resizeInput() {

                    var content = $(this).val().length;
                    var widthTester = $("<span>" + content + "</span>").hide();
                    widthTester.insertAfter($(this));
                    $(this).css("width", widthTester.width() + "px");
                    widthTester.remove();
                }

                $('.resizing-input').focusout(resizeInput).each(resizeInput);
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});
//delivery register
$(document).on("click", "#deliveryfiltersubmit", function () {
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var sl_code = $('#sl_code').val();
    var sb_code = $('#sbcode').val();
    var br_code = $('#brcode').val();
    var bb_code = $('#bbcode').val();
    var sl_brok = $("input[name='formfilter']:checked").val();
    $.ajax({
        type: "POST",
        url: '/delivery_register/deleverydetail',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            sl_code: sl_code,
            sb_code: sb_code,
            br_code: br_code,
            bb_code: bb_code,
            sl_brok: sl_brok,
        },
        success: function (data) {
            if (data['success'] == true) {
                var deliveryentry2 = data['hhtml'];
            }
            $('.delivery_detail_body').html(deliveryentry2);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control" placeholder="Search ' + title + '" autocomplete="false" />');
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});

//product_mast_group
$(document).on("click", ".outer-add-btn", function () {
    var parent_id = $('.inner-add-btn:last').prop('id');
    var main_loop_id = 0;
    $(".product_variation_wrapper").each(function (i, val) {
        main_loop_id++;
    });
    var product_mast = '<div class="product_variation_wrapper" id="product_variation_wrapper-' + main_loop_id + '"><div class="row pp"><div class="product_variation_wrapper" id="variation-row-' + main_loop_id + '"><div class="col-md-1 brand_pack_value"><input name="product_mast_group[' + main_loop_id + '][it_pck]" value="" placeholder="Packing" type="text" class="form-control it_pck"></div><div class="col-md-1 brand_pack_value"><select name="product_mast_group[' + main_loop_id + '][it_bk]" class="form-control it_bk"><option value="katta">Katta</option><option value="bori">Bori</option><option value="box">Box</option></select></div><div class="col-md-1"><input name="product_mast_group[' + main_loop_id + '][it_ratesl]" class="form-control it_ratesl"  placeholder="Brokerage Rate(Seller)" type="text"></div><div class="col-md-1"><select name="product_mast_group[' + main_loop_id + '][it_ratetypsl]" class="form-control it_ratetypsl"><option value="%">%</option><option value="PBag">PBag</option><option value="PQtl">PQtl</option><option value="Fix">Fix</option></select></div><div class="col-md-1"><input class="form-control it_ratebr"  name="product_mast_group[' + main_loop_id + '][it_ratebr]" placeholder="Brokerage Rate (Buyer)" type="text"></div><div class="col-md-1"><select name="product_mast_group[' + main_loop_id + '][it_ratetypbr]" class="form-control it_ratetypbr"><option value="%">%</option><option value="PBag">PBag</option><option value="PQtl">PQtl</option><option value="Fix">Fix</option></select></div><input data-repeater-delete="inner-field-' + main_loop_id + '" data-brand-index="' + main_loop_id + '" type="button" value="X"  class="inner-delete-btn btn btn-danger del"></div></div>';

    $(".product_brand_variaton").append(product_mast);
    $(".pp").css("margin-right", "-638px");
    $(".pp").css("margin-bottom", "10px");
});

$(document).on("click", ".outer-delete-btn", function () {

    alert('Product Deleted Successfully');
    var brandIndex = $(this).attr('data-repeater-delete');
    var parent_id = $(this).closest('.product_variation_wrapper').prop('id');
    $("#" + parent_id).remove();
    $('#inner-btn-' + brandIndex).remove();
});
$(document).on("click", ".inner-delete-btn", function () {
    var parent_id = $(this).closest('.product_variation_wrapper').prop('id');
    $("#" + parent_id).remove();
});;
///product_mast_end
//contact
$(document).on("click", ".contact-add-btn", function () {
    var parent_id = $('.inner-add-btn:last').prop('id');
    var main_loop_id = 100;
    $(".contact_variation_wrapper").each(function (i, val) {
        main_loop_id++;
    });
    var contact_group = '<div class="contact_variation_wrapper" id="contact_variation_wrapper-' + main_loop_id + '"><div class="row cc"><div class="input-group-col col-sm-3"><input class="form-control" name="contact_group[' + main_loop_id + '][contact_no]" placeholder="Contact" type="text" autocomplete="off"/></div><div class="input-group-col col-sm-3"> <input class="form-control" type="mobile_no" placeholder="Mobile" name="contact_group[' + main_loop_id + '][mobile_no]"/></div><div class="input-group-col col-sm-3"><input class="form-control" type="email" placeholder="Email" name="contact_group[' + main_loop_id + '][email_id]"/></div> <div class="input-group-col col-sm-3"> <select name="contact_group[' + main_loop_id + '][document]" id="document" class="form-control"> <option value="">Select Document</option><option value="All">All</option><option value="Contract From">Contract From</option><option value="Delivery Entry">Delivery Entry</option><option value="Payment Entry">Payment Entry</option><option value="Cash/Bank Book">Cash/Bank Book</option><option value="Journal Entry">Journal Entry</option></select></div><input data-repeater-delete="inner-field-' + main_loop_id + '" data-brand-index="' + main_loop_id + '" type="button" value="X"  class="contact-delete-btn btn btn-danger del"></div>';

    $(".contact_row").append(contact_group);
    $(".del").css("float", "right");
    $(".del").css("margin-right", "-98px");
    $(".del").css("margin-top", "2px");
    $(".cc").css("width", " 832px");
    $(".cc").css("margin-left", " -17px");
});
$(document).on("click", ".contact-delete-btn", function () {
    var parent_id = $(this).closest('.contact_variation_wrapper').prop('id');
    $("#" + parent_id).remove();
});

$(document).on("click", ".contact_delete_btn", function () {
    alert('Contact Group Deleted Successfully');
    var brandIndex = $(this).attr('data-brand-index');
    var parent_id = $(this).closest('.contact_variation_row-' + brandIndex).prop('id');
    $("#" + parent_id).remove();
});
$(document).on('click', '.delete-broker', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/brokers/' + id,
        success: function (response) {
            alert('Deleting Broker');
            $('.loader').hide();
            window.location.href = '/brokers/all';
        },
        error: function (err) {
            console.log(err);
        }
    });
});

// $(document).on('click', '.delete-product', function () {
//     $('.loader').show();
//     let id = $(this).attr('data-id');
//     $.ajax({
//         type: 'DELETE',
//         url: '/products/' + id,
//         success: function (response) {
//             $('.loader').hide();
//             alert('Product Deleted Successfully');
//             window.location.href = '/products/all';
//         },
//         error: function (err) {
//             console.log(err);
//         }
//     });
// });

$(document).on('click', '.delete-orders', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/orders/' + id,
        success: function (response) {
            alert('Deleting Order');
            $('.loader').hide();
            window.location.href = '/orders/all';
        },
        error: function (err) {
            console.log(err);
        }
    });
});

$(document).on('click', '.delete-offers', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/offers/' + id,
        success: function (response) {
            alert('Deleting Offer');
            $('.loader').hide();
            window.location.href = '/offers/all';
        },
        error: function (err) {
            console.log(err);
        }
    });
});

// $(document).on('click', '.delete-brand', function () {
//     $('.loader').show();
//     let id = $(this).attr('data-id');
//     swal({
//         icon:'warning',
//         title: "Sure",
//         text:'Are you sure you want to delete it?',
//         buttons: ["Cancel","Confirm"],
//         dangerMode:true
//     }).then((willDelete) => {
//         if (willDelete) {

//             $.ajax({
//                 type: 'DELETE',
//                 url: '/brands/' + id,
//                 success: function (response) {
//                     alert('Deleting Brand');
//                     $('.loader').hide();
//                     window.location.href = '/brands/all';
//                 },
//                 error: function (err) {
//                     console.log(err);
//                 }
//             });
//         }
//       });
// });

$(document).on('click', '.product_name_change', function () {
    $('.offer_product_name').hide();
    $('#offerproductname').show();
});



$("#addbrandform").on("submit", function () {
    var brandTitle = $.trim($('.brandtitle').val());
    var brandDescription = $.trim($('.branddescripiton').val());
    if (brandTitle == '') {
        $('.brandtitle').next().show();

    } else {
        $('.brandtitle').next().hide();
    }

    if (brandDescription == '') {
        $('.branddescripiton').next().show();

    } else {
        $('.branddescripiton').next().hide();
    }

    if (brandTitle == '' || brandDescription == '') {
        return false;
    }
});

$(document).on("click", "#paymentfiltersubmit", function () {
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var sl_code = $('#sl_code').val();
    var brcode = $('#brcode').val();
    var sl_brok = $("input[name='formfilter']:checked").val();
    $.ajax({
        type: "POST",
        url: '/payment_register/paymentdetail',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            sl_code: sl_code,
            brcode: brcode,
            sl_brok: sl_brok,
        },
        success: function (data) {
            if (data['success'] == true) {
                var payment = data['hhtml'];
            }
            $('.payment_detail_body').html(payment);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control" placeholder="Search ' + title + '" autocomplete="false" />');
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});


$(document).on('click', '.edit_state_btn', function () {
    var stateid = $(this).attr('data-id');
    $('.loader').show();
    // alert(stateid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/state_master/' + stateid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // //console.log(response);
                var state_name = response['state_master'].StateName;
                var stateid = response['state_master']._id;
                var vhpxstate = response['state_master']._id;
                var state_code = response['state_master'].StateCode;
                var state_capital = response['state_master'].StateCapital;
                $('.state_name').val(state_name);
                $('.vhpxstate').val(vhpxstate);
                $('.state_code').val(state_code);
                $('.state_capital').val(state_capital);
                $('#edit_state').show();
                $('#edit').show();
                $('#addstate').hide();
                $('#add').hide();
                $('.state_name').focus();
                $("#edit_state").attr("action", "/state_master/edit_state/" + stateid);

            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});


$(document).on('click', '.delete-state', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/state_master/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "State Master",
                    text: "This State Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false
                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/state_master/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/state_master/state_master';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });


});


$("#addcity").on("submit", function () {
    var state_name = $.trim($('.state_name').val());
    var dis_name = $.trim($('.dis_name').val());
    // alert(stateName);
    if (state_name == '') {

        $('.state_name').next().show();

    } else {
        $('.state_name').next().hide();
    }
    if (cityName == '') {

        $('.city_name').next().show();

    } else {
        $('.city_name').next().hide();
    }
    if (dis_name == '') {

        $('.dis_name').next().show();

    } else {
        $('.dis_name').next().hide();
    }
    if (stateName == '' || cityName == '' || dis_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_city_btn', function () {
    var cityid = $(this).attr('data-id');
    $('.loader').show();
    // alert(cityid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/add_city/' + cityid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // //console.log(response);
                var city_name = response['city_master'].CityName;
                var cityid = response['city_master']._id;
                var vhpxcity = response['city_master']._id;
                var state_name = response['city_master'].StateName;
                var ctry_name = response['city_master'].DistrictName;
                var city_code = response['city_master'].CityPinCode;
                var city_std_code = response['city_master'].StdCode;
                var PartyType = response['city_master'].PartyType;
                $('.city_name').val(city_name);
                $('.vhpxcity').val(vhpxcity);
                $('.state_name').val(state_name).trigger('change');
                $('.city_code').val(city_code);
                $('.ctry_name').val(ctry_name).trigger('change');
                $('.city_std_code').val(city_std_code);
                $('.PartyType').val(PartyType).trigger('change');
                $('.city_name').focus();
                $("#addcity").attr("action", "/add_city/edit_city/" + cityid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});

// Delete City 
$(document).on('click', '.delete-city', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/add_city/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "City Master",
                    text: "This City Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false

                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/add_city/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/add_city/add_city';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });


});
///district
// $("#adddis").on( "submit", function() {
//     var dis_name = $.trim($('.dis_name').val());
//     if(dis_name== '') {

//         $('.dis_name').next().show();

//     }else{
//         $('.dis_name').next().hide();
//     }
//     if(dis_name== '' ){
//         return false;
//     }
// });
$(document).on('click', '.edit_district_btn', function () {
    var districtid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/add_district/' + districtid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var state_id = response['district_master'].state_id;
                var dis_name = response['district_master'].dis_name;
                var districtid = response['district_master']._id;
                $('#state_id').val(state_id).trigger('change');
                $('.dis_name').val(dis_name);
                $('#formheading span').text('Edit');
                $("#adddistrict").attr("action", "/add_district/edit_district/" + districtid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-district', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/add_district/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/add_district/add_district';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });

});
//product
$("#addproduct").on("submit", function () {
    var item_name = $.trim($('.item_name').val());
    // alert(stateName);
    if (item_name == '') {

        $('.item_name').next().show();

    } else {
        $('.item_name').next().hide();
    }
    if (item_name == '') {
        return false;
    }
});
// $(document).on('click', '.edit_product_btn', function () {
//     var productid = $(this).attr('data-id');
//     $('.loader').show();
//     $.ajax({
//         type: 'GET',
//         url: '/product/' + productid,
//         dataType: 'json',
//         success: function (response) {
//             if (response['success'] == true) {
//                 // //console.log(response);
//                 var item_name = response['product'].item_name;
//                 var sno = response['product'].sno;
//                 var productid = response['product']._id;
//                 $('.sno').val(sno);
//                 $('.item_name').val(item_name);
//                 $('#edit').show();
//                 $('#edit_product').show();
//                 $('#addproduct').hide();
//                 $('#add').hide();
//                 $("#edit_product").attr("action", "/product/edit_product/" + productid);
//             } else {
//                 $('.branddanger').html(response['message']);
//                 $('.branddanger').show();
//                 $('.brandsuccess').hide();
//             }
//             $('.loader').hide();
//         },
//         error: function (err) {
//             console.log(err);
//         }
//     });
// });
// $(document).on('click', '.delete-product', function () {
//     $('.loader').show();
//     let id = $(this).attr('data-id');
//     $.ajax({
//         type: 'DELETE',
//         url: '/product/' + id,
//         success: function (response) {
//             alert('confirm(Are you sure want to delete.)');
//             // $('.loader').hide();
//             window.location.href = '/product/product';
//             $('.loader').hide();
//         },
//         error: function (err) {
//             console.log(err);
//         }
//     });
// });
//expense
$("#expense").on("submit", function () {
    var expense_name = $.trim($('.expense_name').val());
    var expense_type = $.trim($('.expense_type').val());
    // alert(stateName);
    if (expense_name == '') {

        $('.expense_name').next().show();

    } else {
        $('.expense_name').next().hide();
    }
    if (expense_type == '') {

        $('.expense_type').next().show();

    } else {
        $('.expense_type').next().hide();
    }
    if (expense_name == '' || expense_type == '') {
        return false;
    }
});
$(document).on('click', '.edit_expense_btn', function () {
    var expenseid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/expense/' + expenseid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var expense_name = response['expense'].expense_name;
                var sno = response['expense'].sno;
                var expense_type = response['expense'].expense_type;
                var productid = response['expense']._id;
                $('.expense_name').val(expense_name);
                $('.expense_type').val(expense_type);
                $('#formheading span').text('Edit');
                $("#expense").attr("action", "/expense/edit_expense/" + productid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-expense', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');

    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/expense/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/expense/expense';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
//proprietor
$("#proprietor").on("submit", function () {
    var proprietor_name = $.trim($('.proprietor_name').val());
    // alert(stateName);
    if (proprietor_name == '') {

        $('.proprietor_name').next().show();

    } else {
        $('.proprietor_name').next().hide();
    }
    if (proprietor_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_proprietor_btn', function () {
    var proprietorid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/proprietor/' + proprietorid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var proprietor_name = response['proprietor'].proprietor_name;
                var proprietorid = response['proprietor']._id;
                $('.proprietor_name').val(proprietor_name);
                $('#formheading span').text('Edit');
                $("#addprop").attr("action", "/proprietor/edit_proprietor/" + proprietorid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-proprietor', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/proprietor/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/proprietor/proprietor';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });

});
// group
$("#addgroup").on("submit", function () {
    var group_name = $.trim($('.group_name').val());
    // alert(stateName);
    if (group_name == '') {

        $('.group_name').next().show();

    } else {
        $('.group_name').next().hide();
    }
    if (group_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_group_btn', function () {
    var groupid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/group/' + groupid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var group_name = response['group'].group_name;
                var groupid = response['group']._id;
                $('.group_name').val(group_name);
                $('#formheading span').text('Edit');
                $("#addgroup").attr("action", "/group/edit_group/" + groupid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
// $(document).on('click', '.delete-group', function () {
//     $('.loader').show();
//     let id = $(this).attr('data-id');
//     swal({
//         icon:'warning',
//         title: "Sure",
//         text:'Are you sure you want to delete it?',
//         buttons: ["Cancel","Confirm"],
//         dangerMode:true
//     }).then((willDelete) => {
//         if (willDelete) {
//             $.ajax({
//                 type: 'DELETE',
//                 url: '/group/' + id,
//                 success: function (response) {
//                     // $('.loader').hide();
//                     window.location.href = '/group/group';
//                     $('.loader').hide();
//                 },
//                 error: function (err) {
//                     console.log(err);
//                 }
//             });
//         }
//       });

// });

$("#bank").on("submit", function () {
    var bank_name = $.trim($('.bank_name').val());
    // alert(stateName);
    if (bank_name == '') {

        $('.bank_name').next().show();

    } else {
        $('.bank_name').next().hide();
    }
    if (bank_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_bank_btn', function () {
    var bankid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/bank/' + bankid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var bank_name = response['bank'].bank_name;
                var bnk_brnch = response['bank'].bnk_brnch;
                var bnk_ifsc = response['bank'].bnk_ifsc;
                var bnk_micr = response['bank'].bnk_micr;
                var bnk_center = response['bank'].bnk_center;
                var bnk_add = response['bank'].bnk_add;
                var bnk_add1 = response['bank'].bnk_add1;
                var bnk_dist = response['bank'].bnk_dist;
                var state_name = response['bank'].state_name;
                var bnk_cont = response['bank'].bnk_cont;
                var bankid = response['bank']._id;
                $('.bank_name').val(bank_name);
                $('.bnk_brnch').val(bnk_brnch);
                $('.bnk_ifsc').val(bnk_ifsc);
                $('.bnk_micr').val(bnk_micr);
                $('.bnk_center').val(bnk_center);
                $('.bnk_add').val(bnk_add);
                $('.bnk_add1').val(bnk_add1);
                $('.bnk_dist').val(bnk_dist).trigger('change');
                $('.state_name').val(state_name).trigger('change');
                $('.bnk_cont').val(bnk_cont);
                $('#formheading span').text('Edit');
                $('#addbrand').hide();
                $('#editbank').show();
                $("#editbank").attr("action", "/bank/edit_bank/" + bankid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-bank', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/bank/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/bank/bank';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });

});
//brand
$("#brand").on("submit", function () {
    var brand_name = $.trim($('.brand_name').val());
    // alert(stateName);
    if (brand_name == '') {

        $('.brand_name').next().show();

    } else {
        $('.brand_name').next().hide();
    }
    if (brand_name == '') {
        return false;
    }
});


$(document).on('click', '.delete-brand', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/brand/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/brand/brand';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
//courier
$("#courier").on("submit", function () {
    var courier_name = $.trim($('.courier_name').val());
    // alert(stateName);
    if (courier_name == '') {

        $('.courier_name').next().show();

    } else {
        $('.courier_name').next().hide();
    }
    if (courier_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_courie_btn', function () {
    var courierid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/courier/' + courierid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                //console.log(response);
                var courier_name = response['courier'].courier_name;
                var courierid = response['courier']._id;
                $('.courier_name').val(courier_name);
                $('#formheading span').text('Edit');
                $("#addcourier").attr("action", "/courier/edit_courier/" + courierid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-courie', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/courier/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/courier/courier';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
//Transport
$("#transport").on("submit", function () {
    var transport_name = $.trim($('.transport_name').val());
    // alert(stateName);
    if (transport_name == '') {

        $('.transport_name').next().show();

    } else {
        $('.transport_name').next().hide();
    }
    if (transport_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_transport_btn', function () {
    var transportid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/transport/' + transportid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                //console.log(response);
                var transport_name = response['transport'].transport_name;
                var transportid = response['transport']._id;
                $('.transport_name').val(transport_name);
                $('#formheading span').text('Edit');
                $("#addtrans").attr("action", "/transport/edit_transport/" + transportid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-transport', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/transport/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/transport/transport';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });

});
//term
$("#term").on("submit", function () {
    var term_name = $.trim($('.term_name').val());
    // alert(stateName);
    if (term_name == '') {

        $('.term_name').next().show();

    } else {
        $('.term_name').next().hide();
    }
    if (term_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_term_btn', function () {
    var termid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/term/' + termid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                //console.log(response);
                var term_name = response['term'].term_name;
                var termid = response['term']._id;
                $('.term_name').val(term_name);
                $('#formheading span').text('Edit');
                $("#addterm").attr("action", "/term/edit_term/" + termid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-term', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/term/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/term/term';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
//narration
$("#narration").on("submit", function () {
    var narration_name = $.trim($('.narration_name').val());
    var type = $.trim($('.type').val());
    // alert(stateName);
    if (narration_name == '' || type == '') {

        $('.narration_name').next().show();
        $('.type').next().show();

    } else {
        $('.narration_name').next().hide();
        $('.type').next().hide();
    }
    if (narration_name == '' || type == '') {
        return false;
    }
});
$(document).on('click', '.edit_narration_btn', function () {
    var narrationid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/narration/' + narrationid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                //console.log(response);
                var narration_name = response['narration'].narration_name;
                var narrationid = response['narration']._id;
                var type = response['narration'].type;
                $('.narration_name').val(narration_name);
                $('.type').val(type).trigger('change');
                $('#formheading span').text('Edit');
                $("#addnarration").attr("action", "/narration/edit_narration/" + narrationid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-narration', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/narration/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/narration/narration';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
//party
$("#party").on("submit", function () {
    var party_name = $.trim($('.party_name').val());
    var city_name = $.trim($('.city_name').val());
    // alert(stateName);
    if (party_name == '' || city_name == '') {

        $('.party_name').next().show();
        $('.city_name').next().show();

    } else {
        $('.party_name').next().hide();
        $('.city_name').next().hide();
    }
    if (party_name == '' || city_name == '') {
        return false;
    }
});

///courier_inword
$("#courier_inword").on("submit", function () {
    var party_name = $.trim($('.party_name').val());
    // alert(stateName);
    if (party_name == '') {

        $('.party_name').next().show();

    } else {
        $('.party_name').next().hide();
    }
    if (party_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_courier_inword_btn', function (e) {
    e.preventDefault();
    var checked = $('td input:checked');
    if (checked.length != 1) {

        swal({
            title: 'Improper Selection',
            text: 'Please select Atlest/only one',
            buttons: false,
            timer: 1500
        })
        return;
    }
    var courierid = $("td input:checked").first().val();
    // $('.loader').show();
    // alert(courierid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/courier_inword/' + courierid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // /alert(response);
                var cou_date = response['courier_inword'].cou_date;
                var courierid = response['courier_inword']._id;
                // alert(courierid);
                var party_sno = response['courier_inword'].party_sno;
                var cou_nm = response['courier_inword'].cou_nm;
                var cou_lotno = response['courier_inword'].cou_lotno;
                var cou_product = response['courier_inword'].cou_product;
                var cou_brand = response['courier_inword'].cou_brand;
                var cou_rate = response['courier_inword'].cou_rate;
                var cou_contdition = response['courier_inword'].cou_contdition;
                var cou_rcpt = response['courier_inword'].cou_rcpt;
                var cou_content = response['courier_inword'].cou_content;
                var remarks = response['courier_inword'].remarks;
                var cou_crgs = response['courier_inword'].cou_crgs;
                $('.cou_date').val(cou_date);
                $('.party_sno').val(party_sno).trigger('change');
                $('.cou_nm').val(cou_nm).trigger('change');
                $('.cou_lotno').val(cou_lotno);
                $('.cou_product').val(cou_product);
                $('.cou_brand').val(cou_brand);
                $('.cou_rate').val(cou_rate);
                $('.cou_contdition').val(cou_contdition);
                $('.cou_rcpt').val(cou_rcpt);
                $('.cou_content').val(cou_content);
                $('.remarks').val(remarks);
                $('.cou_crgs').val(cou_crgs);
                $('#edit_courier_inword').show();
                $('#courier_inword').hide();
                $(".edit_courier_inword").attr("action", "/courier_inword/edit_courier_inword/" + courierid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete_courier_inword', function (e) {
    e.preventDefault();
    $('.loader').show();
    let id = $("td input:checked").first().val();
    return swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'DELETE',
                url: '/courier_inword/' + id,
                success: function (response) {
                    window.location.href = '/courier_inword/courier_inword';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    })

});
//courier_outword
$("#courier_outword").on("submit", function () {
    var party_name = $.trim($('.party_name').val());
    // alert(stateName);
    if (party_name == '') {

        $('.party_name').next().show();

    } else {
        $('.party_name').next().hide();
    }
    if (party_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_courier_outword_btn', function (e) {
    e.preventDefault();
    var courierid = $("td input:checked").first().val();
    // $('.loader').show();
    // alert(courierid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/courier_outword/' + courierid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // /alert(response);
                var cou_date = response['courier_outword'].cou_date;
                var courierid = response['courier_outword']._id;
                // alert(courierid);
                var party_sno = response['courier_outword'].party_sno;
                var cou_nm = response['courier_outword'].cou_nm;
                var cou_lotno = response['courier_outword'].cou_lotno;
                var cou_product = response['courier_outword'].cou_product;
                var cou_brand = response['courier_outword'].cou_brand;
                var cou_rate = response['courier_outword'].cou_rate;
                var cou_contdition = response['courier_outword'].cou_contdition;
                var cou_rcpt = response['courier_outword'].cou_rcpt;
                var cou_content = response['courier_outword'].cou_content;
                var remarks = response['courier_outword'].remarks;
                var cou_crgs = response['courier_outword'].cou_crgs;
                $('.cou_date').val(cou_date);
                $('.party_sno').val(party_sno).trigger("change");
                $('.cou_nm').val(cou_nm).trigger("change");
                $('.cou_lotno').val(cou_lotno);
                $('.cou_product').val(cou_product).trigger("change");
                $('.cou_brand').val(cou_brand).trigger("change");
                $('.cou_rate').val(cou_rate);
                $('.cou_contdition').val(cou_contdition);
                $('.cou_rcpt').val(cou_rcpt);
                $('.cou_content').val(cou_content);
                $('.remarks').val(remarks);
                $('.cou_crgs').val(cou_crgs);
                $('#edit_courier_outword').show();
                $('#courier_outword').hide();
                $(".edit_courier_outword").attr("action", "/courier_outword/edit_courier_outword/" + courierid);
                $(".select2").width("100%");
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete_courier_outword', function (e) {
    e.preventDefault();
    $('.loader').show();
    let id = $("td input:checked").first().val();
    return swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'DELETE',
                url: '/courier_outword/' + id,
                success: function (response) {
                    window.location.href = '/courier_outword/courier_outword';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    })
});
//daily_rates
// $("#daily_rates").on( "submit", function() {
//     var item_name = $.trim($('.item_name').val());
//     var rate_min = $.trim($('.rate_min').val());
//     var rate_max = $.trim($('.rate_max').val());
//     // alert(stateName);
//     if(st_name== '' || item_name== '' || prod_spec== '' || rate_min== '' || rate_max== '' || rate_condtion== '') {

//         $('.st_name').next().show();
//         $('.item_name').next().show();
//         $('.prod_spec').next().show();
//         $('.rate_min').next().show();
//         $('.rate_max').next().show();
//         $('.rate_condtion').next().show();

//     }else{
//         $('.st_name').next().hide();
//         $('.item_name').next().hide();
//         $('.prod_spec').next().hide();
//         $('.rate_min').next().hide();
//         $('.rate_max').next().hide();
//         $('.rate_condtion').next().hide();
//     }
//     if(st_name== '' || item_name== '' || prod_spec== '' || rate_min== '' || rate_max== '' || rate_condtion== ''){
//         return false;
//     }
// });
$(document).on('click', '.edit_daily_rates_btn', function () {
    var dailyratesid = $(this).attr('data-id');
    // $('.loader').show();
    // alert(courierid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/daily_rates/' + dailyratesid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // /alert(response);
                var st_name = response['daily_rates'].st_name;
                var dailyratesid = response['daily_rates']._id;
                var item_name = response['daily_rates'].item_name;
                var filepath = response['daily_rates'].filepath;
                var prod_spec = response['daily_rates'].prod_spec;
                var rate_min = response['daily_rates'].rate_min;
                var rate_max = response['daily_rates'].rate_max;
                var rate_condtion = response['daily_rates'].rate_condtion;
                $('.st_name').val(st_name);
                $('.edit_daily_img').attr("src", filepath);
                $('.item_name').val(item_name).trigger('change').width('100%');
                $('.prod_spec').val(prod_spec);
                $('.rate_min').val(rate_min);
                $('.rate_max').val(rate_max);
                $('.rate_condtion').val(rate_condtion);
                $('#edit_daily_rates').show();
                $('#daily_rates').hide();
                $("#edit_daily_rates").attr("action", "/daily_rates/edit_daily_rates/" + dailyratesid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete_daily_rates', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/daily_rates/' + id,
        success: function (response) {
            alert('confirm(Are you sure want to delete.)');
            // $('.loader').hide();
            window.location.href = '/daily_rates/daily_rates';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_enquiry_rates_btn', function () {
    var enquiryratesid = $(this).attr('data-id');
    // $('.loader').show();
    // alert(courierid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/enquiry_rates/' + enquiryratesid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // /alert(response);
                var st_name = response['enquiry'].st_name;
                var enquiryratesid = response['enquiry']._id;
                var item_name = response['enquiry'].item_name;
                var prod_spec = response['enquiry'].prod_spec;
                var rate_min = response['enquiry'].rate_min;
                var rate_max = response['enquiry'].rate_max;
                var rate_condtion = response['enquiry'].rate_condtion;
                $('.st_name').val(st_name);
                $('.item_name').val(item_name).trigger('change');
                $('.prod_spec').val(prod_spec);
                $('.rate_min').val(rate_min);
                $('.rate_max').val(rate_max);
                $('.rate_condtion').val(rate_condtion);
                $('#edit_daily_rates').show();
                $('#daily_rates').hide();
                $("#edit_daily_rates").attr("action", "/enquiry_rates/edit_enquiry_rates/" + enquiryratesid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete_enquiry_rates', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/enquiry_rates/' + id,
        success: function (response) {
            alert('confirm(Are you sure want to delete.)');
            // $('.loader').hide();
            window.location.href = '/enquiry_rates/enquiry_rates';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
//edit_product_mast
//edit_product_mast
$(document).on('click', '.edit_product_mast_btn', function () {
    $('.loader').show();
    var product_mast_id = $(this).attr('data-id');
    alert(product_mast_id);
    $.ajax({
        type: 'GET',
        url: '/product_mast/' + product_mast_id,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                var p_code = response['product_mast'].p_code;
                var sno = response['product_mast'].sno;
                var product_name = response['product_mast'].product_name;
                var product_mast_id = response['product_mast']._id;
                var short_name = response['product_mast'].short_name;
                var hsn_code = response['product_mast'].hsn_code;
                var item_name = response['product_mast'].item_name;
                var item_unit = response['product_mast'].item_unit;
                var product_mast_group = response['product_mast'].product_mast_group;
                $('.p_code').val(p_code);
                $('.sno').val(sno);
                $('.product_name').val(product_name);
                $('.short_name').val(short_name);
                $('.hsn_code').val(hsn_code);
                $('.item_name').val(item_name);
                $('.item_unit').val(item_unit);
                var new_div;
                for (let index = 0; index < product_mast_group.length; index++) {
                    var brandvariation = product_mast_group[index];
                    var new_div = "<tr class='product_wrapper' id='prabal" + index + "'>";
                    new_div += '<td><input class="form-control" name="product_mast_group[' + index + '][it_pck]" value="' + brandvariation.it_pck + '" placeholder="Packing" type="text" required="" style="width:100%;"/></td>';
                    new_div += '<td>';
                    new_div += '<select name="product_mast_group[' + index + '][it_bk]" id="it_bk" value="" class="form-control"  style="width:100%;">';
                    new_div += '<option value="' + brandvariation.it_bk + '">' + brandvariation.it_bk + '</option>'
                    new_div += '<option value="katta">Katta</option>';
                    new_div += '<option value="bori">Bori</option>';
                    new_div += '<option value="box">Box</option>';
                    new_div += '</select>';
                    new_div += '</td>';
                    new_div += '<td><input class="form-control" type="text" placeholder="Brokerage Rate(Seller)" name="product_mast_group[' + index + '][it_ratesl]" value="' + brandvariation.it_ratesl + '" style="width:100%;"/></td>';
                    new_div += '<input type="hidden" name="cntrer' + index + '" value="' + index + '" id="cntrer' + index + '" class="form-control" style="width: 102px;text-align: -webkit-right;">';
                    new_div += '<td>';
                    new_div += '<select name="product_mast_group[' + index + '][it_ratetypsl]" id="it_ratetypsl" class="form-control" style="width:100%;">';
                    new_div += '<option value="' + brandvariation.it_ratetypsl + '">' + brandvariation.it_ratetypsl + '</option>';
                    new_div += '<option value="%">%</option>';
                    new_div += '<option value="PBag">PBag</option>';
                    new_div += '<option value="PQtl">PQtl</option>';
                    new_div += '<option value="Fix">Fix</option>';
                    new_div += '</select>';
                    new_div += '<td>';
                    new_div += '<input class="form-control" type="text" placeholder="Brokerage Rate (Buyer)" style="width:100%;" name="product_mast_group[' + index + '][it_ratebr]" value="' + brandvariation.it_ratebr + '"/>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<select name="product_mast_group[' + index + '][it_ratetypbr]" id="it_ratetypbr" value="" class="form-control" style="width:100%;">';
                    new_div += '<option value="' + brandvariation.it_ratetypbr + '">' + brandvariation.it_ratetypbr + '</option>'
                    new_div += '<option value="%">%</option>';
                    new_div += '<option value="PBag">PBag</option>';
                    new_div += '<option value="PQtl">PQtl</option>';
                    new_div += '<option value="Fix">Fix</option>';
                    new_div += '</select>';
                    new_div += '</td>';
                    if (index != 0) {
                        new_div += "<td><a onclick='remove_updateproduct(" + index + ")'; style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";

                    }
                    $('.product_mast_result').append(new_div);

                }
                //css
                $(".rr").css("margin-right", "-648px");
                $(".rr").css("margin-bottom", "10px");
                $(".del").css("float", "right");
                $(".del").css("margin-top", "-48px");
                $(".del").css("margin-right", "102px");
                $(".cc").css("margin-top", "-45px");
                $(".cc").css("margin-right", "52px");
                $(".cc").css("float", "right");
                //css end

                $('#edit').show();
                $('#edit_product_mast').show();
                $('#product_mast').hide();
                $('#show').hide();
                // $('#product_hide').hide();
                $("#product_mast").attr("action", "/product_mast/edit_product_mast/" + product_mast_id);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete_customer_mast', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/customer/' + id,
                success: function (response) {
                    window.location.href = '/customer/customer_list';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_work_mast', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/worksheet_entry/' + id,
                success: function (response) {
                    window.location.href = '/worksheet_entry/worksheet_entry_list';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_mrn', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/mrn_challan/' + id,
                success: function (response) {

                    window.location.href = '/mrn_challan/mrn_list_mast';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

function saleprint() {
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    // alert(start_date+"   "+end_date)
    $.ajax({
        type: 'GET',
        url: '/sales_order_mast/sales_order_print',
        data: {
            start_date,
            end_date
        },
        success: function (response) {
            if (response['success'] == 'true') {
                console.log(response['somast']);
                var so = response['somast'];
                var newdiv = document.createElement('div');

                new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
                new_div += '<td>' + '</td>';
                new_div += '<td id="orderpriceso' + lstidx + '">';
                new_div += ' <td  id="pacincso' + lstidx + '">';
                new_div += '</td>';
                new_div += '</td>';
                new_div += '<td>';
                new_div += '</td>';
                new_div += '<td>';
                new_div += '</td>';
                new_div += '<td>';
                new_div += '</td>'
            }
        },
        error: function (err) {
            console.log(err);
        }
    });
}


$(document).on('click', '.delete_sales', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/sales_order_mast/' + id,
                success: function (response) {
                    window.location.href = '/sales_order_mast/sales_list_mast';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_pord', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/pur_order/' + id,
                success: function (response) {
                    window.location.href = '/pur_order/pur_order_list';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
function getLastOutBook() {
    var cjsp = $('#so_no').val();
    $.ajax({
        type: 'get',
        url: '/outward_challan/lastno/' + cjsp,
        success: function (response) {
            console.log(response);
            var last = response['last'];
            $('.vouc_code').val(last);
        },
        error: function (err) {
            console.log(err);
        }
    });
}
$(document).on('click', '.delete_out', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/outward_challan/' + id,
                success: function (response) {
                    window.location.href = '/outward_challan/outward_challanlist';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_sales_order', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/sales_order_mast/' + id,
                success: function (response) {
                    window.location.href = '/sales_order_mast/sales_list_mast';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_cash_bank', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/cash_bank/' + id,
                success: function (response) {
                    window.location.href = '/cash_bank/cash_bank_list';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_promast', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/profarma/' + id,
                success: function (response) {
                    window.location.href = '/profarma/proforma_list';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_commercial', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/commercial/' + id,
                success: function (response) {
                    window.location.href = '/commercial/commercial_list';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_product_mast', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/product_mast/' + id,
                success: function (response) {
                    window.location.href = '/product_mast/product_mast';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_WIP_master', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/WIP_master/' + id,
                success: function (response) {
                    window.location.href = '/WIP_master/WIP_master';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
// $(document).on('click', '.delete_product_mast', function () {
//     $('.loader').show();
//     let id = $(this).attr('data-id');
//     $.ajax({
//         type: 'DELETE',
//         url: '/product_mast/confirm/' + id,
//         success: function (response) {
//             console.log(response)
//             if(response['success'] == "true"){
//                 swal({
//                     title: "Finish Goods Master",
//                     text: "This Product Is Used",
//                     icon: "warning",
//                     timer: 1500,
//                     buttons: false

//                 }) 
//             }
//             if(response['success'] == "false"){
//                 swal({
//                     icon:'warning',
//                     title: "Sure",
//                     text:'Are you sure you want to delete it?',
//                     buttons: ["Cancel","Confirm"],
//                     dangerMode:true
//                 }).then((willDelete) => {
//                     if (willDelete) {
//                         $.ajax({
//                             type: 'DELETE',
//                             url: '/product_mast/' + id,
//                             success: function (response) {
//                                 // $('.loader').hide();
//                                 window.location.href = '/product_mast/product_mast';
//                                 $('.loader').hide();
//                             },
//                             error: function (err) {
//                                 console.log(err);
//                             }
//                         });
//                     }
//                   });
//             }
//             // window.location.href = '/state_master/state_master';
//             $('.loader').hide();
//         },
//         error: function (err) {
//             console.log(err);
//         }
//     });
// }); 

$(document).on('click', '.delete_outmast', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/outward_challan/' + id,
                success: function (response) {
                    window.location.href = '/outward_challan/outwardchallan_list';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});





////security

$(document).on('click', '.edit_security_btn', function () {
    var securityid = $(this).attr('data-id');
    // alert(securityid);
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/security_right/' + securityid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                //console.log(response);
                var right_name = response['security'].right_name;
                var right_desc = response['security'].right_desc;
                var sno = response['security'].sno;
                var securityid = response['security']._id;
                $('.sno').val(sno);
                $('.right_name').val(right_name);
                $('.right_desc').val(right_desc);
                $('#edit_security').show();
                $('#security_add').hide();
                $("#edit_security").attr("action", "/security_right/edit_security/" + securityid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-security', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');

    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/security_right/' + id,
                success: function (response) {
                    window.location.href = '/security_right/security_right';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on("change.select2", "#br_code", function () {
    $("#delivery").show();
    $('.loader').show();
    var br_code = $("#br_code").val();
    $.ajax({
        type: 'GET',
        url: '/delivery_entry/saudaname',
        dataType: 'json',
        data: {
            ID: br_code
        },
        success: function (data) {
            // console.log(data);
            var i, j, result, sau;
            result = '';
            if (data['success'] == true) {
                var delveryentry1 = data['delveryentry2'];
                var product = data['product_mast'];
                var brand = data['brand'];
                // var party = data['party'];
                j = 0;
                for (i = 0; i < delveryentry1.length; i++) {
                    console.log(delveryentry1[i])
                    var delveryentry1det = delveryentry1[i]['contract_sauda_group'];
                    $.each(delveryentry1det, function (index, value) {

                        j++;
                        if (value['wght_bal'] > 0) {
                            var filterstartdate = moment(delveryentry1[i]['sd_date']).tz("Asia/Kolkata").format('DD/MM/YYYY');
                            result += '<tr>';
                            result += '<div id="delivery-' + index + '">';
                            result += '<td><input type="text" name="disvouc_code" id="disvouc_code' + j + '" value="' + delveryentry1[i]['vouc_code'] + '" class="form-control" style="width: 72px;text-align: -webkit-right;" readonly></td>';
                            result += '<td><input type="text" name="dissd_date" id="dissd_date' + j + '" value="' + filterstartdate + '" class="form-control" style="width: 72px;" readonly></td><td>';

                            if (delveryentry1[i]['sauda1']['sl_code'] != null || delveryentry1[i]['sauda1']['sl_code'] != undefined) result += '<input type="text" id="dispsl_code' + j + '" value="' + delveryentry1[i]['sauda1']['sl_code']['party_name'] + '" class="form-control" style="width: 172px;" readonly>';
                            else result += '<input type="text" id="dispsl_code' + j + '" class="form-control" style="width: 172px;" readonly>';

                            if (delveryentry1[i]['sauda1']['sb_code'] != null) result += '</td><td><input type="text" name="dispsb_code" id="dispsb_code' + j + '"  value="' + delveryentry1[i]['sauda1']['sb_code']['party_name'] + '" class="form-control" style="width: 72px;" readonly></td>';
                            else result += '</td><td><input type="text" name="dispsb_code" id="dispsb_code' + j + '"   class="form-control" style="width: 72px;" readonly></td>';
                            result += '<td><select disabled name="pppp_code" id="pppp_code' + j + '"  class="form-control" style="width:102px;" readonly>';
                            result += "<option value='" + value['p_code']['_id'] + "' selected>" + value['p_code']['product_name'] + "</option>";
                            // for (p = 0; p < product.length; p++) {
                            //     if (value['p_code'] == product[p]['_id']) {

                            //         result += "<option value='" + product[p]['_id'] + "' selected>" + product[p]['product_name'] + "</option>";
                            //     }
                            // }
                            result += '</select></td><td><select name="brandcode" id="brandcode' + j + '" class="form-control brand_name" style="width: 102px;" disabled>';
                            result += "<option value='" + value['brand_code']['_id'] + "' selected>" + value['brand_code']['brand_name'] + "</option>";
                            // for (b = 0; b < brand.length; b++) {
                            //     if (value['brand_code'] == brand[b]['_id']) {
                            //         result += "<option value='" + brand[b]['_id'] + "' selected>" + brand[b]['brand_name'] + "</option>";
                            //     } 

                            // }
                            result += '</select></td><td><input type="text" name="bbbag" id="bbbbag' + j + '" value="' + value['bag'] + '" class="form-control" style="width: 72px;text-align: -webkit-right;" readonly></td>';
                            result += '<td><input type="text" name="pppppck" id="pppppck' + j + '" value="' + value['pck'] + '" class="form-control" style="width: 72px;text-align: -webkit-right;" readonly></td>';
                            result += '<td><input type="text" name="wwwwght" id="wwwwght' + j + '" value="' + value['wght'] + '" class="form-control" style="width: 72px;text-align: -webkit-right;" readonly></td>';
                            result += '<td><input type="text" name="ssssd_rate" id="ssssd_rate' + j + '" value="' + value['sd_rate'] + '" class="form-control" style="width: 72px;text-align: -webkit-right;" readonly></td>';
                            result += '<td><input type="text" name="dis_ptch" id="dis_ptch' + j + '" value="' + value['wght_exe'] + '" class="form-control" style="width: 72px;text-align: -webkit-right;" readonly></td>';
                            result += '<td><input type="hidden" name="aaaaamount" id="aaaaamount' + j + '" value="' + value['amount'] + '" class="form-control" style="width: 72px;text-align: -webkit-right;" readonly>';
                            result += '<input type="text" name="contrctbal" id="contrctbal' + j + '" oninput="calc(' + j + ')" value="' + value['wght_bal'] + '"  class="form-control" style="width: 72px;text-align: -webkit-right;" readonly></td>';
                            result += '<td><input type="number" name="delivery" id="delivery' + j + '" oninput="calc(' + j + ')"  class="form-control deliveryinputcheck addingdelivery" data-sbname= "' + delveryentry1[i]['sauda1'].sl_code.party_name + '" data-sid= "' + delveryentry1[i]['sauda1'].sl_code._id + '" style="width: 72px;text-align: -webkit-right;"></td>';
                            result += '<td><input type="text" name="new_bal" id="new_bal' + j + '"   class="form-control" style="width: 72px;text-align: -webkit-right;" readonly></td><td><input type="text" name="rmv_bal" id="rmv_bal' + j + '"  placeholder="Rmv Balance" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                            result += '<td><input type="hidden" name="sssssd2id" id="sssssd2id' + j + '"  value="' + delveryentry1[i]['_id'] + '"><input type="hidden" name="sssssd2srno" id="sssssd2srno' + j + '"  value="' + j + '"><input type="hidden" name="slbrkrtmt" id="slbrkrtmt' + j + '"  value="' + value['slbrk_rt'] + '">';
                            result += '<input type="hidden" name="slbrkrtyp" id="slbrkrtyp' + j + '"  value="' + value['slbrk_type'] + '"><input type="hidden" name="brrkramt" id="brrkramt' + j + '"  value="' + value['brbrk_rt'] + '"><input type="hidden" name="brrkrtyp" id="brrkrtyp' + j + '"  value="' + value['brbrk_typ'] + '">';
                            result += '<input type="hidden" name="slbrrt" id="slbrrt' + j + '"  value="' + value['slbrk_amt'] + '">';
                            result += '<input type="hidden" name="brbrt" id="brbrt' + j + '"  value="' + value['brbrk_amt'] + '"><input type="hidden" name="selrttt" id="selrttt' + j + '"  value="' + value['s_rate'] + '"><input type="hidden" name="buyrttt" id="buyrttt' + j + '"  value="' + value['b_rate'] + '"></td></td></div>';
                            result += '</tr>';
                            glbidx = j;
                        }
                    });

                }
                sau = '<input type="button"  value="OK" id="delivery_sauda" class="btn btn-primary" />';
            }
            $('.delivery_repeat_row').html(result);
            if (delveryentry1.length) {
                $('#deliverysupport').modal('show');
            } else {
                swal({
                    title: 'Oops!',
                    text: 'No Pending Delivery',
                    buttons: false,
                    timer: 1500
                })
            }
            $('.loader').hide();
        }
    });
});
// $(document).on("click", "#contsubmit", function () {

//     alert($('#printormessage').val());

//     swal({
//         title:'Great',
//         text:'Message Sent Successful',
//         buttons:false,
//         timer:1500
//     })

// });
$(document).on("click", "#delivery_sauda", function () {
    var valid = '';
    $('.deliveryinputcheck').each(function () {
        if ($(this).val() != null && $(this).val() != '') {
            valid = true;
            $('#deliverysupport').modal('hide');
            return true;
        }
    })
    if (valid != true) {
        alert('Please add atleast one Delivery ');
        return false;
    }


    $("#delivery").hide();
    // $(".contrct").show();
    $.ajax({
        type: 'GET',
        url: '/delivery_entry/productname',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                // var result;
                var product = data['product_mast'];
                var brand = data['brand'];
                var main_loop_id = 0;

                for (i = 1; i <= glbidx; i++) {
                    var delivery = $('#delivery' + i).val();
                    var pck = $('#pppppck' + i).val();
                    var bag = $('#bag' + i).val();
                    var vouc_code = $('#disvouc_code' + i).val();
                    var sd_date = $('#sd_date' + i).val();
                    var pcode = $('#pppp_code' + i).val();
                    var brandcode = $('#brandcode' + i).val();
                    var wghttttt = $('#wwwwght' + i).val();
                    var sdrate = $('#ssssd_rate' + i).val();
                    var amountttt = $('#aaaaamount' + i).val();
                    var dis_ptch = $('#dis_ptch' + i).val();
                    var new_bal = $('#new_bal' + i).val();
                    var rmv_bal = $('#rmv_bal' + i).val();
                    var sd2id = $('#sssssd2id' + i).val();
                    var sd2srno = $('#sssssd2srno' + i).val();
                    var slbrkrtmt = $('#slbrkrtmt' + i).val();
                    var slbrkrtyp = $('#slbrkrtyp' + i).val();
                    var brrkramt = $('#brrkramt' + i).val();
                    var brrkrtyp = $('#brrkrtyp' + i).val();
                    var slbrrt = $('#slbrrt' + i).val();
                    var brbrt = $('#brbrt' + i).val();

                    var selrttt = $('#selrttt' + i).val();
                    var buyrttt = $('#buyrttt' + i).val();
                    if (delivery > 0) {
                        var result;
                        $("#delivery").each(function (i, val) {
                            main_loop_id++;
                            result += '<tr class="delivery-wrapper" id="rohit' + main_loop_id + '">';
                            result += '<td><select name="contract_sauda_group[' + main_loop_id + '][p_code]"  id="inp_code' + main_loop_id + '" onchange="chgcombo(' + main_loop_id + ')"  class="form-control" style="width:102px;">';
                            for (p = 0; p < product.length; p++) {
                                if (pcode == product[p]['_id']) {
                                    result += "<option value='" + product[p]['_id'] + "' data-product_id='" + product[p]['_id'] + "' selected>" + product[p]['product_name'] + "</option>";
                                } else {
                                    result += "<option value='" + product[p]['_id'] + "' data-product_id='" + product[p]['_id'] + "'>" + product[p]['product_name'] + "</option>";
                                }
                            }
                            result += '</select></td><td><select name="contract_sauda_group[' + main_loop_id + '][brand_code]" id="brand_name' + i + '" class="form-control brand_name" style="width: 102px;">';
                            for (b = 0; b < brand.length; b++) {
                                if (brandcode == brand[b]['_id']) {
                                    result += "<option value='" + brand[b]['_id'] + "' selected>" + brand[b]['brand_name'] + "</option>";
                                } else {
                                    result += "<option value='" + brand[b]['_id'] + "'>" + brand[b]['brand_name'] + "</option>";
                                }

                            }
                            result += '</select></td><input type="hidden" name="cntr' + main_loop_id + '" value="' + main_loop_id + '" id="cntr' + main_loop_id + '"><td><input type="number" name="contract_sauda_group[' + main_loop_id + '][bag]" id="bag' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" value="' + delivery + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                            result += '<td class="pack_name' + main_loop_id + '"><input type="number" name="contract_sauda_group[' + main_loop_id + '][pck]" step="0.0001"  id="pck' + main_loop_id + '" onchange="chgpck(' + main_loop_id + ')" oninput="calc(' + main_loop_id + ')"  value="' + pck + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                            result += '<td><select name="contract_sauda_group[' + main_loop_id + '][pck_unit]" id="inbrnd_code' + main_loop_id + '" class="form-control" style="width: 72px;"><option value="KG">KG</option></select></td>';
                            result += '<td><input type="number" step="0.0001" name="contract_sauda_group[' + main_loop_id + '][wght]" id="wght' + main_loop_id + '" value="' + wghttttt + '" oninput="calc(' + main_loop_id + ')" class="form-control wght" style="width: 82px;text-align: -webkit-right;"></td>';
                            result += '<td><input type="number" step="0.0001" name="contract_sauda_group[' + main_loop_id + '][sd_rate]" id="sel_rate' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" value="' + sdrate + '"  class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                            result += '<td><input type="number" step="0.0001" name="contract_sauda_group[' + main_loop_id + '][s_rate]" id="seler_rate' + main_loop_id + '" value="' + selrttt + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td><td><input type="number" name="contract_sauda_group[' + main_loop_id + '][b_rate]" id="buy_rate' + main_loop_id + '" value="' + buyrttt + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                            result += '<td><select name="contract_sauda_group[' + main_loop_id + '][w_q]" id="w_q' + main_loop_id + '" class="form-control w_q" style="width: 72px;">';
                            result += '<option value="W">W</option>';
                            result += '<option value="Q">Q</option>';
                            result += '</select></td>';
                            result += '<td><select name="contract_sauda_group[' + main_loop_id + '][wghtunit]" id="wghtunit' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 72px;">';
                            result += '<option value="Qtl">Qtl</option>';
                            result += '<option value="Tons">Tons</option>';
                            result += '<option value="Kg">Kg</option>';
                            result += '</select></td>';
                            result += '<td><select name="contract_sauda_group[' + main_loop_id + '][rateper]" id="rateper' + main_loop_id + '" class="form-control" style="width: 62px;text-align: -webkit-right;">';
                            result += '<option value="1">1</option>';
                            result += '<option value="10">10</option>';
                            result += '<option value="100">100</option>';
                            result += '</select></td>';
                            result += '<td><input type="number" step="0.0001" name="contract_sauda_group[' + main_loop_id + '][amount]" id="amount' + main_loop_id + '" value="' + amountttt + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                            result += '<td><select name="contract_sauda_group[' + main_loop_id + '][pcktype]" id="pcktype" class="form-control" style="width: 102px;">';
                            result += '<option value="Gross">Gross</option>';
                            result += '<option value="Net">Net</option>';
                            result += '</select></td>';
                            result += '<td><select name="contract_sauda_group[' + main_loop_id + '][g_n]" id="g_n' + main_loop_id + '" class="form-control" style="width: 102px;">';
                            result += '<option value="O">O</option>';
                            result += '<option value="N">N</option>';
                            result += '</select></td>';
                            result += '<td><input type="number" step="0.0001" name="contract_sauda_group[' + main_loop_id + '][ipack]" id="ipack' + main_loop_id + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                            result += '<td class="slbrk_name' + main_loop_id + '"><input type="number" name="contract_sauda_group[' + main_loop_id + '][slbrk_rt]" id="slbrk_rt' + main_loop_id + '" value="' + slbrkrtmt + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                            result += '<td class="slbrk_type' + main_loop_id + '"><select name="contract_sauda_group[' + main_loop_id + '][slbrk_type]" id="slbrk_type' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 102px;">';
                            result += '<option value="' + slbrkrtyp + '">' + slbrkrtyp + '</option>';
                            result += '<option value="%">%</option>';
                            result += '<option value="PBag">PBag</option>';
                            result += '<option value="PQtl">PQtl</option>';
                            result += '<option value="Fix">Fix</option>';
                            result += '</select></td>';
                            result += '<td><input type="number" step="0.0001" name="contract_sauda_group[' + main_loop_id + '][slbrk_amt]" id="slbrk_amt' + main_loop_id + '" value="' + slbrrt + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                            result += '<td class="brbrk_rt' + main_loop_id + '"><input type="number" name="contract_sauda_group[' + main_loop_id + '][brbrk_rt]" oninput="calc(' + main_loop_id + ')" value="' + brrkramt + '" id="brbrk_rt' + main_loop_id + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                            result += '<td class="brbrk_typ' + main_loop_id + '">';
                            result += '<select name="contract_sauda_group[' + main_loop_id + '][brbrk_typ]" oninput="calc(' + main_loop_id + ')" id="brbrk_typ' + main_loop_id + '" class="form-control" style="width: 102px;">';
                            result += '<option value="' + brrkrtyp + '">' + brrkrtyp + '</option>';
                            result += '<option value="%">%</option>';
                            result += '<option value="PBag">PBag</option>';
                            result += '<option value="PQtl">PQtl</option>';
                            result += '<option value="Fix">Fix</option>';
                            result += '</select></td>';
                            result += '<td><input type="number" step="0.0001" name="contract_sauda_group[' + main_loop_id + '][brbrk_amt]" oninput="calc(' + main_loop_id + ')" value="' + brbrt + '"  id="brbrk_amt' + main_loop_id + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                            result += '<td><input type="hidden" step="0.0001" name="contract_sauda_group[' + main_loop_id + '][sd2id]" value="' + sd2id + '"></td>';
                            result += '<td><input type="hidden" name="contract_sauda_group[' + main_loop_id + '][sd2srno]" value="' + sd2srno + '"></td>';
                            result += '</td>';
                            if (main_loop_id != 1) {
                                result += "<td><a data-repeater-delete='inner-field-" + main_loop_id + "' data-brand-index='" + main_loop_id + "' class='delivery-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left: -38px;'></i></a></td></tr>";
                            }

                            result += '</tr>';
                        });


                    }
                }
                $(".contract_repeat_row tbody tr").not('tr#contract_div').remove();
                $('tr#contract_div').before(result);
                calc(1);
                chgpck(1);

            }

        }
    });
});
$(document).on("click", ".delivery-delete-btn", function () {
    alert('Are you sure you want to delete this element');
    var parent_id = $(this).closest('.delivery-wrapper').prop('id');
    $("#" + parent_id).remove();
    calc(1);

});

// $(document).on("change.select2", "#br_code", function () {
//     alert('clicked');
//     $("#delivery").show();
// });
var s = 1;
var member = s + 1;
var limit = 1000;
$(document).on('click', '.addSauda', function () {
    lstidx = $("input[name*='cntr']").length + 1;
    member = lstidx;
    glbitidx = member;
    if (s == limit) {
        alert("You have reached the limit of adding " + s + " inputs");
    } else {
        var product = "";
        $.ajax({
            type: 'GET',
            url: '/contract_sauda/productname',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    product = data['product_mast'];
                    brand = data['brand'];
                    var newdiv = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
                    new_div += "<td><input type='hidden'  name='contract_sauda_group[" + lstidx + "][sd2srno]' value=" + member + ">";
                    new_div += "<input type='text'  name='contract_sauda_group[" + member + "][qty_bal]' id='qty_bal" + member + "' style='display:none'>";
                    new_div += "<input type='text'  name='contract_sauda_group[" + member + "][wght_bal]' id='wght_bal" + member + "' style='display:none'>";
                    new_div += "<input type='hidden'  name='contract_sauda_group[" + member + "][qty_exe]'  value='0'>";
                    new_div += "<input type='hidden'  name='contract_sauda_group[" + member + "][wght_exe]' value='0'>";
                    // new_div += "<select name='contract_sauda_group[" + lstidx + "][p_code]'  id='inp_code" + lstidx + "' onchange='chgcombo(" + lstidx + ")'  class='form-control select2 selectproductfocus productplace' style='width:162px;'>";
                    // new_div += "<option value=''></option>";
                    // for (j = 0; j < product.length; j++) {
                    //     new_div += "<option value='" + product[j]['_id'] + "' data-product_id='" + product[j]['_id'] + "'>" + product[j]['product_name'] + "</option>";
                    // }
                    // new_div += '</select>';
                    new_div += '<select name="contract_sauda_group[' + lstidx + '][p_code]" id="inp_code' + lstidx + '" onchange="chgcombo(' + lstidx + ')" class="form-control selectproductfocus productplace" style="width:162px">';
                    new_div += '<option value=""></option>';
                    new_div += '</select>';
                    new_div += '</td>';
                    new_div += "<td><select required name='contract_sauda_group[" + lstidx + "][brand_code]' id='brand_name" + lstidx + "'  class='form-control brandplace select2' style='width: 142px;' required>";
                    new_div += '<option value=""></option>';
                    for (i = 0; i < brand.length; i++) {
                        new_div += "<option value='" + brand[i]['_id'] + "'>" + brand[i]['brand_name'] + "</option>";
                    }
                    new_div += "</select></td><td><input type='hidden' name='cntr" + member + "' value=" + member + " id='cntr" + member + "'>";
                    new_div += "<input type='text' name='contract_sauda_group[" + lstidx + "][bag]' id='bag" + lstidx + "'  oninput='calc(" + lstidx + ")' class='form-control number' style='width: 72px;text-align: -webkit-right;' required></td>";
                    new_div += "<td class='pack_name" + lstidx + "'><input type='text' name='contract_sauda_group[" + lstidx + "][pck]'  id='pck" + lstidx + "' oninput='calc(" + lstidx + ")' class='form-control number' style='width: 72px;text-align: -webkit-right;' required></td>";
                    new_div += "<td><select name='contract_sauda_group[" + lstidx + "][pck_unit]' list='brnd_code' id='inbrnd_code" + lstidx + "'  class='form-control' style='width: 72px;'>";
                    new_div += "<option value='KG'>KG</option>";
                    new_div += "</select></td>";
                    new_div += "<td><input type='text' name='contract_sauda_group[" + lstidx + "][wght]'  id='wght" + lstidx + "' oninput='calc(" + lstidx + ")' class='form-control wght' style='width: 82px;text-align: -webkit-right;'></td>";
                    new_div += "<td><input type='text' name='contract_sauda_group[" + lstidx + "][sd_rate]'  id='sel_rate" + lstidx + "'  oninput='calc(" + lstidx + ")' class='form-control wght amountfocus' style='width: 72px;text-align: -webkit-right;' required></td>";
                    new_div += "<td><input type='text' name='contract_sauda_group[" + lstidx + "][s_rate]'  id='seler_rate" + lstidx + "'  class='form-control nofocus' style='width: 72px;text-align: -webkit-right;'></td>";
                    new_div += "<td><input type='text' name='contract_sauda_group[" + lstidx + "][b_rate]' id='buy_rate" + lstidx + "'  class='form-control nofocus' style='width: 72px;text-align: -webkit-right;'></td>";
                    new_div += "<td><select name='contract_sauda_group[" + lstidx + "][w_q]' id='w_q" + lstidx + "' oninput='calc(" + lstidx + ")' class='form-control w_q' style='width: 72px;'>";
                    new_div += "<option value='W'>W</option>";
                    new_div += "<option value='Q'>Q</option>";
                    new_div += "</select></td>";
                    new_div += "<td><select name='contract_sauda_group[" + lstidx + "][wghtunit]' id='wghtunit" + lstidx + "' oninput='calc(" + lstidx + ")' class='form-control' style='width: 72px;'>";
                    new_div += "<option value='Qtl'>Qtl</option>";
                    new_div += "<option value='Tons'>Tons</option>";
                    new_div += "<option value='Kg'>Kg</option>";
                    new_div += "</select></td>";
                    new_div += "<td><select name='contract_sauda_group[" + lstidx + "][rateper]' id='rateper" + lstidx + "'  oninput='calc(" + lstidx + ")' class='form-control' style='width: 62px;'>";
                    new_div += "<option value='1'>1</option>";
                    new_div += "<option value='10'>10</option>";
                    new_div += "<option value='100'>100</option>";
                    new_div += "</select></td>";
                    new_div += "<td><input type='text' name='contract_sauda_group[" + lstidx + "][amount]'  id='amount" + lstidx + "' class='form-control amount amountfocus' style='width: 102px;text-align: -webkit-right;'></td>";
                    new_div += "<td><select name='contract_sauda_group[" + lstidx + "][pcktype]' id='pcktype" + lstidx + "' class='form-control nofocus' style='width: 102px;'>";
                    new_div += "<option value='Gross'>Gross</option>";
                    new_div += "<option value='Net'>Net</option>";
                    new_div += "</select></td>";
                    new_div += "<td><select name='contract_sauda_group[" + lstidx + "][g_n]' id='g_n" + lstidx + "' class='form-control nofocus' style='width: 102px;'>";
                    new_div += "<option value='O'>O</option>";
                    new_div += "<option value='N'>N</option>";
                    new_div += "</select></td>";
                    new_div += "<td><input type='text' name='contract_sauda_group[" + lstidx + "][ipack]' id='ipack" + lstidx + "'  class='form-control nofocus' style='width: 102px;text-align: -webkit-right;'></td>";
                    new_div += "<td class='slbrk_name" + lstidx + "'><input type='text' name='contract_sauda_group[" + lstidx + "][slbrk_rt]'  oninput='calc(" + lstidx + ")' id='slbrk_rt" + lstidx + "' class='form-control nofocus' style='width: 102px;text-align: -webkit-right;'></td>";
                    new_div += "<td class='slbrk_type" + lstidx + "'><select name='contract_sauda_group[" + lstidx + "][slbrk_type]' oninput='calc(" + lstidx + ")' id='slbrk_type" + lstidx + "' class='form-control nofocus' style='width: 102px;'>";
                    new_div += "<option value='%'>%</option>";
                    new_div += "<option value='PBag'>PBag</option>";
                    new_div += "<option value='PQtl'>PQtl</option>";
                    new_div += "<option value='Fix'>Fix</option>";
                    new_div += "</select></td>";
                    new_div += "<td><input type='text' name='contract_sauda_group[" + lstidx + "][slbrk_amt]'  id='slbrk_amt" + lstidx + "' class='form-control nofocus' style='width: 102px;text-align: -webkit-right;'></td>";
                    new_div += "<td class='brbrk_rt" + lstidx + "'><input type='text' name='contract_sauda_group[" + lstidx + "][brbrk_rt]'  oninput='calc(" + lstidx + ")'  id='brbrk_rt" + lstidx + "' class='form-control nofocus' style='width: 102px;text-align: -webkit-right;'></td>";
                    new_div += "<td class='brbrk_typ" + lstidx + "'><select name='contract_sauda_group[" + lstidx + "][brbrk_typ]' id='brbrk_typ" + lstidx + "' oninput='calc(" + lstidx + ")' class='form-control nofocus' style='width: 102px;'>";
                    new_div += "<option value=''>Select...</option>";
                    new_div += "<option value='%'>%</option>";
                    new_div += "<option value='PBag'>PBag</option>";
                    new_div += "<option value='PQtl'>PQtl</option>";
                    new_div += "<option value='Fix'>Fix</option></select></td>";
                    new_div += "<td><input type='text' name='contract_sauda_group[" + lstidx + "][brbrk_amt]'  id='brbrk_amt" + lstidx + "' class='form-control buyerbrokfocus nofocus' style='width: 102px;text-align: -webkit-right;'></td>";
                    new_div += "<td><a data-repeater-delete='inner-field-" + lstidx + "' data-brand-index='" + member + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#contract_div");
                    s++;
                    lstidx--;
                    member++;
                    $(".brandplace").select2({
                        placeholder: "Select Brand",
                        allowClear: true,
                    });
                    $('.productplace').select2({
                        placeholder: 'Select Product',
                        allowClear: true,
                        // minimumInputLength: 3,
                        ajax: {
                            type: "GET",
                            url: '/contract_sauda/getproductname',
                            dataType: 'json',
                            data: function (term) {
                                return {
                                    term: term
                                };
                            },
                            success: function (data) {
                            },
                        },
                        templateResult: formatcity,
                        templateSelection: formatcity,
                        escapeMarkup: function (m) { return m; }
                    });
                    // $(".productplace").select2({
                    //     placeholder: "Select Product",
                    //     allowClear: true,
                    // })
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()
                }
            }
        });

    }
});
// function remove_div(member)
// {
//     alert(member);
//     if(s == 1)
//     {
//         alert("No record to delete");
//     }
//     else
//     {
//         s--;
//         calc(-lstidx);   
//         $("#rohit"+lstidx).remove();

//     }
// }
$(document).on("click", ".contract-delete-btn", function () {
    alert('Are you sure you want to delete this element');
    var parent_id = $(this).closest('.contract_wrapper').prop('id');
    //alert(parent_id)
    $("#" + parent_id).remove();
    calc(1);

});

$(document).on("click", ".sauda_delete_btn", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    var parent_id = $(this).closest('.sauda_variation_row-' + brandIndex).prop('id');
    $("#" + parent_id).remove();
    calc(1);
});
function getsateid() {
    var selid = $("#kind  option:selected").val();
    $.ajax({
        type: 'GET',
        url: '/deal_entry/getpartydeal',
        dataType: 'json',
        data: {
            selid: selid
        },
        success: function (data) {
            if (data['success']) {
                var party = data['party']
                var compstatecode = data['compstatecode']
                console.log(compstatecode);
                var partystateid = '<input type="hidden" class="form-control" name="compstateid" value="' + party[0]['state_name'] + '" id="compsateid">';

                $('.partystateid').html(partystateid);
                //$('.loader').hide();
            }
        }
    });
}
function getproduct(callback) {
    member = callback;
    lstidx = member;
    var prdtnameid = $("#wpname" + callback + " option:selected").val();
    $.ajax({
        type: 'GET',
        url: '/worksheet_entry/productlist',
        dataType: 'json',
        data: {
            prdtnameid: prdtnameid
        },
        success: function (data) {
            if (data['success']) {
                //  alert(product.length);
                var product = data['product']
                for (j = 0; j < product.length; j++) {
                    var result = '<input type="text" name="work_sheet_group[' + lstidx + '][in_qty]" value="' + product[j]['p_crtn'] + '" oninput="calc(' + lstidx + ')" id="inqty' + lstidx + '" class="form-control  work_sheet_group[' + lstidx + '][in_qty]" style="width: 142px;text-align: -webkit-right;">';
                    var c = product[j]['cbm_length'];
                    var b = product[j]['cbm_width'];
                    var m = product[j]['cbm_height'];
                    var tot = (Number(c) * Number(b) * Number(m)) / 1000000;
                    var cbm = '<input type="text" name="work_sheet_group[' + lstidx + '][perc_cbm]" id="perccbm' + lstidx + '" oninput="calc(' + lstidx + ')"value="' + tot + '"  class="form-control work_sheet_group[' + lstidx + '][perc_cbm]" style="width: 135px;text-align: -webkit-right;">';
                    var cost = '<input type="text" name="work_sheet_group[' + lstidx + '][w_cost]" id="wcost' + lstidx + '" oninput="calc(' + lstidx + ')"value="' + product[j]['export_price'] + '" class="form-control work_sheet_group[' + lstidx + '][w_cost]" style="width: 87px;text-align: -webkit-right;">';
                    var tbpc = '<input type="text" name="work_sheet_group[' + lstidx + '][w_boxperC]" id="wboxperC' + lstidx + '" oninput="calc(' + lstidx + ')"value="' + product[j]['tot_bpc'] + '" class="form-control work_sheet_group[' + lstidx + '][w_boxperC]" style="width: 142px;text-align: -webkit-right;">';
                    var orqty = '<input type="text" name="work_sheet_group[' + lstidx + '][or_qty]" id="orqty' + lstidx + '" oninput="calc(' + lstidx + ')"value="' + product[j]['tot_bpc'] + '" class="form-control work_sheet_group[' + lstidx + '][or_qty]" style="width: 92px;text-align: -webkit-right;">';
                }
                $('#innerqty' + lstidx).html(result);
                $('#cmblprt' + lstidx).html(cbm);
                $('#wcostrtrt' + lstidx).html(cost);
                $('#boxpercontainer' + lstidx).html(tbpc);
                $('#orqtytrtr' + lstidx).html(orqty);
                calc(1);
            }
        }
    });
}

// function getworksheetdata() {


//     var prdtnameid = $("#ws_no").val();
//   //  alert(prdtnameid);
//     $.ajax({
//         type: 'GET',
//         url: '/profarma/worksheetlist',
//         dataType: 'json',
//         data: {
//             prdtnameid: prdtnameid
//         },        
//         success: function (data) {
//             if (data['success']) {
//                 var product = data['workmast']
//               if  (product!=undefined)
//               console.log( product[0]['pono']);                                       
//                        var ponopro= '<input type="text" name="pro_pono" id="pro_pono" value="'+product[0]['pono']+'" class="form-control pro_pono" />';
//                        var pocus=' <select class="form-control prbank pro_cus_name select2 prbank" name="pro_cus_name"  placeholder="Please Select buyer">   <option value=""></option> {{#each acmast}}   <option value="{{this.id}}"{{#equal ../promast.pro_cus_name id}} selected=""{{/equal}}>'+this.ac_name+'</option>   {{/each}} </select>' ;




//                 $('#proponopppp').html(ponopro);
//                 $('#propocuspppp').html(pocus); 
//             }
//         }
//     });
// }


function getpriMrn(callback) {
    member = callback;
    lstidx = member;
    var prdtnameid = $("#descpso" + callback + " option:selected").val();
    // alert(prdtnameid)
    $.ajax({
        type: 'GET',
        url: '/mrn_challan/productlist',
        dataType: 'json',
        data: {
            prdtnameid: prdtnameid
        },
        success: function (data) {
            console.log(data)
            if (data['success']) {
                var product = data['product']
                for (j = 0; j < product.length; j++) {
                    var result = '<input type="number" name="sales_or_group[' + lstidx + '][order_price]" value="' + product[j]['Rm_StRate'] + '" oninput="calsalesorder(' + lstidx + ')" id="orderprice' + lstidx + '" class="form-control  sales_or_group[' + lstidx + '][order_price]" style="text-align: -webkit-right;" required>';
                }
                $('#orderpriceso' + lstidx).html(result);
                calsalesorder(1);
            }
        }
    });
}

function getdec(callback) {
    member = callback;
    lstidx = member;
    var prdtnameid = $("#descpso" + callback + " option:selected").val();
    // alert(prdtnameid)
    $.ajax({
        type: 'GET',
        url: '/sales_order_mast/productlist',
        dataType: 'json',
        data: {
            prdtnameid: prdtnameid
        },
        success: function (data) {
            console.log(data)
            if (data['success']) {

                var product = data['product']
                for (j = 0; j < product.length; j++) {
                    if (product[j]['Fg_SPrice'] == '' || product[j]['Fg_SPrice'] == null) {
                        var result = '<input type="text" name="sales_or_group[' + lstidx + '][order_price]" value="' + 1 + '" oninput="calslsorder(' + lstidx + ')" id="orderprice' + lstidx + '" class="form-control  sales_or_group[' + lstidx + '][order_price]" style="text-align: -webkit-right;">';
                    } else {
                        var result = '<input type="text" name="sales_or_group[' + lstidx + '][order_price]" value="' + product[j]['Fg_SPrice'] + '" oninput="calslsorder(' + lstidx + ')" id="orderprice' + lstidx + '" class="form-control  sales_or_group[' + lstidx + '][order_price]" style="text-align: -webkit-right;">';
                    }
                    if (product[j]['Fg_Pack'] == '' || product[j]['Fg_Pack'] == null) {
                        var pacinc = '<input type="text" name="sales_or_group[' + lstidx + '][sopacper_carten]" id="sopacpercarten' + lstidx + '"oninput="calslsorder(' + lstidx + ')" value="' + 1 + '"  class="form-control sales_or_group[' + lstidx + '][sopacper_carten]" style="text-align: -webkit-right;">';
                    } else {
                        var pacinc = '<input type="text" name="sales_or_group[' + lstidx + '][sopacper_carten]" id="sopacpercarten' + lstidx + '"oninput="calslsorder(' + lstidx + ')" value="' + product[j]['Fg_Pack'] + '"  class="form-control sales_or_group[' + lstidx + '][sopacper_carten]" style="text-align: -webkit-right;">';
                    }
                    // if()
                    var sodiv = '<input type="text" name="sales_or_group[' + lstidx + '][gst]" id="so_div' + lstidx + '"oninput="calsalesorder(' + lstidx + ')" value="' + product[j]['Fg_GstRate'] + '"  class="form-control sales_or_group[' + lstidx + '][gst]" style="text-align: -webkit-right;">';
                }
                // alert(result);
                $('#orderpriceso' + lstidx).html(result);
                $('#pacincso' + lstidx).html(pacinc);
                $('#sodivpso' + lstidx).html(sodiv);

                calsalesorder(1);
            }
        }
    });

    // $("#so_qty"+lstidx).focus();
}


function getoutward(callback) {
    member = callback;
    lstidx = member;
    var prdtnameid = $("#outname" + callback + " option:selected").val();
    // alert(prdtnameid)
    $.ajax({
        type: 'GET',
        url: '/outward_challan/productlist',
        dataType: 'json',
        data: {
            prdtnameid: prdtnameid
        },
        success: function (data) {
            if (data['success']) {

                var product = data['product']
                for (j = 0; j < product.length; j++) {
                    var result = '<input type="text" name="sales_or_group[' + lstidx + '][outin_qty]" value="' + product[j]['p_pck'] + '" oninput="calsalesorder(' + lstidx + ')" id="inqtyout' + lstidx + '" class="form-control  sales_or_group[' + lstidx + '][outin_qty]" style="text-align: -webkit-right;">';
                    var cost = '<input type="text" name="sales_or_group[' + lstidx + '][ocrate]" id="ocrate' + lstidx + '"oninput="calsalesorder(' + lstidx + ')" value="' + product[j]['si_price'] + '"  class="form-control sales_or_group[' + lstidx + '][ocrate]" style="text-align: -webkit-right;">';
                    var buyer = ''
                }
                // alert(result);
                $('#innerqtyout' + lstidx).html(result);
                $('#rateout' + lstidx).html(cost);
                caloutward(1);
            }
        }
    });

}

function getdsi(callback) {
    member = callback;
    lstidx = member;
    var prdtnameid = $("#dsiname" + callback + " option:selected").val();
    // alert(prdtnameid)
    $.ajax({
        type: 'GET',
        url: '/domes_salesinvoice/productlist',
        dataType: 'json',
        data: {
            prdtnameid: prdtnameid
        },
        success: function (data) {
            console.log(data)
            if (data['success']) {
                var product = data['product']
                for (j = 0; j < product.length; j++) {
                    if (product[j]['Fg_Pack'] != null || product[j]['Fg_Pack'] != undefined) {
                        var result = '<input type="text" name="sales_or_group[' + lstidx + '][outin_qty]" value="' + product[j]['Fg_Pack'] + '" oninput="caldsi(' + lstidx + ')" id="inqtydsi' + lstidx + '" class="form-control  sales_or_group[' + lstidx + '][outin_qty]" style="text-align: -webkit-right;" required>';
                    } else {
                        // alert('Please Add Pac Per Pack In Master');
                    }
                    if (product[j]['Fg_SPrice'] != null || product[j]['Fg_SPrice'] != undefined) {
                        var cost = '<input type="text" name="sales_or_group[' + lstidx + '][ocrate]" id="dsirate' + lstidx + '"oninput="caldsi(' + lstidx + ')" value="' + product[j]['Fg_SPrice'] + '"  class="form-control sales_or_group[' + lstidx + '][ocrate]" style="text-align: -webkit-right;" required>';
                    }
                    else {
                        alert('Please Add Rate In Master');
                    }
                    if (product[j]['Fg_GstRate'] == '' || product[j]['Fg_GstRate'] == null) {
                        alert('Please Add GST Rate In Master');
                    } else {
                        $("#so_gstrate" + lstidx).val(product[j]['Fg_GstRate'])
                    }
                }
                // alert(result);
                $('#innerqtydsi' + lstidx).html(result);
                $('#ratedsi' + lstidx).html(cost);
                caldsi(1);
            }
        }
    });
}
function chgcombo(callback) {
    member = callback;
    lstidx = member;
    // $('.loader').show();
    var partyID = $("#inp_code" + callback + " option:selected").val();
    var partysateid = $("#compsateid").val();
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/packname',
        dataType: 'json',
        data: {
            id: partyID
        },
        success: function (data) {
            if (data['success']) {
                var packArray = data['product_mast']['product_mast_group'];
                var pack = data['product_mast'];
                var compstatecode = data['compstatecode']
                var j;
                var result = '<select name="contract_sauda_group[' + lstidx + '][pck]" id="pck' + lstidx + '" class="form-control" style="width: 72px;" onchange="chgpck(' + lstidx + ')"  oninput="calc(' + lstidx + ')" required>';
                for (j = 0; j < packArray.length; j++) {
                    result += '<option value="' + packArray[j]['it_pck'] + '" data-pack-id="' + pack['_id'] + '">' + packArray[j]['it_pck'] + '</option>';
                }
                result += '</select>';
                if (pack['prdt_taxrate'] != null && pack['prdt_taxrate'] != undefined) var prdttax = pack['prdt_taxrate']
                else var prdttax = '';
                if (partysateid == compstatecode) {
                    prdttax = prdttax / 2
                    var addamt = '<input type="text" class="form-control plus number delv_load" name="add1_amt" value="' + prdttax + '" id="add1_amt" oninput="calc()" placeholder="SGST">';
                    var cgst = '<input type="text" class="form-control plus number" name="add2_amt" value="' + prdttax + '" id="add2_amt" oninput="calc()" placeholder="CGST">';

                }
                else {
                    var igst = '<input type="text" class="form-control plus number" name="add3_amt" value="' + prdttax + '" id="add3_amt" oninput="calc()" placeholder="IGST">';
                }
                // console.log(addamt)
                $('.pack_name' + callback).html(result);
                $('.sgsttax').html(addamt);
                $('.cgst').html(cgst);
                $('.igst').html(igst);


                chgpck(+callback);
                $('.loader').hide();
            }
        }
    });
}

function chgpck(callback) {
    member = callback;
    lstidx = member;
    // $('.loader').show();
    var ID = $("#pck" + callback + " option:selected").attr("data-pack-id");
    var pckvalue = Number(parseInt($("#pck" + callback).val()));
    // alert(ID);
    $.ajax({
        type: 'GET',
        url: '/contract_sauda/brokrate',
        dataType: 'json',
        data: {
            id: ID
        },
        success: function (data) {
            if (data['success']) {
                var packArray = data['product_mast']['product_mast_group'];
                var pack = data['product_mast'];
                var prodtname = data['productname'];
                // console.log(pckvalue);
                var j;
                var result = '';
                for (j = 0; j < packArray.length; j++) {
                    if (pckvalue == packArray[j]['it_pck']) {
                        result += '<input type="number" class="form-control" style="width: 102px;text-align: -webkit-right;" name="contract_sauda_group[' + lstidx + '][slbrk_rt]" oninput="calc(' + lstidx + ')" id="slbrk_rt' + lstidx + '" oninput="calc(' + lstidx + ')" value="' + packArray[j]['it_ratesl'] + '">';
                    }
                }
                $('.slbrk_name' + lstidx).html(result);

                var sl = '<select name="contract_sauda_group[' + lstidx + '][slbrk_type]" id="slbrk_type' + lstidx + '" oninput="calc(' + lstidx + ')" class="form-control" style="width: 102px;">';
                for (j = 0; j < packArray.length; j++) {
                    if (pckvalue == packArray[j]['it_pck']) {
                        sl += '<option value="' + packArray[j]['it_ratetypsl'] + '" data-pack-id="' + pack['_id'] + '">' + packArray[j]['it_ratetypsl'] + '</option>';
                    }
                }
                sl += "</select>";
                $('.slbrk_type' + lstidx).html(sl);
                var br = '';
                for (j = 0; j < packArray.length; j++) {
                    if (pckvalue == packArray[j]['it_pck']) {
                        br += '<input type="number" class="form-control" style="width: 102px;text-align: -webkit-right;" name="contract_sauda_group[' + lstidx + '][brbrk_rt]" id="brbrk_rt' + lstidx + '" oninput="calc(' + lstidx + ')" value="' + packArray[j]['it_ratebr'] + '">';
                    }

                }
                $('.brbrk_rt' + lstidx).html(br);
                var brtyp = '<select name="contract_sauda_group[' + lstidx + '][brbrk_typ]" id="brbrk_typ' + lstidx + '" oninput="calc(' + lstidx + ')" class="form-control" style="width: 102px;">';
                for (j = 0; j < packArray.length; j++) {
                    if (pckvalue == packArray[j]['it_pck']) {
                        brtyp += '<option value="' + packArray[j]['it_ratetypbr'] + '" data-pack-id="' + pack['_id'] + '">' + packArray[j]['it_ratetypbr'] + '</option>';
                    }
                }
                brtyp += '</select>';
                $('.brbrk_typ' + lstidx).html(brtyp);
                $('.loader').hide();
            }
        }
    });
}

//contract_sauda calculation
$(document).ready(function () {
    $('body').on('click', '.addingdelivery', function () {
        var sellerid = $(this).attr('data-sid');
        $('#sl_code').val(sellerid).trigger('change');
        var sellerbuyerid = $(this).attr('data-sbid');
        $('#sl_code').val(sellerbuyerid).trigger('change');
    })
    $("#wght").keyup(function () {
        calc(function (err, result) { });
    });
    $('.StLadgerSelect2').select2({
        placeholder: "Select Product",
        allowClear: true,
    });
});
$(document).ready(function () {
    $("#pck").keyup(function () {
        calc(function (err, result) { });
    });
});
$(document).ready(function () {
    $("#bag").keyup(function () {
        calc(function (err, result) { });
    });
});
$(document).ready(function () {
    $("#sel_rate").keyup(function () {

    });
});
$(document).ready(function () {
    $("#buy_rate").keyup(function () {

    });
});
$(document).ready(function () {
    $("#wghtunit").change(function () {
        calc(function (err, result) { });

    });
});
$(document).ready(function () {
    $("#w_q").change(function () {
        calc(function (err, result) { });
    });
});
$(document).ready(function () {
    $("#slbrk_rt").keyup(function () {
        calc(function (err, result) { });
    });
});
$(document).ready(function () {
    $("#slbrk_type").change(function () {
        calc(function (err, result) { });
    });
});
$(document).ready(function () {
    $("#brbrk_rt").keyup(function () {
        calc(function (err, result) { });
    });
});
$(document).ready(function () {
    $("#brbrk_typ").change(function () {
        calc(function (err, result) { });
    });

    $('body').on('input', '.pereceivedamount', function () {
        var sellerid = $(this).attr('data-sellerid');
        var sellername = $(this).attr('data-sellername');
        $('#brcodepayment').val(sellerid).trigger('change');
        $('.paymentsllerrows').not('.' + sellerid).remove();
    })

    $('body').on('click', '.canceladjustment', function () {
        $('.delivery_repeat_row').html('');
        $('.expence_repeat_row').html('');
        $('#slcodepaymnt').val('').trigger('change');
        $('#brcodepayment').val('').trigger('change');
    })

    $('button[type="reset"]').not('.update').click(function () {
        $('.select2-selection').css({ 'background-color': "#fff", 'color': '#333' });
        $('input').css({ 'background-color': "#fff", 'color': '#333' });
        if ($('.city').length >= 1)
            $('.city').val(null).trigger('change');
        if ($('.party').length >= 1)
            $('.party').val(null).trigger('change');
        if ($('.sbparty').length >= 1)
            $('.sbparty').val(null).trigger('change');
        if ($('.brparty').length >= 1)
            $('.brparty').val(null).trigger('change');
        if ($('.bbparty').length >= 1)
            $('.bbparty').val(null).trigger('change');
        if ($('.getprdt').length >= 1)
            $('.getprdt').val(null).trigger('change');
        $('select.select2').each(function () {
            $(this).val(null).trigger('change');
        })
    })

    $('button.resetpaymententry').click(function () {
        $('.delivery_repeat_row').html('');
        $('.expence_repeat_row').html('');
    })

    $('button[type="reset"].update').click(function () {
        var path = $(this).attr('data-link');
        window.location.replace('http://' + window.location.host + path);
    })

});

function calc(callback) {
    var orqty1 = 0;
    var wcost = 0;
    var wprofit = 0;
    var wprofitamt1 = 0;
    var wsellprice = 0;
    var wdoller = 0;
    var inqty = 0;
    var wsellpriceD = 0;
    var wtotaFr = 0;
    var wboxperC = 0;
    var perbxfrghtrs = 0;
    var woverseasFPB = 0;
    var boxpricedoller = 0;
    var wboxperFD = 0;
    var wfinalc1 = 0;
    var perccbm = 0;
    var totelcbm = 0;
    var con_cbm = 0;
    var wprofitamt2 = 0;
    var orqty3 = 0;
    var wfobAmt2 = 0;
    var wcnfAmt3 = 0;
    lstidx = $("input[name*='cntr']").length;
    member = lstidx;
    //new_div += 'class="form-control numerals digits" style="width: 72px;text-align: -webkit-right;"';
    if (lstidx === undefined) lstidx = 1;
    else lstidx = member;
    // alert(lstidx);
    for (i = 1; i <= lstidx; i++) {
        // alert(i);
        if ($("#inqty" + i).val() != undefined) {
            //  var orqty= $("#orqty" + i).val();
            // alert(orqty1);
            wcost = $("#wcost" + i).val();
            wprofit = $("#wprofit" + i).val();
            wdoller = $("#wdoller").val();
            wboxperFD = $("#wboxperFD" + i).val();
            inqty = $("#inqty" + i).val();
            $("#wprofitamt" + i).val((parseFloat(wcost) * parseFloat(wprofit) / 100).toFixed(2));
            // wprofitamt

            var wprofitamt1 = $("#wprofitamt" + i).val();
            // alert(wprofitamt1);
            $("#wsellprice" + i).val(parseFloat(wcost) + parseFloat(wprofitamt1));
            wsellprice = $("#wsellprice" + i).val();
            $("#wsellpriceD" + i).val((parseFloat(wsellprice) / parseFloat(wdoller)).toFixed(3));
            wsellpriceD = $("#wsellpriceD" + i).val();
            $("#wdollerp" + i).val((parseFloat(wsellprice) / parseFloat(inqty)).toFixed(2));
            $("#boxpricedoller" + i).val((parseFloat(wsellpriceD) * parseFloat(inqty)).toFixed(2));
            boxpricedoller = $("#boxpricedoller" + i).val();
            wtotaFr = $("#wtotaFr").val();
            wboxperC = $("#wboxperC" + i).val();
            $("#perbxfrghtrs" + i).val((parseFloat(wtotaFr) / parseFloat(wboxperC)).toFixed(2));
            perbxfrghtrs = $("#perbxfrghtrs" + i).val();
            $("#wboxperFD" + i).val((parseFloat(perbxfrghtrs) / parseFloat(wdoller)).toFixed(2));
            woverseasFPB = $("#woverseasFPB").val();
            $("#wfinalb" + i).val((parseFloat(woverseasFPB) / parseFloat(wboxperC)).toFixed(2));
            wfinalb1 = $("#wfinalb" + i).val();
            wboxperFD = $("#wboxperFD" + i).val()
            $("#wfinalc" + i).val((parseFloat(boxpricedoller) + parseFloat(wboxperFD) + parseFloat(wfinalb1)).toFixed(2));
            var wfinalc1 = $("#wfinalc" + i).val();
            var orqty1 = $("#orqty" + i).val();
            $("#wfobAmt" + i).val((parseFloat(orqty1) * (parseFloat(wboxperFD) + parseFloat(boxpricedoller))).toFixed(2));
            $("#wcnfAmt" + i).val((parseFloat(wfinalc1) * parseFloat(orqty1)).toFixed(2));
            perccbm = $("#perccbm" + i).val();
            $("#totelcbm" + i).val((parseFloat(orqty1) * parseFloat(perccbm)).toFixed(2));
            totelcbm = $("#totelcbm" + i).val();
            totelcbm = $("#totelcbm" + i).val();
            con_cbm = $("#con_cbm").val();

            $("#frcbm" + i).val((parseFloat(wtotaFr) / parseFloat(con_cbm) * parseFloat(totelcbm)).toFixed(2));

            ///$("#tot_order" + i).val((tot_order) + parseFloat(orqty));

            orqty3 = orqty3 + parseFloat($("#orqty" + i).val());

            wprofitamt2 = wprofitamt2 + parseFloat($("#wprofitamt" + i).val());
            wfobAmt2 = wfobAmt2 + parseFloat($("#wfobAmt" + i).val());
            wcnfAmt3 = wcnfAmt3 + parseFloat($("#wcnfAmt" + i).val());

        }
    }
    $("#tot_order").val((orqty3).toFixed(2));
    $("#tot_pamt").val((wprofitamt2).toFixed(2));
    $("#tot_fobamt").val((wfobAmt2).toFixed(2));
    $("#tot_cnfamt").val((wcnfAmt3).toFixed(2));
}

function calsaleadd(callback) {
    var subtotal = 0;
    var add = 0;
    var less = 0;
    addlstidx = $("input[name*='saleadd']").length;
    lesslstidx = $("input[name*='saleless']").length;
    addvalues = $("input[name='saleadd']")
        .map(function () { return $(this).val(); }).get();
    addidx = addvalues[addvalues.length - 1]
    lessvalues = $("input[name='saleless']")
        .map(function () { return $(this).val(); }).get();
    lessidx = lessvalues[lessvalues.length - 1]
    if (addidx >= lessidx) {
        idx = addidx;
    }
    if (lessidx > addidx) {
        idx = lessidx;
    }
    lstidx = parseInt(idx);
    member = lstidx;

    if (lstidx === undefined) lstidx = 1;
    else lstidx = member;
    for (i = 0; i <= lstidx; i++) {
        if ($("#AmountParticular" + i).val() != undefined) {
            add = add + parseFloat($("#AmountParticular" + i).val());
            subtotal = $("#tot_amtso").val();
        }
    }
    lstidx1 = $("input[name*='saleless1']").length;
    member = lstidx;

    if (lstidx1 === undefined) lstidx1 = 1;
    else lstidx1 = member;
    for (i = 0; i <= lstidx1; i++) {
        if ($("#lessamtParticular" + i).val() != undefined || NaN) {
            less = less + parseFloat($("#lessamtParticular" + i).val());
        }
    }
    $("#totalgrand").val(((parseFloat(subtotal) + parseFloat(add)) - parseFloat(less)).toFixed(2));
}

function calsaleinvoiceadd(callback) {

    var subtotal = 0;
    var add = 0;
    var less = 0;
    lstidx = $("input[name*='saleadd']").length;
    member = lstidx;

    if (lstidx === undefined) lstidx = 1;
    else lstidx = member;
    for (i = 0; i <= lstidx; i++) {
        if ($("#AmountParticular" + i).val() != undefined) {

            add = add + parseFloat($("#AmountParticular" + i).val());

            subtotal = $("#tot_amtso").val();
            //  alert(subtotal);
            //  alert(add);

        }
    }
    lstidx1 = $("input[name*='saleless1']").length;
    member = lstidx;

    if (lstidx1 === undefined) lstidx1 = 1;
    else lstidx1 = member;
    for (i = 0; i <= lstidx1; i++) {
        if ($("#lessamtParticular" + i).val() != undefined || NaN) {
            less = less + parseFloat($("#lessamtParticular" + i).val());
        }
    }
    $("#totalgrand").val(((parseFloat(subtotal) + parseFloat(add)) - parseFloat(less)).toFixed(2));
}

function purchaseordradd_remove(id) {
    var strconfirm = confirm("Are you sure want to delete?");
    var lstidx = $("input[name*='saleadd']").length;
    if (strconfirm == true && lstidx > 1) {
        $("#addselrow" + id).remove();
        calsaleadd(1);
        setTimeout(function () { sal_roumdof(1) }, 100);
    }
}
function purchaseless_remove(id) {
    var strconfirm = confirm("Are you sure want to delete?");
    var lstidx = $("input[name*='saleless']").length;
    // alert(lstidx)
    if (strconfirm == true && lstidx > 1) {
        $("#purchaseless" + id).remove();
        calsaleadd(1);
        setTimeout(function () { sal_roumdof(1) }, 100);
    }
}





function calproduct() {

    var slprice = 0;
    var taxrate = 0;
    var c = 0;
    var b = 0;
    var m = 0;
    var mul = 0;
    var mrpper = 0;
    var pper = 0

    slprice = $("#pro_slprice").val();
    taxrate = $("#pro_gstrate").val();
    $("#pro_exportprice").val((parseFloat(slprice) - (parseFloat(slprice) * (parseFloat(taxrate) / 100))).toFixed(2));
    c = $("#pro_c").val();
    b = $("#pro_b").val();
    m = $("#pro_m").val();
    $("#pro_tbpc").val((65 / ((parseFloat(c) * parseFloat(b) * parseFloat(m)) / 1000000)).toFixed(2));
    pper = $("#pcsperpack").val();
    mrpper = $("#mrpperpcs").val();
    $("#mrp_boxpro").val((parseFloat(pper) * parseFloat(mrpper)).toFixed(2));
}

function calproforma(callback) {

    var inqty2 = 0;
    var percortancbm = 0;
    var orqty2 = 0;
    var orqty3 = 0;
    var cp = 0;
    var totipercbm = 0;
    var totalamount = 0;
    lstidx = $("input[name*='pntr']").length;
    member = lstidx;
    //new_div += 'class="form-control numerals digits" style="width: 72px;text-align: -webkit-right;"';

    if (lstidx === undefined) lstidx = 1;
    else lstidx = member;
    for (i = 0; i <= lstidx; i++) {
        if ($("#inqtypq" + i).val() != undefined) {
            orqty2 = $("#orqtymn" + i).val();
            //alert(orqty);
            percortancbm = $("#percbmpq" + i).val();
            $("#cbmperItem" + i).val((parseFloat(orqty2) * parseFloat(percortancbm)).toFixed(2));
            cp = $("#cartonPrice" + i).val();
            $("#totalAmount" + i).val((parseFloat(orqty2) * parseFloat(cp)).toFixed(2));
            ///$("#tot_order" + i).val((tot_order) + parseFloat(orqty));
            orqty3 = orqty3 + parseFloat($("#orqtymn" + i).val());
            totipercbm = totipercbm + parseFloat($("#cbmperItem" + i).val());
            totalamount = totalamount + parseFloat($("#totalAmount" + i).val());

        }
    }
    $("#totpoq").val((orqty3).toFixed(2));
    $("#tot_picbm").val((totipercbm).toFixed(2));
    $("#tot_amt").val((totalamount).toFixed(2));

}

function calsalesorder(callback) {
    var Orprice = 0;
    var orqty3 = 0;
    var pacinc = 0;
    var discount = 0;
    var qty = 0;
    var qtysum = 0;
    var totalamount = 0;
    var totaldiscount = 0;
    var totalamtbefore = 0;
    lstidx = $("input[name*='buyrn']").length;
    var values = $("input[name='buyrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    member = lstidx;
    // alert(lstidx)
    if (lstidx === undefined) lstidx = 1;
    else lstidx = member;
    for (i = 0; i <= lstidx; i++) {
        if ($("#orderprice" + i).val() != undefined) {
            Orprice = $("#orderprice" + i).val();
            // pacinc= $("#sopacpercarten" + i).val();
            qty = $("#so_qty" + i).val();
            discount = $("#so_discount" + i).val();
            $("#po_qty_blc" + i).val(qty);
            $("#total_amt_before" + i).val((parseFloat(Orprice) * parseFloat(qty)).toFixed(2));
            $("#total_amt" + i).val((parseFloat(Orprice) * parseFloat(qty) - ((parseFloat(Orprice) * parseFloat(qty) * parseFloat(discount)) / 100)).toFixed(2));
            //$("#tot_order" + i).val((tot_order) + parseFloat(orqty));
            qtysum = qtysum + parseFloat($("#so_qty" + i).val());

            totaldiscount = totaldiscount + parseFloat($("#so_discount" + i).val());
            totalamtbefore = totalamtbefore + parseFloat($("#total_amt_before" + i).val());
            totalamount = totalamount + parseFloat($("#total_amt" + i).val());

        }

    }
    $("#tot_sooq").val((qtysum).toFixed(2));
    // $("#tot_picbm").val((totipercbm).toFixed(2));
    $("#tot_amtso").val((totalamount).toFixed(2));
    $("#tot_discount").val((totaldiscount).toFixed(2));
    $("#tot_amtbefore").val((totalamtbefore).toFixed(2));
    this.calsaleadd(1);
}


function calslsorder(callback) {
    var Orprice = 0;
    var orqty3 = 0;
    var pacinc = 0;
    var discount = 0;
    var qty = 0;
    var qtysum = 0;
    var totalamount = 0;
    var totaldiscount = 0;
    var totalamtbefore = 0;
    lstidx = $("input[name*='buyrn']").length;
    member = lstidx;
    //new_div += 'class="form-control numerals digits" style="width: 72px;text-align: -webkit-right;"';
    if (lstidx === undefined) lstidx = 1;
    else lstidx = member;
    for (i = 0; i <= lstidx; i++) {
        if ($("#so_qty" + i).val() != undefined) {
            // Orprice= $("#orderprice" + i).val();
            // pacinc= $("#sopacpercarten" + i).val();
            qty = $("#so_qty" + i).val();
            $("#so_qty_blc" + i).val(qty);
            // discount= $("#so_discount" + i).val();
            //  $("#total_amt_before" + i).val((parseFloat(Orprice)*parseFloat(pacinc)*parseFloat(qty)).toFixed(2));
            //  $("#total_amt" + i).val((parseFloat(Orprice)*parseFloat(pacinc)*parseFloat(qty)-((parseFloat(Orprice)*parseFloat(pacinc)*parseFloat(qty)*parseFloat(discount))/100)).toFixed(2));
            //$("#tot_order" + i).val((tot_order) + parseFloat(orqty));
            qtysum = qtysum + parseFloat($("#so_qty" + i).val());
            //  totaldiscount = totaldiscount+ parseFloat($("#so_discount" + i).val());
            //  totalamtbefore = totalamtbefore+ parseFloat($("#total_amt_before" + i).val());
            //  totalamount = totalamount+ parseFloat($("#total_amt" + i).val());
        }

    }
    $("#tot_sooq").val((qtysum).toFixed(2));
    // $("#tot_picbm").val((totipercbm).toFixed(2));
    $("#tot_amtso").val((totalamount).toFixed(2));
    $("#tot_discount").val((totaldiscount).toFixed(2));
    $("#tot_amtbefore").val((totalamtbefore).toFixed(2));
    this.calsaleadd(1);
}




function caloutward(callback) {
    var orqty2 = 0;
    var orqty3 = 0;
    var rate = 0;
    var discount = 0;
    var netamount = 0;
    var totalamount = 0;
    lstidx = $("input[name*='outrn']").length;
    member = lstidx;
    //new_div += 'class="form-control numerals digits" style="width: 72px;text-align: -webkit-right;"';

    if (lstidx === undefined) lstidx = 1;
    else lstidx = member;
    for (i = 0; i <= lstidx; i++) {
        if ($("#inqtyout" + i).val() != undefined) {
            orqty2 = $("#orqtyoc" + i).val();
            //alert(orqty);
            rate = $("#ocrate" + i).val();
            discount = $("#ocdiscount" + i).val();
            $("#octotalAmount" + i).val((parseFloat(orqty2) * parseFloat(rate) - (parseFloat(orqty2) * parseFloat(rate) * parseFloat(discount) / 100)).toFixed(2));

            orqty3 = orqty3 + parseFloat($("#orqtyoc" + i).val());
            //  totipercbm = totipercbm+ parseFloat($("#cbmperItem" + i).val());
            totalamount = totalamount + parseFloat($("#octotalAmount" + i).val());

        }
    }
    $("#totoqoc").val((orqty3).toFixed(2));
    // $("#tot_picbm").val((totipercbm).toFixed(2));
    $("#tot_amtso").val((totalamount).toFixed(2));

}
function caldsi(callback) {
    //  alert()
    var orqty2 = 0;
    var orqty3 = 0;
    var rate = 0;
    var discount = 0;
    var inqtyout = 0;
    var gstrate = 0;
    var netamount = 0;
    var totalamount = 0;
    var tot_beforedisamt = 0;
    var tot_taxvalue = 0;
    var gst12 = 0;
    var gst18 = 0;
    amt = 0;
    lstidx = $("input[name*='dsirn']").length;
    var values = $("input[name='dsirn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    member = lstidx;
    //new_div += 'class="form-control numerals digits" style="width: 72px;text-align: -webkit-right;"';
    //  alert(lstidx)
    if (lstidx == undefined) lstidx = 1;
    else lstidx = member;
    for (i = 0; i <= lstidx; i++) {
        // alert($("#inqtydsi" + i).val())
        if ($("#orqtydsi" + i).val() != undefined) {
            orqty2 = $("#orqtydsi" + i).val();
            rate = $("#dsirate" + i).val();
            discount = $("#dsidiscount" + i).val();
            inqtyout = $("#inqtydsi" + i).val();
            inqtyout = 1;
            // alert()
            console.log(inqtyout)
            gstrate = $("#so_gstrate" + i).val();
            console.log('gst', gstrate)
            if (gstrate == null || gstrate == undefined || gstrate == NaN || gstrate == '') gstrate = 18;
            $("#so_beforedisamt" + i).val((parseFloat(orqty2) * parseFloat(rate) * parseFloat(inqtyout).toFixed(2)));
            $("#dsitotalAmount" + i).val((parseFloat(orqty2) * parseFloat(rate) * parseFloat(inqtyout) - (parseFloat(orqty2) * parseFloat(rate) * parseFloat(inqtyout) * parseFloat(discount) / 100)).toFixed(2));
            amt = (parseFloat(orqty2) * parseFloat(rate) * parseFloat(inqtyout) - (parseFloat(orqty2) * parseFloat(rate) * parseFloat(inqtyout) * parseFloat(discount) / 100)).toFixed(2)
            $("#so_taxvalue" + i).val(amt * gstrate / 100);
            orqty3 = orqty3 + parseFloat($("#orqtydsi" + i).val());
            totalamount = totalamount + parseFloat($("#dsitotalAmount" + i).val());
            $("#so_afttaxvalue" + i).val((parseFloat(orqty2) * parseFloat(rate) * parseFloat(inqtyout).toFixed(2)) + amt * gstrate / 100)
            tot_taxvalue = tot_taxvalue + amt * gstrate / 100;
            tot_beforedisamt = tot_beforedisamt + (parseFloat(orqty2) * parseFloat(rate) * parseFloat(inqtyout).toFixed(2))

            if (parseInt(gstrate) == 12) gst12 = gst12 + amt * gstrate / 100;
            if (parseInt(gstrate) == 18) gst18 = gst18 + amt * gstrate / 100;
        }
    }
    console.log('gst', gstrate)
    $("#gsttaxamtot12").val((gst12).toFixed(2));
    $("#gsttaxamtot18").val((gst18).toFixed(2));
    $("#tot_beforedisamt").val(tot_beforedisamt)
    $("#tot_taxvalue").val(tot_taxvalue)
    $("#totoqdsi").val((orqty3).toFixed(2));
    $("#tot_amtso").val((totalamount).toFixed(2));
    $("#totalgrand").val((totalamount).toFixed(2))
    calgst(1);

    if (gst12 == NaN || gst12 == null) gst12 == 0;
    if (gst18 == NaN || gst18 == null) gst18 == 0;
    var tot = totalamount + parseFloat(gst18) + parseFloat(gst12);
    console.log(tot);
    $("#totalgrand").val(tot.toFixed(2));
}



$("#checkAll").click(function () {
    $('input[name="allcheck"]').not(this).prop('checked', this.checked);
});
$("#partyAll").click(function () {
    $('input[name="partyAllcheck"]').not(this).prop('checked', this.checked);
});


$('body').on('keyup', '.amountcal', function () {
    var sum = 0;
    var rowid = $(this).attr("data-id");
    $('.amountexpence' + rowid).each(function () {
        if ($(this).val())
            sum += parseInt($(this).val());
    })
    $('#totamountexpence' + rowid).val(sum);
    $('#dtcton_amt' + rowid).val(sum);
    $('#dtcton_amt' + rowid).trigger("change");
})
$('body').on('change', '.deductionamount', function () {
    var chk = 0;
    $('.deductionamount').each(function () {
        if ($(this).val())
            chk += parseInt($(this).val());
        // alert(chk);
    })
    $('#chkdddt').val(chk);
})
$(document).on("change.select2", "#slcodepaymnt", function () {
    $('.loader').show();
    var brcode = $("#slcodepaymnt").val();
    var slcode = $("#brcodepayment").val();
    $.ajax({
        type: 'GET',
        url: '/payment_entry/saudaname',
        dataType: 'json',
        data: {
            brcode: brcode,
            slcode: slcode,
        },
        success: function (data) {
            console.log(data);
            var i, j;
            var seller = '';
            if (data['success'] == true) {
                var outstading = data['outstading'];
                var result = '<div class="table-responsive adjustmentstable">';
                result += '<button class="btn btn-danger btn-link canceladjustment center-block nofocus" type="button">Close</button>';
                result += '<table class="table table-condensed">';
                result += '<thead>';
                result += '<tr>';
                // result += '<th>Seller</th>';
                result += '<th>Bill No</th>';
                result += '<th>Bill Date</th>';
                result += '<th>Bargain Amount</th>';
                result += '<th>Current Bal</th>';
                result += '<th>Rec Amt</th>';
                result += '<th>Deduction Amt</th>';
                result += '<th>Balance</th>';
                result += '<th>Remarks</th>';
                result += '</tr>';
                result += '</thead>';
                result += '<tbody>';
                for (j = 0; j < outstading.length; j++) {
                    // if(outstading[j]['sl_code']['party_name'])
                    var filterstartdate = moment(outstading[j]['sd_date']).tz("Asia/Kolkata").format('DD/MM/YYYY');
                    if (seller != outstading[j]['sl_code']['party_name']) {
                        seller = outstading[j]['sl_code']['party_name'];
                        result += '<tr class="paymentsllerrows  ' + outstading[j]['sl_code']['_id'] + '"><td colspan="8" class="tablerowheadings">' + outstading[j]['sl_code']['party_name'] + '</td></tr>';
                    }
                    result += '<tr class="paymentsllerrows ' + outstading[j]['sl_code']['_id'] + '" id="paymentsllerrows' + j + '">';
                    // result += '<td>';
                    // result += '<input type="hidden" name="payment_sauda_group[' + j + '][outstadingid]" id="outstadingid" value="' + outstading[j]['_id'] + '"  class="form-control">';
                    // result += ' <select name="payment_sauda_group[' + j + '][sl_code]" id="sl_code" class="form-control" disabled>';
                    // result += '<option value="' + outstading[j]['sl_code']['_id'] + '">' + outstading[j]['sl_code']['party_name'] + '</option>';
                    // result += '</select>';
                    // result += '</td>';
                    result += '<td><input type="text"  name="payment_sauda_group[' + j + '][vouc_code]" id="vouc_code' + j + '" value="' + outstading[j]['vouc_code'] + '"  class="form-control wght nofocus" readonly></td>';
                    result += '<td><input type="text" name="payment_sauda_group[' + j + '][sd_date]" id="sd_date"  value="' + filterstartdate + '"  class="form-control nofocus" readonly></td>';
                    result += '<td><input type="text"  name="payment_sauda_group[' + j + '][barg_amt]" id="bill_amt" value="' + outstading[j]['barg_amt'] + '" class="form-control nofocus" readonly></td>';
                    result += '<td><input type="text"  name="payment_sauda_group[' + j + '][tot_ammount]" id="currbill_amt' + j + '" value="' + outstading[j]['totamt_bal'] + '" class="form-control amount nofocus" readonly></td>';
                    result += '<td><input type="text" autocomplete="off" name="payment_sauda_group[' + j + '][outs_rec]" id="outs_rec' + j + '" oninput="paycalc(' + j + ')"  data-sellername="' + outstading[j]['sl_code']['party_name'] + '" data-sellerid="' + outstading[j]['sl_code']['_id'] + '" class="form-control pereceivedamount number"></td>';
                    result += '<td><input type="text" autocomplete="off" name="payment_sauda_group[' + j + '][dtcton_amt]" onchange="paycalc(' + j + ')"  onfocus="changesl(' + outstading[j]['vouc_code'] + ')" id="dtcton_amt' + outstading[j]['vouc_code'] + '" class="form-control numerals deductionamount" data-vcode="' + outstading[j]['vouc_code'] + '" readonly></td>';
                    result += '<td><input type="text" autocomplete="off"  name="payment_sauda_group[' + j + '][outs_bal]" value="' + outstading[j]['totamt_bal'] + '" id="outs_bal' + j + '" class="form-control outs_bal nofocus"></td>';
                    result += '<td><input type="text" autocomplete="off" name="payment_sauda_group[' + j + '][rmks]"  id="rmks" class="form-control"></td>';
                    ///id
                    result += '<td><input type="hidden" autocomplete="off" name="payment_sauda_group[' + j + '][outsid]"  id="outsid" value="' + outstading[j]._id + '" class="form-control"></td>';
                    result += '</tr> ';
                    // glbidx = j;

                    // data-toggle="modal" data-target="#myModal"
                }
                // result += '<tr><td colspan="8"></td></tr>'
                result += '<tr><td></td><td></td><td></td><td></td>';
                result += '<td><input type="text" name="chkddamt" id="chkddamt" placeholder="DD/Chk Amount" class="form-control number chkddamt nofocus" readonly></td><td><input type="text" name="chkdddt" id="chkdddt" placeholder="Deducations" class="form-control chkdddt nofocus" readonly></td>';
                result += '<td></td><td></td></tr>';
                result += '</tbody>';
                result += '</table>';
                result += '</div>';
                if (outstading.length) {
                    $('.ifnoentry').hide();
                    $('.ifnoentry input').attr('disabled', 'disabled');
                    $('.ifnoentry input').attr('readonly', 'readonly');
                    $('.delivery_repeat_row').html(result);
                }
                else {
                    $('.delivery_repeat_row').html('');
                    swal({
                        title: "Oops!!",
                        text: "No Deliveries",
                        buttons: false,
                        timer: 1500
                    })
                    $('.ifnoentry').show();
                    $('.ifnoentry input').val(null);
                    $('.ifnoentry input').removeAttr('disabled');
                    $('.ifnoentry input').removeAttr('readonly');
                }
                // $('#selectseller').modal({'show':true,'backdrop':'static'});
                $('.loader').hide();
            }
        }
    });

});
function paycalc(id) {
    var outs_rec = 0;
    var currbill_amt = 0;
    var outs = 0;
    var dtcton_amt = 0;
    for (i = 0; i <= id; i++) {
        outs_rec = outs_rec + parseInt($("#outs_rec" + i).val());
        currbill_amt = $("#currbill_amt" + i).val();
        outs = $("#outs_rec" + i).val();
        vcd = $("#vouc_code" + i).val();
        dtcton_amt = $("#dtcton_amt" + vcd).val();
        console.log(dtcton_amt);
        $("#outs_bal" + id).val(Number(currbill_amt) - Number(outs) - Number(dtcton_amt));
    }
    $("#chkddamt").val(Number(outs_rec));

}
function changesl(callback) {
    // alert(callback);
    $('.loader').show();
    if ($("#expence_detail" + callback).length) {
        $('#expence_detail' + callback).css('display', 'block');
    } else {
        $.ajax({
            type: 'GET',
            url: '/payment_entry/expenseaname',
            dataType: 'json',
            success: function (data) {
                var i, j;
                if (data['success'] == true) {
                    var expense = data['expense'];
                    var result = '<div class="col-md-12" id="expence_detail' + callback + '">';
                    result += '<div class="row adjustmentstable">';
                    result += `<div class="col-md-8 deliverydata${callback}"></div>`;
                    result += '<div class="col-md-4">';
                    result += '<div class="panel panel-default">';
                    result += '<div class="table-responsive">';
                    result += '<table class="product_detail_table">';
                    result += '<thead>';
                    result += '<tr><th colspan="4">Bill No : ' + callback + '</th></tr>';
                    result += '<tr>';
                    result += '<th>+/-</th>';
                    result += '<th>Expense</th>';
                    result += '<th>%</th>';
                    result += '<th>Amount</th>';
                    result += '</tr>';
                    result += '</thead>';
                    result += '<tbody>';
                    for (j = 0; j < expense.length; j++) {
                        result += '<tr>';
                        result += '<td>' + expense[j]['expense_type'] + '';
                        result += '<input type="hidden"  name="expense_group[' + j + '][expense_type]" value="' + expense[j]['expense_type'] + '"></td>';
                        result += '<td>' + expense[j]['expense_name'] + '';
                        result += '<input type="hidden"  name="expense_group[' + j + '][expense_name]" value="' + expense[j]['expense_name'] + '">';
                        result += '<input type="hidden"  name="expense_group[' + j + '][vouch_code]" value="' + callback + '"></td>';
                        result += '<td></td>';
                        result += '<td><input type="text"  name="expense_group[' + j + '][amountexpence]"  id="amountexpence' + callback + '"  class="form-control amountcal firstdeduction amountexpence' + callback + ' number" data-id="' + callback + '"></td>';

                        result += '</tr>';
                    }
                    result += '<tr>';
                    result += '<td style="color:red">Total</td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td><input type="text" name="totamountexpence"  id="totamountexpence' + callback + '" class="form-control number nofocus" readonly></td> ';
                    result += '</tr>';
                    result += '<tr>';
                    result += '<td colspan="4"><input type="button" value="OK" id="expencesauda' + callback + '" data-box="' + callback + '" class="btn btn-primary btn-block expencesauda expensesaudaok" /></td> ';
                    result += '</tr>';
                    result += '</tbody>';
                    result += '</table>';
                    result += '</div>';
                    result += '</div>';
                    result += '</div>';
                    result += '</div>'
                    result += '</div>';
                    $('.expence_repeat_row').append(result);
                    showdeliverydata('deliverydata' + callback);
                    $(".product_detail_table tr:first-child .firstdeduction").focus();
                    $('.loader').hide();
                }
            }
        });
        // $('#myModal').modal('show');

    }
}

function showdeliverydata(apto) {
    var output = ` <div class="row">
    <div class="col-sm-12 col-md-7">
        <div class="form-group  form-md-line-input clearfix">
            <label class="col-sm-3 control-label">Ref No: </label>
            <div class="col-md-5">
                <p class="form-control-static">058</p> 
            </div>
            <div class="col-md-4">
                <p class="form-control-static">058</p>   
            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-5">
        <div class="form-group  form-md-line-input clearfix">

            <label class="col-sm-3 control-label">Date: </label>
            <div class="col-md-9">
                <p class="form-control-static">05/05/05</p> 
            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-6">
        <div class="form-group clearfix">
            <label for="" class="control-label col-md-3">Buyer</label>
            <div class="col-md-9">
                 <p class="form-control-static">058</p> 
            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-6">
        <div class="form-group clearfix">
            <label for="" class="control-label col-md-3">Seller</label>
            <div class="col-md-9">
                <p class="form-control-static">058</p> 
                </div>
            </div>
        </div>
    </div>
</div>`;
    output += `<div classs="row"><div class="col-md-12">
    <div class="table-responsive"><table class="table delivrateinpayentry">
    
    <thead>
    <tr>
        <th style="width:80px;">Product</th>
        <th style="width:80px;">Brand</th>
        <th style="width:80px;">Bag</th>
        <th style="width:80px;">Pack</th>
        <th style="width:80px;">Unit</th>
        <th style="width:80px;">Wght</th>
        <th style="width:80px;">Sauda Rt</th>
        <th style="width:80px;">Seller Rt</th>
        <th style="width:80px;">Buyer Rt</th>
        <th style="width:80px;">Rate /Type</th>
        <th style="width:80px;">Qtl /Tons</th>
        <th style="width:80px;">Per</th>
        <th style="width:80px;">Amount</th>
        <th style="width:80px;">Type</th>
        <th style="width:80px;">Old/New</th>
        <th style="width:80px;">IPack</th>
        <th style="width:80px;">SI Brok Rt</th>
        <th style="width:80px;">Type</th>
    </tr>
</thead>
<tbody>`;

    for (j = 0; j < 2; j++) {
        output += `<tr>`;
        for (var i = 0; i < 18; i++) {
            output += `<td>${i}</td>`
        }
        output += `</tr>`;
    }

    output += `
</tbody>
    </table>
</div></div></div>`;

    output += `
<div class="row">
<div class="col-sm-6 col-md-4">
    <div class="form-group clearfix">
        <label for="" class="control-label col-md-3">Bill</label>
        <div class="col-md-9">
             <p class="form-control-static">058</p> 
        </div>
    </div>
</div>
<div class="col-sm-6 col-md-4">
    <div class="form-group clearfix">
        <label for="" class="control-label col-md-3">Date</label>
        <div class="col-md-9">
            <p class="form-control-static">25/12/2019</p> 
        </div>
    </div>
    
</div>

<div class="col-sm-6 col-md-4">
<div class="form-group clearfix">
    <label for="" class="control-label col-md-3">Freight</label>
    <div class="col-md-9">
         <p class="form-control-static">058</p> 
    </div>
</div>
</div></div>
<div class="row">
<div class="col-sm-6 col-md-4">
<div class="form-group clearfix">
    <label for="" class="control-label col-md-3">Adv</label>
    <div class="col-md-9">
        <p class="form-control-static">25/12/2019</p> 
        </div>
    </div>
</div>
<div class="col-sm-6 col-md-4">
<div class="form-group clearfix">
    <label for="" class="control-label col-md-3">Term</label>
    <div class="col-md-9">
        <p class="form-control-static">25/12/2019</p> 
        </div>
    </div>
</div>
<div class="col-sm-6 col-md-4">
<div class="form-group clearfix">
    <label for="" class="control-label col-md-3">Credit</label>
    <div class="col-md-9">
        <p class="form-control-static">05 Days</p> 
        </div>
    </div>
</div>
<div class="row">
<div class="col-sm-6 col-md-4">
<div class="form-group clearfix">
    <label for="" class="control-label col-md-3">Weight</label>
    <div class="col-md-9">
        <p class="form-control-static">19</p> 
        </div>
    </div>
</div>
<div class="col-sm-6 col-md-4">
<div class="form-group clearfix">
    <label for="" class="control-label col-md-3">Gross</label>
    <div class="col-md-9">
        <p class="form-control-static">2019</p> 
        </div>
    </div>
</div>
<div class="col-sm-6 col-md-4">
<div class="form-group clearfix">
    <label for="" class="control-label col-md-3">Barg.</label>
    <div class="col-md-9">
        <p class="form-control-static">0511</p> 
        </div>
    </div>
</div>
</div>
</div>
</div>`;

    $('.' + apto).html(output);
}

$(document).on("click", ".expencesauda", function () {
    var vcode = $(this).attr('data-box');
    $('#expence_detail' + vcode).css('display', 'none');
});

function calcpay(callback) {
    var outs_rec = 0;
    var dtcton_amt = 0;
    var currbill_amt = 0;
    var amountexpence = 0;
    for (i = 0; i <= callback; i++) {
        outs_rec = outs_rec + parseInt($("#outs_rec" + i).val());
        currbill_amt = $("#currbill_amt" + callback).val();
        $("#outs_bal" + callback).val(Number(currbill_amt) - Number($("#outs_rec" + i).val()) - Number($("#amountexpence" + callback).val()));
        amountexpence = amountexpence + parseInt($("#amountexpence" + i).val());
        $("#dtcton_amt" + callback).val(Number($("#amountexpence" + callback).val()));
        //   alert($("#dtcton_amt"+i).val());
        dtcton_amt = dtcton_amt + parseInt($("#dtcton_amt" + i).val());
        //   $("#outs_bal"+i).val(Number($("#outs_rec"+i).val())-Number(amountexpence));

    }
    $("#chkddamt").val(Number(outs_rec));
    $("#chkdddt").val(Number(dtcton_amt));
    $("#totamountexpence").val(Number(amountexpence));

    // 

}
///bill generation
$(document).on("click", "#billfiltersubmit", function () {
    // $('.loader').show();
    var from_dt = $("#from_dt").val();
    var to_dt = $("#to_dt").val();
    var bill_dt = $("#bill_dt").val();
    var to_begented = $("#to_begented").val();
    var formfilter = $("input[name='formfilter']:checked").val();
    var radioformfilter = $("input[name='radioformfilter']:checked").val();
    // alert(radioformfilter);
    var marked = $("input[name='marked']:checked").val();
    var currntcmpny = $("input[name='currntcmpny']:checked").val();
    var skipsubbr = $("input[name='skipsubbr']:checked").val();
    var allprty = $("input[name='allprty']:checked").val();
    var citywise = $("#citywise").val();
    var partyAllcheck = $("input[name='partyAllcheck']:checked").val();

    var party_name = $('#party_name').val();
    // alert(party_name);
    // var val = [];
    // $(".party_name.select2").each(function (i) {
    //     val[i] = $(this).attr('data-id');
    //     alert(val[i]);
    // });
    // var Allcheck = ( $('input[type="checkbox"]:checked').length );
    // alert(Allcheck)
    $.ajax({
        type: "POST",
        url: '/bill_generation/partydetail',
        dataType: 'json',
        data: {
            radioformfilter: radioformfilter,
            from_dt: from_dt,
            to_dt: to_dt,
            bill_dt: bill_dt,
            to_begented: to_begented,
            formfilter: formfilter,
            radioformfilter: radioformfilter,
            marked: marked,
            currntcmpny: currntcmpny,
            skipsubbr: skipsubbr,
            allprty: allprty,
            party_name: party_name,
            citywise: citywise,
            partyAllcheck: partyAllcheck
        },
        success: function (data) {
            var i, j, result;
            if (data['success'] == true) {
                var party = data['party'];
                // console.log(party);
            }
            // $('.contract_detail_body').html(result);
            // $('.loader').hide();
        }
    });
});
// $(document).on("click","#filtersubmit",function(){
//     $(".loader").show().$(this).attr('id').$("a.remove[data-id='2']").attr('id').$("#abc1'").attr('id');
//     Object.defineProperty($.fn, 'id', {
//         get: function () { return this.attr("id"); },
//         set: function (newValue) { this.attr("id", newValue); }
//     });
// });



$("#addproduct").on("submit", function () {
    var item_name = $.trim($('.item_name').val());
    // alert(stateName);
    if (item_name == '') {

        $('.item_name').next().show();

    } else {
        $('.item_name').next().hide();
    }
    if (item_name == '') {
        return false;
    }
});
$(document).on('click', '.edit_product_btn', function () {
    var productid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/product/' + productid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var item_name = response['product'].item_name;
                var sno = response['product'].sno;
                var productid = response['product']._id;
                $("#formheading span").text('Edit')
                $('.item_name').val(item_name);
                $("#addproduct").attr("action", "/product/edit_product/" + productid);
            } else {
                swal({
                    title: "Error",
                    icon: "Warning",
                    text: response['message'],
                    buttons: false,
                    timer: 1500
                })
                // $('.branddanger').html(response['message']);
                // $('.branddanger').show();
                // $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-product', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/product/' + id,
                success: function (response) {
                    window.location.href = '/product/product';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
var counter = 1;
var member = counter + 1;
var limit = 100;
$(document).on('click', '.addWIP', function () {
    lstidx = $("input[name*='cntrer']").length;
    var values = $("input[name='cntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    membern = lstidx;
    counter = lstidx;
    if (counter == limit) {
        alert("You have reached the limit of adding " + counter + " inputs");
    }
    else {
        $.ajax({
            type: 'GET',
            url: '/product_mast/rawmatmastname',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    rowmatname = data['rowmatname'];
                    StockUnit = data['StockUnit'];
                    var new_div = document.createElement('div');
                    var new_div = "<tr class='product_wrapper' id='prabal" + counter + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="cntrer" value="' + counter + '" id="cntrer' + counter + '">';
                    new_div += '<select name="product_mast_group[' + counter + '][raw_matrl_nm]" id="it_bk" value="" class="form-control selectproductfocus productplace" style="width:100%;">';
                    // new_div +='<option value=""></option>';
                    for (j = 0; j < rowmatname.length; j++) {
                        new_div += "<option value='" + rowmatname[j]['_id'] + "' data-product_id='" + rowmatname[j]['_id'] + "'>" + rowmatname[j]['Rm_Des'] + "</option>";
                    }
                    new_div += '</select></td>';

                    new_div += '<td>';
                    new_div += '<input class="form-control" placeholder="Qty/Pcs"  name="product_mast_group[' + counter + '][qty_pcs]" type="text" style="width:100%"/>';
                    new_div += '</td>';
                    new_div += '<td><select name="product_mast_group[' + counter + '][sku]" class="form-control sku" style="width:100%;">';
                    // new_div +='<option value=""></option>';
                    for (j = 0; j < StockUnit.length; j++) {
                        new_div += "<option value='" + StockUnit[j]['_id'] + "' data-product_id='" + StockUnit[j]['_id'] + "'>" + StockUnit[j]['SKUName'] + "</option>";
                    }
                    new_div += '</select></td>';
                    // new_div +='<td> <select class="form-control Sku" name="product_mast_group['+counter+'][sku]" style="width:100%"/>';
                    // new_div +='<option value=""></option>';
                    // for (j = 0; j < StockUnit.length; j++) {
                    //         new_div += "<option value='" + StockUnit[j]['_id'] + "' data-product_id='" + StockUnit[j]['_id'] + "'>" + StockUnit[j]['sku_name'] + "</option>";
                    //     }
                    // new_div +='</select></td>';                    
                    new_div += '<td>';
                    new_div += '<input class="form-control amountfocus" placeholder="Price"  name="product_mast_group[' + counter + '][price]" type="text" style="width:100%"/></td>';
                    new_div += "<td><a onclick='remove_updateproduct(" + counter + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#insert_product");
                    counter++;
                    member++;
                    $(".productplace").select2({
                        // placeholder: "Select Raw Material",
                        allowClear: true,
                    });
                    $(".sku").select2({
                        // placeholder: "Select SKU",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()

                }
            }
        });
    }
});

// $(document).ready(function () {
//     $('#product_detail_table_next').removeClass('disabled');
//     $('#product_detail_table_previous').removeClass('disabled');
// });
// $(document).on('click','#product_detail_table_next',function(){
//     $('#product_detail_table_next').removeClass('disabled');
//     $('#product_detail_table_previous').removeClass('disabled');
//     alert($(".active").text())
// })
// $(document).on('click','#product_detail_table_previous',function(){
//     $('#product_detail_table_next').removeClass('disabled');
//     $('#product_detail_table_previous').removeClass('disabled');
//     alert($(".active").text())
// })
// $('#product_detail_table').on( 'page.dt', function () {
//     var table = $('#product_detail_table').DataTable();
//     var info = table.page.info();
// });
function remove_WIPproduct(id) {
    var a = confirm('Are you sure you want to delete this element');
    if (a == true) $("#prabal" + id).remove();
}
function remove_Rawproduct(id) {
    var a = confirm('Are you sure you want to delete this element');
    if (a == true) $("#RawDel" + id).remove();
}
var counter = 1;
var member = counter + 1;
var limit = 100;
$(document).on('click', '.addproduct', function () {
    lstidx = $("input[name*='cntrer']").length;
    var values = $("input[name='cntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    if ($("input[name*='cntrer']").length == 0) lstidx = 0;
    membern = lstidx;
    counter = lstidx;
    if (counter == limit) {
        alert("You have reached the limit of adding " + counter + " inputs");
    }
    else {
        $.ajax({
            type: 'GET',
            url: '/product_mast/rawmatmastname',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    rowmatname = data['WIPName'];
                    StockUnit = data['StockUnit'];
                    var new_div = document.createElement('div');
                    var new_div = "<tr class='product_wrapper' id='prabal" + counter + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="cntrer" value="' + counter + '" id="cntrer' + counter + '">';
                    new_div += '<select name="product_mast_group[' + counter + '][raw_matrl_nm]" id="it_bk" value="" class="form-control selectproductfocus productplace" style="width:100%;" required="true">';
                    // new_div +='<option value=""></option>';
                    for (j = 0; j < rowmatname.length; j++) {
                        new_div += "<option value='" + rowmatname[j]['_id'] + "' data-product_id='" + rowmatname[j]['_id'] + "'>" + rowmatname[j]['Fg_Des'] + "</option>";
                    }
                    new_div += '</select></td>';

                    new_div += '<td>';
                    new_div += '<input class="form-control" placeholder="Qty/Pcs"  name="product_mast_group[' + counter + '][qty_pcs]" type="text" style="width:100%"/>';
                    new_div += '</td>';
                    new_div += '<td><select name="product_mast_group[' + counter + '][sku]" class="form-control sku" style="width:100%;" required="true">';
                    // new_div +='<option value=""></option>';
                    for (j = 0; j < StockUnit.length; j++) {
                        new_div += "<option value='" + StockUnit[j]['_id'] + "' data-product_id='" + StockUnit[j]['_id'] + "'>" + StockUnit[j]['SKUName'] + "</option>";
                    }
                    new_div += '</select></td>';

                    new_div += '<td>';
                    new_div += '<input class="form-control amountfocus" placeholder="Price"  name="product_mast_group[' + counter + '][price]" type="text" style="width:100%"/></td>';
                    new_div += "<td><a onclick='remove_WIPproduct(" + counter + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#insert_product");
                    counter++;
                    member++;
                    $(".productplace").select2({
                        // placeholder: "Select Raw Material",
                        allowClear: true,
                    });
                    $(".sku").select2({
                        // placeholder: "Select SKU",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()
                }
            }
        });
    }
});

$(document).on('click', '.addRawproduct', function () {
    lstidx = $("input[name*='rawcntrer']").length;
    var values = $("input[name='rawcntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    if ($("input[name*='rawcntrer']").length == 0) lstidx = 0;
    membern = lstidx;
    counter = lstidx;
    if (counter == limit) {
        alert("You have reached the limit of adding " + counter + " inputs");
    }
    else {
        $.ajax({
            type: 'GET',
            url: '/product_mast/rawmatmastname',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    rowmatname = data['rowmatname'];
                    StockUnit = data['StockUnit'];
                    var new_div = document.createElement('div');
                    var new_div = "<tr class='product_wrapper' id='RawDel" + counter + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="rawcntrer" value="' + counter + '" id="rawcntrer' + counter + '">';
                    new_div += '<select name="product_raw_group[' + counter + '][raw_matrl_nm]" id="it_bk" value="" class="form-control selectproductfocus productplace" style="width:100%;" required="true">';
                    // new_div +='<option value=""></option>';
                    for (j = 0; j < rowmatname.length; j++) {
                        new_div += "<option value='" + rowmatname[j]['_id'] + "' data-product_id='" + rowmatname[j]['_id'] + "'>" + rowmatname[j]['Rm_Des'] + "</option>";
                    }
                    new_div += '</select></td>';
                    new_div += '<td>';
                    new_div += '<input class="form-control" placeholder="Qty/Pcs"  name="product_raw_group[' + counter + '][qty_pcs]" type="text" style="width:100%"/>';
                    new_div += '</td>';
                    new_div += '<td><select name="product_raw_group[' + counter + '][sku]" class="form-control sku" style="width:100%;" required="true">';
                    // new_div +='<option value=""></option>';
                    for (j = 0; j < StockUnit.length; j++) {
                        new_div += "<option value='" + StockUnit[j]['_id'] + "' data-product_id='" + StockUnit[j]['_id'] + "'>" + StockUnit[j]['SKUName'] + "</option>";
                    }
                    new_div += '</select></td>';

                    new_div += '<td>';
                    new_div += '<input class="form-control CutRawfocus" placeholder="Price"  name="product_raw_group[' + counter + '][price]" type="text" style="width:100%"/></td>';
                    new_div += "<td><a onclick='remove_Rawproduct(" + counter + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#insert_raw_product");
                    counter++;
                    member++;

                    $(".productplace").select2({
                        // placeholder: "Select Raw Material",
                        allowClear: true,
                    });
                    $(".sku").select2({
                        // placeholder: "Select SKU",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()
                }
            }
        });
    }
});
var counter = 1;
var member = counter + 1;
var limit = 100;
$(document).on('click', '.updateproduct', function () {
    lstidx = $("input[name*='cntrer']").length;
    counter = lstidx;
    if (counter == limit) {
        alert("You have reached the limit of adding " + counter + " inputs");
    }
    else {
        var new_div = document.createElement('div');
        var new_div = "<tr class='product_wrapper' id='rohit" + counter + "'>";
        new_div += '<td><input class="form-control" name="product_mast_group[' + counter + '][it_pck]" value="" placeholder="Packing" type="text" required="" style="width:100%;"/></td>';
        new_div += '<td>';
        new_div += '<select name="product_mast_group[' + counter + '][it_bk]" id="it_bk" value="" class="form-control"  style="width:100%;">';
        new_div += '<option value="katta">Katta</option>';
        new_div += '<option value="bori">Bori</option>';
        new_div += '<option value="box">Box</option>';
        new_div += '</select>';
        new_div += '</td>';
        new_div += '<td><input class="form-control" type="text" placeholder="Brokerage Rate(Seller)" name="product_mast_group[' + counter + '][it_ratesl]" style="width:100%;"/></td>';
        new_div += '<input type="hidden" name="cntrer' + counter + '" value="' + counter + '" id="cntrer' + counter + '" class="form-control" style="width: 102px;text-align: -webkit-right;">';
        new_div += '<td>';
        new_div += '<select name="product_mast_group[' + counter + '][it_ratetypsl]" id="it_ratetypsl" value="" class="form-control" style="width:100%;">';
        new_div += '<option value="%">%</option>';
        new_div += '<option value="PBag">PBag</option>';
        new_div += '<option value="PQtl">PQtl</option>';
        new_div += '<option value="Fix">Fix</option>';
        new_div += '</select>';
        new_div += '<td>';
        new_div += '<input class="form-control" type="text" placeholder="Brokerage Rate (Buyer)" style="width:100%;" name="product_mast_group[' + counter + '][it_ratebr]"/>';
        new_div += '</td>';
        new_div += '<td>';
        new_div += '<select name="product_mast_group[' + counter + '][it_ratetypbr]" id="it_ratetypbr" value="" class="form-control" style="width:100%;">';
        new_div += '<option value="%">%</option>';
        new_div += '<option value="PBag">PBag</option>';
        new_div += '<option value="PQtl">PQtl</option>';
        new_div += '<option value="Fix">Fix</option>';
        new_div += '</select>';
        new_div += '</td>';
        new_div += "<td><a onclick='remove_product(" + counter + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
        $(new_div).insertBefore("#update_product");
        counter++;
        member++;

    }
});
function remove_product(id) {
    alert('Are you sure you want to delete this element');
    if (counter == 0) {
        alert("No record to delete");
    }
    else {
        counter--;
        member--;
        $("#rohit" + id).remove();

    }
}





$(document).ready(function () {
    //################################################################################
    $("body").on("click", ".expensesaudaok", function () {
        $(".cash").focus();
    })
    //################################################################################
    $('.printa').click(function (e) {
        e.preventDefault();
        var link = $(this).attr('href');
        var printwindow = window.open(link, "Print Sauda", "width=1100, height=600");
    })
    //################################################################################
    $(".fstable").click(function () {
        if (typeof document.cancelFullScreen != 'undefined' && document.fullScreenEnabled === true) {
            /* do fullscreen stuff */
        }
        gofullscreen("tableportlet");
    })
    //################################################################################
    var dropdownMenu;
    $(window).on('show.bs.dropdown', function (e) {

        dropdownMenu = $(e.target).parent('td').find('.dropdown-menu');

        $('body').append(dropdownMenu.detach());

        // grab the new offset position
        var eOffset = $(e.target).offset();

        dropdownMenu.css({
            'display': 'block',
            'top': eOffset.top + $(e.target).outerHeight(),
            'right': 0
        });

    });
    //################################################################################                                               
    $(window).on('hide.bs.dropdown', function (e) {
        $(e.target).append(dropdownMenu.detach());
        dropdownMenu.hide();
    });
    //################################################################################
    $("body").on("click", ".delbutton", function (e) {
        e.preventDefault();
        var link = $(this).attr("href");
        return swal({
            title: "Confirm",
            text: "Are you Sure you want to delete it?",
            icon: "warning",
            buttons: ["Cancel", "Confirm"],
            dangerMode: true
        }).then(function (valu) {
            if (valu)
                window.location.href = link;
        }).catch(function () {
            return false;
        })
    })
    //################################################################################
    $(".discountcredit").bootstrapSwitch();
    //################################################################################
    $(".partymasterbuttons button").click(function () {
        var dval = $(this).attr('data-value');
        var buyer = $('button[data-value="B"]');
        var seller = $('button[data-value="S"]');
        if ($(this).attr("data-active") == "no") {
            $(this).css({ 'background-color': "#4b77be", 'color': "#fff" });
            $(this).attr("data-active", "yes");
            updatepartymasterbuttons();
        }
        else {
            $(this).css({ 'background-color': "#fff", 'color': 'rgb(51,51,51)' });
            $(this).attr("data-active", "no");
            updatepartymasterbuttons();
        }
    })
    //################################################################################
    var data = [
        {
            id: 0,
            name: 'enhancement'
        },
        {
            id: 1,
            name: 'bug'
        },
        {
            id: 2,
            name: 'duplicate'
        },
        {
            id: 3,
            name: 'invalid'
        },
        {
            id: 4,
            name: 'wontfix'
        }
    ];
    //################################################################################
    addselect2('.select2');
    //################################################################################
    $('.city').select2({
        // minimumlength:3,
        placeholder: 'Please Select City',
        maximumSelectionLength: 3,
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/account_mast/getcity',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {

            }
        }
    });
    //################################################################################
    $('.state').select2({
        // minimumlength:3,
        placeholder: 'Please Select State',
        maximumSelectionLength: 3,
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/account_mast/getstate',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {

            }
        }
    });
    //################################################################################
    $('.group').select2({
        // minimumlength:3,
        placeholder: 'Please Select Group',
        maximumSelectionLength: 3,
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/account_mast/getgroup',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {

            }
        }
    });
    //################################################################################
    $('.tax_mast').select2({
        // minimumlength:3,
        placeholder: 'Please Select Tax',
        maximumSelectionLength: 3,
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/account_mast/gettax_mast',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {

            }
        }
    });
    //################################################################################
    $('.TAX').select2({
        // minimumlength:3,
        placeholder: 'Select',
        maximumSelectionLength: 3,
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/tax_mast/TAX',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {

            }
        }
    });
    //################################################################################
    $('.TDS').select2({
        // minimumlength:3,
        placeholder: 'Select TDS Account',
        maximumSelectionLength: 3,
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/tax_mast/TDS',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {

            }
        }
    });
    //################################################################################
    $('.partytype').select2({
        // minimumlength:3,
        placeholder: 'Please Select Party Type',
        maximumSelectionLength: 3,
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/account_mast/getpartytype',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {

            }
        }
    });
    //################################################################################ 
    $('.AllAccount').select2({
        placeholder: 'Please Select',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/AllAccount',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################ 
    $('.Expense_Acc').select2({
        placeholder: 'Please Select',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/Expense_Acc',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################ 
    $('.AllAccountWithOutCashBank').select2({
        placeholder: 'Please Select',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/AllAccountWithOutCashBank',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################ 
    $('.Credit_Debit_AC').select2({
        placeholder: 'Please Select',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/Credit_Debit_AC',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.cashbankname').select2({
        placeholder: 'Please Select Bank',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/cashbankname',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.getpartyoposmodule').select2({
        placeholder: 'Please select Party',
        allowClear: true,
        // minimumInputLength: 3,
        ajax: {
            type: "GET",
            url: '/op_os_module/getpartyoposmodule',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.DraweeBank').select2({
        placeholder: 'Please Select Bank',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/bank_details/DraweeBank',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.cashac_name').select2({
        placeholder: 'Please Select Account Name',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/cash_bank/accountname',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.cashac_namejv').select2({
        placeholder: 'Please Select Bank',
        allowClear: true,
        // minimumInputLength: 3,
        ajax: {
            type: "GET",
            url: '/journal_entry/journalname',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        // templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################  
    $('.party').select2({
        placeholder: 'Please select Party',
        allowClear: true,
        // minimumInputLength: 3,
        ajax: {
            type: "GET",
            url: '/contract_sauda/getparty',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.sbparty').select2({
        placeholder: 'Please select Party',
        allowClear: true,
        // minimumInputLength: 3,
        ajax: {
            type: "GET",
            url: '/contract_sauda/sbparty',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.brparty').select2({
        placeholder: 'Please select Party',
        allowClear: true,
        // minimumInputLength: 3,
        ajax: {
            type: "GET",
            url: '/contract_sauda/brparty',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.Tax_Master').select2({
        placeholder: 'Please Select',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/Tax_Master',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.ItenCodeName').select2({
        placeholder: 'Please select Item',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/ItenCodeName',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })

    $('.brandName').select2({
        placeholder: 'Please select Brand',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/brandName',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    //################################################################################
    $('.SaleAcInSaleEntry').select2({
        placeholder: 'Select Sale A/C',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Sales_Entry/SaleAcInSaleEntry',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    //################################################################################
    $('.PurAcInSaleEntry').select2({
        placeholder: 'Select Purchase A/C',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/PurAcInSaleEntry',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    //################################################################################
    $('.partynamename').select2({
        placeholder: 'Please select Party',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/brparty',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    //################################################################################
    $('.customerName').select2({
        placeholder: 'Please select Party',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/customerName',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    $('.bankrenclName').select2({
        placeholder: 'Please select Bank',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/bankrenclName',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    //################################################################################
    $('.sl_Person').select2({
        placeholder: 'Please select SL Person',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/sl_Person',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    //################################################################################
    $('.broker_Code').select2({
        placeholder: 'Please select Broker',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/broker_Code',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    //################################################################################
    $('.Posting_Ac').select2({
        placeholder: 'Select Posting Ac',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/Posting_Ac',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    //################################################################################
    $('.postingProAc').select2({
        placeholder: 'Please select Ac',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/product_mast/postingProAc',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    })
    //################################################################################
    $('.brprod').select2({
        placeholder: 'Select Product',
        allowClear: true,
        // minimumInputLength: 3,
        ajax: {
            type: "GET",
            url: '/contract_sauda/getproductname',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        // processResults: function (data) {
        //     console.log(data);
        //     return {
        //         results: data.format
        //     };
        // },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.bbparty').select2({
        placeholder: 'Please select Party',
        allowClear: true,
        // minimumInputLength: 3,
        ajax: {
            type: "GET",
            url: '/contract_sauda/bbparty',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        // processResults: function (data) {
        //     console.log(data);
        //     return {
        //         results: data.format
        //     };
        // },
        templateResult: formatcity,
        templateSelection: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    //################################################################################
    $('.addbank').on('click', '', function () {
        addselect2('.bankrow:last-child select');
    })
    //################################################################################
    $('.addcontact').on('click', '', function () {
        addselect2('.contactrow:last-child select');
    })
    //################################################################################
    $("select").on("change.select2", function (e) {
        $(this).valid();
    });
    //################################################################################
    var formvalid = $('.validate').validate({
        ignore: [],
        messages: {
            "p_type[]": "Please select atleast 1 Party type"
        },
        errorPlacement: function (error, element) {
            if (element.hasClass('select2')) {
                // error.appendTo(element.parent().parent());
                error.appendTo(element.parents('.col-md-9'));
            }
            else if (element.hasClass('party') || element.hasClass('brparty')) {
                // error.appendTo(element.parent().parent());
                error.appendTo(element.parents('.col-md-9'));
            }
            else {
                error.insertAfter(element);
            }
        }
    });
    //################################################################################
    // for blank page only for demo
    jQuery('.dtable').DataTable({
        // "dom": "<'row' <'col-md-12'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "lengthChange": true,
        "processing": true,
        "serverSide": true,
        "ajax": "/userright/data",
        "buttons": [
            {
                extend: 'excel',
                className: 'btn-default btn-excel'
            },
            {
                extend: 'pdf',
                className: 'btn-default btn-pdf'
            },
            {
                extend: 'print',
                className: 'btn-default btn-print'
            },
        ],
        "columns": [
            { "data": "id" },
            { "data": "name" },
            { "data": "position" },
            { "data": "office" },
            { "data": "extn" },
            { "data": "start_date" },
            { "data": "salary" }
        ]
    })
    //################################################################################
    $(document).on("keypress", 'form', function (e) {
        var code = e.keyCode || e.which;
        if (code == 13) {
            e.preventDefault();
            return false;
        }
    });
    //################################################################################
    /* open select on focus instead of enter */
    $('body').on('select2:select', '.select2', function () {
        $(this).select2('close');
        $(this).focus();
    })
    //################################################################################
    $('body').on('keydown', 'input, select:visible, .select2-container, textarea, .shiftfocus', function (e) {
        var self = $(this)
            , form = self.parents('form:eq(0)')
            , focusable
            , next
            ;
        if (e.keyCode == 13) {
            focusable = form.find('input,a,select, select:visible,button:not(".isprop"), .select2-container,.shiftfocus, textarea').not('.nofocus').filter(':visible');
            if ($(this).hasClass('.select2-container')) {
                ol = $(this).siblings('select');
                next = focusable.eq(focusable.index(ol) + 1);
            }
            else
                next = focusable.eq(focusable.index(this) + 1);

            if (next.length) {
                // next.hasClass('select2') ||
                if (next.hasClass('prbank'))
                    $(next).select2('open');
                else
                    next.focus();
                // console.log(next.focus());
            }
            return false;
        }
    });
    //################################################################################ 
    $('body').on('keydown', '.amountfocus', function (e) {
        var tr = $(this).parents('tr').index();
        if (e.keyCode == 13) {
            var answer = true; //confirm('Do you want to add new Row?')
            if (answer) {
                $('#add').trigger('click');
                $('.adjustmentstable').scrollLeft(0);
                // setTimeout(function(){ $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus(); }, 100);
            } else {
                var lasttr = $('.adjustmentstable tr:nth-last-child(2)').index();
                // alert(tr +" = "+ lasttr);
                if (tr == lasttr)
                    $('.delv_load').focus();
                else {
                    $('.adjustmentstable').scrollLeft(0);
                    setTimeout(function () { $('.adjustmentstable tr:nth-child(' + (tr + 2) + ')').find('.selectproductfocus').focus(); }, 100);
                }
            }
        }
    })
    //################################################################################
    $('body').on('keydown', '.CutRawfocus', function (e) {
        var tr = $(this).parents('tr').index();
        if (e.keyCode == 13) {
            var answer = true; //confirm('Do you want to add new Row?')
            if (answer) {
                $('#addCutRaw').trigger('click');
                $('.adjustmentstable').scrollLeft(0);
                // setTimeout(function(){ $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus(); }, 100);
            } else {
                var lasttr = $('.adjustmentstable tr:nth-last-child(2)').index();
                // alert(tr +" = "+ lasttr);
                if (tr == lasttr)
                    $('.delv_load').focus();
                else {
                    $('.adjustmentstable').scrollLeft(0);
                    setTimeout(function () { $('.adjustmentstable tr:nth-child(' + (tr + 2) + ')').find('.selectproductfocus').focus(); }, 100);
                }
            }
        }
    })
    //################################################################################
    $('body').on('keydown', '.WIPFocus', function (e) {
        var tr = $(this).parents('tr').index();
        if (e.keyCode == 13) {
            var answer = true; //confirm('Do you want to add new Row?')
            if (answer) {
                $('#add').trigger('click');
                $('.adjustmentstable').scrollLeft(0);
            } else {
                var lasttr = $('.adjustmentstable tr:nth-last-child(2)').index();
                if (tr == lasttr)
                    $('.delv_load').focus();
                else {
                    $('.adjustmentstable').scrollLeft(0);
                    setTimeout(function () { $('.adjustmentstable tr:nth-child(' + (tr + 2) + ')').find('.selectpnofocus').focus(); }, 100);
                }
            }
        }
    })
    //################################################################################
    ///rohit
    $('body').on('keydown', '.productplace + .select2-container', function (event) {
        if (event.keyCode == 27) {
            $(this).parents('tr').remove();
            glbitidx--;
            calc(1);
            $('.delv_load').focus();
        }
    })
    //################################################################################
    $(".save-form").click(function (ev) {
        ev.preventDefault();
        if ($(this).closest('form').valid()) {
            var data = $(this).closest('form').serialize();
            $.ajax({
                url: '/party/city_add',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    // alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "City",
                            text: "City Saved",
                            icon: "success",
                            timer: 2000,
                            buttons: false
                        })
                    } else {
                        swal({
                            title: "City",
                            text: "City Not Saved, Please Try Again",
                            icon: "error",
                            timer: 2000,
                            buttons: false
                        })
                    }
                }
            })
        }
    })
    //################################################################################
    $(".save-party").click(function (ev) {
        ev.preventDefault();
        if ($(this).closest('form').valid()) {
            var data = $(this).closest('form').serialize();
            $.ajax({
                url: '/customer/customer_add',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    // alert(dat)
                    //alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Customer",
                            text: "Customer Saved",
                            icon: "success",
                            timer: 2000,
                            buttons: false

                        })
                        window.location.href = "/customer/customer_list";
                    } else {
                        swal({
                            title: "Customer",
                            text: "Duplicate customer with same city is not allowed",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }
            })
        }
    })
    //################################################################################
    $(".lock-transport").click(function (ev) {
        ev.preventDefault();

        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxtransport").val();
            // alert("p"+id)
            if (id == "" || id == undefined) {

                $.ajax({

                    url: '/transport_mast/add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //      alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Transport",
                                text: "Transport Entry Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            window.location.href = "/transport_mast/transport_mast";
                        }
                        else {
                            swal({
                                title: "Transport",
                                text: "Duplicate transporter name with same city is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/transport_mast/edit_transport/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Transport",
                                text: "Transport Entry Updated",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/transport_mast/transport_mast";
                        } else {
                            swal({
                                title: "Transport",
                                text: "Duplicate transporter name with same city is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    })
    //################################################################################
    $(".lock-group").click(function (ev) {
        ev.preventDefault();

        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxgroup").val();
            // alert("p"+id)
            if (id == "" || id == undefined) {
                $.ajax({

                    url: '/group_mast/gmast_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //      alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Group",
                                text: "Group Entry Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            $('#addGroup').modal('hide');
                            if (dat.GaruEntryModel == 'GaruEntryModel') setTimeout(function () { $('.ac_name').focus(); }, 300);
                            else window.location.href = "/group_mast/group_mast";
                        }
                        else {
                            swal({
                                title: "Group",
                                text: "Duplicate group name  is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/group_mast/edit_gmast/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        // alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Group",
                                text: "Group Entry Updated",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/group_mast/group_mast";
                        } else {
                            swal({
                                title: "Group",
                                text: "Duplicate group name with same city is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    })
    //################################################################################
    $(".lock-group").on("keydown", function (ev) {
        // ev.preventDefault();
        if (ev.keyCode == 13) {
            if ($(this).closest('form').valid()) {

                var data = $(this).closest('form').serialize();
                var id = $("#vhpxgroup").val();
                // alert("p"+id)
                if (id == "" || id == undefined) {
                    $.ajax({

                        url: '/group_mast/gmast_add',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            //      alert("data")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "Group Master",
                                    text: "Group Entry Saved",
                                    icon: "success",
                                    timer: 4000,
                                    buttons: false

                                })
                                $('#addGroup').modal('hide');
                                if (dat.GaruEntryModel == 'GaruEntryModel') setTimeout(function () { $('.ac_name').focus(); }, 300);
                                else window.location.href = "/group_mast/group_mast";
                            }
                            else {
                                swal({
                                    title: "Group Master",
                                    text: "Duplicate group name  is not allowed",
                                    icon: "error",
                                    timer: 4000,
                                    buttons: false
                                })
                            }
                        }
                    })
                } else {
                    $.ajax({
                        url: '/group_mast/edit_gmast/' + id + '',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            // alert("updata")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "Group Master",
                                    text: "Group Entry Updated",
                                    icon: "success",
                                    timer: 4000,
                                    buttons: false
                                })
                                window.location.href = "/group_mast/group_mast";
                            } else {
                                swal({
                                    title: "Group Master",
                                    text: "Error in Update",
                                    icon: "error",
                                    timer: 4000,
                                    buttons: false
                                })
                                //  window.location.href = "/customer/customer_list";
                            }
                        }
                    })
                }
            }
        }
    })
    //################################################################################
    $(".lock-transaction").click(function (ev) {
        ev.preventDefault();

        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxtransac").val();
            //
            alert("p" + id)
            if (id == "" || id == undefined) {
                $.ajax({

                    url: '/trans_mast/tm_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //      alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Transaction Master",
                                text: "Transaction Entry Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            window.location.href = "/trans_mast/trans_mast";
                        }
                        else {
                            swal({
                                title: "Transaction Master",
                                text: "Duplicate transaction entry  is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/trans_mast/edit_tm/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //   alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Transaction Master",
                                text: "Transaction Entry Updated",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/trans_mast/trans_mast";
                        } else {
                            swal({
                                title: "Transaction Master",
                                text: "Duplicate transaction entry  is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    })
    //################################################################################
    $(".lock-product").on('keydown', function (ev) {
        ev.preventDefault();
        if (ev.keyCode == 13) {
            if ($(this).closest('form').valid()) {
                var data = $(this).closest('form').serialize();
                console.log(data);
                $.ajax({
                    url: '/product_mast/product_mast_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //   alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Finish Goods Master",
                                text: "Finish Goods Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            window.location.href = "/product_mast/add_product";
                        }
                        else {
                            swal({
                                title: "Finish Goods Master",
                                text: "Duplicate Finish Goods  with same name is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }

                })
            }
        }
    })
    $(".lock-product").click(function (ev) {
        ev.preventDefault();

        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            console.log(data);
            $.ajax({
                url: '/product_mast/product_mast_add',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    //   alert("data")
                    //  alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Finish Goods Master",
                            text: "Finish Goods Saved",
                            icon: "success",
                            timer: 4000,
                            buttons: false

                        })
                        window.location.href = "/product_mast/add_product";
                    }
                    else {
                        swal({
                            title: "Finish Goods Master",
                            text: "Duplicate Finish Goods  with same name is not allowed",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }

            })
        }

    })
    $(".lock-upproduct").click(function (ev) {
        ev.preventDefault();

        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxproduct").val();
            //  alert(id)
            $.ajax({
                url: '/product_mast/edit_product_mast/' + id + '',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    //  alert("data")
                    // alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Finish Goods Master",
                            text: "Finish Goods Updated",
                            icon: "success",
                            timer: 4000,
                            buttons: false

                        })
                        window.location.href = "/product_mast/product_mast";
                    }
                    else {
                        swal({
                            title: "Finish Goods Master",
                            text: "Duplicate Finish Goods  with same name is not allowed",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }

            })

        }
    })
    $(".lock-upproduct").on("keydown", function (ev) {
        // ev.preventDefault();
        if (ev.keyCode == 13) {
            if ($(this).closest('form').valid()) {

                var data = $(this).closest('form').serialize();
                var id = $("#vhpxproduct").val();
                //  alert(id)
                $.ajax({
                    url: '/product_mast/edit_product_mast/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //  alert("data")
                        // alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Finish Goods Master",
                                text: "Finish Goods Updated",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            window.location.href = "/product_mast/product_mast";
                        }
                        else {
                            swal({
                                title: "Finish Goods Master",
                                text: "Duplicate Finish Goods  with same name is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }

                })

            }
        }
    })
    //################################################################################
    $(".update-gsetup").on("click", function (ev) {
        // ev.preventDefault();
        var id = $("#group_id").val();

        // if($(this).closest('form').valid()){
        var group = $("#group").val();
        var garry = $("#garry").val();
        // var data = $(this).closest('form').serialize();
        console.log(group)
        console.log(garry)
        var id = $("#group_id").val();
        // alert(id)
        $.ajax({
            url: '/group_setup_mast/group_setup_mast_update/' + id + '',
            method: 'POST',
            dataType: 'json',
            data: { group, garry },
            success: function (dat) {
                console.log(dat)
                //  alert("data")
                // alert(dat.success);
                if (dat.success == true) {
                    $('#addcity').modal('hide');
                    swal({
                        title: "Group Setup Master",
                        text: "Group Setup Updated",
                        icon: "success",
                        timer: 4000,
                        buttons: false

                    })
                    window.location.href = "/group_setup_mast/group_setup_mast";
                }
                else {
                    swal({
                        title: "Group Setup Master",
                        text: "Error in Update",
                        icon: "error",
                        timer: 4000,
                        buttons: false
                    })
                }
            }

        })

        // }

    })
    //################################################################################   
    $(".lock-skumaster").click(function (ev) {
        ev.preventDefault();

        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxskuunit").val();
            //alert("p"+id)
            if (id == "" || id == undefined) {
                $.ajax({

                    url: '/stock_unit_mast/StockUnit_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //      alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "SKU Master",
                                text: "SKU Entry Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            window.location.href = "/stock_unit_mast/stock_unit_mast";
                        }
                        else {
                            swal({
                                title: "SKU Master",
                                text: "Duplicate unit name with same symbol is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/stock_unit_mast/su_update/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //  alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "SKU Master",
                                text: "SKU Entry Upadate Succesfull",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/stock_unit_mast/stock_unit_mast";
                        } else {
                            swal({
                                title: "SKU Master",
                                text: "Error In Update",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    })
    //################################################################################ 
    $(".lock-skumaster").on("keydown", function (ev) {
        // ev.preventDefault();
        if (ev.keyCode == 13) {
            if ($(this).closest('form').valid()) {

                var data = $(this).closest('form').serialize();
                var id = $("#vhpxskuunit").val();
                //alert("p"+id)
                if (id == "" || id == undefined) {
                    $.ajax({

                        url: '/stock_unit_mast/StockUnit_add',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            //      alert("data")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "SKU Master",
                                    text: "SKU Entry Saved",
                                    icon: "success",
                                    timer: 4000,
                                    buttons: false

                                })
                                window.location.href = "/stock_unit_mast/stock_unit_mast";
                            }
                            else {
                                swal({
                                    title: "SKU Master",
                                    text: "Duplicate unit name with same symbol is not allowed",
                                    icon: "error",
                                    timer: 4000,
                                    buttons: false
                                })
                            }
                        }
                    })
                } else {
                    $.ajax({
                        url: '/stock_unit_mast/su_update/' + id + '',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            //  alert("updata")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "SKU Master",
                                    text: "SKU Entry Upadate Succesfull",
                                    icon: "success",
                                    timer: 4000,
                                    buttons: false
                                })
                                window.location.href = "/stock_unit_mast/stock_unit_mast";
                            } else {
                                swal({
                                    title: "SKU Master",
                                    text: "Error In Update",
                                    icon: "error",
                                    timer: 4000,
                                    buttons: false
                                })
                                //  window.location.href = "/customer/customer_list";
                            }
                        }
                    })
                }
            }
        }
    })
    //################################################################################ 
    $(".lock-city").click(function (ev) {
        ev.preventDefault();
        if ($(this).closest('form').valid()) {
            var data = $(this).closest('form').serialize();
            var id = $("#vhpxcity").val();
            //alert("p"+id)
            if (id == "" || id == undefined) {
                $.ajax({
                    url: '/add_city/city_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        // alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "City Master",
                                text: "City Saved",
                                icon: "success",
                                timer: 2000,
                                buttons: false

                            })
                            $('#addCity').modal('hide');
                            if (dat.GaruEntryModel == 'GaruEntryModel') setTimeout(function () { $('#ac_add2').focus(); }, 300);
                            else window.location.href = "/add_city/add_city";
                        }
                        else {
                            $('#addCity').modal('hide');
                            swal({
                                title: "City Master",
                                text: "Duplicate city name  is not allowed",
                                icon: "error",
                                timer: 2000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/add_city/edit_city/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //   alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "City Master",
                                text: "City Successfully Update",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/add_city/add_city";
                        } else {
                            swal({
                                title: "City Master",
                                text: "Error In Update",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    })
    //################################################################################ 
    $(".lock-city").on("keydown", function (ev) {
        // ev.preventDefault();
        if (ev.keyCode == 13) {
            if ($(this).closest('form').valid()) {

                var data = $(this).closest('form').serialize();
                var id = $("#vhpxcity").val();
                //alert("p"+id)
                if (id == "" || id == undefined) {
                    $.ajax({

                        url: '/add_city/city_add',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            // alert("data")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "City Master",
                                    text: "City Saved",
                                    icon: "success",
                                    timer: 2000,
                                    buttons: false

                                })
                                $('#addCity').modal('hide');
                                if (dat.GaruEntryModel == 'GaruEntryModel') setTimeout(function () { $('#ac_add2').focus(); }, 300);
                                else window.location.href = "/add_city/add_city";
                            }
                            else {
                                $('#addCity').modal('hide');
                                swal({
                                    title: "City Master",
                                    text: "Duplicate city name  is not allowed",
                                    icon: "error",
                                    timer: 2000,
                                    buttons: false
                                })
                            }
                        }
                    })
                } else {
                    $.ajax({
                        url: '/add_city/edit_city/' + id + '',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            //   alert("updata")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "City Master",
                                    text: "City Successfully Update",
                                    icon: "success",
                                    timer: 4000,
                                    buttons: false
                                })
                                window.location.href = "/add_city/add_city";
                            } else {
                                swal({
                                    title: "City Master",
                                    text: "Error In Update",
                                    icon: "error",
                                    timer: 4000,
                                    buttons: false
                                })
                                //  window.location.href = "/customer/customer_list";
                            }
                        }
                    })
                }
            }
        }
    })
    //################################################################################ 
    $(".lock-state").click(function (ev) {
        ev.preventDefault();

        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxstate").val();
            //  alert("p"+id)
            if (id == "" || id == undefined) {
                $.ajax({

                    url: '/state_master/state_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //   alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "State Master",
                                text: "State Saved",
                                icon: "success",
                                timer: 2000,
                                buttons: false

                            })
                            $('#addState').modal('hide');
                            if (dat.GaruEntryModel == 'GaruEntryModel') setTimeout(function () { $('#ac_add2').focus(); }, 300);
                            else window.location.href = "/state_master/state_master";
                        }
                        else {
                            $('#addState').modal('hide');
                            swal({
                                title: "State Master",
                                text: "Duplicate state name with same country is not allowed",
                                icon: "error",
                                timer: 2000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/state_master/edit_state/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //   alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "State Master",
                                text: "State Succefully Update",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/state_master/state_master";
                        } else {
                            swal({
                                title: "State Master",
                                text: "Error",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    })
    //################################################################################ 
    $(".lock-state").on("keydown", function (ev) {
        // ev.preventDefault();
        if (ev.keyCode == 13) {
            if ($(this).closest('form').valid()) {

                var data = $(this).closest('form').serialize();
                var id = $("#vhpxstate").val();
                //  alert("p"+id)
                if (id == "" || id == undefined) {
                    $.ajax({

                        url: '/state_master/state_add',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            //   alert("data")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "State Master",
                                    text: "State Saved",
                                    icon: "success",
                                    timer: 2000,
                                    buttons: false

                                })
                                $('#addState').modal('hide');
                                if (dat.GaruEntryModel == 'GaruEntryModel') setTimeout(function () { $('#ac_add2').focus(); }, 300);
                                else window.location.href = "/state_master/state_master";
                            }
                            else {
                                $('#addState').modal('hide');
                                swal({
                                    title: "State Master",
                                    text: "Duplicate state name with same country is not allowed",
                                    icon: "error",
                                    timer: 2000,
                                    buttons: false
                                })
                            }
                        }
                    })
                } else {
                    $.ajax({
                        url: '/state_master/edit_state/' + id + '',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            //   alert("updata")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "State Master",
                                    text: "State Update SuccesFully",
                                    icon: "success",
                                    timer: 4000,
                                    buttons: false
                                })
                                window.location.href = "/state_master/state_master";
                            } else {
                                swal({
                                    title: "State Master",
                                    text: "Error",
                                    icon: "error",
                                    timer: 4000,
                                    buttons: false
                                })
                                //  window.location.href = "/customer/customer_list";
                            }
                        }
                    })
                }
            }
        }
    })
    //################################################################################ 
    $(".lock-country").click(function (ev) {
        ev.preventDefault();

        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxcountry").val();
            //   alert("p"+id)
            if (id == "" || id == undefined) {
                $.ajax({

                    url: '/district_mast/district_mast_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //      alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Distrct Master",
                                text: "Distrct Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            window.location.href = "/district_mast/district_mast";
                        }
                        else {
                            swal({
                                title: "Distrct Master",
                                text: "Duplicate Distrct name is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/district_mast/edit_district/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Distrct Master",
                                text: "Distrct Succesfully Update",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/district_mast/district_mast";
                        } else {
                            swal({
                                title: "Distrct Master",
                                text: "Error",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    })
    //################################################################################ 
    $(".lock-country").on("keydown", function (ev) {
        // ev.preventDefault();
        if (ev.keyCode == 13) {
            if ($(this).closest('form').valid()) {

                var data = $(this).closest('form').serialize();
                var id = $("#vhpxcountry").val();
                // alert("p"+id)
                if (id == "" || id == undefined) {
                    $.ajax({

                        url: '/district_mast/district_mast_add',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            //      alert("data")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "Distrct Master",
                                    text: "Distrct Saved",
                                    icon: "success",
                                    timer: 4000,
                                    buttons: false

                                })
                                window.location.href = "/district_mast/district_mast";
                            }
                            else {
                                swal({
                                    title: "Distrct Master",
                                    text: "Duplicate Distrct name is not allowed",
                                    icon: "error",
                                    timer: 4000,
                                    buttons: false
                                })
                            }
                        }
                    })
                } else {
                    $.ajax({
                        url: '/district_mast/edit_district/' + id + '',
                        method: 'POST',
                        dataType: 'json',
                        data: data,
                        success: function (dat) {
                            //alert("updata")
                            //  alert(dat.success);
                            if (dat.success == true) {
                                $('#addcity').modal('hide');
                                swal({
                                    title: "Distrct Master",
                                    text: "Distrct Update Succesfully",
                                    icon: "success",
                                    timer: 4000,
                                    buttons: false
                                })
                                window.location.href = "/district_mast/district_mast";
                            } else {
                                swal({
                                    title: "Distrct Master",
                                    text: "Error",
                                    icon: "error",
                                    timer: 4000,
                                    buttons: false
                                })
                                //  window.location.href = "/customer/customer_list";
                            }
                        }
                    })
                }
            }
        }
    })
    //################################################################################ 

    //################################################################################ 
    $(".update-journal").click(function (ev) {
        ev.preventDefault();
        if ($(this).closest('form').valid()) {
            var data = $(this).closest('form').serialize();
            var id = $("#vhpxjournal").val();
            // alert("p"+id)
            $.ajax({
                url: '/journal_entry/update/' + id + '',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    // alert(dat)
                    //alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Journal",
                            text: "Journal Entry Updated",
                            icon: "success",
                            timer: 2000,
                            buttons: false

                        })
                        window.location.href = "/journal_entry/journal_entry_list";
                    } else {
                        swal({
                            title: "Journal",
                            text: "Total Debit amount and Credit amount should be same",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }
            })
        }
    })
    $(".update-journal").on('keydown', function (ev) {
        // ev.preventDefault();  
        if (ev.keyCode == 13) {
            if ($(this).closest('form').valid()) {
                var data = $(this).closest('form').serialize();
                var id = $("#vhpxjournal").val();
                // alert("p"+id)
                $.ajax({
                    url: '/journal_entry/update/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        // alert(dat)
                        //alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Journal",
                                text: "Journal Entry Updated",
                                icon: "success",
                                timer: 2000,
                                buttons: false

                            })
                            window.location.href = "/journal_entry/journal_entry_list";
                        } else {
                            swal({
                                title: "Journal",
                                text: "Total Debit amount and Credit amount should be same",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            }
        }
    })
    //################################################################################ 
    $(".addpartylink").click(function () {
        var partytype = $(this).attr('data-party-type');
        $(".partymasterbuttons button").each(function () {
            if ($(this).attr('data-value') == partytype) {
                $(this).attr('data-active', 'yes');
            } else {
                $(this).attr('data-active', 'no');
            }
        })
        onupdate_masterbuttons();
    })
    //################################################################################ 
    if ($('#bars').length == 1) {
        google.charts.load('current', { packages: ['corechart', 'bar'] });
        google.charts.setOnLoadCallback(drawCharts);
    }
    //################################################################################ 
    $(".cancelmaster").click(function () {
        var action = $(this).attr('data-form-ad-action');
        $('#formheading span').text('Add');
        $(this).parents('form').attr('action', action);
    })
    //################################################################################ 

    $(".mastercheckbox input").click(function () {
        var table = $(this).parents("table");
        if ($(this).is(":checked")) {
            table.find('input[type="checkbox"]').prop("checked", true);
        }
        else {
            table.find('input[type="checkbox"]').prop("checked", false);
        }
    })
    //################################################################################ 
    $("table").on("click", ".trowcheck", function () {
        if ($(this).is(":checked")) {
            $(this).parent().siblings().attr('style', 'background-color: #337ab7 !important');
            $(this).parent().siblings().css({ "color": "#fff" });
        }
        else {
            if ($(this).parents('tr').hasClass('odd')) {
                $(this).parent().siblings().attr('style', 'background-color: #f2f2f2 !important');
                $(this).parent().siblings().css({ "background-color": "#f2f2f2", "color": "#333" });
            } else {
                $(this).parent().siblings().attr('style', 'background-color: #fff !important');
                $(this).parent().siblings().css({ "background-color": "#fff", "color": "#333" });
            }
        }
    })
    //################################################################################ 
    jQuery.validator.addMethod("alphas", function (value, element) {
        return this.optional(element) || /^[a-z," "]+$/i.test(value);
    }, "Letters and spaces only please");
    //################################################################################ 
    $(".editaction").click(function (e) {
        e.preventDefault();
        var checked = $('td input:checked');
        if (checked.length != 1) {

            swal({
                title: 'Improper Selection',
                text: 'Please select Atlest/only one',
                buttons: false,
                timer: 1500
            })
            return;
        }
        var id = $('td input:checked').first().val();
        var link = $(this).data("link");
        window.location.href = link + id;
    })
    //################################################################################ 
    $(".printaction").click(function (e) {
        e.preventDefault();
        var checked = $('td input:checked');
        if (checked.length < 1) {

            swal({
                title: 'Improper Selection',
                text: 'Please select Atlest/only one',
                buttons: false,
                timer: 1500
            })
            return;
        }
        var firstchecked = $('td input:checked').first();
        var id = firstchecked.val();
        var comp = firstchecked.data("comp");
        var link = $(this).data("link");
        window.location.href = link + id + "&amp;compid=" + comp;
    })
    //################################################################################ 
    $(".deleteaction").click(function (e) {
        e.preventDefault();
        var link = $(this).data("link");
        var checked = $('td input:checked');
        var deleteallid = [];
        var sauda2id = [];
        checked.each(function (x, y) {
            deleteallid.push($(y).val());
            sauda2id.push($(y).data("sauda2"));
        })
        var ides = encodeURI(deleteallid.toString());
        var sauda2 = encodeURI(sauda2id.toString());


        // var firstchecked = $('td input:checked').first();
        // var id = firstchecked.val();
        // var vouc = firstchecked.data("vouc");
        var goto = link + ides;
        if (sauda2 != '') {
            goto += "&sauda2=" + sauda2;
        }
        $.ajax({
            'url': goto + "&del=no",
            success: function (data) {
                if (data.success) {
                    swal({
                        title: "Confirm",
                        text: "Are you Sure you want to delete it?",
                        icon: "warning",
                        buttons: ["Cancel", "Confirm"],
                        dangerMode: true
                    }).then(function (isConfirm) {
                        if (isConfirm) {
                            $.ajax({
                                'url': goto + "&del=yes",
                                success: function (data) {
                                    if (data.success) {
                                        swal({
                                            title: 'Success',
                                            text: 'Records Deleted Succesfully',
                                            buttons: false,
                                            timer: 1500
                                        })
                                        // location.reload();
                                        checked.parents("tr").remove();

                                    } else {
                                        swal({
                                            title: 'Error!',
                                            text: data.message,
                                            buttons: false,
                                            timer: 1500
                                        })
                                    }
                                }
                            })
                        }
                    })
                } else {
                    swal({
                        title: 'Error!',
                        text: data.message,
                        buttons: false,
                        timer: 1500
                    })
                }
            }
        })

    })
    //################################################################################ 
    $(".prevdef").click(function (e) {
        e.preventDefault();
    })
    //################################################################################ 
    $("#searchmenu").keydown(function (e) {
        if (e.keyCode == 27) {
            $(this).slideToggle();
        }
    })
    //################################################################################ 
    $("#savedev").click(function () {
        $.ajax({
            type: 'GET',
            url: '/delivery_entry/productname',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    var product = data['product_mast'];
                    var brand = data['brand'];
                    var main_loop_id = 0;
                    var result = '';
                    var tot_bags = $('#tot_bags').val();
                    var tot_wght = $('#tot_wght').val();
                    var tot_ammount = $('#tot_ammount').val();
                    for (i = 1; i <= glbitidx; i++) {
                        var inp_code = $('#inp_code' + i).val();
                        var brand_name = $("#brand_name" + i).val();
                        var bag = $('#bag' + i).val();
                        var pck = $('#pck' + i).val();
                        var inbrnd_code = $('#inbrnd_code').val();
                        var wght = $('#wght' + i).val();
                        var sel_rate = $('#sel_rate' + i).val();
                        var seler_rate = $('#seler_rate' + i).val();
                        var buy_rate = $('#buy_rate' + i).val();
                        var w_q = $('#w_q' + i).val();
                        var wghtunit = $('#wghtunit' + i).val();
                        var rateper = $('#rateper' + i).val();
                        var amount = $('#amount' + i).val();
                        var pcktype = $('#pcktype' + i).val();
                        var g_n = $('#g_n' + i).val();
                        var ipack = $('#ipack' + i).val();
                        var slbrk_type = $('#slbrk_type' + i).val();
                        var slbrk_rt = $('#slbrk_rt' + i).val();
                        var slbrk_amt = $('#slbrk_amt' + i).val();
                        var brbrk_rt = $('#brbrk_rt' + i).val();
                        var brbrk_typ = $('#brbrk_typ' + i).val();
                        var brbrk_amt = $('#brbrk_amt' + i).val();
                        main_loop_id = i;
                        result += '<tr class="delivery-wrapper" id="rohit' + main_loop_id + '">';
                        result += '<td><select disabled name="contract_sauda_group[' + main_loop_id + '][p_code]"  id="inp_code' + main_loop_id + '" onchange="chgcombo(' + main_loop_id + ')"  class="form-control" style="width:102px;">';
                        for (p = 0; p < product.length; p++) {
                            if (inp_code == product[p]['_id']) {
                                result += "<option value='" + product[p]['_id'] + "' data-product_id='" + product[p]['_id'] + "' selected>" + product[p]['product_name'] + "</option>";
                            }
                            else {
                                result += "<option value='" + product[p]['_id'] + "' data-product_id='" + product[p]['_id'] + "'>" + product[p]['product_name'] + "</option>";
                            }
                        }
                        result += '</select></td><td><select disabled name="contract_sauda_group[' + main_loop_id + '][brand_code]" id="brand_name' + i + '" class="form-control brand_name" style="width: 102px;">';
                        for (b = 0; b < brand.length; b++) {
                            if (brand_name == brand[b]['_id']) {
                                result += "<option value='" + brand[b]['_id'] + "' selected>" + brand[b]['brand_name'] + "</option>";
                            } else {
                                result += "<option value='" + brand[b]['_id'] + "'>" + brand[b]['brand_name'] + "</option>";
                            }
                        }
                        result += '</select></td>';
                        result += '<td>';
                        result += '<input type="number" name="contract_sauda_group[' + main_loop_id + '][bag]" id="bag_dlv' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" value="' + bag + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                        result += '<td><input type="number" readonly name="contract_sauda_group[' + main_loop_id + '][pck]" step="0.0001"  id="pck_dlv' + main_loop_id + '" onchange="chgpck(' + main_loop_id + ')" oninput="calc(' + main_loop_id + ')"  value="' + pck + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                        result += '<td><select disabled name="contract_sauda_group[' + main_loop_id + '][pck_unit]" id="inbrnd_code' + main_loop_id + '" class="form-control" style="width: 72px;"><option value="KG">KG</option></select></td>';
                        result += '<td><input type="number" readonly step="0.0001" name="contract_sauda_group[' + main_loop_id + '][wght]" id="wght_dlv' + main_loop_id + '" value="' + wght + '" oninput="calc(' + main_loop_id + ')" class="form-control wght" style="width: 82px;text-align: -webkit-right;"></td>';
                        result += '<td><input type="number"  step="0.0001" name="contract_sauda_group[' + main_loop_id + '][sd_rate]" id="sel_rate_dlv' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" value="' + sel_rate + '"  class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                        result += '<td><input type="number" readonly step="0.0001" name="contract_sauda_group[' + main_loop_id + '][s_rate]" id="seler_rate_dlv' + main_loop_id + '" value="' + seler_rate + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                        result += '<td><input type="number" readonly name="contract_sauda_group[' + main_loop_id + '][b_rate]" id="buy_rate_dlv' + main_loop_id + '" value="' + buy_rate + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                        result += '<td><select disabled name="contract_sauda_group[' + main_loop_id + '][w_q]" id="w_q_dlv' + main_loop_id + '" class="form-control w_q" style="width: 72px;">';
                        if (w_q == 'W') result += '<option value="W" selected>W</option>';
                        else result += '<option value="W">W</option>';
                        if (w_q == 'Q') result += '<option value="Q" selected>Q</option>';
                        else result += '<option value="Q">Q</option>';
                        result += '</select></td>';
                        result += '<td><select disabled name="contract_sauda_group[' + main_loop_id + '][wghtunit]" id="wghtunit' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 72px;">';
                        if (wghtunit == "Qtl") result += '<option value="Qtl" selected>Qtl</option>';
                        else result += '<option value="Qtl">Qtl</option>';
                        if (wghtunit == "Tons") result += '<option value="Tons" selected>Tons</option>';
                        else result += '<option value="Tons">Tons</option>';
                        if (wghtunit == "Kg") result += '<option value="Kg" selected>Kg</option>';
                        else result += '<option value="Kg">Kg</option>';
                        result += '</select></td>';
                        result += '<td><select disabled name="contract_sauda_group[' + main_loop_id + '][rateper]" id="rateper' + main_loop_id + '" class="form-control" style="width: 62px;text-align: -webkit-right;">';
                        if (rateper == "1") result += '<option value="1" selected>1</option>';
                        else result += '<option value="1">1</option>';
                        if (rateper == "10") result += '<option value="10" selected>10</option>';
                        else result += '<option value="10">10</option>';
                        if (rateper == "100") result += '<option value="100" selected>100</option>';
                        else result += '<option value="100">100</option>';
                        result += '</select></td>';
                        result += '<td><input type="number" readonly step="0.0001" name="contract_sauda_group[' + main_loop_id + '][amount]" id="amount_dlv' + main_loop_id + '" value="' + amount + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                        result += '<td><select disabled name="contract_sauda_group[' + main_loop_id + '][pcktype]" id="pcktype" class="form-control" style="width: 102px;">';
                        if (pcktype == "Gross") result += '<option value="Gross" selected>Gross</option>';
                        else result += '<option value="Gross">Gross</option>';
                        if (pcktype == "Net") result += '<option value="Net" selected>Net</option>';
                        else result += '<option value="Net">Net</option>';
                        result += '</select></td>';
                        result += '<td><select disabled name="contract_sauda_group[' + main_loop_id + '][g_n]" id="g_n' + main_loop_id + '" class="form-control" style="width: 102px;">';
                        if (g_n == 'O') result += '<option value="O" selected>O</option>';
                        else result += '<option value="O">O</option>';
                        if (g_n == 'N') result += '<option value="N" selected>N</option>';
                        else result += '<option value="N">N</option>';
                        result += '</select></td>';
                        result += '<td><input type="number" readonly  step="0.0001" name="contract_sauda_group[' + main_loop_id + '][ipack]" value="' + ipack + '" id="ipack' + main_loop_id + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                        result += '<td><input type="number" readonly name="contract_sauda_group[' + main_loop_id + '][slbrk_rt]" id="slbrk_rt_dlv' + main_loop_id + '" value="' + slbrk_rt + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                        result += '<td><select disabled name="contract_sauda_group[' + main_loop_id + '][slbrk_type]" id="slbrk_type_dlv' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 102px;">';

                        if (slbrk_type == '%') result += '<option value="%" selected>%</option>';
                        else result += '<option value="%">%</option>';
                        if (slbrk_type == 'PBag') result += '<option value="PBag" selected>PBag</option>';
                        else result += '<option value="PBag">PBag</option>';
                        if (slbrk_type == 'PQtl') result += '<option value="PQtl" selected>PQtl</option>';
                        else result += '<option value="PQtl">PQtl</option>';
                        if (slbrk_type == 'Fix') result += '<option value="Fix" selected>Fix</option>';
                        else result += '<option value="Fix">Fix</option>';
                        result += '</select></td>';
                        result += '<td><input type="number" readonly step="0.0001" name="contract_sauda_group[' + main_loop_id + '][slbrk_amt]" id="slbrk_amt_dlv' + main_loop_id + '" value="' + slbrk_amt + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                        result += '<td><input type="number" readonly  name="contract_sauda_group[' + main_loop_id + '][brbrk_rt]" oninput="calc(' + main_loop_id + ')" value="' + brbrk_rt + '" id="brbrk_rt_dlv' + main_loop_id + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                        result += '<td>';
                        result += '<select disabled name="contract_sauda_group[' + main_loop_id + '][brbrk_typ]" oninput="calc(' + main_loop_id + ')" id="brbrk_typ_dlv' + main_loop_id + '" class="form-control" style="width: 102px;">';
                        if (brbrk_typ == '%') result += '<option value="%" selected>%</option>';
                        else result += '<option value="%">%</option>';
                        if (brbrk_typ == 'PBag') result += '<option value="PBag" selected>PBag</option>';
                        else result += '<option value="PBag">PBag</option>';
                        if (brbrk_typ == 'PQtl') result += '<option value="PQtl" selected>PQtl</option>';
                        else result += '<option value="PQtl">PQtl</option>';
                        if (brbrk_typ == 'Fix') result += '<option value="Fix" selected>Fix</option>';
                        else result += '<option value="Fix">Fix</option>';
                        result += '</select></td>';
                        result += '<td><input readonly type="number" step="0.0001" name="contract_sauda_group[' + main_loop_id + '][brbrk_amt]" oninput="calc(' + main_loop_id + ')" value="' + brbrk_amt + '"  id="brbrk_amt_dlv' + main_loop_id + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';

                        result += '</td>';
                        result += '</tr>';

                    }
                    result += '<tr id="contract_div">';
                    result += '<th>Total</th>';
                    result += '<td></td>';
                    result += '<td><input name="tot_bags" value="' + tot_bags + '" id="tot_bags_dlv" placeholder="Total Bags" value="" class="form-control nofocus" readonly  tabindex="-1"></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td> <input type="text" name="tot_wght" value="' + tot_wght + '" id="tot_wght_dlv" placeholder="Total tot_wght" class="form-control item_name nofocus" readonly  tabindex="-1"></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td> <input type="text" name="tot_ammount" value="' + tot_ammount + '" id="tot_ammount_dlv" placeholder="Total Amount" class="form-control tot_ammount nofocus"  readonly  tabindex="-1"></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '<td></td>';
                    result += '</tr>';
                    $("#deliverysupport .modal-body .modalappend").html(result);
                }


            }

            // }
        });

        // var cont = $(".delvcopy").concat();
        // $("#deliverysupport .modal-body .modalappend").html(cont);
    })
    //################################################################################ 
    // to run on party master update
    onupdate_masterbuttons();
})
//################################################################################ //################################################################################ 
function drawCharts() {
    totalsauda();
    barchart();
}
function totalsauda() {

    var data = google.visualization.arrayToDataTable([
        ['Sauda', 'total'],
        ['Completed', 11],
        ['Pending', 2],
        ['In Process', 6],
    ]);

    var options = {
        title: "Total Sauda's",
        is3D: true,
        legend: 'left',
        legendposition: 'center',
        width: '100%',
        height: '100%',
        chartArea: {
            left: "3%",
            top: "3%",
            height: "94%",
            width: "94%"
        },
        pieSliceText: 'value',
    };

    var totalsaudapie = new google.visualization.PieChart(document.getElementById('totalsauda'));
    google.visualization.events.addListener(totalsaudapie, 'select', totalsaudaclick);

    totalsaudapie.draw(data, options);

    function totalsaudaclick() {
        var selectedItem = totalsaudapie.getSelection()[0];

        if (selectedItem) {
            var topping = data.getValue(selectedItem.row, 0);
            alert('The user selected ' + topping);
        }
    }

}

function barchart() {

    var data = google.visualization.arrayToDataTable([
        ['Sauda', 'total'],
        ['Completed', 11],
        ['Pending', 2],
        ['In Process', 6],
    ]);

    var options = {
        title: "Total Bars",
        is3D: true,
        legend: 'bottom',
        legendposition: 'center',
        width: '100%',
        height: '100%',
        bars: 'vertical',
        chartArea: {
            left: "3%",
            top: "3%",
            height: "94%",
            width: "94%"
        },
        pieSliceText: 'value',
    };

    var bars = new google.charts.Bar(document.getElementById('bars'));
    google.visualization.events.addListener(bars, 'select', barsclick);

    bars.draw(data, options);

    function barsclick() {
        var selectedItem = bars.getSelection()[0];

        if (selectedItem) {
            var topping = data.getValue(selectedItem.row, 0);
            alert('The user selected ' + topping);
        }
    }

}


// function checkcontractpartytypeonedit(){
//     $(".contractpartycheckbox").each(function(){
//         if($(this).prop('checked') == true)
//         $(this).parents(".input-group").find('select').removeAttr('disabled');
//         else
//         $(this).parents(".input-group").find('select').attr('disabled','true');
//     })
// }

var company = [
    { id: 0, comp: 'Huseini Indorewala', city: 'Indore' },
    { id: 1, comp: 'Alias', city: 'Mumbai' }
]

function formatcity(data) {
    var divided = data['text'].split(',');
    if (typeof (divided[1]) == 'undefined') {
        divided[1] = '';
    }
    var ret = $('<div class="clearfix"><div class="pull-left">' + divided[0] + '</div><div class="pull-right">' + divided[1] + '</div></div>');
    return ret;
}


function addselect2(selec) {
    $(selec).each(function () {
        var plach = $(this).attr('placeholder');
        $(this).select2({
            placeholder: plach,
            allowClear: true
        }).on('selct2-select', function () {
            alert('hi');
        })
    })
}

function updatepartymasterbuttons() {
    var v = '';
    $(".partymasterbuttons button").each(function (i) {
        if ($(this).attr('data-active') == 'yes') {
            if (v != '') {
                v = v + ',';
            }
            v = v + $(this).attr('data-value');
        }
        $("#bsrt").val(v);
        $("#bsrt").valid();
    })
}

// function for update page
function onupdate_masterbuttons() {
    var v = '';
    $(".partymasterbuttons button").each(function (i) {
        if ($(this).attr('data-active') == 'yes') {
            if (v != '') {
                v = v + ',';
            }
            v = v + $(this).attr('data-value');
            $(this).css({ 'background-color': "#4b77be", 'color': "#fff" });
        } else {
            $(this).css({ 'background-color': "#fff", 'color': "#333" });
        }
        $("#bsrt").val(v);
        $("#bsrt").valid();
    })
}

function gofullscreen(elementid) {

    var elem = document.getElementById(elementid);
    if (elem.requestFullscreen) {
        elem.requestFullscreen();
    } else if (elem.mozRequestFullScreen) {
        elem.mozRequestFullScreen();
    } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
    }

}


// Mousetrap.bind('p m', function () {
//     var link = 'http://' + window.location.host + '/party/party_list';
//     window.location.replace(link);
// });

// Mousetrap.bind('c m', function () {
//     var link = 'http://' + window.location.host + '/add_city/add_city';
//     window.location.replace(link);
// });


// Mousetrap.bind('home', function () {
//     var link = 'http://' + window.location.host + '/userright/index';
//     window.location.replace(link);
// });

// Mousetrap.bind('F', function () {
//     gofullscreen("body");
//     $("body").css('overflow', "scroll");
// });

// Mousetrap.bind('ctrl + t', function () {
//     $(".panel-body").css('overflow', "auto");
//     gofullscreen("portletbody");
// });

// Mousetrap.bind('ctrl+b', function () {
//     $("#searchmenu").slideDown();
//     $("#searchmenu").focus();
// });

Mousetrap.bind('f5', async function (e) {
    e.preventDefault();
    var confirm = $('#GaruEntryModel').val();
    var Form = $('#Form').val();
    if (Form == 'SaleBillEntry') {
        var b = await calRoundoffSale()
    }
    if (confirm == '' || confirm == null || confirm == undefined) {
        $('.panel').find('form').submit();
    }
    else {
        if (confirm == 'AccountForm') {
            $(".lock-account").click();
        }
        if (confirm == 'DailyGroceeryEntry') {
            $(".lock-dailygrocery").click();
        }
        if (confirm == 'journalEntryForm') {
            if ($('#totcash_amtdr').val() == $('#totcash_amtcr').val()) $(".save-journal").click();
            else {
                swal({
                    title: "Journal Entry",
                    text: "Total Debit Amount And Total Credit Amount Must Be Same",
                    icon: "error",
                    timer: 1000,
                    buttons: false
                })
            }
        }
    }
});
Mousetrap.bind('f4', function (e) {
    e.preventDefault();
    getSaleBillModal();
    chaqReturnEntry();
    if ($('#Form').val() == 'BillCollUpdate') chaqReturnEntryInBC();
});
Mousetrap.bind('f8', function (e) {
    e.preventDefault();
    getAccMastModalInSateBillEntry()
});
Mousetrap.bind('f7', function (e) {
    e.preventDefault();
    SaleDetailModalPartyWise()
});
Mousetrap.bind('f2', function (e) {
    $('.btn-link').trigger("click");
    var Form = $('#Form').val();
    if (Form == 'BillCollection_Add_Form') {
        var values = $("input[name='cashtrn']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1];
        getOutstandingModalInBC(idx)
    }
});
function ShowShortcuts() {
    $('#shortcuts').modal("show");
}
// Mousetrap.bind('f1', function (e) {
//     e.preventDefault();
//     $('#shortcuts').modal("show"); 
// });
Mousetrap.prototype.stopCallback = function () {
    return false;
}
$(".partyform").submit(function (ev) {
    ev.preventDefault();
    if ($(this).closest('form').valid()) {
        var data = $(this).closest('form').serialize();
        $.ajax({
            url: '/party/party_add',
            method: 'POST',
            dataType: 'json',
            data: data,
            success: function (dat) {
                if (dat.success == true) {
                    window.location.href = '/party/party_list';
                }
                else if (dat.success == "city_name") {
                    swal({
                        title: "Party",
                        text: "Party Name And City Name Allready Exits",
                        icon: "error",
                        timer: 2000,
                        buttons: false
                    })
                }
                else if (dat.success == "partyusername") {
                    swal({
                        title: "Party",
                        text: "Mobile Username Already Exits",
                        icon: "error",
                        timer: 2000,
                        buttons: false
                    })
                }
            }
        })
    }
})
$(document).on("click", "#delivery_contractsauda", function () {
    $.ajax({
        type: 'GET',
        url: '/delivery_entry/productname',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                var product = data['product_mast'];
                var brand = data['brand'];
                var main_loop_id = 0;
                var bno = $('#bno').val();
                var bdt = $('#bdt').val();
                var mot_no = $('#mot_no').val();
                var tptcode = $('#tptcode').val();
                var tpt_col = $('#tpt_col').val();
                var frght = $('#frght').val();
                var frght_rt = $('#frght_rt').val();
                var frght_adv = $('#frght_adv').val();
                var result = '<input type="text" name="bdt" value="' + bdt + '">';
                result += '<input type="text" name="mot_no" value="' + mot_no + '">';
                result += '<input type="text" name="tptcode" value="' + tptcode + '">';
                result += '<input type="text" name="tpt_col" value="' + tpt_col + '">';
                result += '<input type="text" name="frght" value="' + frght + '">';
                result += '<input type="text" name="frght_rt" value="' + frght_rt + '">';
                result += '<input type="text" name="frght_adv" value="' + frght_adv + '">';
                result += '<input type="text" name="bno" value="' + bno + '">';
                // var html='';
                var tot_bags_dlv = $('#tot_bags_dlv').val();
                var tot_wght_dlv = $('#tot_wght_dlv').val();
                var tot_ammount_dlv = $('#tot_ammount_dlv').val();
                for (i = 1; i <= glbitidx; i++) {
                    var inp_code = $('#inp_code' + i).val();
                    var brand_name = $("#brand_name" + i).val();
                    var bag_dlv = $('#bag_dlv' + i).val();
                    var pck = $('#pck' + i).val();
                    var inbrnd_code = $('#inbrnd_code').val();
                    var wght_dlv = $('#wght_dlv' + i).val();
                    var sel_rate_dlv = $('#sel_rate_dlv' + i).val();
                    var seler_rate = $('#seler_rate' + i).val();
                    var buy_rate = $('#buy_rate' + i).val();
                    var w_q = $('#w_q' + i).val();
                    var wghtunit = $('#wghtunit' + i).val();
                    var rateper = $('#rateper' + i).val();
                    var amount_dlv = $('#amount_dlv' + i).val();
                    var pcktype = $('#pcktype' + i).val();
                    var g_n = $('#g_n' + i).val();
                    var ipack = $('#ipack' + i).val();
                    var slbrk_type = $('#slbrk_type' + i).val();
                    var slbrk_rt = $('#slbrk_rt' + i).val();
                    var slbrk_amt_dlv = $('#slbrk_amt_dlv' + i).val();
                    var brbrk_rt = $('#brbrk_rt' + i).val();
                    var brbrk_typ = $('#brbrk_typ' + i).val();
                    var brbrk_amt_dlv = $('#brbrk_amt_dlv' + i).val();

                    main_loop_id = i;
                    result += '<tr class="delivery-wrapper" id="rohit' + main_loop_id + '">';
                    result += '<td><select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][p_code]"  id="inp_code' + main_loop_id + '" onchange="chgcombo(' + main_loop_id + ')"  class="form-control" style="width:102px;">';
                    for (p = 0; p < product.length; p++) {
                        if (inp_code == product[p]['_id']) {
                            result += "<option value='" + product[p]['_id'] + "' data-product_id='" + product[p]['_id'] + "' selected>" + product[p]['product_name'] + "</option>";
                        }
                        else {
                            result += "<option value='" + product[p]['_id'] + "' data-product_id='" + product[p]['_id'] + "'>" + product[p]['product_name'] + "</option>";
                        }
                    }
                    result += '</select></td><td><select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][brand_code]" id="brand_name' + i + '" class="form-control brand_name" style="width: 102px;">';
                    for (b = 0; b < brand.length; b++) {
                        if (brand_name == brand[b]['_id']) {
                            result += "<option value='" + brand[b]['_id'] + "' selected>" + brand[b]['brand_name'] + "</option>";
                        } else {
                            result += "<option value='" + brand[b]['_id'] + "'>" + brand[b]['brand_name'] + "</option>";
                        }
                    }
                    result += '</select></td>';
                    result += '<td>';
                    result += '<input type="number" name="contract_sauda_group_dlv[' + main_loop_id + '][bag]" id="bag_dlv' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" value="' + bag_dlv + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                    result += '<td><input type="number" readonly name="contract_sauda_group_dlv[' + main_loop_id + '][pck]" step="0.0001"  id="pck_dlv' + main_loop_id + '" onchange="chgpck(' + main_loop_id + ')" oninput="calc(' + main_loop_id + ')"  value="' + pck + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                    result += '<td><select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][pck_unit]" id="inbrnd_code' + main_loop_id + '" class="form-control" style="width: 72px;"><option value="KG">KG</option></select></td>';
                    result += '<td><input type="number" readonly step="0.0001" name="contract_sauda_group_dlv[' + main_loop_id + '][wght]" id="wght_dlv' + main_loop_id + '" value="' + wght_dlv + '" oninput="calc(' + main_loop_id + ')" class="form-control wght" style="width: 82px;text-align: -webkit-right;"></td>';
                    result += '<td><input type="number"  step="0.0001" name="contract_sauda_group_dlv[' + main_loop_id + '][sd_rate]" id="sel_rate_dlv' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" value="' + sel_rate_dlv + '"  class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                    result += '<td><input type="number" readonly step="0.0001" name="contract_sauda_group_dlv[' + main_loop_id + '][s_rate]" id="seler_rate_dlv' + main_loop_id + '" value="' + seler_rate + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                    result += '<td><input type="number" readonly name="contract_sauda_group_dlv[' + main_loop_id + '][b_rate]" id="buy_rate_dlv' + main_loop_id + '" value="' + buy_rate + '" class="form-control" style="width: 72px;text-align: -webkit-right;"></td>';
                    result += '<td><select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][w_q]" id="w_q_dlv' + main_loop_id + '" class="form-control w_q" style="width: 72px;">';
                    if (w_q == 'W') result += '<option value="W" selected>W</option>';
                    else result += '<option value="W">W</option>';
                    if (w_q == 'Q') result += '<option value="Q" selected>Q</option>';
                    else result += '<option value="Q">Q</option>';
                    result += '</select></td>';
                    result += '<td><select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][wghtunit]" id="wghtunit' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 72px;">';
                    if (wghtunit == "Qtl") result += '<option value="Qtl" selected>Qtl</option>';
                    else result += '<option value="Qtl">Qtl</option>';
                    if (wghtunit == "Tons") result += '<option value="Tons" selected>Tons</option>';
                    else result += '<option value="Tons">Tons</option>';
                    if (wghtunit == "Kg") result += '<option value="Kg" selected>Kg</option>';
                    else result += '<option value="Kg">Kg</option>';
                    result += '</select></td>';
                    result += '<td><select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][rateper]" id="rateper' + main_loop_id + '" class="form-control" style="width: 62px;text-align: -webkit-right;">';
                    if (rateper == "1") result += '<option value="1" selected>1</option>';
                    else result += '<option value="1">1</option>';
                    if (rateper == "10") result += '<option value="10" selected>10</option>';
                    else result += '<option value="10">10</option>';
                    if (rateper == "100") result += '<option value="100" selected>100</option>';
                    else result += '<option value="100">100</option>';
                    result += '</select></td>';
                    result += '<td><input type="number" readonly step="0.0001" name="contract_sauda_group_dlv[' + main_loop_id + '][amount]" id="amount_dlv' + main_loop_id + '" value="' + amount_dlv + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                    result += '<td><select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][pcktype]" id="pcktype" class="form-control" style="width: 102px;">';
                    if (pcktype == "Gross") result += '<option value="Gross" selected>Gross</option>';
                    else result += '<option value="Gross">Gross</option>';
                    if (pcktype == "Net") result += '<option value="Net" selected>Net</option>';
                    else result += '<option value="Net">Net</option>';
                    result += '</select></td>';
                    result += '<td><select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][g_n]" id="g_n' + main_loop_id + '" class="form-control" style="width: 102px;">';
                    if (g_n == 'O') result += '<option value="O" selected>O</option>';
                    else result += '<option value="O">O</option>';
                    if (g_n == 'N') result += '<option value="N" selected>N</option>';
                    else result += '<option value="N">N</option>';
                    result += '</select></td>';
                    result += '<td><input type="number" readonly  step="0.0001" name="contract_sauda_group_dlv[' + main_loop_id + '][ipack]" value="' + ipack + '" id="ipack' + main_loop_id + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                    result += '<td><input type="number" readonly  name="contract_sauda_group_dlv[' + main_loop_id + '][slbrk_rt]" id="slbrk_rt_dlv' + main_loop_id + '" value="' + slbrk_rt + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                    result += '<td><select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][slbrk_type]" id="slbrk_type_dlv' + main_loop_id + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 102px;">';

                    if (slbrk_type == '%') result += '<option value="%" selected>%</option>';
                    else result += '<option value="%">%</option>';
                    if (slbrk_type == 'PBag') result += '<option value="PBag" selected>PBag</option>';
                    else result += '<option value="PBag">PBag</option>';
                    if (slbrk_type == 'PQtl') result += '<option value="PQtl" selected>PQtl</option>';
                    else result += '<option value="PQtl">PQtl</option>';
                    if (slbrk_type == 'Fix') result += '<option value="Fix" selected>Fix</option>';
                    else result += '<option value="Fix">Fix</option>';
                    result += '</select></td>';

                    result += '<td><input type="number" readonly step="0.0001" name="contract_sauda_group_dlv[' + main_loop_id + '][slbrk_amt]" id="slbrk_amt_dlv' + main_loop_id + '" value="' + slbrk_amt_dlv + '" oninput="calc(' + main_loop_id + ')" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                    result += '<td><input type="number" readonly  name="contract_sauda_group_dlv[' + main_loop_id + '][brbrk_rt]" oninput="calc(' + main_loop_id + ')" value="' + brbrk_rt + '" id="brbrk_rt_dlv' + main_loop_id + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';
                    result += '<td>';
                    result += '<select disabled name="contract_sauda_group_dlv[' + main_loop_id + '][brbrk_typ]" oninput="calc(' + main_loop_id + ')" id="brbrk_typ_dlv' + main_loop_id + '" class="form-control" style="width: 102px;">';
                    if (brbrk_typ == '%') result += '<option value="%" selected>%</option>';
                    else result += '<option value="%">%</option>';
                    if (brbrk_typ == 'PBag') result += '<option value="PBag" selected>PBag</option>';
                    else result += '<option value="PBag">PBag</option>';
                    if (brbrk_typ == 'PQtl') result += '<option value="PQtl" selected>PQtl</option>';
                    else result += '<option value="PQtl">PQtl</option>';
                    if (brbrk_typ == 'Fix') result += '<option value="Fix" selected>Fix</option>';
                    else result += '<option value="Fix">Fix</option>';
                    result += '</select></td>';
                    result += '<td><input readonly type="number" step="0.0001" name="contract_sauda_group_dlv[' + main_loop_id + '][brbrk_amt]" oninput="calc(' + main_loop_id + ')" value="' + brbrk_amt_dlv + '"  id="brbrk_amt_dlv' + main_loop_id + '" class="form-control" style="width: 102px;text-align: -webkit-right;"></td>';

                    result += '</td>';
                    result += '</tr>';

                }
                result += '<tr id="contract_div">';
                result += '<th>Total</th>';
                result += '<td></td>';
                result += '<td><input name="tot_bags_dlv" value="' + tot_bags_dlv + '" id="tot_bags_dlv" placeholder="Total Bags" value="" class="form-control nofocus" readonly  tabindex="-1"></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td> <input type="text" name="tot_wght_dlv" value="' + tot_wght_dlv + '" id="tot_wght_dlv" placeholder="Total tot_wght" class="form-control item_name nofocus" readonly  tabindex="-1"></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td> <input type="text" name="tot_ammount_dlv" value="' + tot_ammount_dlv + '" id="tot_ammount_dlv" placeholder="Total Amount" class="form-control tot_ammount nofocus"  readonly  tabindex="-1"></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '<td></td>';
                result += '</tr>';
                // alert(html)
                // $(".deliverdeatils").html(html);
                $('#deliverysupport').modal('hide');
                $('.delivery_contract').html(result);
            }


        }

        // }
    });
})

function myFunction() {
    window.print();
}
$(document).on('click', '.edit_company_master', function () {
    var compid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/company_master/' + compid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                console.log(response);
                var com_name = response['company'].com_name;
                var sdate = response['company'].sdate;
                var smomdt = moment(sdate).tz("Asia/Kolkata").format('DD/MM/YYYY');
                var edate = response['company'].edate;
                var emomdt = moment(edate).tz("Asia/Kolkata").format('DD/MM/YYYY');
                var mast_nm = response['company'].mast_nm;
                var Dealer_miscsno = response['company'].Dealer_miscsno;
                var Q_T_K = response['company'].Q_T_K;
                var compid = response['company']._id;
                $('.com_name').val(com_name);
                $('.sdate').val(smomdt);
                $('.edate').val(emomdt);
                $('.mast_nm').val(mast_nm);
                $('.Dealer_miscsno').val(Dealer_miscsno);
                $('.Q_T_K').val(Q_T_K);
                $('#companyadd').hide();
                $('#formheading').hide();
                $('#editformheading').show();
                $('#companyedit').show();
                $("#companyedit").attr("action", "/company_master/update/" + compid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_division_master', function () {
    var divid = $(this).attr('data-id');
    console.log(divid);
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/division_master/' + divid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                var div_mast = response['division'].div_mast;
                var ac_cin = response['division'].ac_cin;
                var div_code = response['division'].div_code;
                var ac_add2 = response['division'].ac_add2;
                var ac_place = response['division'].ac_place;
                var ac_state = response['division'].ac_state;
                var ac_pin = response['division'].ac_pin;
                var propreietor = response['division'].propreietor;
                var ac_pan = response['division'].ac_pan;
                var ac_pho = response['division'].ac_pho;
                var ac_phfax = response['division'].ac_phfax;
                var ac_mobno = response['division'].ac_mobno;
                var ac_gstin = response['division'].ac_gstin;
                var prvyr_datafile = response['division'].prvyr_datafile;
                var ac_wbsite = response['division'].ac_wbsite;
                var ac_email = response['division'].ac_email;
                var ac_interfclanguge = response['division'].ac_interfclanguge;
                var ssevadomain = response['division'].ssevadomain;
                var ssevausr = response['division'].ssevausr;
                var ssevapwd = response['division'].ssevapwd;
                var sms_port_no = response['division'].sms_port_no;
                var smttp_client = response['division'].smttp_client;
                var email_user = response['division'].email_user;
                var email_pwd = response['division'].email_pwd;
                var email_port = response['division'].email_port;
                var jurisdiction = response['division'].jurisdiction;
                var ac_topline = response['division'].ac_topline;
                var ac_midline = response['division'].ac_midline;
                var ac_bottline = response['division'].ac_bottline;
                var contract_qty = response['division'].contract_qty;
                var weight_calcution = response['division'].weight_calcution;
                var character_case = response['division'].character_case;
                var bank_name = response['division'].bank1;
                var bank_ac = response['division'].bank2;
                var bank_add = response['division'].bank_add;
                var bank_city = response['division'].bank_city;
                var bank_fax = response['division'].bank_fax;
                var bank3 = response['division'].bank3;
                var bank_code = response['division'].bank_code;
                var swift_code = response['division'].swift_code;
                var fix = response['division'].fix;
                var filepath = response['division'].filepath;
                var divid = response['division']._id;
                var FSSAINo = response['division'].FSSAINo;
                var NMMCNo = response['division'].NMMCNo;
                var groceryMarketRegNo = response['division'].groceryMarketRegNo;
                var Delivery = response['division'].Delivery;
                // var comp_con_person = response['division'].comp_con_person; 
                $('.FSSAINo').val(FSSAINo);
                $('.NMMCNo').val(NMMCNo);
                $('.groceryMarketRegNo').val(groceryMarketRegNo);
                $('.Delivery').val(Delivery);

                $('.bank1').val(bank_name);
                $('.ac_cin').val(ac_cin);
                $('.bank2').val(bank_ac);
                $('.bank_add').val(bank_add);
                $('.bank_city').val(bank_city).trigger('change');
                $('.bank_fax').val(bank_fax);
                $('.bank3').val(bank3);
                $('.bank_code').val(bank_code);
                $('.swift_code').val(swift_code);
                $('.div_mast').val(div_mast);
                $('.div_code').val(div_code);
                $('.ac_add2').val(ac_add2);
                $('.ac_place').val(ac_place).trigger('change');
                $('.ac_state').val(ac_state).trigger('change');
                $('.ac_pin').val(ac_pin);
                $('.propreietor').val(propreietor);
                $('.ac_pan').val(ac_pan);
                $('.ac_pho').val(ac_pho);
                $('.ac_phfax').val(ac_phfax);
                $('.ac_mobno').val(ac_mobno);
                $('.ac_gstin').val(ac_gstin);
                $('.prvyr_datafile').val(prvyr_datafile);
                $('.ac_wbsite').val(ac_wbsite);
                $('.ac_email').val(ac_email);
                $('.ac_interfclanguge').val(ac_interfclanguge);
                $('.ssevadomain').val(ssevadomain);
                $('.ssevausr').val(ssevausr);
                $('.ssevapwd').val(ssevapwd);
                $('.sms_port_no').val(sms_port_no);
                $('.smttp_client').val(smttp_client);
                $('.email_user').val(email_user);
                $('.weight_calcution').val(weight_calcution);
                $('.email_port').val(email_port);
                $('.email_pwd').val(email_pwd);
                $('.jurisdiction').val(jurisdiction);
                $('.ac_topline').val(ac_topline);
                $('.ac_midline').val(ac_midline);
                $('.ac_bottline').val(ac_bottline);
                $('.contract_qty').val(contract_qty);
                $('.character_case').val(character_case);
                $('.fix').val(fix);

                $('.edit_filename').val(filepath);
                $('.edit_div_img').attr("src", filepath);
                $('#divisionadd').hide();
                $('.btn_add').hide();
                $('#add').hide();
                $('#edit').show();
                $('#divisionedit').show();
                $('.div_mast').focus();
                $("#divisionedit").attr("action", "/division_master/update/" + divid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on("click", "#billregsubmit", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    $.ajax({
        type: "POST",
        url: '/bill_ragister/billregdetail',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
        },
        success: function (data) {
            if (data['success'] == true) {
                var contract = data['hhtml'];
                console.log(contract);
            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.billreg_detail_body').html(contract);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control" placeholder="Search ' + title + '" autocomplete="false" />');
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});
function getbill() {
    var billno = $('#billno').val();
    // alert(billno);
    $.ajax({
        type: "POST",
        url: '/bill_ragister/getbillsauda2',
        dataType: 'json',
        data: {
            billno: billno,
        },
        success: function (data) {
            if (data['success'] == true) {
                var bill = data['hhtml'];
                var sauda2 = data['sauda2'];
                var bldate = '<input type="text" class="form-control" name="bldate"';
                for (let i = 0; i < sauda2.length; i++) {
                    var filterstartdate = moment(sauda2[0]['bldate']).tz("Asia/Kolkata").format('DD/MM/YYYY');
                    bldate += 'value="' + filterstartdate + '"';
                }
                bldate += '>';
                var blfromdate = '<input type="text" class="form-control" name="blfromdate"';
                for (let i = 0; i < sauda2.length; i++) {
                    var filterform = moment(sauda2[0]['blfromdate']).tz("Asia/Kolkata").format('DD/MM/YYYY');
                    blfromdate += 'value="' + filterform + '"';
                }
                blfromdate += '>';
                var bltodate = '<input type="text" class="form-control" name="bltodate"';
                for (let i = 0; i < sauda2.length; i++) {
                    var filterform = moment(sauda2[0]['bltodate']).tz("Asia/Kolkata").format('DD/MM/YYYY');
                    bltodate += 'value="' + filterform + '"';
                }
                bltodate += '>';
                var partyname = '<input type="text" class="form-control" name="partyname"';
                for (let i = 0; i < sauda2.length; i++) {
                    if (sauda2[0]['pcode'] != null) partyname += 'value="' + sauda2[0]['pcode']['party_name'] + '"';
                    else partyname += 'value=""';
                    // console.log(sauda2[0]['pcode']['party_name'])
                    // 
                }
                partyname += '>';
            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.billview_detail_body').html(bill);
            $('#bldate').html(bldate);
            $('#blfromdate').html(blfromdate);
            $('#bltodate').html(bltodate);
            $('#partyname').html(partyname);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control" placeholder="Search ' + title + '" autocomplete="false" />');
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
}
$(document).on("click", "#dealfiltersubmit", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var sl_code = $('#sl_code').val();
    var sb_code = $('#sbcode').val();
    var br_code = $('#brcode').val();
    var bb_code = $('#bbcode').val();
    var sl_brok = $("input[name='formfilter']:checked").val();
    $.ajax({
        type: "POST",
        url: '/deal_register/contractdetail',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            sl_code: sl_code,
            sb_code: sb_code,
            br_code: br_code,
            bb_code: bb_code,
            sl_brok: sl_brok,
        },
        success: function (data) {
            if (data['success'] == true) {
                var contract = data['hhtml'];
            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.deal_detail_body').html(contract);
            $('table.table.adsearch tfoot:visible th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control" placeholder="Search ' + title + '" autocomplete="false" />');
            });
            $('table.table.adsearch tfoot:visible').insertBefore('table.table.adsearch thead:visible');
            basicdatatable('.adsearch');
            $('.loader').hide();
        }
    });
});

////deal entry
var s = 0;
var member = s + 1;
var limit = 1000;
$(document).on('click', '.addworksheet', function () {
    lstidx = $("input[name*='cntr']").length + 1;
    member = lstidx;
    if (s == limit) {
        alert("You have reached the limit of adding " + s + " inputs");
    } else {
        ;
        $.ajax({
            type: 'POST',
            url: '/worksheet_entry/productname',
            dataType: 'json',

            success: function (data) {
                if (data['success']) {
                    var product = data['product'];
                    var newdiv = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="cntr" id="cntr' + lstidx + '" value="' + lstidx + '">';
                    new_div += '<select name="work_sheet_group[' + lstidx + '][w_pname]" class="form-control selectproductfocus productplace" style="width:162px" onchange="getproduct(' + lstidx + ')" id="wpname' + lstidx + '" placeholder="Select Product">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < product.length; i++) {
                        new_div += '<option value="' + product[i]['_id'] + '">' + product[i]['prdt_desc'] + '</option>';

                    }
                    new_div += '</td>';
                    new_div += '<td id="innerqty' + lstidx + '">';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][in_qty]"oninput="calc(' + lstidx + ')"';
                    new_div += 'id="inqty' + lstidx + '"';
                    new_div += 'class="form-control " style="width: 142px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td id="cmblprt' + lstidx + '">';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][perc_cbm]"';
                    new_div += 'id="perccbm' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control " style="width: 135px;text-align: -webkit-right;"';
                    new_div += ' required>';
                    new_div += '</td>';
                    new_div += ' <td id="orqtytrtr' + lstidx + '">';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][or_qty]"';
                    new_div += 'id="orqty' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control " style="width: 92px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td id="wcostrtrt' + lstidx + '">';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_cost]"';
                    new_div += 'id="wcost' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control " style="width: 87px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_profit]"';
                    new_div += 'id="wprofit' + lstidx + '" value="10"  oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control "style="width: 72px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_profitamt]"';
                    new_div += 'id="wprofitamt' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control" style="width: 92px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_sellprice]"';
                    new_div += 'id="wsellprice' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control " style="width: 84px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    // new_div += '<td>';
                    // new_div += '<input type="text" name="work_sheet_group['+lstidx+'][w_doller]"';
                    // new_div += 'id="wdoller'+lstidx+'" oninput="calc('+lstidx+')"';
                    // new_div += 'class="form-control " style="width: 102px;text-align: -webkit-right;"';
                    // new_div += 'required>';
                    // new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_sellpriceD]"';
                    new_div += 'id="wsellpriceD' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control "style="width: 115px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_boxpricedoller]"';
                    new_div += 'id="boxpricedoller' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control " style="width: 129px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    // new_div += ' <td>';
                    // new_div += '<input type="text" name="work_sheet_group['+lstidx+'][w_totaFr]"';
                    // new_div += 'id="wtotaFr'+lstidx+'" oninput="calc('+lstidx+')"';
                    // new_div += 'class="form-control " style="width: 102px;text-align: -webkit-right;"';
                    // new_div += 'required>';
                    // new_div += '</td>';
                    new_div += '<td id="boxpercontainer' + lstidx + '">';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_boxperC]"';
                    new_div += 'id="wboxperC' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control "style="width: 142px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_boxperFR]"';
                    new_div += 'id="perbxfrghtrs' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control "style="width: 142px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_boxperFD]"';
                    new_div += 'id="wboxperFD' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control " style="width: 132px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    // new_div += '<td>';
                    // new_div += '<input type="text" name="work_sheet_group['+lstidx+'][w_overseasFPB]"';
                    // new_div += 'id="woverseasFPB'+lstidx+'" oninput="calc('+lstidx+')"';
                    // new_div += 'class="form-control "  style="width: 162px;text-align: -webkit-right;"';
                    // new_div += 'required>';
                    // new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_finalb]"';
                    new_div += 'id="wfinalb' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control "  style="width: 152px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_finalc]"';
                    new_div += 'id="wfinalc' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control " style="width: 87px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_fobAmt]"';
                    new_div += 'id="wfobAmt' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control " style="width: 108px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][w_cnfAmt]"';
                    new_div += 'id="wcnfAmt' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control "  style="width: 112px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][tot_cbm]"';
                    new_div += 'id="totelcbm' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control " style="width: 102px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="work_sheet_group[' + lstidx + '][fr_cbm]"';
                    new_div += 'id="frcbm' + lstidx + '" oninput="calc(' + lstidx + ')"';
                    new_div += 'class="form-control  amountfocus"  style="width: 112px;text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += "<td> <a data-repeater-delete='inner-field-" + lstidx + "' onclick='delemrn(" + lstidx + ")' data-brand-index='" + member + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    // new_div += "<td> <a  onclick='delemrn("+lstidx+")'  class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#contract_div");
                    s++;
                    lstidx--;
                    member++;
                    $(".productplace").select2({
                        placeholder: "Select Product",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                }
            }
        });

    }
});
//Cash/Bank Entry
function delemrn(index) {
    $("#rohit" + index).remove();
}
//

//
// function setout(k){
//     $('#outstanding_amount'+k).val($('#BalanceAmt'+k).val())
// }
//


//





var n = 0;
var membern = n + 1;
var limitn = 1000;



function DubAlert() {
    if ($("#dubalert").val() != '') {
        alert('Dublicate');
    }
}


////Proforma Entry
// var v = 1;
// var memberp = v + 1;
// var limitp = 1000;
// $(document).on('click', '.addproforma', function () {

//     lstidx = $("input[name*='cntr']").length + 1;
//     memberp = lstidx;

//     if (v == limitp) {
//         alert("You have reached the limit of adding " + v + " inputs");
//     } else {
//         $.ajax({
//             type: 'Get',
//             url: '/profarma/productname',
//             dataType: 'json',
//             success: function (data) {

//                 if (data['success']) {

//                      var product = data['product'];
//                     var newdiv = document.createElement('div');
//                     new_div = "<tr class='contract_wrapper' id='rohit"+ lstidx +"'>";
//                     new_div += '<td>';
//                     // new_div += '<input type="hidden" name="cntr" id="cntr'+lstidx+'" value="'+lstidx+'">';
//                     new_div += '<select name="pro_forma_group['+lstidx+'][item_name]"';
//                     new_div += 'class="form-control selectproductfocus productplace"';
//                     new_div += 'style="width:162px"  onchange="getproduct('+lstidx+')" id="iname'+lstidx+'" placeholder="Select Item">';
//                     new_div += '<option value=""></option>';
//                     for (let i = 0; i < product.length; i++)
//                     {
//                         new_div += '<option value="'+product[i]['_id']+'">'+product[i]['prdt_desc']+'</option>';

//                     }
//                     new_div += '</select>';
//                     new_div += '</td>';
//                     new_div += '<td id="innerqty'+lstidx+'">';
//                     new_div += '<input type="text" name="pro_forma_group['+lstidx+'][in_qty]"oninput="calc('+lstidx+')"';
//                     new_div += 'id="inqty'+lstidx+'"';
//                     new_div += 'class="form-control " style="width: 100%;text-align: -webkit-right;"';
//                     new_div += 'required>';
//                     new_div += '</td>';
//                     // new_div += '<td id="cmblprt'+lstidx+'">';
//                     // new_div += '<input type="text" name="pro_forma_group['+lstidx+'][perc_cbm]"';
//                     // new_div += 'id="perccbm'+lstidx+'" oninput="calc('+lstidx+')"';
//                     // new_div += 'class="form-control " style="width: 142px;text-align: -webkit-right;"';
//                     // new_div += ' required>';
//                     // new_div += '</td>';                
//                     new_div += '<td>';
//                     new_div += '<input type="text" name="pro_forma_group['+lstidx+'][or_qty]"';
//                     new_div += 'id="orqty'+lstidx+'" oninput="calc('+lstidx+')"';
//                     new_div += 'class="form-control " style="width: 100%;text-align: -webkit-right;"';
//                     new_div += 'required>';
//                     new_div += '</td>';
//                     new_div += '<td>';
//                     new_div += '<input type="text" name="pro_forma_group['+lstidx+'][cbm_perItem]"';
//                     new_div += 'id="cbmperItem'+lstidx+'" oninput="calc('+lstidx+')"';
//                     new_div += 'class="form-control "style="width:100%;text-align: -webkit-right;"';
//                     new_div += 'required>';
//                     new_div += '</td>';
//                     new_div += '<td>';
//                     new_div += '<input type="text" name="pro_forma_group['+lstidx+'][carton_price]"';
//                     new_div += 'id="cartonPrice'+lstidx+'" oninput="calc('+lstidx+')"';
//                     new_div += 'class="form-control" style="width:100%;text-align: -webkit-right;"';
//                     new_div += 'required>';
//                     new_div += '</td>';                    
//                     new_div += '<td>';
//                     new_div += '<input type="text" name="pro_forma_group['+lstidx+'][total_amount]"';
//                     new_div += 'id="totalAmount'+lstidx+'" oninput="calc('+lstidx+')"';
//                     new_div += 'class="form-control " style="width:100%;text-align: -webkit-right;"';
//                     new_div += ' amountfocus>';
//                     new_div += '</td>';


//                     new_div += "<td><a data-repeater-delete='inner-field-"+lstidx+"' data-brand-index='" + memberp + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
//                     $(new_div).insertBefore("#contract_div");
//                     v++;
//                     lstidx--;
//                     memberp++;
//                     $(".productplace").select2({
//                         placeholder: "Select item",
//                         allowClear: true,
//                     });
//                     $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
//                 }
//             }
//         });

//     }
// });


$(document).on("click", ".cashentry-delete-btn", function () {
    var str = confirm('Are you sure you want to delete this element');
    if (str == true) {
        var parent_id = $(this).closest('.contract_wrapper').prop('id');
        $("#" + parent_id).remove();
        calcashbank(1);
    }
});
///SalesOrder Entry 
var z = 1;
var membern = z + 1;
var limitz = 1000;
$(document).on('click', '.addMrn', function () {
    lstidx = $("input[name*='buyrn']").length;
    var values = $("input[name='buyrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    membern = lstidx;
    if (z == limitz) {
        alert("You have reached the limit of adding " + z + " inputs");
    } else {
        $.ajax({
            type: 'Get',
            url: '/mrn_challan/productname',
            dataType: 'json',
            success: function (data) {
                console.log(data)
                if (data['success']) {
                    var product = data['product'];
                    var newdiv = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="buyrn" id="buyrn' + lstidx + '" value="' + lstidx + '">';
                    new_div += '<select name="sales_or_group[' + lstidx + '][so_disc]"';
                    new_div += 'class="form-control selectproductfocus productplace"';
                    new_div += 'onchange="getpriMrn(' + lstidx + ')" id="descpso' + lstidx + '" placeholder="Select Item"  style="text-align: -webkit-right;">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < product.length; i++) {
                        new_div += '<option value="' + product[i]['_id'] + '">' + product[i]['Rm_Des'] + '</option>';

                    }
                    new_div += '</select>';
                    new_div += '</td>';
                    new_div += '<td id="orderpriceso' + lstidx + '">';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][order_price]"oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'id="orderprice' + lstidx + '"';
                    new_div += 'class="form-control " style="text-align: -webkit-right;"';
                    new_div += 'required>';

                    new_div += ' <td  id="pacincso' + lstidx + '" style="display: none">';
                    new_div += '<input type="text" name="sales_or_group[' + lstidx + '][unit]"';
                    new_div += 'id="sopacpercarten' + lstidx + '" oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control " style="text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';

                    new_div += '<td style="display:none;" id="sodivpso' + lstidx + '">';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][so_div]"';
                    new_div += 'id="so_div' + lstidx + '"  oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control" style="text-align: -webkit-right;"/>';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][so_qty]"';
                    new_div += 'id="so_qty' + lstidx + '" oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control "style="text-align: -webkit-right;"';
                    new_div += '>';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][po_qty_blc]"';
                    new_div += 'id="po_qty_blc' + lstidx + '" oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control "style="text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][po_qty_exe]"';
                    new_div += 'id="po_qty_exe' + lstidx + '" oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control "style="text-align: -webkit-right;"';
                    new_div += 'value="' + 0 + '">';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][so_discount]"';
                    new_div += 'id="so_discount' + lstidx + '" value=0 oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][total_amt_before]" id="total_amt_before' + lstidx + '" oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][total_amt]"';
                    new_div += 'id="total_amt' + lstidx + '" oninput="calsalesorder(' + lstidx + ')" readonly="true"';
                    new_div += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                    new_div += ' amountfocus>';
                    new_div += '</td>';

                    new_div += "<td><a data-repeater-delete='inner-field-" + lstidx + "'  data-brand-index='" + membern + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    // new_div += "<td><a data-brand-index='" + membern + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#contract_div_po");
                    z++;
                    lstidx--;
                    membern++;
                    $(".productplace").select2({
                        placeholder: "Select Product",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                }
            }
        });

    }
});
$(document).on('click', '.delete_plan', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/plan_entry/' + id,
                success: function (response) {
                    window.location.href = '/plan_entry/plan_entrylist';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
function WIP_cjsp() {
    var cjsp = $('#c_j_s_p').val();
    if (cjsp == 'FG') {
        $('.addReq').attr('required', true);
        $.ajax({
            type: 'get',
            url: '/WIP_entry/lastno/' + cjsp,
            success: function (response) {
                console.log(response);
                var last = response['last'];
                $('#vouc_codeid').val(last);
                var fg = response['fg'];
                $('#production_dept').val(fg).trigger('change');
            },
            error: function (err) {
                console.log(err);
            }
        });
    }
    if (cjsp == 'WIP') {
        $('.addReq').attr('required', false);
        $.ajax({
            type: 'get',
            url: '/WIP_entry/lastno/' + cjsp,
            success: function (response) {
                console.log(response);
                var last = response['last'];
                $('#vouc_codeid').val(last);
            },
            error: function (err) {
                console.log(err);
            }
        });
    }
}
function calWipQty(i) {
    lstidx = $("input[name*='buyrn']").length;
    var values = $("input[name='buyrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    lstidx = parseInt(idx) + 1;
    var totqty = 0;
    for (let i = 0; i < lstidx; i++) {
        $("#so_qty" + i).val(parseInt($('#Bs_qty' + i).val()) - parseInt($('#Rej_qty' + i).val()))
        totqty = totqty + parseInt($("#so_qty" + i).val())
        $("#tot_sooq").val(totqty)
    }
}
function calPlan(i) {
    lstidx = $("input[name*='buyrn']").length;
    var values = $("input[name='buyrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    lstidx = parseInt(idx) + 1;
    var totqty = 0;
    for (let i = 0; i < lstidx; i++) {
        console.log($("#so_qty" + i).val())
        totqty = totqty + parseInt($("#so_qty" + i).val())
        $("#tot_sooq").val(totqty)
    }
}
function calPlanraw(i) {
    lstidx = $("input[name*='raw']").length;
    var values = $("input[name='raw']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    lstidx = parseInt(idx) + 1;
    var totqty = 0;
    for (let i = 0; i < lstidx; i++) {
        // console.log($("#Raw_Qty"+i).val())
        totqty = totqty + parseInt($("#Raw_Qty" + i).val())
        $("#tot_qty_raw").val(totqty)
    }
}
$(document).on('click', '.addPlan', function () {
    lstidx = $("input[name*='buyrn']").length;
    var values = $("input[name='buyrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    membern = lstidx;
    if (z == limitz) {
        alert("You have reached the limit of adding " + z + " inputs");
    } else {
        $.ajax({
            type: 'Get',
            url: '/plan_entry/productlist',
            dataType: 'json',
            success: function (data) {
                console.log(data)
                if (data['success']) {
                    var product = data['product'];
                    var newdiv = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="buyrn" id="buyrn' + lstidx + '" value="' + lstidx + '">';
                    new_div += '<select name="plan_entry_group[' + lstidx + '][so_disc]"';
                    new_div += 'class="form-control selectproductfocus productplace"';
                    new_div += 'onchange="getpriMrn(' + lstidx + ')" id="descpso' + lstidx + '" placeholder="Select Item"  style="text-align: -webkit-right;">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < product.length; i++) {
                        new_div += '<option value="' + product[i]['_id'] + '">' + product[i]['Fg_Des'] + '</option>';

                    }
                    new_div += '</select>';
                    new_div += '<td>';
                    new_div += '<input type="number" name="plan_entry_group[' + lstidx + '][so_qty]"';
                    new_div += 'id="so_qty' + lstidx + '" oninput="calPlan(' + lstidx + ')"';
                    new_div += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                    new_div += 'required="true">';
                    new_div += '</td>';

                    new_div += "<td><a data-repeater-delete='inner-field-" + lstidx + "'  data-brand-index='" + membern + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    // new_div += "<td><a data-brand-index='" + membern + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#contract_div_po");
                    z++;
                    lstidx--;
                    membern++;
                    $(".productplace").select2({
                        placeholder: "Select Product",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                }
            }
        });

    }
});

$(document).on('click', '.delete_CUTEntry', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/Cutting_entry/' + id,
                success: function (response) {
                    window.location.href = '/Cutting_entry/Cutting_entrylist';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_WIPEntry', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/WIP_entry/' + id,
                success: function (response) {
                    window.location.href = '/WIP_entry/WIP_entrylist';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_WIPDeptEntry', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/WIP_DeptEntry/' + id,
                success: function (response) {
                    window.location.href = '/WIP_DeptEntry/WIP_DeptEntrylist';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

function getPlan(index, e) {
    if (e.keyCode == 27) {
        $('#rohit' + index).remove();
        $('.WIPSave').focus();
    }
    if (e.keyCode == 13) {
        var dept = $('#production_dept').val();
        // $('#WipPlanModel').modal('show');
        var party = 2;
        var mainindex = index;
        // $.ajax({
        //     type: 'GET',
        //     url: '/plan_entry/getPlan',
        //     dataType: 'json',
        //     data: {
        //         dept:dept
        //     },
        //     success: function (data) {
        //     console.log(data)
        //         var i, j, result, sau;
        //         result='';
        //         if (data['success'] == true) {
        //             var somast = data['plan'];
        //             j = -1;
        //             for (i = 0; i < somast.length; i++) {
        //                 var somastgroup = somast[i].plan_entry_group;
        //                 console.log(somastgroup)
        //                 $.each(somastgroup, function (index, value) {
        //                     if(value.so_panding_qty>0){
        //                         j++;
        //                         result += '<tr>';
        //                         result += '<div id="delivery-' + index + '">';

        //                         result +=  '<td>';
        //                         result +=  '<input type="text" value="'+somast[i].plan_no+'" name="plan_no"';
        //                         result +=  'id="plan_number'+j+'"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
        //                         result +=  '</td>';

        //                         result +=  '<td>';
        //                         result +=  '<input type="text" value="'+somast[i].plan_date+'" name="plan_date"';
        //                         result +=  'id="plan_date'+j+'"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
        //                         result +=  '</td>';

        //                         result += '<td>';
        //                         if(value.so_disc != null)result += '<input type="text" name="itemname" id="itemnameid'+j+'" value="'+value.so_disc.Fg_Des+'" data-itemid="'+value.so_disc._id+'" class="form-control" style="text-align: -webkit-left;" readonly="true">';
        //                         else result += '<input type="text" name="itemname" id="itemnameid'+j+'" value="" data-itemid="" class="form-control" style="text-align: -webkit-right;">';
        //                         result += '</td>'

        //                         result +=  '<td>';
        //                         result +=  '<input type="text" value="'+value.so_qty+'" name="so_qty"';
        //                         result +=  'id="orqtyocc'+j+'" oninput="calsalesorder(' + j +')" readonly="true"';
        //                         result +=  'class="form-control " style="text-align: -webkit-right;"';
        //                         result +=  'required>';
        //                         result +=  '<input type="hidden" value="'+value._id+'" name="plan_grp_id" oninput="calsalesorder(' + j +')"';
        //                         result +=  'id="plan_grp_id_mod'+j+'"';
        //                         result +=  'class="form-control " style="text-align: -webkit-right"';
        //                         result +=  '>';
        //                         result +=  '<input type="hidden" value="'+somast[i]._id+'" name="plan_id" oninput="calsalesorder(' + j +')"';
        //                         result +=  'id="plan_id_mod'+j+'"';
        //                         result +=  'class="form-control" style="text-align: -webkit-right;"';
        //                         result +=  '>';
        //                         result +=  '</td>';

        //                         result +=  '<td>';
        //                         result +=  '<input type="text" value="'+value.so_panding_qty+'" name="pending_qty"';
        //                         result +=  'id="pending_qty'+ j +'" oninput="calsalesorder(' + j +')" readonly="true"';
        //                         result +=  'class="form-control "style="text-align: -webkit-right;"';
        //                         result +=  'required>';
        //                         result +=  '</td>';

        //                     //  result +=  '<td>';'+value.order_price+'
        //                     //  result +=  '<input type="text"  value="'+value.so_discount+'" name="so_discount" readonly="true"';
        //                     //  result +=  'id="ocdiscounte' + j +'" oninput="calsalesorder(' + j +')"';
        //                     //  result +=  'class="form-control" style="text-align: -webkit-right;"';
        //                     //  result +=  'required>';
        //                     //  result +=  '</td>'; 

        //                     //  result +=  '<td>';
        //                     //  result +=  '<input type="text" value="'+value.total_amt+'" name="total_amt" readonly="true"';
        //                     //  result +=  'id="octotalAmountf' + j +'" oninput="calsalesorder(' + j +')"';
        //                     //  result +=  'class="form-control amountfocus" style="text-align: -webkit-right;"';
        //                     //  result +=  ' amountfocus>';
        //                     //  result +=  '</td>';'+value.so_qty_blc+'

        //                         result += '<td>';
        //                         result += '<input type="number" name="WIPqty" value="" id="WIPqty'+j+'" onkeydown="ChangeWIPEntry('+j+','+mainindex+',event)"  class="form-control deliveryinputcheck">';
        //                         result += '</td>';
        //                         result += '</div>';
        //                         result += '</tr>';
        //                         glbidx = j;
        //                     }
        //                 });
        //             }
        //         }
        //         $('.dsi_repeat_row').html(result);
        //         if(party!='')
        //         {
        //             if(somast.length){
        //                 $('#deliverysupport').modal('show');
        //             }else{
        //                 swal({
        //                     title:'Oops!',
        //                     text:'No Pending Salesorder',
        //                     buttons:false,
        //                     timer:1500
        //                 })
        //             }
        //         }
        //     }
        // });
    }
}


function ChangeWIPEntry(index, i, e) {
    if (e.keyCode == 13) {
        if ($('#WIPqty' + index).val() != '') {
            $('#plan_no' + i).val($('#plan_number' + index).val());
            $('#descpso' + i).val($('#itemnameid' + index).attr('data-itemid')).trigger('change');
            $('#so_qty' + i).val($('#WIPqty' + index).val());
            $('#plan_id' + i).val($('#plan_id_mod' + index).val());
            $('#plan_grp_id' + i).val($('#plan_grp_id_mod' + index).val());
            $('#WipPlanModel').modal('hide');
            $('#WIP_name' + i).focus()

        } else {
            alert('Please Enter Wip Qty');
        }
    }
    calPlan(0);
}
function deleteWipDeptEntry(id) {
    var a = confirm('Are Want To Delete It');
    if (a == true) $('#rohit' + id).remove();
}
function EscWipEntry(id, e) {
    if (e.keyCode == 27) {
        $('#rohit' + id).remove();
        $('.WIPSave').focus();
    }
}
$(document).on('click', '.addWIPDeptEntry', function () {
    lstidx = $("input[name*='buyrn']").length;
    var values = $("input[name='buyrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    membern = lstidx;
    if (z == limitz) {
        alert("You have reached the limit of adding " + z + " inputs");
    } else {
        $.ajax({
            type: 'Get',
            url: '/WIP_entry/productlist',
            dataType: 'json',
            success: function (data) {
                console.log(data)
                if (data['success']) {
                    var product = data['product'];
                    var WIP_mast = data['WIP_mast'];
                    var newdiv = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";

                    new_div += '<td>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][plan_no]"';
                    new_div += 'id="plan_no' + lstidx + '" oninput="calPlan(' + lstidx + ')"';
                    new_div += 'class="form-control selectproductfocus" onkeydown="EscWipEntry(' + lstidx + ',event)"';
                    new_div += 'style="width:100%">';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<input type="hidden" name="buyrn" id="buyrn' + lstidx + '" value="' + lstidx + '">';
                    new_div += '<select name="sales_or_group[' + lstidx + '][so_disc]"';
                    new_div += 'class="form-control productplace" style="width:100%"';
                    new_div += 'onchange="getpriMrn(' + lstidx + ')" id="descpso' + lstidx + '" placeholder="Select Item">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < product.length; i++) {
                        new_div += '<option value="' + product[i]['_id'] + '">' + product[i]['Fg_Des'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<select name="sales_or_group[' + lstidx + '][WIP_name]"';
                    new_div += 'class="form-control productWIP" style="width:100%"';
                    new_div += 'id="WIP_name' + lstidx + '" placeholder="Select Item">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < WIP_mast.length; i++) {
                        new_div += '<option value="' + WIP_mast[i]['_id'] + '">' + WIP_mast[i]['Fg_Des'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>'

                    new_div += '<td>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][Bs_qty]"';
                    new_div += 'id="Bs_qty' + lstidx + '" oninput="calWipQty(' + lstidx + ')"';
                    new_div += 'class="form-control" style="text-align: -webkit-right;"';
                    new_div += '>';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][Rej_qty]"';
                    new_div += 'id="Rej_qty' + lstidx + '" oninput="calWipQty(' + lstidx + ')"';
                    new_div += 'class="form-control" style="text-align: -webkit-right;"';
                    new_div += '>';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][so_qty]"';
                    new_div += 'id="so_qty' + lstidx + '" oninput="calWipQty(' + lstidx + ')"';
                    new_div += 'class="form-control" style="text-align: -webkit-right;"';
                    new_div += '>';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<input type="text" name="sales_or_group[' + lstidx + '][WIP_Rem]"';
                    new_div += 'id="WIP_Rem' + lstidx + '" oninput="calWipQty(' + lstidx + ')"';
                    new_div += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                    new_div += '>';
                    new_div += '</td>';

                    new_div += "<td><a data-repeater-delete='inner-field-" + lstidx + "'  data-brand-index='" + membern + "' onclick='deleteWipDeptEntry(" + lstidx + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    // new_div += "<td><a data-brand-index='" + membern + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#contract_div_po");
                    z++;
                    lstidx--;
                    membern++;
                    $(".productplace").select2({
                        placeholder: "Select Product",
                        allowClear: true,
                    });
                    $(".productWIP").select2({
                        placeholder: "Select WIP",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                    WIP_cjsp();
                }
            }
        });

    }
});
$(document).on("click", "#WIPRegisterShow", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    $('.loader').show();
    // $('#ledgerbody > tr > td').remove();
    $.ajax({
        type: "POST",
        url: '/WIP_DeptEntry/WIP_RegisterShow',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
        },
        success: function (data) {
            console.log(data);
            if (data['success'] == true) {
                // console.log("length",data.ledger.length);
                if (data.ladger == '' || data.ladger == null) $('.loader').hide();
                var html = '<div class="showsearchdata">';
                html += '<div class="row">';
                html += '<div class="col-md-12">';
                html += '<div class="table-responsive">';
                html += '<table id="userTable" class="userTable table table-striped table-bordered table-hover adsearch">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>Entry No</th>';
                html += '<th>Date</th>';
                html += '<th>Base Dept</th>';
                html += '<th>Next Dept</th>';
                html += '<th>Fg Name</th>';
                html += '<th>WIP Name</th>';
                html += '<th>Qty</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';

                // html += '<tr>';
                // html+='<th></th>';
                // html+='<th></th>';
                // html+='<th></th>';
                // html+='<th>Opening Balance</th>';
                // html+='<th id="op_debit" style="font-size: 14px;text-align: right"></th>';
                // html+='<th id="op_credit" style="font-size: 14px;text-align: right"></th>';
                // html+='<th></th>';
                // html+='</tr>';
                $.each(data.ladger, function (index, value) {
                    html += "<tr>";
                    html += "<td style='text-align: center'>" + value.EntryNo + "</td>";
                    html += "<td style='text-align: center'>" + value.EntryDate + "</td>";
                    html += "<td style='text-align: left'>" + value.BaseDept + "</td>";
                    html += "<td style='text-align: left'>" + value.NextDept + "</td>";
                    html += "<td style='text-align: left'>" + value.FgName + "</td>";
                    html += "<td style='text-align: left'>" + value.WIPName + "</td>";
                    html += "<td style='text-align: right'>" + value.Qty + "</td>";
                    html += "</tr>"
                });

                html += '</tbody>';
                html += '</table>';
                $("#datatableWIPRegister").html(html);
                dattable = jQuery('#userTable').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "processing": false,
                    "serverSide": false,
                    "colReorder": true,
                    "autoWidth": false,
                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf',
                            exportOptions: {

                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                            footer: true,
                            orientation: 'landscape',
                            customize: function (doc) {
                                doc.content.splice(0, 0, {
                                    margin: [0, 0, 0, 12],
                                    alignment: 'center',
                                    text: 'Soft Sauda'
                                });
                            },
                            messageBottom: 'Exported from Soft Sauda'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                    ],
                    "order": [1, 'asc'],
                    "columnDefs": [{
                        "className": "actioncell",
                        "orderable": false,
                        "searchable": false,
                        "sortable": false,
                        "targets": [0],
                        "width": "5%"
                    }],
                })
                $('.loader').hide();
            }
        }
    });
});
function getRawMat(index) {
    WIPname = $('#WIP_name' + index).val();
    $.ajax({
        type: 'GET',
        url: '/Cutting_entry/getWIPRaw',
        dataType: 'json',
        data: {
            WIPname: WIPname
        },
        success: function (data) {
            console.log(data);
            if (data['success'] == true) {
                var WIP = data['WIP_mast'];
                var WIPgrp = WIP.product_mast_group
                for (let i = 0; i < WIPgrp.length; i++) {
                    var values = $("input[name='raw']")
                        .map(function () { return $(this).val(); }).get();
                    var idx = values[values.length - 1]
                    lstidx = parseInt(idx) + 1;
                    for (let j = 0; j <= lstidx; j++) {
                        var rowmat = $('#row_mat' + j).val();
                        if (WIPgrp[i].raw_matrl_nm == rowmat) {
                            var qty = $("#Raw_Qty" + j).val();
                            // if($('#so_qty'+index).val() == ''){
                            $('#so_qty' + index).val(qty * WIPgrp[i].qty_pcs);
                            // break;
                            // }
                        }
                    }
                }
            }
        }

    });
    setTimeout(function () { calPlan(1); }, 100);
}
$(document).on('click', '.addWIPEntry', function () {
    lstidx = $("input[name*='buyrn']").length;
    var values = $("input[name='buyrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    membern = lstidx;
    if (z == limitz) {
        alert("You have reached the limit of adding " + z + " inputs");
    } else {
        $.ajax({
            type: 'Get',
            url: '/WIP_entry/productlist',
            dataType: 'json',
            success: function (data) {
                console.log(data)
                if (data['success']) {
                    var product = data['product'];
                    var WIP_mast = data['WIP_mast'];
                    var newdiv = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";

                    new_div += '<td>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][plan_no]"';
                    new_div += 'id="plan_no' + lstidx + '" oninput="calPlan(' + lstidx + ')" onkeydown="getPlan(' + lstidx + ',event)"';
                    new_div += 'class="form-control selectproductfocus" style="text-align: -webkit-right;"';
                    new_div += '>';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<input type="hidden" name="buyrn" id="buyrn' + lstidx + '" value="' + lstidx + '">';
                    new_div += '<select name="sales_or_group[' + lstidx + '][so_disc]"';
                    new_div += 'class="form-control productplace addReq"';
                    new_div += 'onchange="getpriMrn(' + lstidx + ')" id="descpso' + lstidx + '" placeholder="Select Item"  style="text-align: -webkit-right;width:100%">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < product.length; i++) {
                        new_div += '<option value="' + product[i]['_id'] + '">' + product[i]['Fg_Des'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<select name="sales_or_group[' + lstidx + '][WIP_name]"';
                    new_div += 'class="form-control productWIP" onchange="getRawMat(' + lstidx + ')"';
                    new_div += 'id="WIP_name' + lstidx + '" placeholder="Select Item"  style="text-align: -webkit-right; width:100%">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < WIP_mast.length; i++) {
                        new_div += '<option value="' + WIP_mast[i]['_id'] + '">' + WIP_mast[i]['Fg_Des'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>'

                    new_div += '<td>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][so_qty]"';
                    new_div += 'id="so_qty' + lstidx + '" oninput="calPlan(' + lstidx + ')"';
                    new_div += 'class="form-control amountfocus addReq" style="text-align: -webkit-right;"';
                    new_div += '>';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][plan_id]" id="plan_id' + lstidx + '">';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][plan_grp_id]" id="plan_grp_id' + lstidx + '">';
                    new_div += '</td>';

                    new_div += "<td><a data-repeater-delete='inner-field-" + lstidx + "'  data-brand-index='" + membern + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    // new_div += "<td><a data-brand-index='" + membern + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#contract_div_po");
                    z++;
                    lstidx--;
                    membern++;
                    $(".productplace").select2({
                        placeholder: "Select Product",
                        allowClear: true,
                    });
                    $(".productWIP").select2({
                        placeholder: "Select WIP",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                    WIP_cjsp();
                }
            }
        });

    }
});
$(document).on('keydown', '.CutRawExit', function (e) {
    if (e.keyCode == 27) $("#plan_no0").focus();
});
function Cutrawdelete(id) {
    var a = confirm('Are you Want to delete it');
    if (a == true) $('#Cutraw' + id).remove();
}
$(document).on('click', '.addCuttingRawEntry', function () {
    lstidx = $("input[name*='raw']").length;
    var values = $("input[name='raw']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    membern = lstidx;
    if (z == limitz) {
        alert("You have reached the limit of adding " + z + " inputs");
    } else {
        $.ajax({
            type: 'Get',
            url: '/WIP_entry/productlist',
            dataType: 'json',
            success: function (data) {
                console.log(data)
                if (data['success']) {
                    var product = data['rawMat_mast'];
                    var newdiv = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='Cutraw" + lstidx + "'>";

                    // new_div += '<td>';
                    // new_div += '<input type="number" name="row_mat_group['+lstidx+'][plan_no]"';
                    // new_div += 'id="plan_no'+lstidx+'" oninput="calPlanraw('+lstidx+')" ';
                    // // onkeydown="getPlan('+lstidx+',event)"
                    // new_div += 'class="form-control selectproductfocus" style="text-align: -webkit-right;"';
                    // new_div += '>';
                    // new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<input type="hidden" name="raw" id="raw' + lstidx + '" value="' + lstidx + '">';
                    new_div += '<select name="row_mat_group[' + lstidx + '][row_mat]"';
                    new_div += 'class="form-control productplace selectproductfocus"';
                    new_div += 'onchange="getpriMrn(' + lstidx + ')" id="row_mat' + lstidx + '" placeholder="Select Item"  style="text-align: -webkit-right; width:100%">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < product.length; i++) {
                        new_div += '<option value="' + product[i]['_id'] + '">' + product[i]['Rm_Des'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>';

                    new_div += '<td>';
                    new_div += '<input type="number" name="row_mat_group[' + lstidx + '][Raw_Qty]"';
                    new_div += 'id="Raw_Qty' + lstidx + '" oninput="calPlanraw(' + lstidx + ')"';
                    new_div += 'class="form-control CutRawfocus addReq" style="text-align: -webkit-right;"';
                    new_div += '>';
                    new_div += '<input type="hidden" name="row_mat_group[' + lstidx + '][plan_id]" id="plan_id' + lstidx + '">';
                    new_div += '<input type="hidden" name="row_mat_group[' + lstidx + '][plan_grp_id]" id="plan_grp_id' + lstidx + '">';
                    new_div += '</td>';

                    new_div += "<td><a data-repeater-delete='inner-field-" + lstidx + "' onclick='Cutrawdelete(" + lstidx + ")'  data-brand-index='" + membern + "' class='Cutraw-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    // new_div += "<td><a data-brand-index='" + membern + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#contract_div_Raw");
                    z++;
                    lstidx--;
                    membern++;
                    $(".productplace").select2({
                        placeholder: "Select Product",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                }
            }
        });

    }
});

function purdel(index) {
    $("#salesorder_row-" + index).remove();
    // setTimeout(function() { 
    // var lstidx = $("input[name*='buyrn']").length;
    // alert(lstidx) 
    // }, 500); 
    // for(var i=0; i<=lstidx-1; i++){
    //     $('#buyrn'+i).attr('id', 'buyrn');
    // }

}

$(document).on('click', '.addSales', function () {
    lstidx = $("input[name*='buyrn']").length + 1;

    membern = lstidx;

    if (z == limitz) {
        alert("You have reached the limit of adding " + z + " inputs");
    } else {
        $.ajax({
            type: 'Get',
            url: '/sales_order_mast/productname',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {

                    var product = data['product'];
                    var newdiv = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="buyrn" id="buyrn' + lstidx + '" value="' + lstidx + '">';
                    new_div += '<select name="sales_or_group[' + lstidx + '][so_fg_disc]"';
                    new_div += 'class="form-control selectproductfocus productplace"';
                    new_div += 'onchange="getdec(' + lstidx + ')" id="descpso' + lstidx + '" placeholder="Select Item"  style="text-align: -webkit-right;">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < product.length; i++) {
                        new_div += '<option value="' + product[i]['_id'] + '">' + product[i]['Fg_Des'] + '</option>';

                    }
                    new_div += '</select>';
                    new_div += '</td>';
                    new_div += '<td id="orderpriceso' + lstidx + '">';
                    new_div += '<input type="text" name="sales_or_group[' + lstidx + '][order_price]"oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'id="orderprice' + lstidx + '"';
                    new_div += 'class="form-control " style="text-align: -webkit-right;"';
                    new_div += 'required>';
                    // new_div += ' <td  id="pacincso'+lstidx+'">';
                    // new_div += '<input type="text" name="sales_or_group['+lstidx+'][sopacper_carten]"';
                    // new_div += 'id="sopacpercarten'+lstidx+'" oninput="calsalesorder('+lstidx+')"';
                    // new_div += 'class="form-control " style="text-align: -webkit-right;"';
                    // new_div += 'required>';
                    // new_div += '</td>';
                    new_div += '<td style="display:none;" id="sodivpso' + lstidx + '">';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][so_div]"';
                    new_div += 'id="so_div' + lstidx + '"  oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control" style="text-align: -webkit-right;"/>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="sales_or_group[' + lstidx + '][so_qty]"';
                    new_div += 'id="so_qty' + lstidx + '" oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control "style="text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="sales_or_group[' + lstidx + '][so_discount]"';
                    new_div += 'id="so_discount' + lstidx + '" value=0 oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control" style="text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][total_amt_before]" id="total_amt_before' + lstidx + '" oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
                    new_div += '<input type="text" name="sales_or_group[' + lstidx + '][total_amt]"';
                    new_div += 'id="total_amt' + lstidx + '" oninput="calsalesorder(' + lstidx + ')"';
                    new_div += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                    new_div += ' amountfocus>';
                    new_div += '</td>';


                    new_div += "<td><a data-repeater-delete='inner-field-" + lstidx + "'  data-brand-index='" + membern + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#contract_div");
                    z++;
                    lstidx--;
                    membern++;
                    $(".productplace").select2({
                        placeholder: "Select Product",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                }
            }
        });

    }
});



$(document).on('click', '.addSalesOrder', function () {
    lstidx = $("input[name*='buyrn']").length;
    var values = $("input[name='buyrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    membern = lstidx;

    if (z == limitz) {
        alert("You have reached the limit of adding " + z + " inputs");
    } else {
        $.ajax({
            type: 'Get',
            url: '/sales_order_mast/productname',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {

                    var product = data['product'];
                    var newdiv = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="buyrn" id="buyrn' + lstidx + '" value="' + lstidx + '">';
                    new_div += '<select name="sales_or_group[' + lstidx + '][so_fg_disc]"';
                    new_div += 'class="form-control selectproductfocus productplace"';
                    new_div += 'onchange="getdec(' + lstidx + ')" id="descpso' + lstidx + '" placeholder="Select Item"  style="text-align: -webkit-right; width: 100%">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < product.length; i++) {
                        new_div += '<option value="' + product[i]['_id'] + '">' + product[i]['Fg_Des'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>';

                    // new_div += '<td id="orderpriceso'+lstidx+'">';
                    // new_div += '<input type="text" name="sales_or_group['+lstidx+'][order_price]"oninput="calslsorder('+lstidx+')"';
                    // new_div += 'id="orderprice'+lstidx+'"';
                    // new_div += 'class="form-control " style="text-align: -webkit-right;"';
                    // new_div += 'required>';

                    // new_div += ' <td  id="pacincso'+lstidx+'">';
                    // new_div += '<input type="text" name="sales_or_group['+lstidx+'][sopacper_carten]"';
                    // new_div += 'id="sopacpercarten'+lstidx+'" oninput="calslsorder('+lstidx+')"';
                    // new_div += 'class="form-control " style="text-align: -webkit-right;"';
                    // new_div += 'required>';
                    // new_div += '</td>';



                    new_div += '<td>';
                    new_div += '<input type="number" name="sales_or_group[' + lstidx + '][so_qty]"';
                    new_div += 'id="so_qty' + lstidx + '" oninput="calslsorder(' + lstidx + ')"';
                    new_div += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                    new_div += 'required>';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][so_qty_blc]"';
                    new_div += 'id="so_qty_blc' + lstidx + '" oninput="calslsorder(' + lstidx + ')"';
                    new_div += 'class="form-control "style="text-align: -webkit-right;"';
                    new_div += '>';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][so_qty_exe]"';
                    new_div += 'id="so_qty_exe' + lstidx + '" oninput="calslsorder(' + lstidx + ')"';
                    new_div += 'class="form-control "style="text-align: -webkit-right;"';
                    new_div += 'value="' + 0 + '">';
                    new_div += '<input type="hidden" name="sales_or_group[' + lstidx + '][gst]"';
                    new_div += 'id="so_div' + lstidx + '"  oninput="calslsorder(' + lstidx + ')"';
                    new_div += 'class="form-control" style="text-align: -webkit-right;"/>';
                    new_div += '</td>';

                    // new_div += '<td>';
                    // new_div += '<input type="text" name="sales_or_group['+lstidx+'][so_discount]"';
                    // new_div += 'id="so_discount'+lstidx+'" value=0 oninput="calslsorder('+lstidx+')"';
                    // new_div += 'class="form-control" style="text-align: -webkit-right;"';
                    // new_div += 'required>';
                    // new_div += '</td>';                    
                    // new_div += '<td>';

                    // new_div +='<input type="hidden" name="sales_or_group['+lstidx+'][total_amt_before]" id="total_amt_before'+lstidx+'" oninput="calsalesorder('+lstidx+')"';
                    // new_div +='class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
                    // new_div += '<input type="text" name="sales_or_group['+lstidx+'][total_amt]"';
                    // new_div += 'id="total_amt'+lstidx+'" oninput="calslsorder('+lstidx+')" readonly="true"' ; 
                    // new_div += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                    // new_div += ' amountfocus>';
                    // new_div += '</td>';


                    new_div += "<td><a onclick='deletesalesorder(" + lstidx + ")' data-repeater-delete='inner-field-" + lstidx + "'  data-brand-index='" + membern + "' class='aa-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#contract_div");
                    z++;
                    lstidx--;
                    membern++;
                    $(".productplace").select2({
                        placeholder: "Select Product",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                }
            }
        });
    }
});
function deletesalesorder(id) {
    var strconfirm = confirm('Are you sure you want to delete this element');
    // var lstidx = $("input[name*='dsirn']").length;
    console.log(lstidx, id)
    if (strconfirm == true) $("#rohit" + id).remove();
}


// 16-03-2019


$(document).ready(function () {
    $('#sl_code').change(function () {
        sval = $(this).val();
        bval = $("#brcont").val();
        if (sval == bval) {
            alert("oops same");
        }
    })
})




// demo Datatable for col reorder

$(document).ready(function () {
    dattable = jQuery('#demotable').DataTable({
        // "dom": "<'row' <'col-md-12'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
        "lengthChange": true,
        "processing": false,
        "serverSide": false,
        "colReorder": true,
        "autoWidth": false,
        "columnDefs": [
            { "width": "80px", "targets": 0 },
            { "width": "60%", "targets": 1 },
            { "width": "20%", "targets": 2 }
        ],
        "buttons": [
            {
                extend: 'excel',
                className: 'btn-default btn-excel',
                exportOptions: {
                    columns: "thead th:not(.noExport)"
                }
            },
            {
                extend: 'pdf',
                className: 'btn-default btn-pdf',
                exportOptions: {
                    modifier: {
                        page: 'current'
                    },
                    columns: "thead th:not(.noExport)"
                },
                orientation: 'landscape',
                customize: function (doc) {
                    // Splice the image in after the header, but before the table
                    doc.content.splice(0, 0, {
                        margin: [0, 0, 0, 12],
                        alignment: 'center',
                        // image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA9lpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wUmlnaHRzPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvcmlnaHRzLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcFJpZ2h0czpNYXJrZWQ9IkZhbHNlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDoxN2FlYzk4Yy0zMjgzLTExZGEtYTIzOC1lM2UyZmFmNmU5NjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QUYzODU5RTYxNDNCMTFFNTlBNjVCOTY4NjAwQzY5QkQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QUYzODU5RTUxNDNCMTFFNTlBNjVCOTY4NjAwQzY5QkQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowODgwMTE3NDA3MjA2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'
                        text: 'Soft Sauda'
                    });
                },
                messageBottom: 'Exported from Soft Sauda'
            },
            {
                extend: 'print',
                className: 'btn-default btn-print',
                exportOptions: {
                    columns: "thead th:not(.noExport)"
                }
            },
        ],
        "order": [],
        "columnDefs": [{
            "targets": [0],
            "orderable": false,
            "searchable": false
        }
        ],
        initComplete: function () {
            var api = this.api();

            // Apply the search
            api.columns().every(function () {
                var that = this;

                $('input', this.footer()).on('keyup change', function () {
                    if (that.search() !== this.value) {
                        that
                            .search(this.value)
                            .draw();
                    }
                });
            });
        },
        footerCallback: function (row, data, start, end, display) {
            var api = this.api();
            api.columns('.sum', {
                page: 'all'
            }).every(function () {
                var asum = this
                    .data()
                    .reduce(function (a, b) {
                        var x = parseFloat(a) || 0;
                        var y = parseFloat(b) || 0;
                        return x + y;
                    }, 0);
                $('div.gtotal', this.footer()).html("Grand Total = " + asum);
            });

        }
    })

})
// $(document).on('click', '.edit_category_btn', function () {
//     var ctgid = $(this).attr('data-id');
//     $('.loader').show();
//     $.ajax({
//         type: 'GET',
//         url: '/category_mast/' + ctgid,
//         dataType: 'json',
//         success: function (response) {
//             if (response['success'] == true) {
//                 // //console.log(response);
//                 var category_name = response['category'].category_name;
//                 var ctgid = response['category']._id;
//                 $('.category_name').val(category_name);
//                 $('#formheading span').text('EDIT');
//                 $("#addcategory").attr("action", "/category_mast/edit_category/" + ctgid);
//             } else {
//                 $('.branddanger').html(response['message']);
//                 $('.branddanger').show();
//                 $('.brandsuccess').hide();
//             }
//             $('.loader').hide();
//         },
//         error: function (err) {
//             console.log(err);
//         }
//     });
// });
$(document).on('click', '.delete-category', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/category_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/category_mast/category_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });

});
$(document).on('click', '.edit_category_tax_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/category_tax_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var category_tax_name = response['categorytax'].category_tax_name;
                var ctgid = response['categorytax']._id;
                $('.category_tax_name').val(category_tax_name);
                $('#formheading span').text('EDIT');
                $("#addtaxcategory").attr("action", "/category_tax_mast/edit_category_tax/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-category-tax', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/category_tax_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/category_tax_mast/category_tax_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });

});
$(document).on('keyup', '.dealdlvrd_no', function () {
    var id = $(this).attr('data-id');
    var dealdlvrdsrno = $(this).attr('data-dealdlvrdsrno');
    var dealdlvrdno = $('#dealdlvrdno' + dealdlvrdsrno).val();
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/dealdlvrd_no/' + id,
        dataType: 'json',
        data:
        {
            dealdlvrdno: dealdlvrdno,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(document).on('keyup', '.dealbill_no', function () {
    var id = $(this).attr('data-id');
    var dealbillnodsrno = $(this).attr('data-dealbillnodsrno');
    var dealbillno = $('#dealbillno' + dealbillnodsrno).val();
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/dealbill_no/' + id,
        dataType: 'json',
        data:
        {
            dealbillno: dealbillno,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(document).on('keyup', '.dealfright_no', function () {
    var id = $(this).attr('data-id');
    var dealfrightnodsrno = $(this).attr('data-dealfrightnodsrno');
    var dealfrightno = $('#dealfrightno' + dealfrightnodsrno).val();
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/dealfright_no/' + id,
        dataType: 'json',
        data:
        {
            dealfrightno: dealfrightno,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(document).on('keyup', '.dealloory_no', function () {
    var id = $(this).attr('data-id');
    var dealloorynodsrno = $(this).attr('data-dealloorynodsrno');
    var deallooryno = $('#deallooryno' + dealloorynodsrno).val();
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/dealloory_no/' + id,
        dataType: 'json',
        data:
        {
            deallooryno: deallooryno,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(document).on('keyup', '.deallorydrive_no', function () {
    var id = $(this).attr('data-id');
    var deallorydrivenodsrno = $(this).attr('data-deallorydrivenodsrno');
    var deallorydriveno = $('#deallorydriveno' + deallorydrivenodsrno).val();
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/deallorydrive_no/' + id,
        dataType: 'json',
        data:
        {
            deallorydriveno: deallorydriveno,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(document).on('keyup', '.pament_amt', function () {
    var id = $(this).attr('data-id');
    var pamentamtdsrno = $(this).attr('data-pamentamtdsrno');
    var datebargamt = $(this).attr('data-amt');

    var pamentamt = $('#pamentamt' + pamentamtdsrno).val();

    $('#dealrecvamt' + pamentamtdsrno).val(Number(datebargamt) - Number(pamentamt));
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/pament_amt/' + id,
        dataType: 'json',
        data:
        {
            pamentamt: pamentamt,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(document).on('keyup', '.dealrecv_amt', function () {
    var id = $(this).attr('data-id');
    var datadealrecvamt = $(this).attr('data-dealrecvamt');
    var dealrecvamt = $('#dealrecvamt' + datadealrecvamt).val();
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/dealrecv_amt/' + id,
        dataType: 'json',
        data:
        {
            dealrecvamt: dealrecvamt,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(document).on('keyup', '.pament_amt', function () {
    var id = $(this).attr('data-id');
    var pamentamtdsrno = $(this).attr('data-pamentamtdsrno');
    var pamentamt = $('#pamentamt' + pamentamtdsrno).val();
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/pament_amt/' + id,
        dataType: 'json',
        data:
        {
            pamentamt: pamentamt,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(document).on('keyup', '.payment_no', function () {
    var id = $(this).attr('data-id');
    var paymentnodsrno = $(this).attr('data-paymentnodsrno');
    var paymentno = $('#paymentno' + paymentnodsrno).val();
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/payment_no/' + id,
        dataType: 'json',
        data:
        {
            paymentno: paymentno,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(document).on('keyup', '.payment_narrtion', function () {
    var id = $(this).attr('data-id');
    var paymentnarrtionsrno = $(this).attr('data-paymentnarrtionsrno');
    var paymentnarrtion = $('#paymentnarrtion' + paymentnarrtionsrno).val();
    //console.log(commit_date)
    $.ajax({
        type: 'POST',
        url: '/deal_register/payment_narrtion/' + id,
        dataType: 'json',
        data:
        {
            paymentnarrtion: paymentnarrtion,
        },
        success: function (response) {
            if (response['success'] == true) {


            }
        }
    })
});
$(".admincheckbox").click(function () {
    var table = $(this).parents("table");
    if ($(this).is(":checked")) {
        table.find('input[type="checkbox"]').prop("checked", true);
    }
    else {
        table.find('input[type="checkbox"]').prop("checked", false);
    }
})
$(".save-dealentry").submit(function (ev) {
    //alert('rohit');
    ev.preventDefault();
    if ($(this).closest('form').valid()) {
        var data = $(this).closest('form').serialize();
        $.ajax({
            url: '/deal_entry/add',
            method: 'POST',
            dataType: 'json',
            data: data,
            success: function (dat) {
                if (dat.success == true) {
                    window.location.href = '/deal_entry/deal_entry';
                }
                else {
                    swal({
                        title: "Deal Entry",
                        text: "Seller Name And Bill Number Already Exists",
                        icon: "error",
                        timer: 2000,
                        buttons: false
                    })
                }
            }
        })
    }
})
$(document).on("click", "#reportfiltersubmit", function () {
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var checkvaluname = $("input[name='formfilter']:checked").val();
    var partygroup = $('#partygroup').val();
    var partycategorytax = $('#partycategorytax').val();
    var partycategory = $('#partycategory').val();
    $.ajax({
        type: "POST",
        url: '/sauda_report/getlist',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            partygroup: partygroup,
            partycategorytax: partycategorytax,
            partycategory: partycategory,
            checkvaluname: checkvaluname,
        },
        success: function (data) {
            if (data['success'] == true) {
                var saudalist = data['hhtml'];
            }
            $('.sauda_detail_body').html(saudalist);
            dattable = jQuery('#demotable').DataTable({
                // "dom": "<'row' <'col-md-12'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                "lengthChange": true,
                "processing": false,
                "serverSide": false,
                "colReorder": true,
                "autoWidth": false,
                "columnDefs": [
                    { "width": "80px", "targets": 0 },
                    { "width": "60%", "targets": 1 },
                    { "width": "20%", "targets": 2 }
                ],
                "buttons": [
                    {
                        extend: 'excel',
                        className: 'btn-default btn-excel',
                        exportOptions: {
                            columns: "thead th:not(.noExport)"
                        }
                    },
                    {
                        extend: 'pdf',
                        className: 'btn-default btn-pdf',
                        exportOptions: {
                            modifier: {
                                page: 'current'
                            },
                            columns: "thead th:not(.noExport)"
                        },
                        orientation: 'landscape',
                        customize: function (doc) {
                            // Splice the image in after the header, but before the table
                            doc.content.splice(0, 0, {
                                margin: [0, 0, 0, 12],
                                alignment: 'center',
                                // image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA9lpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wUmlnaHRzPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvcmlnaHRzLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcFJpZ2h0czpNYXJrZWQ9IkZhbHNlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDoxN2FlYzk4Yy0zMjgzLTExZGEtYTIzOC1lM2UyZmFmNmU5NjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QUYzODU5RTYxNDNCMTFFNTlBNjVCOTY4NjAwQzY5QkQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QUYzODU5RTUxNDNCMTFFNTlBNjVCOTY4NjAwQzY5QkQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowODgwMTE3NDA3MjA2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'
                                text: 'Soft Sauda'
                            });
                        },
                        messageBottom: 'Exported from Soft Sauda'
                    },
                    {
                        extend: 'print',
                        className: 'btn-default btn-print',
                        exportOptions: {
                            columns: "thead th:not(.noExport)"
                        }
                    },
                ],
                "order": [],
                "columnDefs": [{
                    "targets": [0],
                    "orderable": false,
                    "searchable": false
                }
                ],
                initComplete: function () {
                    var api = this.api();

                    // Apply the search
                    api.columns().every(function () {
                        var that = this;

                        $('input', this.footer()).on('keyup change', function () {
                            if (that.search() !== this.value) {
                                that
                                    .search(this.value)
                                    .draw();
                            }
                        });
                    });
                },
                footerCallback: function (row, data, start, end, display) {
                    var api = this.api();
                    api.columns('.sum', {
                        page: 'all'
                    }).every(function () {
                        var asum = this
                            .data()
                            .reduce(function (a, b) {
                                var x = parseFloat(a) || 0;
                                var y = parseFloat(b) || 0;
                                return x + y;
                            }, 0);
                        $('div.gtotal', this.footer()).html("Total = " + asum);
                    });

                }
            })
            $('.loader').hide();
        }
    });
});
$(document).on('click', '.edit_product_tax_btn', function () {
    var prdtid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/product_tax_mast/' + prdtid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var product_tax_name = response['producttax'].product_tax_name;
                var prdtid = response['producttax']._id;
                $('.product_tax_name').val(product_tax_name);
                $('#formheading span').text('EDIT');
                $("#addtaxproduct").attr("action", "/product_tax_mast/edit_category_tax/" + prdtid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-product-tax', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/product_tax_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/product_tax_mast/product_tax_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });

});

// $('.getprdt').select2({
//     placeholder: 'Please select Product',
//     allowClear: true,
//     ajax:{
//         type: "GET",
//         url: '/contract_sauda/getproductname',
//         dataType: 'json',
//         data: function (term) {
//             return {
//                 term: term
//             };
//         },            
//         success: function (data) {
//             console.log(data)
//         },
//     },
//     // processResults: function (data) {
//     //     console.log(data);
//     //     return {
//     //         results: data.format
//     //     };
//     // },
//     // templateResult: formatcity,
//     // templateSelection: formatcity,
//     escapeMarkup: function (m) { return m; }
// });
$(document).on("click", "#dealentryfiltersubmit", function (event) {
    event.preventDefault();
    $('.loader').show();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var sl_code = $('#sl_code').val();
    var sb_code = $('#sbcode').val();
    var br_code = $('#brcode').val();
    var bb_code = $('#bbcode').val();
    var sl_brok = $("input[name='formfilter']:checked").val();
    $.ajax({
        type: "POST",
        url: '/deal-register-2/contractdetail',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            sl_code: sl_code,
            sb_code: sb_code,
            br_code: br_code,
            bb_code: bb_code,
            sl_brok: sl_brok,
        },
        success: function (data) {
            if (data['success'] == true) {
                var contract = data['hhtml'];
            }
            if ($.fn.DataTable.isDataTable('.adsearch')) {
                tablename.destroy();
            }
            $('.deal_detail_body').html(contract);
            $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control" placeholder="Search ' + title + '" autocomplete="false" />');
            });
            $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
            var table;
            table = $('.product_detail_table').DataTable({
                "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable table-responsive't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                "lengthChange": true,
                "colReorder": true,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                // "ajax": "",
                "buttons": [
                    {
                        extend: 'excel',
                        className: 'btn-default btn-excel'
                    },
                    {
                        extend: 'pdf',
                        className: 'btn-default btn-pdf'
                    },
                    {
                        extend: 'print',
                        className: 'btn-default btn-print'
                    },
                ],
                "columnDefs": [
                    {
                        "className": "actioncell",
                        "orderable": false,
                        "searchable": false,
                        "sortable": false,
                        "targets": [0]
                    }
                ],
                initComplete: function () {
                    var api = this.api();
                    api.columns().every(function () {
                        var that = this;

                        $('input', this.footer()).on('keyup change', function () {
                            if (that.search() !== this.value) {
                                that
                                    .column($(this).parent().index() + ':visible')
                                    .search(this.value)
                                    .draw();
                            }
                        });
                    });
                }
            });
            $('.loader').hide();
        }
    });
});
$(document).on('click', '.edit_rawtypmast_tbtn', function () {
    var cityid = $(this).attr('data-id');
    $('.loader').show();
    // alert(cityid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/raw_mat_typ_mast/' + cityid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // //console.log(response);
                var type_descr = response['raw_mat_typ_mast'].type_descr;
                var rawid = response['raw_mat_typ_mast']._id;
                var type_Code = response['raw_mat_typ_mast'].type_Code;
                $('.Description').val(type_descr);
                $('.Code').val(type_Code);
                $("#rawmatmst").attr("action", "/raw_mat_typ_mast/edit_raw_mat/" + rawid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete_rawtypemast_btn', function () {
    // $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/raw_mat_typ_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/raw_mat_typ_mast/raw_mat_typ_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
})
$(document).on('click', '.edit_rmstsub_btn', function () {
    var cityid = $(this).attr('data-id');
    $('.loader').show();
    // alert(cityid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/raw_mat_sub_typ_mast/' + cityid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // //console.log(response);
                var sub_descr = response['raw_mast'].sub_descr;
                var rawid = response['raw_mast']._id;
                var sub_Code = response['raw_mast'].sub_Code;
                $('.Description').val(sub_descr);
                $('.Code').val(sub_Code);
                $("#rawmatmst").attr("action", "/raw_mat_sub_typ_mast/edit_raw_sub/" + rawid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    })
})
$(document).on('click', '.delete_rmstsub_btn', function () {
    // $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/raw_mat_sub_typ_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/raw_mat_sub_typ_mast/raw_mat_sub_typ_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.edit_loc_mast', function () {
    var cityid = $(this).attr('data-id');
    $('.loader').show();
    // alert(cityid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/gowdown_location_mast/' + cityid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // //console.log(response);

                var location_name = response['gowdown_mast'].location_name;
                var rawid = response['gowdown_mast']._id;
                var row_no = response['gowdown_mast'].row_no;
                var rack_no = response['gowdown_mast'].rack_no;
                var qty_cap = response['gowdown_mast'].qty_cap;
                var remark = response['gowdown_mast'].remark;

                $('.location_name').val(location_name);
                $('.rack_no').val(rack_no);
                $('.row_no').val(row_no);
                $('.qty_cap').val(qty_cap);
                $('.remark').val(remark);
                $("#rawmatmst").attr("action", "/gowdown_location_mast/edit_location/" + rawid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    })
})
$(document).on('click', '.delete_loc_mast', function () {
    // $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/gowdown_location_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/gowdown_location_mast/gowdown_location_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

// $(document).on('click', '.edit_mat_mast', function () {
//     var cityid = $(this).attr('data-id');
//     alert(cityid);
//     $('.loader').show();
//     // alert(cityid)
//     // alert(brandid);
//     $.ajax({
//         type: 'GET',
//         url: '/raw_material_mast/' + cityid,
//         dataType: 'json',
//         success: function (response) {

//             // alert(response);
//             if (response['success'] == true) {
//                 // //console.log(response);
//                  var type = response['rawMat_mast'].type;
//                 var rawid = response['rawMat_mast']._id;
//                 var sub_type = response['rawMat_mast'].sub_type;
//                 var descr_rm = response['rawMat_mast'].descr_rm;
//                 var manu_rm = response['rawMat_mast'].manu_rm;
//                 var min_stk = response['rawMat_mast'].min_stk;
//                 var max_stack = response['rawMat_mast'].max_stack;
//                 var qty_opening  = response['rawMat_mast'].qty_opening;
//                 var lead_time = response['rawMat_mast'].lead_time;
//                 var sku_rm = response['rawMat_mast'].sku_rm;

//                $('.type').val(type);
//                $('.sub_type').val(sub_type);
//                $('.descr_rm').val(descr_rm);
//                 $('.manu_rm').val(manu_rm);
//                 $('.min_stk').val(min_stk);
//                 $('.max_stack').val(max_stack);
//                 $('.qty_opening').val(qty_opening);
//                 $('.lead_time').val(lead_time);
//                 $('.qty_cap').val(qty_cap);
//                 $('.sku_rm').val(sku_rm);
//                 $("#rawmatmst").attr("action", "/gowdown_location_mast/edit_location/" + rawid);
//             } else {
//                 $('.branddanger').html(response['message']);
//                 $('.branddanger').show();
//                 $('.brandsuccess').hide();
//             }
//             $('.loader').hide();
//         },
//         error: function (err) {
//             console.log(err);
//         }
//     })
// })
$(document).on('click', '.edit_mat_mast', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/raw_material_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var type_descr = response['rawMat_mast'].type_descr;
                var ctgid = response['rawMat_mast']._id;
                var Rm_ProCode = response['rawMat_mast'].Rm_ProCode;
                var Rm_Quality = response['rawMat_mast'].Rm_Quality;
                var Rm_Sub_Qua = response['rawMat_mast'].Rm_Sub_Qua;
                var Rm_Category = response['rawMat_mast'].Rm_Category;
                var Rm_Unit = response['rawMat_mast'].Rm_Unit;
                var Rm_ManuFac = response['rawMat_mast'].Rm_ManuFac;
                var Rm_Des = response['rawMat_mast'].Rm_Des;
                var Rm_OpStk = response['rawMat_mast'].Rm_OpStk;
                var Rm_Price = response['rawMat_mast'].Rm_Price;
                var Rm_StRate = response['rawMat_mast'].Rm_StRate;
                var Rm_StMin = response['rawMat_mast'].Rm_StMin;
                var Rm_StMax = response['rawMat_mast'].Rm_StMax;
                var Rm_Lead = response['rawMat_mast'].Rm_Lead;
                $('.type_descr').val(type_descr).trigger('change');
                $('.Rm_ProCode').val(Rm_ProCode);
                $('.Rm_Quality').val(Rm_Quality).trigger('change');
                $('.Rm_Sub_Qua').val(Rm_Sub_Qua).trigger('change');
                $('.Rm_Category').val(Rm_Category).trigger('change');
                $('.Rm_Unit').val(Rm_Unit).trigger('change');
                $('.Rm_ManuFac').val(Rm_ManuFac).trigger('change');
                $('.Rm_Des').val(Rm_Des);
                $('.Rm_OpStk').val(Rm_OpStk);
                $('.Rm_Price').val(Rm_Price);
                $('.Rm_StRate').val(Rm_StRate);
                $('.Rm_StMin').val(Rm_StMin);
                $('.Rm_StMax').val(Rm_StMax);
                $('.Rm_Lead').val(Rm_Lead);

                $(".Rm_ProCode").focus()
                $("#addcategory").attr("action", "/raw_material_mast/edit_mat_mast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});

$(document).on('click', '.edit_tax_mast', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/tax_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // console.log(response);

                var ctgid = response['tax_mast']._id;
                var tx_Thead = response['tax_mast'].tx_Thead;
                var tx_TDSAC = response['tax_mast'].tx_TDSAC;
                var tx_ScCode = response['tax_mast'].tx_ScCode;
                var tx_TDS = response['tax_mast'].tx_TDS;
                var tx_GST = response['tax_mast'].tx_GST;

                var tx_SGSTR = response['tax_mast'].tx_SGSTR;
                var tx_SGSTP = response['tax_mast'].tx_SGSTP;
                var tx_CGSTR = response['tax_mast'].tx_CGSTR;
                var tx_CGSTP = response['tax_mast'].tx_CGSTP;
                var tx_IGSTR = response['tax_mast'].tx_IGSTR;
                var tx_IGSTP = response['tax_mast'].tx_IGSTP;
                $('.tx_Thead').val(tx_Thead);
                $('.tx_ScCode').val(tx_ScCode);
                $('#tx_TDS').val(tx_TDS);
                $('.tx_GST').val(tx_GST);
                if (tx_TDSAC != null) {
                    var slnm = tx_TDSAC.ACName;
                    var slid = tx_TDSAC._id;
                    var option = new Option(slnm, slid, true, true);
                    $('#tx_TDSAC').append(option).trigger('change');
                    $('#tx_TDSAC').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": slid, "text": slnm }
                        }
                    });
                }
                if (tx_SGSTR != null) {
                    var slnm = tx_SGSTR.ACName;
                    var slid = tx_SGSTR._id;
                    var option = new Option(slnm, slid, true, true);
                    $('#tx_SGSTR').append(option).trigger('change');
                    $('#tx_SGSTR').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": slid, "text": slnm }
                        }
                    });
                }
                if (tx_SGSTP != null) {
                    var slnm = tx_SGSTP.ACName;
                    var slid = tx_SGSTP._id;
                    var option = new Option(slnm, slid, true, true);
                    $('#tx_SGSTP').append(option).trigger('change');
                    $('#tx_SGSTP').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": slid, "text": slnm }
                        }
                    });
                }
                if (tx_CGSTR != null) {
                    var slnm = tx_CGSTR.ACName;
                    var slid = tx_CGSTR._id;
                    var option = new Option(slnm, slid, true, true);
                    $('#tx_CGSTR').append(option).trigger('change');
                    $('#tx_CGSTR').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": slid, "text": slnm }
                        }
                    });
                }
                if (tx_CGSTP != null) {
                    var slnm = tx_CGSTP.ACName;
                    var slid = tx_CGSTP._id;
                    var option = new Option(slnm, slid, true, true);
                    $('#tx_CGSTP').append(option).trigger('change');
                    $('#tx_CGSTP').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": slid, "text": slnm }
                        }
                    });
                }
                if (tx_IGSTR != null) {
                    var slnm = tx_IGSTR.ACName;
                    var slid = tx_IGSTR._id;
                    var option = new Option(slnm, slid, true, true);
                    $('#tx_IGSTR').append(option).trigger('change');
                    $('#tx_IGSTR').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": slid, "text": slnm }
                        }
                    });
                }
                if (tx_IGSTP != null) {
                    var slnm = tx_IGSTP.ACName;
                    var slid = tx_IGSTP._id;
                    var option = new Option(slnm, slid, true, true);
                    $('#tx_IGSTP').append(option).trigger('change');
                    $('#tx_IGSTP').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": slid, "text": slnm }
                        }
                    });
                }

                $(".tx_Thead").focus()
                $("#addcategory").attr("action", "/tax_mast/tax_mast_update/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});

$(document).on('click', '.delete_tax_mast', function () {
    // $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/tax_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/tax_mast/tax_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});



$(document).on('click', '.delete-rawmat', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/raw_material_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Raw Material Master",
                    text: "This Raw Material Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false

                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/raw_material_mast/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/raw_material_mast/raw_material_mast';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });


});

$(document).on('click', '.su_edit_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/stock_unit_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['Stock_Unit']._id;
                var vhpxskuunit = response['Stock_Unit']._id;
                var sku_name = response['Stock_Unit'].SKUName;
                var sku_symbol = response['Stock_Unit'].SKUSymbol;
                var no_of_dec = response['Stock_Unit'].NoOfDecimal;
                $('.sku_name').val(sku_name);
                $('.vhpxskuunit').val(vhpxskuunit);
                $('.sku_symbol').val(sku_symbol);
                $('.no_of_dec').val(no_of_dec);
                $('.sku_name').focus();
                $("#stockunit").attr("action", "/stock_unit_mast/su_update/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.su_delete_btn', function () {
    // $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/stock_unit_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/stock_unit_mast/stock_unit_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

$(document).on('click', '.edit_ptype_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/party_type_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['ptyp_mast']._id;
                var ptype_descr = response['ptyp_mast'].Description;
                var ptype_Code = response['ptyp_mast'].Code;
                var sales_posting_ac = response['ptyp_mast'].sales_posting_ac;
                var pur_posting_ac = response['ptyp_mast'].pur_posting_ac;
                var SR_posting_ac = response['ptyp_mast'].SR_posting_ac;
                var PR_posting_ac = response['ptyp_mast'].PR_posting_ac;
                $('.ptype_descr').val(ptype_descr);
                $('.ptype_Code').val(ptype_Code);
                $('.sales_posting_ac').val(sales_posting_ac).trigger('change');
                $('.pur_posting_ac').val(pur_posting_ac).trigger('change');
                $('.SR_posting_ac').val(SR_posting_ac).trigger('change');
                $('.PR_posting_ac').val(PR_posting_ac).trigger('change');
                $('.ptype_descr').focus();
                $("#ptypemast").attr("action", "/party_type_mast/edit_ptype_mat/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete_addless_btn', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/addless_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Addless Master",
                    text: "This Entry Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false
                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/addless_mast/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/addless_mast/addless_mast';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_addless_tbtn', function () {
    var addlessid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/addless_mast/' + addlessid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                var type_descr = response['addlessmast'].type_descr;
                var addlessid = response['addlessmast']._id;
                var addlesstype = response['addlessmast'].addlesstype;
                var sales_posting_ac = response['addlessmast'].sales_posting_ac;
                var pur_posting_ac = response['addlessmast'].pur_posting_ac;
                var SR_posting_ac = response['addlessmast'].SR_posting_ac;
                var PR_posting_ac = response['addlessmast'].PR_posting_ac;
                var Parameter_posting = response['addlessmast'].Parameter_posting;

                $('.type_descr').val(type_descr);
                $('.addlesstype').val(addlesstype);
                $('.sales_posting_ac').val(sales_posting_ac).trigger('change');
                $('.pur_posting_ac').val(pur_posting_ac).trigger('change');
                $('.SR_posting_ac').val(SR_posting_ac).trigger('change');
                $('.PR_posting_ac').val(PR_posting_ac).trigger('change');
                $('.Parameter_posting').val(Parameter_posting).trigger('change');
                $('#formheading span').text('Edit');
                $("#addlessmast").attr("action", "/addless_mast/edit_addless_mast/" + addlessid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_category_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/category_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['ptyp_mast']._id;
                var ptype_descr = response['ptyp_mast'].Description;
                var ptype_Code = response['ptyp_mast'].Code;
                $('.ptype_descr').val(ptype_descr);
                $('.ptype_Code').val(ptype_Code);
                $('.ptype_descr').focus();
                $("#ptypemast").attr("action", "/category_mast/edit_category_mast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_model_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/model_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['ptyp_mast']._id;
                var ptype_descr = response['ptyp_mast'].Description;
                var ptype_Code = response['ptyp_mast'].Code;
                $('.ptype_descr').val(ptype_descr);
                $('.ptype_Code').val(ptype_Code);
                $('.ptype_descr').focus();
                $("#ptypemast").attr("action", "/model_mast/edit_model_mast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_brand_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/brand_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['ptyp_mast']._id;
                var ptype_descr = response['ptyp_mast'].Description;
                var ptype_Code = response['ptyp_mast'].Code;
                $('.ptype_descr').val(ptype_descr);
                $('.ptype_Code').val(ptype_Code);
                $('.ptype_descr').focus();
                $("#ptypemast").attr("action", "/brand_mast/edit_brand_mast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_GowdawnCode', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/GowdawnCode/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['ptyp_mast']._id;
                var ptype_descr = response['ptyp_mast'].Description;
                var ptype_Code = response['ptyp_mast'].Code;
                $('.ptype_descr').val(ptype_descr);
                $('.ptype_Code').val(ptype_Code);
                $('.ptype_descr').focus();
                $("#ptypemast").attr("action", "/GowdawnCode/edit_GowdawnCode/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_production_dept_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/production_dept_master/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['ptyp_mast']._id;
                var ptype_descr = response['ptyp_mast'].Description;
                var ptype_Code = response['ptyp_mast'].Code;
                var Order = response['ptyp_mast'].Order;
                $('.ptype_descr').val(ptype_descr);
                $('.ptype_Code').val(ptype_Code).trigger('change');
                $('.Order').val(Order);
                $('.ptype_descr').focus();
                $("#ptypemast").attr("action", "/production_dept_master/edit_production_dept_master/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});

$(".update_gsetup").click(function (ev) {
    ev.preventDefault();

    if ($(this).closest('form').valid()) {
        //  alert("data")
        var data = $(this).closest('form').serialize();
        //alert(data)
        $.ajax({
            url: '/supplier_mast/s_mast_add',
            method: 'POST',
            dataType: 'json',
            data: data,
            success: function (dat) {
                // alert(dat)
                // alert(dat.success);
                if (dat.success == true) {
                    $('#addcity').modal('hide');
                    swal({
                        title: "Supplier",
                        text: "Supplier Saved",
                        icon: "success",
                        timer: 2000,
                        buttons: false

                    })
                    window.location.href = "/supplier_mast/supplier_mast";
                } else {
                    swal({
                        title: "Supplier",
                        text: "Duplicate supplier with same city is not allowed",
                        icon: "error",
                        timer: 4000,
                        buttons: false
                    })
                }
            }
        })
    }
})

$(document).on('click', '.edit_group_setup_btn', function () {
    var ctgid = $(this).attr('data-id');
    console.log(ctgid)
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/group_setup_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            console.log(response)
            if (response['success'] == true) {
                // //console.log(response);
                var id = response['g_mast']._id;
                var group = response['g_mast'].group;
                var garry = response['g_mast'].garry;
                $('.group_id').val(id);
                $('.groupname').val(group);
                $('.garry').val(garry).trigger('change');
                //    $('.ptype_descr').focus();
                //    $("#ptypemast").attr("action", "/brand_mast/edit_brand_mast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_sub_quality_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/sub_quality_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['ptyp_mast']._id;
                var ptype_descr = response['ptyp_mast'].Description;
                var ptype_Code = response['ptyp_mast'].Code;
                $('.ptype_descr').val(ptype_descr);
                $('.ptype_Code').val(ptype_Code);
                $('.ptype_descr').focus();
                $("#ptypemast").attr("action", "/sub_quality_mast/edit_sub_quality_mast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.edit_quality_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/quality_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['ptyp_mast']._id;
                var ptype_descr = response['ptyp_mast'].Description;
                var ptype_Code = response['ptyp_mast'].Code;
                $('.ptype_descr').val(ptype_descr);
                $('.ptype_Code').val(ptype_Code);
                $('.ptype_descr').focus();
                $("#ptypemast").attr("action", "/quality_mast/edit_quality_mast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});


// Delete Party Type
$(document).on('click', '.delete-partytype', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/party_type_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "PartyType Master",
                    text: "This Party Type Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false

                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/party_type_mast/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/party_type_mast/party_type_mast';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });


});



$(document).on('click', '.delete-category', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/category_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Category Master",
                    text: "This Category Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false

                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/category_mast/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/category_mast/category_mast';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });


});

$(document).on('click', '.delete_gowdawn', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/GowdawnCode/' + id,
                success: function (response) {
                    $('.loader').hide();
                    window.location.href = '/GowdawnCode/GowdawnCode';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

$(document).on('click', '.delete_brand_btn', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/brand_mast/' + id,
                success: function (response) {
                    $('.loader').hide();
                    window.location.href = '/brand_mast/brand_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.delete_production_dept', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/production_dept_master/' + id,
                success: function (response) {
                    $('.loader').hide();
                    window.location.href = '/production_dept_master/production_dept_master';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});


$(document).on('click', '.delete-quality', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/quality_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Quality Master",
                    text: "This Quality Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false

                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/quality_mast/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/quality_mast/quality_mast';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });


});



$(document).on('click', '.delete-subquality', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/sub_quality_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Sub Quality Master",
                    text: "This Sub Quality Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false

                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/sub_quality_mast/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/sub_quality_mast/sub_quality_mast';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });


});


$(document).on('click', '.delete_model_btn', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/model_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/model_mast/model_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on('click', '.edit_tm_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/trans_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['tm_mast']._id;
                var vhpxtransac = response['tm_mast']._id;
                var tran_descr = response['tm_mast'].tran_descr;
                var tran_Code = response['tm_mast'].tran_Code;
                $('.tran_descr').val(tran_descr);
                $('.vhpxtransac').val(vhpxtransac);
                $('.tran_Code').val(tran_Code);
                $("#TMmast").attr("action", "/trans_mast/edit_tm/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete_tm_btn', function () {
    // $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/trans_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/trans_mast/trans_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

// edit district
$(document).on('click', '.edit_country_btn', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/district_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            console.log(response)
            if (response['success'] == true) {
                // //console.log(response);
                var ctgid = response['c_mast']._id;
                var vhpxcountry = response['c_mast']._id;
                var DistrictName = response['c_mast'].DistrictName;
                var StateName = response['c_mast'].StateName;
                var Population = response['c_mast'].Population;
                var Area = response['c_mast'].Area;
                $('.DistrictName').val(DistrictName);
                $('.vhpxcountry').val(vhpxcountry);
                $('.Population').val(Population);
                $('.Area').val(Area);
                $('.StateName').val(StateName).trigger('change');
                $('.DistrictName').focus();
                $("#countrymast").attr("action", "/district_mast/edit_district/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});

// Delete District
$(document).on('click', '.delete_district', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/district_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "District Master",
                    text: "This District Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false

                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/district_mast/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/district_mast/district_mast';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });


});


$(document).on('click', '.edit_smast', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/supplier_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);

                var ctgid = response['s_mast']._id;
                var ac_name = response['s_mast'].ac_name;
                var ac_add1 = response['s_mast'].ac_add1;
                var ac_opbal = response['s_mast'].ac_opbal;
                var ac_open_type = response['s_mast'].ac_open_type;
                var ac_groupname = response['s_mast'].ac_groupname;
                var ac_add2 = response['s_mast'].ac_add2;
                var ac_city = response['s_mast'].ac_city;
                var ac_phmob = response['s_mast'].ac_phmob;
                var ac_gstin = response['s_mast'].ac_gstin;
                var ac_bank = response['s_mast'].ac_bank;
                $('.ac_opbal').val(ac_opbal);
                $('.ac_add1').val(ac_add1);
                $('.ac_open_type').val(ac_open_type).trigger('change');
                $('.ac_groupname').val(ac_groupname).trigger('change');
                $('.ac_add2').val(ac_add2);
                $('#ac_city').val(ac_city).trigger('change');
                $('.ac_phmob').val(ac_phmob);
                $('.ac_gstin').val(ac_gstin);
                $('.ac_bank').val(ac_bank).trigger('change');
                $("#suplliermaster").attr("action", "/supplier_mast/edit_smast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete_smast', function () {
    // $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/supplier_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/supplier_mast/supplier_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

$(document).on('click', '.edit_group_mast', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/group_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);group_type
                var ctgid = response['g_mast']._id;
                var vhpxgroup = response['g_mast']._id;
                var gm_order = response['g_mast'].Order;
                var sub_group = response['g_mast'].MainGroupName;
                var group_name = response['g_mast'].GroupName;
                var group_type = response['g_mast'].GroupType;
                var main_out = response['g_mast'].MaintainOs;
                var supp_gwt = response['g_mast'].Suppress;
                var Address = response['g_mast'].Address;
                var Ladger = response['g_mast'].Ledger;
                $('.gm_order').val(gm_order);
                $('.vhpxgroup').val(vhpxgroup);
                $('.sub_group').val(sub_group).trigger('change');
                $('.group_name').val(group_name);
                $('.group_type').val(group_type).trigger('change');
                $('.main_out').val(main_out).trigger('change');
                $('.supp_gwt').val(supp_gwt).trigger('change');
                $('.Address').val(Address).trigger('change');
                $('.Ladger').val(Ladger).trigger('change');
                $('.gm_order').focus();
                $("#groupMast").attr("action", "/group_mast/edit_gmast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});



$(document).on('click', '.delete-group', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/group_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Group Master",
                    text: "This Group Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false

                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/group_mast/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/group_mast/group_mast';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});

// Account Master Start #####################################################################################################################################
$(".lock-account").on('keydown', function (ev) {
    ev.preventDefault();
    if (ev.keyCode == 13) {
        if ($(this).closest('form').valid()) {
            var data = $(this).closest('form').serialize();
            var id = $("#vhpxaccount").val();
            if (id == "" || id == undefined) {
                $.ajax({
                    url: '/account_mast/amast_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Account",
                                text: "Account Entry Saved",
                                icon: "success",
                                timer: 2000,
                                buttons: false
                            })
                            $('#addparty').modal('hide');
                            if (dat.GaruEntryModel == 'GaruEntryModel') {
                                setTimeout(function () { $('#vouc_code').focus(); }, 300);
                            }
                            else window.location.href = "/account_mast/account_mast";
                        } else {
                            $('#addparty').modal('hide');
                            if (dat.GaruEntryModel == 'GaruEntryModel') {
                                setTimeout(function () { $('#vouc_code').focus(); }, 300);
                            }
                            swal({
                                title: "Account",
                                text: "Duplicate account with same city is not allowed",
                                icon: "error",
                                timer: 2000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/account_mast/edit_amast/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Account",
                                text: "Account Entry Updated",
                                icon: "success",
                                timer: 2000,
                                buttons: false
                            })
                            window.location.href = "/account_mast/account_mast_list";
                        } else {
                            swal({
                                title: "Account",
                                text: "Duplicate account with same city is not allowed",
                                icon: "error",
                                timer: 3000,
                                buttons: false
                            })
                        }
                    }
                })
            }
        }
    }
})
$(".lock-account").click(function (ev) {
    ev.preventDefault();
    if ($(this).closest('form').valid()) {

        var data = $(this).closest('form').serialize();
        var id = $("#vhpxaccount").val();
        if (id == "" || id == undefined) {
            $.ajax({
                url: '/account_mast/amast_add',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Account",
                            text: "Account Entry Saved",
                            icon: "success",
                            timer: 4000,
                            buttons: false
                        })
                        $('#addparty').modal('hide');
                        if (dat.GaruEntryModel == 'GaruEntryModel') {
                            setTimeout(function () { $('#vouc_code').focus(); }, 300);
                        }
                        else window.location.href = "/account_mast/account_mast";
                    } else {
                        $('#addparty').modal('hide');
                        if (dat.GaruEntryModel == 'GaruEntryModel') {
                            setTimeout(function () { $('#vouc_code').focus(); }, 300);
                        }
                        swal({
                            title: "Account",
                            text: "Duplicate account with same city is not allowed",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }
            })
        } else {
            $.ajax({
                url: '/account_mast/edit_amast/' + id + '',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Account",
                            text: "Account Entry Updated",
                            icon: "success",
                            timer: 4000,
                            buttons: false
                        })
                        window.location.href = "/account_mast/account_mast_list";
                    } else {
                        swal({
                            title: "Account",
                            text: "Duplicate account with same city is not allowed",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }
            })
        }
    }
})
$(".update_accountInSaleBill").on('keydown', function (ev) {
    ev.preventDefault();
    if (ev.keyCode == 13) {
        if ($(this).closest('form').valid()) {
            var data = $(this).closest('form').serialize();
            var id = $("#vhpxaccount").val();
            if (id == "" || id == undefined) {
            } else {
                $.ajax({
                    url: '/account_mast/update_accountInSaleBill/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        if (dat.success == true) {
                            $('#updateParty').modal('hide');
                            swal({
                                title: "Account",
                                text: "Account Entry Updated",
                                icon: "success",
                                timer: 2000,
                                buttons: false
                            })
                        } else {

                        }
                    }
                })
            }
        }
    }
})
$(".update_accountInSaleBill").click(function (ev) {
    ev.preventDefault();
    if ($(this).closest('form').valid()) {
        var data = $(this).closest('form').serialize();
        var id = $("#vhpxaccount").val();
        alert(id)
        if (id == "" || id == undefined) {
        } else {
            $.ajax({
                url: '/account_mast/update_accountInSaleBill/' + id + '',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    if (dat.success == true) {
                        $('#updateParty').modal('hide');
                        swal({
                            title: "Account",
                            text: "Account Entry Updated",
                            icon: "success",
                            timer: 4000,
                            buttons: false
                        })
                    } else {

                    }
                }
            })
        }
    }
})
$(document).on('click', '.edit_account_mast', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/account_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);group_type
                var ctgid = response['a_mast']._id;
                var vhpxaccount = response['a_mast']._id;
                var ac_name = response['a_mast'].ACName;
                var ac_opbal = response['a_mast'].OpBalance;
                var ac_open_type = response['a_mast'].dbcr;
                var ac_groupname = response['a_mast'].GroupName;
                var broker_Code = response['a_mast'].broker_Code;
                var sl_Person = response['a_mast'].sl_Person;
                var ac_pan = response['a_mast'].PanNumber;
                var ac_code = response['a_mast'].ACCode;
                var ac_add1 = response['a_mast'].Address1;
                var ac_city = response['a_mast'].CityName;
                var ac_state = response['a_mast'].StateName;
                var ac_area = response['a_mast'].Area;
                var ac_gstin = response['a_mast'].GSTIN;
                var ac_ptype = response['a_mast'].PartyType;
                var ac_crelimit = response['a_mast'].CrLimit;
                var ac_iecno = response['a_mast'].ac_iecno;
                var ac_website = response['a_mast'].ac_website;
                var ac_email = response['a_mast'].Email;
                var ac_phoff = response['a_mast'].ac_phoff;
                var ac_phres = response['a_mast'].ac_phres;
                var ac_phmob = response['a_mast'].MobileNo;
                var ac_phfax = response['a_mast'].ac_phfax;
                var ac_cont = response['a_mast'].ac_cont;
                var ac_PrintType = response['a_mast'].ac_PrintType;
                var ac_APMC = response['a_mast'].ac_APMC;
                var ac_add2 = response['a_mast'].ac_add2;
                var ac_intrestper = response['a_mast'].ac_intrestper;
                var ac_taxnm = response['a_mast'].ac_taxnm;
                var ac_fccino = response['a_mast'].ac_fccino;
                var ac_creditdys = response['a_mast'].ac_creditdys;
                var ac_pincode = response['a_mast'].ac_pincode;
                var bank_group = response['a_mast'].bank_group;
                var ac_transportCode = response['a_mast'].ac_transportCode;
                var html = '';
                if (bank_group != null) {
                    for (p = 0; p < bank_group.length; p++) {
                        html += '<div data-repeater-list="bank_group">';
                        html += '<div class="form-group bankrow clearfix" data-repeater-item>';
                        if (p != 0) {
                            html += '<button class="delbankbtn" data-repeater-delete type="button"><i class="fa fa-close"></i> </button>';
                        }
                        html += '<div class="col-sm-12 col-md-6">';
                        html += '<div class="form-group form-md-line-input clearfix">';
                        html += '<label class="control-label col-md-3">Bank Name</label>';
                        html += '<div class="col-md-9">';
                        if (bank_group[p]['ac_banknm'] != undefined) var ac_banknm = bank_group[p]['ac_banknm'];
                        else var ac_banknm = '';
                        html += '<input class="form-control ac_banknm" placeholder="Bank Name" name="bank_group[' + p + '][ac_banknm]" value="' + ac_banknm + '"  type="text">';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '<div class="col-sm-12 col-md-6">';
                        html += '<div class="form-group form-md-line-input clearfix">';
                        html += '<label class="control-label col-md-3">IFSC Code</label>';
                        html += '<div class="col-md-9">';
                        if (bank_group[p]['ifc_code'] != undefined) var ifc_code = bank_group[p]['ifc_code'];
                        else var ifc_code = '';
                        html += '<input class="form-control" name="bank_group[' + p + '][ifc_code]" placeholder="IFSC Code" type="text" value="' + ifc_code + '" autocomplete="off" />';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '<div class="col-sm-12 col-md-6">';
                        html += '<div class="form-group form-md-line-input clearfix">';
                        html += '<label class="control-label col-md-3">Account No</label>';
                        html += '<div class="col-md-9">';
                        if (bank_group[p]['account_no'] != undefined) var account_no = bank_group[p]['account_no'];
                        else var account_no = '';
                        html += '<input class="form-control" type="text" placeholder="Account No"  name="bank_group[' + p + '][account_no]" value="' + account_no + '"/>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '<div class="col-sm-12 col-md-6">';
                        html += '<div class="form-group form-md-line-input clearfix">';
                        html += '<label class="control-label col-md-3">Branch Name</label>';
                        html += '<div class="col-md-9">';
                        if (bank_group[p]['branch_name'] != undefined) var branch_name = bank_group[p]['branch_name'];
                        else var branch_name = '';
                        html += '<input class="form-control" type="text" placeholder="Branch"  name="bank_group[' + p + '][branch_name]" value="' + branch_name + '"/>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    }
                }
                $('#datanm').html(html);
                $('#ac_pincode').html(ac_pincode);
                $('.ac_add2').val(ac_add2);
                $('.ac_add2').val(ac_add2);
                $('.ac_intrestper').val(ac_intrestper);
                $('.ac_taxnm').val(ac_taxnm).trigger('change');
                $('.ac_fccino').val(ac_fccino);
                $('.ac_creditdys').val(ac_creditdys);
                $('.vhpxaccount').val(vhpxaccount);
                $('.ac_name').val(ac_name);
                $('.ac_opbal').val(ac_opbal);
                $('.ac_open_type').val(ac_open_type).trigger('change');
                $('.ac_groupname').val(ac_groupname).trigger('change');
                $('.ac_pan').val(ac_pan);
                $('.ac_code').val(ac_code);
                $('.ac_add1').val(ac_add1);
                $('.ac_city').val(ac_city).trigger('change');
                $('.ac_state').val(ac_state).trigger('change');
                $('.ac_area').val(ac_area);
                $('.ac_gstin').val(ac_gstin);
                $('.ac_ptype').val(ac_ptype).trigger('change');
                $('.ac_crelimit').val(ac_crelimit);
                $('.ac_iecno').val(ac_iecno);
                $('.ac_website').val(ac_website);
                $('.ac_email').val(ac_email);
                $('.ac_phoff').val(ac_phoff);
                $('.ac_phres').val(ac_phres);
                $('.ac_phmob').val(ac_phmob);
                $('.ac_phfax').val(ac_phfax);
                $('.ac_cont').val(ac_cont);
                $('.ac_transportCode').val(ac_transportCode);
                $('.ac_PrintType').val(ac_PrintType).trigger('change');
                $('.ac_APMC').val(ac_APMC).trigger('change');

                var brnm = broker_Code.ACName;
                var brid = broker_Code._id;
                var option = new Option(brnm, brid, true, true);
                $('#broker_Code').append(option).trigger('change');
                $('#broker_Code').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": brid, "text": brnm }
                    }
                });

                var slnm = sl_Person.ACName;
                var slid = sl_Person._id;
                var option = new Option(slnm, slid, true, true);
                $('#sl_Person').append(option).trigger('change');
                $('#sl_Person').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": slid, "text": slnm }
                    }
                });

                var ac_GroupName = ac_groupname.GroupName;
                var ac_GroupNameid = ac_groupname._id;
                var option = new Option(ac_GroupName, ac_GroupNameid, true, true);
                $('#ac_groupname').append(option).trigger('change');
                $('#ac_groupname').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": ac_GroupNameid, "text": ac_GroupName }
                    }
                });
                var cityname = ac_city.CityName;
                var citynameid = ac_city._id;
                var option = new Option(cityname, citynameid, true, true);
                $('#ac_city').append(option).trigger('change');
                $('#ac_city').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": citynameid, "text": cityname }
                    }
                });
                var statename = ac_state.StateName;
                var stateid = ac_state._id;
                var option = new Option(statename, stateid, true, true);
                $('#ac_state').append(option).trigger('change');
                $('#ac_state').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": stateid, "text": statename }
                    }
                });
                var partytypdes = ac_ptype.Description;
                var parttypeid = ac_ptype._id;
                var option = new Option(partytypdes, parttypeid, true, true);
                $('#ac_ptype').append(option).trigger('change');
                $('#ac_ptype').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": parttypeid, "text": partytypdes }
                    }
                });
                if (ac_taxnm != null) {
                    var taxname = ac_taxnm.tx_Thead;
                    var taxnameid = ac_taxnm._id;
                    var option = new Option(taxname, taxnameid, true, true);
                    $('#ac_taxnm').append(option).trigger('change');
                    $('#ac_taxnm').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": taxnameid, "text": taxname }
                        }
                    });
                }
                //    $("#accountMast").attr("action", "/account_mast/edit_amast/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
$(document).on('click', '.delete-account', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/account_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Account Master",
                    text: "This Account Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false
                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/account_mast/' + id,
                            success: function (response) {
                                window.location.href = '/account_mast/account_mast_list';
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
function checkAddressdetailes() {
    var group = $('#ac_groupname').val()
    if (group == null || group == '' || group == undefined) {

    } else {
        $.ajax({
            type: 'GET',
            url: '/account_mast/checkAddressdetailes/' + group,
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    // console.log(data['g_mast'].Address);
                    if (data['g_mast'].Address == 'Y') {
                        $('#ac_areahide').show();
                        $('#ac_add1hide').show();
                        $('#ac_add2hide').show();
                        $('#ac_cityhide').show();
                        $('#ac_statehide').show();
                        $('#ac_pincodehide').show();
                        $('#ac_panhide').show();
                        $('#ac_gstinhide').show();
                        $('#ac_intrestperhide').show();
                        $('#ac_ptypehide').show();
                        $('#ac_taxnmhide').show();
                        $('#ac_crelimithide').show();
                        $('#ac_creditdyshide').show();
                        $('#ac_iecnohide').show();
                        $('#ac_fccinohide').show();
                        $('#ac_websitehide').show();
                        $('#ac_emailhide').show();
                        $('#ac_phoffhide').show();
                        $('#ac_phreshide').show();
                        $('#ac_phmobhide').show();
                        $('#ac_phfaxhide').show();
                        $('#ac_PrintTypehide').show();
                        $('#BankDetailed').show();
                        $('#ac_transportCode').show();
                        $('#ac_broker_Code').show();
                        $('#ac_sl_Person').show();
                        $('#ac_APMChide').show();
                        $('#ac_transportCodehide').show();
                        $('#ac_city').attr('required', true);
                        $('#ac_ptype').attr('required', true);
                    }
                    if (data['g_mast'].Address == 'N') {
                        $('#ac_areahide').hide();
                        $('#ac_add1hide').hide();
                        $('#ac_add2hide').hide();
                        $('#ac_cityhide').hide();
                        $('#ac_statehide').hide();
                        $('#ac_pincodehide').hide();
                        $('#ac_panhide').hide();
                        $('#ac_gstinhide').hide();
                        $('#ac_intrestperhide').hide();
                        $('#ac_ptypehide').hide();
                        $('#ac_taxnmhide').hide();
                        $('#ac_crelimithide').hide();
                        $('#ac_creditdyshide').hide();
                        $('#ac_iecnohide').hide();
                        $('#ac_fccinohide').hide();
                        $('#ac_websitehide').hide();
                        $('#ac_emailhide').hide();
                        $('#ac_phoffhide').hide();
                        $('#ac_phreshide').hide();
                        $('#ac_phmobhide').hide();
                        $('#ac_phfaxhide').hide();
                        $('#BankDetailed').hide();
                        $('#ac_PrintTypehide').hide();
                        $('#ac_transportCode').hide();
                        $('#ac_broker_Code').hide();
                        $('#ac_sl_Person').hide();
                        $('#ac_APMChide').hide();
                        $('#ac_transportCodehide').hide();
                        $('#ac_city').attr('required', false);
                        $('#ac_ptype').attr('required', false);
                    }
                }
            }
        });
    }
}
function getCityData() {
    var cityid = $('#ac_city').val();
    $.ajax({
        type: 'GET',
        url: '/account_mast/getCityData/' + cityid,
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                var city = data['city'];
                // $('#ac_state').val(city.StateName).trigger('change');
                $('#StateCode').val(city.StateName.StateCode);
                var statename = city.StateName.StateName;
                var stateid = city.StateName._id;
                var option = new Option(statename, stateid, true, true);
                $('#ac_state').append(option).trigger('change');
                $('#ac_state').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": stateid, "text": statename }
                    }
                });
                // $('#ac_ptype').val(city.PartyType).trigger('change');
                var partytypdes = city.PartyType.Description;
                var parttypeid = city.PartyType._id;
                var option = new Option(partytypdes, parttypeid, true, true);
                $('#ac_ptype').append(option).trigger('change');
                $('#ac_ptype').trigger({
                    type: 'select2:select',
                    params: {
                        data: { "id": parttypeid, "text": partytypdes }
                    }
                });
                $('#ac_pincode').val(city.CityPinCode);
                $('#ac_pan').focus();
            }
        }
    });
}
function GenGstNo() {
    $('#ac_gstin').val($('#StateCode').val() + '' + $('#ac_pan').val())
}
function addGroup() {
    $('#addGroup').modal('show');
    setTimeout(function () {
        $('.gm_order').focus();
    }, 300);
}
function addCity() {
    $('#addCity').modal('show');
    setTimeout(function () {
        $('.city_name').focus();
    }, 300);
}
function addState() {
    $('#addState').modal('show');
    setTimeout(function () {
        $('.state_name').focus();
    }, 300);
}
// Account Master End  #####################################################################################################################################

$(document).on('click', '.edit_taxctg_mast', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/tax_catogory_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                var ctgid = response['taxctg_mast']._id;
                var tx_ctgnm = response['taxctg_mast'].tx_ctgnm;
                $('.tx_ctgnm').val(tx_ctgnm);
                $('#formheading span').text('Edit');
                $("#addtaxcategory").attr("action", "/tax_catogory_mast/tax_ctgmast_update/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});

$(document).on('click', '.delete_tax_ctgmast', function () {
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/tax_catogory_mast/' + id,
                success: function (response) {
                    window.location.href = '/tax_catogory_mast/tax_catogory_mast';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

$(document).on('click', '.edit_transport_mast', function () {
    var ctgid = $(this).attr('data-id');
    $('.loader').show();
    $.ajax({
        type: 'GET',
        url: '/transport_mast/' + ctgid,
        dataType: 'json',
        success: function (response) {
            if (response['success'] == true) {
                // //console.log(response);group_type
                var ctgid = response['transportmast']._id;
                var vhpxtransport = response['transportmast']._id;
                var ac_name = response['transportmast'].ac_name;
                var ac_opbal = response['transportmast'].ac_opbal;
                var ac_open_type = response['transportmast'].ac_open_type;
                var ac_groupname = response['transportmast'].ac_groupname;
                var ac_pan = response['transportmast'].ac_pan;
                var ac_rmks = response['transportmast'].ac_rmks;
                var ac_add1 = response['transportmast'].ac_add1;
                var ac_city = response['transportmast'].ac_city;
                var ac_state = response['transportmast'].ac_state;
                var ac_cst = response['transportmast'].ac_cst;
                var ac_gstin = response['transportmast'].ac_gstin;
                var ac_website = response['transportmast'].ac_website;
                var ac_email = response['transportmast'].ac_email;
                var ac_phoff = response['transportmast'].ac_phoff;
                var ac_phres = response['transportmast'].ac_phres;
                var ac_phmob = response['transportmast'].ac_phmob;
                var ac_phfax = response['transportmast'].ac_phfax;
                var ac_cont = response['transportmast'].ac_cont;
                $('.ac_name').val(ac_name);
                $('.vhpxtransport').val(vhpxtransport);
                $('.ac_opbal').val(ac_opbal);
                $('.ac_open_type').val(ac_open_type).trigger('change');
                $('.ac_groupname').val(ac_groupname).trigger('change');
                $('.ac_pan').val(ac_pan);
                $('.ac_rmks').val(ac_rmks);
                $('.ac_add1').val(ac_add1);
                $('.ac_city').val(ac_city).trigger('change');
                $('.ac_state').val(ac_state).trigger('change');
                $('.ac_cst').val(ac_cst);
                $('.ac_gstin').val(ac_gstin);
                $('.ac_website').val(ac_website);
                $('.ac_email').val(ac_email);
                $('.ac_phoff').val(ac_phoff);
                $('.ac_phres').val(ac_phres);
                $('.ac_phmob').val(ac_phmob);
                $('.ac_phfax').val(ac_phfax);
                $('.ac_cont').val(ac_cont);
                $("#transportmast").attr("action", "/transport_mast/edit_transport/" + ctgid);
            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});

$(document).on('click', '.delete_transport_mast', function () {
    // $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/transport_mast/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    window.location.href = '/transport_mast/transport_mast';
                    $('.loader').hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

$(document).on("keyup", "#ws_no", function () {
    // $(document).on("change.select2", "#br_code", function () {
    $("#delivery").show();
    $('.loader').show();
    var ws_no = $("#ws_no").val();
    $.ajax({
        type: 'GET',
        url: '/profarma/worksheetname',
        dataType: 'json',
        data: {
            vouc_code: ws_no
        },
        success: function (data) {
            // console.log(data);
            var i, j, result, sau;
            result = '';
            if (data['success'] == true) {
                var workmast = data['workmast'];
                j = 0;
                for (i = 0; i < workmast.length; i++) {
                    var workmastgroup = workmast[i]['work_sheet_group'];
                    $.each(workmastgroup, function (index, value) {
                        j++;
                        result += '<tr>';
                        result += '<div id="delivery-' + index + '">';
                        result += '<td>';
                        if (value.w_pname != null) result += '<input type="hidden" value="' + value.w_pname._id + '" id="w_pnameaid' + j + '"/><input type="text" name="w_pname" value="' + value.w_pname.prdt_desc + '" id="w_pnamea' + j + '" class="form-control" style="width: 142px;text-align: -webkit-right;"/>';
                        else result += '<input type="text" name="w_pname"  id="w_pnamea' + j + '" class="form-control" style="width: 142px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="in_qty" value="' + value.in_qty + '" id="inqtyb' + j + '"  class="form-control" style="width: 142px;text-align: -webkit-right;" />';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="perc_cbm" value="' + value.perc_cbm + '" id="perccbmc' + j + '" class="form-control" style="width: 135px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="or_qty" value="' + value.or_qty + '" id="orqtyd' + j + '" class="form-control" style="width: 92px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_cost" value="' + value.w_cost + '" id="wcoste' + j + '"  class="form-control" style="width: 72px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_profit" value="' + value.w_profit + '" id="wprofitf' + j + '" class="form-control" value="10" style="width: 72px;text-align: -webkit-right;">';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_profitamt" value="' + value.w_profitamt + '" id="wprofitamtg' + j + '" class="form-control" style="width: 92px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_sellprice" value="' + value.w_sellprice + '" id="wsellpriceh' + j + '" class="form-control" style="width: 82px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_sellpriceD" value="' + value.w_sellpriceD + '" id="wsellpriceDi' + j + '" class="form-control" style="width: 112px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_boxpricedoller" value="' + value.w_boxpricedoller + '" id="boxpricedollerj' + j + '"  class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td> <input type="text" name="w_boxperC" value="' + value.w_boxperC + '" id="wboxperCk' + j + '" class="form-control" style="width: 142px;text-align: -webkit-right;"/>';
                        result += ' </td>';
                        result += '<td>';
                        result += '<input type="text" name="w_boxperFR" value="' + value.w_boxperFR + '" id="perbxfrghtrsl' + j + '" class="form-control" style="width: 142px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_boxperFD" value="' + value.w_boxperFD + '" id="wboxperFDm' + j + '" class="form-control" style="width: 132px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_finalb" value="' + value.w_finalb + '" id="wfinalbn' + j + '"  class="form-control" style="width: 152px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += ' <td>';
                        result += '<input type="text" name="w_finalc" value="' + value.w_finalc + '" id="wfinalco' + j + '" class="form-control" style="width: 87px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_fobAmt" value="' + value.w_fobAmt + '" id="wfobAmtp' + j + '" class="form-control" style="width: 102px;text-align: -webkit-right;">';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="w_cnfAmt" value="' + value.w_cnfAmt + '" id="wcnfAmtq' + j + '" class="form-control focus" style="width: 112px;text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="tot_cbm" value="' + value.tot_cbm + '" id="totelcbmr' + j + '" class="form-control" style="width: 102px;text-align: -webkit-right;">';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" name="fr_cbm" value="' + value.fr_cbm + '" id="frcbs' + j + '" class="form-control"  style="width: 102px;text-align: -webkit-right;">';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="number" name="delivery" id="delivery' + j + '"  class="form-control deliveryinputcheck addingdelivery" data-sid = ' + workmast[0].ws_cus_name + ' data-re = ' + workmast[0].w_rmks + ' data-po = ' + workmast[0].pono + '  data-podt = ' + workmast[0].podtmilisecond + ' style="width: 72px;text-align: -webkit-right;">';
                        // result += '<input type="text" name="fr_cbm" value="'+value.fr_cbm+'" id="frcbms'+j+'" class="form-control" style="width: 112px;text-align: -webkit-right;"/>'
                        result += '</td>';
                        result += '</div>';
                        result += '</tr>';
                        glbidx = j;
                    });

                }
            }

            $('.delivery_repeat_row').html(result);

            if (ws_no != '') {
                if (workmast.length) {
                    $('#deliverysupport').modal('show');
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'No Pending Worksheet',
                        buttons: false,
                        timer: 1500
                    })
                }
            }

            $('.loader').hide();
        }

    });
});

$('body').on('input', '.addingdelivery', function () {
    var datasid = $(this).attr('data-sid');
    var datare = $(this).attr('data-re');
    var datapo = $(this).attr('data-po');
    var datapodtm = $(this).attr('data-podt');
    //alert(datare)
    $('#profarmaByer').val(datasid).trigger('change');
    $('#premarks').val(datare);
    $('#pro_pono').val(datapo);
    var date = Date(datapodtm);
    $('#podt').val(date.toDateString());
})

$(document).on("click", "#worksheet_entry", function () {
    var valid = '';

    $('.deliveryinputcheck').each(function () {
        if ($(this).val() != null && $(this).val() != '') {
            valid = true;
            $('#deliverysupport').modal('hide');
            return true;
        }
    })
    if (valid != true) {
        alert('Please add atleast one Delivery ');
        return false;
    }
    // alert("P")
    // $('#deliverysupport').modal('hide');
    $.ajax({
        type: 'GET',
        url: '/profarma/productname',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                // var result;
                var product = data['product'];
                var main_loop_id = 0;

                for (i = 1; i <= glbidx; i++) {
                    var delivery = $('#delivery' + i).val();
                    var w_pnameaid = $('#w_pnameaid' + i).val();
                    var inqtyb = $('#inqtyb' + i).val();
                    var perccbmc = $('#perccbmc' + i).val();
                    var orqtyd = $('#orqtyd' + i).val();
                    var wcoste = $('#wcoste' + i).val();
                    var wprofitf = $('#wprofitf' + i).val();
                    var wprofitamtg = $('#wprofitamtg' + i).val();
                    var wsellpriceh = $('#wsellpriceh' + i).val();
                    var wsellpriceDi = $('#wsellpriceDi' + i).val();
                    var boxpricedollerj = $('#boxpricedollerj' + i).val();
                    var wboxperCk = $('#wboxperCk' + i).val();
                    var perbxfrghtrsl = $('#perbxfrghtrsl' + i).val();
                    var wboxperFDm = $('#wboxperFDm' + i).val();
                    var wfinalbn = $('#wfinalbn' + i).val();
                    var wfinalco = $('#wfinalco' + i).val();
                    var wfobAmtp = $('#wfobAmtp' + i).val();
                    var wcnfAmtq = $('#wcnfAmtq' + i).val();
                    var totelcbmr = $('#totelcbmr' + i).val();
                    if (delivery > 0) {
                        var result;
                        $("#delivery").each(function (i, val) {
                            main_loop_id++;
                            result += '<tr class="delivery-wrapper" id="rohit' + main_loop_id + '">';
                            result += '<td>';
                            result += '<input type="hidden" name="pntr' + main_loop_id + '" value="' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')" id="cntr' + main_loop_id + '">';

                            result += '<select name="pro_forma_group[' + main_loop_id + '][item_name]"';
                            result += 'class="form-control selectproductfocus prbank productplace"';
                            result += 'style="width:162px" required onchange="getproduct(' + main_loop_id + ')" id="wpname' + main_loop_id + '" placeholder="Select Item">';
                            result += '<option value=""></option>';
                            for (p = 0; p < product.length; p++) {
                                if (w_pnameaid == product[p]['_id']) {
                                    result += "<option value='" + product[p]['_id'] + "' selected>" + product[p]['prdt_desc'] + "</option>";
                                } else {
                                    result += "<option value='" + product[p]['_id'] + "'>" + product[p]['prdt_desc'] + "</option>";
                                }
                            }
                            result += '</select>';
                            result += '</td>';
                            result += '<td id="innerqty' + main_loop_id + '">';
                            result += '<input type="text" value="' + inqtyb + '" name="pro_forma_group[' + main_loop_id + '][in_qty]" id="inqtypq' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width: 142px;text-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td id="cmblprt' + main_loop_id + '">';
                            result += '<input type="text" value="' + perccbmc + '" name="pro_forma_group[' + main_loop_id + '][perc_cbm]"';
                            result += 'id="percbmpq' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width: 135px;text-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td>';
                            result += '<input type="text" value="' + delivery + '" name="pro_forma_group[' + main_loop_id + '][or_qty]"';
                            result += 'id="orqtymn' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width: 179px;text-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td>';
                            result += '<input type="text" name="pro_forma_group[' + main_loop_id + '][cbm_perItem]"';
                            result += 'id="cbmperItem' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control "style="width:185px;text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';
                            result += '<td>';
                            result += '<input type="text"value="' + wfinalbn + '" name="pro_forma_group[' + main_loop_id + '][carton_price]"';
                            result += 'id="cartonPrice' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width:170px;text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';
                            result += '<td>';
                            result += '<input type="text" name="pro_forma_group[' + main_loop_id + '][total_amount]"';
                            result += 'id="totalAmount' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control " style="width:170px;text-align: -webkit-right;"';
                            result += ' amountfocus>';
                            result += '</td>';
                            if (main_loop_id != 1) {
                                result += "<td><a data-repeater-delete='inner-field-" + main_loop_id + "' data-brand-index='" + main_loop_id + "' class='delivery-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left: 32px;margin-top: 12px;'></i></a></td></tr>";
                            }

                            result += '</tr>';
                        });


                    }
                }
                $(".worksheet_repeat_row tbody tr").not('tr#contract_div').remove();
                $('tr#contract_div').before(result);
                calproforma(1);
            }

        }
    });
});

$(document).on("change.select2", "#outwardbyer", function () {
    // $(document).on("change.select2", "#br_code", function () {
    $("#delivery").show();
    $('.loader').show();
    var outwardbyer = $("#outwardbyer").val();

    $.ajax({
        type: 'GET',
        url: '/outward_challan/salesorder',
        dataType: 'json',
        data: {
            vouc_code: outwardbyer
        },
        success: function (data) {
            //alert(data)
            var i, j, result, sau;
            result = '';
            if (data['success'] == true) {
                var somast = data['somast'];
                j = -1;

                for (i = 0; i < somast.length; i++) {
                    var somastgroup = somast[i]['sales_or_group'];
                    $.each(somastgroup, function (index, value) {
                        j++;
                        result += '<tr>';
                        result += '<div id="delivery-' + index + '">';
                        result += '<td>';
                        if (value.so_disc != null) result += '<input type="hidden" value="' + value.so_disc._id + '" id="so_discaid' + j + '"/><input type="text" name="so_disc" value="' + value.so_disc.prdt_desc + '" id="so_disca' + j + '" class="form-control" style="text-align: -webkit-right;"/>';
                        else result += '<input type="text" name="so_disc"  id="so_disca' + j + '" class="form-control" style="text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td id="innerqtyso' + j + '">';
                        result += '<input type="text" value="' + value.order_price + '" name="order_price"oninput="calsalesorder(' + j + ')"';
                        result += 'id="inqtysob' + j + '"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += ' <td>';
                        result += '<input type="text" value="' + value.sopacper_carten + '" name="sopacper_carten"';
                        result += 'id="orqtysoc' + j + '" oninput="calsalesorder(' + j + ')"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '</td>';
                        result += '<td id="rateso' + j + '">';
                        result += '<input type="text" value="' + value.so_qty + '" name="so_qty"';
                        result += 'id="so_rated' + j + '" oninput="calsalesorder(' + j + ')"';
                        result += 'class="form-control "style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text"  value="' + value.so_discount + '" name="so_discount"';
                        result += 'id="so_discounte' + j + '" oninput="calsalesorder(' + j + ')"';
                        result += 'class="form-control" style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" value="' + value.total_amt + '" name="total_amt"';
                        result += 'id="total_amtf' + j + '" oninput="calsalesorder(' + j + ')"';
                        result += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                        result += ' amountfocus>';
                        result += '</td>';
                        result += '<td  style="display:none;">';
                        result += '<input type="hidden" value="' + somast[i]._id + '" name="sd2id"';
                        result += 'id="sd2idv' + j + '" oninput="calsalesorder(' + j + ')"';
                        result += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                        result += ' amountfocus>';
                        result += '</td>'
                        result += '<td  style="display:none;">';
                        result += '<input type="hidden" value="' + somast[i].sales_or_group[j]._id + '" name="sd2srno"';
                        result += 'id="sd2srnov' + j + '" oninput="calsalesorder(' + j + ')"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += ' amountfocus>';
                        result += '</td>';
                        result += '<td  style="display:none;">';
                        result += '<input type="hidden" value="' + value.so_div + '" name="so_div"';
                        result += 'id="so_div' + j + '" oninput="calsalesorder(' + j + ')"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += ' >';
                        result += '</td>';
                        result += '<td>';

                        result += '<input type="number" name="delivery" id="delivery' + j + '"  class="form-control deliveryinputcheck addingdeliverya"  data-re =" ' + somast[0].buy_rmks + '" data-po = "' + somast[0].buy_pono + '"  data-podt = "' + somast[0].buy_podtmilisecond + '" style="text-align: -webkit-right;">';
                        // result += '<input type="text" name="fr_cbm" value="'+value.fr_cbm+'" id="frcbms'+j+'" class="form-control" style="width: 112px;text-align: -webkit-right;"/>'
                        result += '</td>';
                        result += '<td>';

                        result += '<input type="number" name="pendqty" id="pendqtya' + j + '"  class="form-control "   style="text-align: -webkit-right;">';
                        // result += '<input type="text" name="fr_cbm" value="'+value.fr_cbm+'" id="frcbms'+j+'" class="form-control" style="width: 112px;text-align: -webkit-right;"/>'
                        result += '</td>';
                        result += '</div>';
                        result += '</tr>';
                        glbidx = j;
                        // alert("p")
                    });

                }

            }

            $('.so_repeat_row').html(result);

            if (outwardbyer != '') {
                //  alert(somast.length)  
                if (somast.length) {
                    $('#deliverysupport').modal('show');
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'No Pending Salesorder',
                        buttons: false,
                        timer: 1500
                    })
                }
            }

            $('.loader').hide();
        }
    })
})

$('body').on('input', '.addingdeliverya', function () {
    // var datasid = $(this).attr('data-sid');
    var datare = $(this).attr('data-re');
    var datapo = $(this).attr('data-po');
    var datapodt = $(this).attr('data-podt');
    // alert(datare)
    // alert(datapo)
    // alert(datapodt)
    // $('#outwardbyer').val(datasid).trigger('change');  
    $('#outwardremarks').val(datare);
    $('#out_pono').val(datapo);
    var date = Date(datapodt);
    //alert("p")
    $('#podt').val(date.toDateString());
})

$(document).on("click", "#salesorder_entry", function () {

    var valid = '';
    $('.deliveryinputcheck').each(function () {
        if ($(this).val() != null && $(this).val() != '') {
            valid = true;
            $('#deliverysupport').modal('hide');
            return true;
        }
    })
    if (valid != true) {
        alert('Please add atleast one Delivery ');
        return false;
    }

    // $('#deliverysupport').modal('hide');
    $.ajax({
        type: 'GET',
        url: '/outward_challan/productname',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                // var result;
                var product = data['product'];
                var main_loop_id = 0;

                for (i = 0; i <= glbidx; i++) {
                    var delivery = $('#delivery' + i).val();
                    var so_discaid = $('#so_discaid' + i).val();
                    var inqtysob = $('#inqtysob' + i).val();
                    var orqtysoc = $('#orqtysoc' + i).val();
                    var so_rated = $('#so_rated' + i).val();
                    var so_discounte = $('#so_discounte' + i).val();
                    var total_amtf = $('#total_amtf' + i).val();
                    var sd2ida = $('#sd2idv' + i).val();
                    var sd2srnoa = $('#sd2srnov' + i).val();
                    var pendqtyb = $('#pendqtya' + i).val();
                    // alert(sd2ida);
                    // alert(sd2srnoa);
                    var so_diva = $('#so_div' + i).val();
                    if (delivery > 0) {
                        var result;
                        $("#delivery").each(function (i, val) {
                            main_loop_id++;
                            result += '<tr class="delivery-wrapper" id="rohit' + main_loop_id + '">';
                            result += '<td>';
                            result += '<input type="hidden" name="outrn' + main_loop_id + '" value="' + main_loop_id + '" oninput="caloutward(' + main_loop_id + ')" id="outrn' + main_loop_id + '">';
                            result += '<input type="text" name="sales_or_group[' + main_loop_id + '][so_sno]"';
                            result += 'id="outitem_no' + main_loop_id + '" oninput="caloutward(' + main_loop_id + ')"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td>';
                            result += '<select name="sales_or_group[' + main_loop_id + '][so_disc]"';
                            result += 'class="form-control selectproductfocus prbank productplace"';
                            result += ' onchange="getoutward(' + main_loop_id + ')" id="outname' + main_loop_id + '" placeholder="Select Item">';
                            result += '<option value=""></option>';
                            for (p = 0; p < product.length; p++) {
                                if (so_discaid == product[p]['_id']) {
                                    result += "<option value='" + product[p]['_id'] + "' selected>" + product[p]['prdt_desc'] + "</option>";
                                } else {
                                    result += "<option value='" + product[p]['_id'] + "'>" + product[p]['prdt_desc'] + "</option>";
                                }
                            }
                            result += '</select>';
                            result += '</td>';
                            result += '<td id="innerqtyout' + main_loop_id + '">';
                            result += '<input type="text" value="' + orqtysoc + '" name="sales_or_group[' + main_loop_id + '][outin_qty]" id="inqtyout' + main_loop_id + '" oninput="caloutward(' + main_loop_id + ')"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td>';
                            result += '<input type="text" value="' + delivery + '" name="sales_or_group[' + main_loop_id + '][so_qty]"';
                            result += 'id="orqtyoc' + main_loop_id + '" oninput="caloutward(' + main_loop_id + ')"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td id="rateout' + main_loop_id + '">';
                            result += '<input type="text" value="' + so_rated + '" name="sales_or_group[' + main_loop_id + '][ocrate]"';
                            result += 'id="ocrate' + main_loop_id + '" oninput="caloutward(' + main_loop_id + ')"';
                            result += 'class="form-control "style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';
                            result += '<td>';
                            result += '<input type="text" value="' + so_discounte + '" name="sales_or_group[' + main_loop_id + '][so_discount]"';
                            result += 'id="ocdiscount' + main_loop_id + '" oninput="caloutward(' + main_loop_id + ')"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';
                            result += '<td>';
                            result += '<input type="text" value="' + total_amtf + '" name="sales_or_group[' + main_loop_id + '][total_amt]"';
                            result += 'id="octotalAmount' + main_loop_id + '" oninput="caloutward(' + main_loop_id + ')"';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += ' amountfocus>';
                            result += '</td>';
                            result += '<td  style="display:none;">';
                            result += '<input type="hidden" value="' + sd2ida + '" name="sales_or_group[' + main_loop_id + '][sd2id]"';
                            result += 'id="sd2ida' + main_loop_id + '" ';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += '>';
                            result += '</td>';
                            result += '<td style="display:none;">';
                            result += '<input type="hidden" value="' + sd2srnoa + '" name="sales_or_group[' + main_loop_id + '][sd2srno]"';
                            result += 'id="sd2srno' + main_loop_id + '" ';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += ' >';
                            result += '</td>';
                            result += '<td style="display:none;">';
                            result += '<input type="hidden" value="' + so_diva + '" name="sales_or_group[' + main_loop_id + '][so_div]"';
                            result += 'id="so_div' + main_loop_id + '" ';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += ' >';
                            result += '</td>';
                            result += '</td>';
                            result += '<td style="display:none;">';
                            result += '<input type="hidden" value="' + pendqtyb + '" name="sales_or_group[' + main_loop_id + '][pendqty]"';
                            result += 'id="pendqty' + main_loop_id + '" ';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += ' >';
                            result += '</td>';
                            if (main_loop_id != 1) {
                                result += "<td><a data-repeater-delete='inner-field-" + main_loop_id + "' data-brand-index='" + main_loop_id + "' class='delivery-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left: 32px;margin-top: 12px;'></i></a></td></tr>";
                            }

                            result += '</tr>';
                        });


                    }
                }
                $(".salesorder_repeat_row tbody tr").not('tr#contract_div').remove();
                $('tr#contract_div').before(result);
                caloutward(1);
            }
        }
    });
});

$(document).on("keyup", "#commer_no", function () {

    // $(document).on("change.select2", "#br_code", function () {
    $("#delivery").show();
    $('.loader').show();
    var so_no = $("#commer_no").val();
    $.ajax({
        type: 'GET',
        url: '/commercial/com_modal',
        dataType: 'json',
        data: {
            vouc_code: so_no
        },
        success: function (data) {
            // console.log(data);
            var i, j, result, sau;
            result = '';

            if (data['success'] == true) {
                var promast = data['promast'];
                j = 0;
                for (i = 0; i < promast.length; i++) {
                    var promastgroup = promast[i]['pro_forma_group'];
                    $.each(promastgroup, function (index, value) {
                        j++;
                        result += '<tr>';
                        result += '<div id="delivery-' + index + '">';
                        result += '<td>';
                        //    alert(value.item_name.prdt_desc)
                        if (value.item_name != null) result += '<input type="hidden" value="' + value.item_name._id + '" id="inamea' + j + '"/><input type="text" name="item_name" value="' + value.item_name.prdt_desc + '" id="inamea' + j + '" class="form-control" style="text-align: -webkit-right;"/>';
                        else result += '<input type="text" name="item_name"  id="inamea' + j + '" class="form-control" style="text-align: -webkit-right;"/>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" value="' + value.in_qty + '" name="in_qty"';
                        result += 'id="inqtypqb' + j + '"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += ' <td>';
                        result += '<input type="text" value="' + value.perc_cbm + '" name="perc_cbm"';
                        result += 'id="percbmpqc' + j + '" ';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '</td>';
                        result += '<td id="rateso' + j + '">';
                        result += '<input type="text" value="' + value.or_qty + '" name="or_qty"';
                        result += 'id="orqtymnd' + j + '"';
                        result += 'class="form-control "style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text"  value="' + value.cbm_perItem + '" name="cbm_perItem"';
                        result += 'id="cbmperIteme' + j + '" ';
                        result += 'class="form-control" style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" value="' + value.carton_price + '" name="carton_price"';
                        result += 'id="cartonPricef' + j + '" ';
                        result += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                        result += ' amountfocus>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="text" value="' + value.total_amount + '" name="total_amount"';
                        result += 'id="totalAmountg' + j + '"';
                        result += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                        result += ' amountfocus>';
                        result += '</td>';
                        result += '<td>';
                        result += '<input type="number" name="delivery" id="delivery' + j + '"  class="form-control deliveryinputcheck addingdeliveryb"   data-sid = ' + promast[0].pro_cus_name + ' data-re = ' + promast[0].pro_rmks + ' data-po = ' + promast[0].pro_pono + '  data-podt = ' + promast[0].pro_podt + ' style="text-align: -webkit-right;">';
                        // result += '<input type="text" name="fr_cbm" value="'+value.fr_cbm+'" id="frcbms'+j+'" class="form-control" style="width: 112px;text-align: -webkit-right;"/>'
                        result += '</td>';
                        result += '</div>';
                        result += '</tr>';
                        glbidx = j;
                    });

                }
            }
            $('.commercial_repete_row').html(result);
            if (so_no != '') {
                if (promast.length) {
                    $('#deliverysupport').modal('show');
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'No Pending Proforma',
                        buttons: false,
                        timer: 1500
                    })
                }
            }

            $('.loader').hide();
        }
    });
});

$('body').on('input', '.addingdeliveryb', function () {
    var datasid = $(this).attr('data-sid');
    var datare = $(this).attr('data-re');
    var datapo = $(this).attr('data-po');
    var datapodt = $(this).attr('data-podt');
    var date = Date(datapodt);

    $('#commercialbyyer').val(datasid).trigger('change');
    $('#commmarks').val(datare);
    $('#comm_pono').val(datapo);
    $('#podt').val(date.toDateString());
})

$(document).on("click", "#commercial_entry", function () {
    var valid = '';
    $('.deliveryinputcheck').each(function () {
        if ($(this).val() != null && $(this).val() != '') {
            valid = true;
            $('#deliverysupport').modal('hide');
            return true;
        }
    })
    if (valid != true) {
        alert('Please add atleast one Delivery ');
        return false;
    }

    // $('#deliverysupport').modal('hide');
    $.ajax({
        type: 'GET',
        url: '/commercial/productlist',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                // var result;
                var product = data['product'];
                StockUnit = data['StockUnit'];
                var main_loop_id = 0;

                for (i = 1; i <= glbidx; i++) {
                    var delivery = $('#delivery' + i).val();
                    var inamea = $('#inamea' + i).val();
                    var inqtypqb = $('#inqtypqb' + i).val();
                    var percbmpqc = $('#percbmpqc' + i).val();
                    var orqtymnd = $('#orqtymnd' + i).val();
                    var cbmperIteme = $('#cbmperIteme' + i).val();
                    var cartonPricef = $('#cartonPricef' + i).val();
                    var totalAmountg = $('#totalAmountg' + i).val();
                    var skunm = ""
                    if (delivery > 0) {
                        var result;
                        $("#delivery").each(function (i, val) {
                            main_loop_id++;
                            result += '<tr class="delivery-wrapper" id="rohit' + main_loop_id + '">';
                            result += '<td>';
                            result += '<input type="hidden" name="pntr' + main_loop_id + '" value="1" id="cntr' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width: 102px;text-align: -webkit-right;">';
                            result += '<select name="pro_forma_group[' + main_loop_id + '][item_name]" style="width:250px"';
                            result += 'class="form-control selectproductfocus prbank productplace select2"';
                            result += ' onchange="getproduct(' + main_loop_id + ')" id="wpname' + main_loop_id + '" placeholder="Select Item">';
                            result += '<option value=""></option>';
                            for (p = 0; p < product.length; p++) {
                                if (inamea == product[p]['_id']) {
                                    skunm = product[p]['sku_name'];
                                    result += "<option value='" + product[p]['_id'] + "' selected>" + product[p]['prdt_desc'] + "</option>";
                                } else {
                                    result += "<option value='" + product[p]['_id'] + "'>" + product[p]['prdt_desc'] + "</option>";
                                }
                            }
                            result += '</select>';
                            result += '</td>';
                            result += '<td id="innerqty' + main_loop_id + '">';
                            result += '<input type="text" value="' + inqtypqb + '" name="pro_forma_group[' + main_loop_id + '][in_qty]" id="inqtypq' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width: 142px;text-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td id="cmblprt' + main_loop_id + '">';
                            result += '<input type="text"   value="' + percbmpqc + '" name="pro_forma_group[' + main_loop_id + '][perc_cbm]"';
                            result += 'id="percbmpq' + main_loop_id + '"       oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width: 142px;ext-align: -webkit-right;">';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="text"  value="' + delivery + '" name="pro_forma_group[' + main_loop_id + '][or_qty]"';
                            result += 'id="orqtymn' + main_loop_id + '" oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width: 178px;text-align: -webkit-right;">';
                            result += '</td>';
                            result += '<td>';
                            result += '<input type="text" name="pro_forma_group[' + main_loop_id + '][batch_no]"';
                            result += 'id="batchno' + main_loop_id + '"        oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width: 142px;ext-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td >';
                            result += '<input type="text" name="pro_forma_group[' + main_loop_id + '][marks_and_no]"';
                            result += 'id="marksandno' + main_loop_id + '"    oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width: 142px;ext-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td><select  class="form-control " id="communit' + main_loop_id + '" name="pro_forma_group[' + main_loop_id + '][comm_unit]" class="form-control comm_unit" style="width: 142px;ext-align: -webkit-right;">';
                            for (j = 0; j < StockUnit.length; j++) {
                                // console.log(skunm);
                                if (skunm == StockUnit[j]['_id']) {
                                    result += "<option value='" + StockUnit[j]['_id'] + "' selected data-product_id='" + StockUnit[j]['_id'] + "'>" + StockUnit[j]['sku_name'] + "</option>";
                                } else {
                                    result += "<option value='" + StockUnit[j]['_id'] + "' data-product_id='" + StockUnit[j]['_id'] + "'>" + StockUnit[j]['sku_name'] + "</option>";
                                }
                            }
                            result += '</select></td>';

                            result += '<td>';
                            result += '<input type="text" value="' + cartonPricef + '" name="pro_forma_group[' + main_loop_id + '][carton_price]"';
                            result += 'id="cartonPrice' + main_loop_id + '"  oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control"  style="width:170px;text-align: -webkit-right;">';
                            result += '</td>';
                            result += '<td>';
                            result += '<input type="text" value="' + totalAmountg + '" name="pro_forma_group[' + main_loop_id + '][total_amount]"';
                            result += 'id="totalAmount' + main_loop_id + '"  oninput="calproforma(' + main_loop_id + ')"';
                            result += 'class="form-control" style="width:170px;text-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            if (main_loop_id != 1) {
                                result += "<td><a data-repeater-delete='inner-field-" + main_loop_id + "' data-brand-index='" + main_loop_id + "' class='delivery-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left: 32px;margin-top: 12px;'></i></a></td></tr>";
                            }

                            result += '</tr>';
                        });


                    }
                }
                $(".salesorder_repeat_row tbody tr").not('tr#contract_div').remove();
                $('tr#contract_div').before(result);
                calproforma(1);
            }
        }
    });
});

function printinvoice() {
    $("#hideprintbtn").hide()
    $("#scroll_hide").hide()
    window.print();
    setTimeout(function () {
        $("#hideprintbtn").show()
        $("#scroll_hide").show()
    }, 300);
}

function dsienvelpePrint() {
    $("#hideprintbtn").hide()
    $("#scroll_hide").hide()
    window.print();
    setTimeout(function () {
        $("#hideprintbtn").show()
        $("#scroll_hide").show()
    }, 300);
}

function callback(window, resultCallback) {
    alert("vikas");
}
function getShipParty() {
    var Ship_Party_id = $("#getShip_Party").val();
    console.log(Ship_Party_id)
    $.ajax({
        type: 'GET',
        url: '/domes_salesinvoice/Ship_Party_data',
        dataType: 'json',
        data: {
            Ship_Party_id: Ship_Party_id
        },
        success: function (data) {
            console.log(data)
            if (data['success'] == true) {
                var Ship_Party = data['Ship_Party']

                $("#Ship_party").val(Ship_Party.ACName)
                $("#Ship_party_gst").val(Ship_Party.GSTIN);
                $("#Ship_party_add").val(Ship_Party.Address1);
                $("#Ship_party_State").val(Ship_Party.StateName).trigger('change');
                $("#Ship_party_City").val(Ship_Party.CityName).trigger('change');
                // alert(Ship_Party.ac_name);
            }
        }
    });
}

function getsales() {
    // alert()
    $("#delivery").show();
    $('.loader').show();
    var party = $(".buy_cus_name").val();
    // if(party != ''){
    // alert(party)
    $.ajax({
        type: 'GET',
        url: '/domes_salesinvoice/salesorder',
        dataType: 'json',
        data: {
            party: party
        },
        success: function (data) {
            console.log(data)
            var i, j, result, sau;
            result = '';
            if (data['success'] == true) {
                var somast = data['somast'];
                j = 0;
                for (i = 0; i < somast.length; i++) {
                    var somastgroup = somast[i].sales_or_group;
                    console.log(somastgroup)
                    $.each(somastgroup, function (index, value) {
                        console.log(value.sopacper_carten);
                        j++;
                        result += '<tr>';
                        result += '<div id="delivery-' + index + '">';
                        result += '<td>';
                        if (value.so_fg_disc != null) result += '<input type="text" name="itemname" id="itemnameid' + j + '" value="' + value.so_fg_disc.Fg_Des + '" data-itemid="' + value.so_fg_disc._id + '" class="form-control" style="text-align: -webkit-right;" readonly="true">';
                        else result += '<input type="text" name="itemname" id="itemnameid' + j + '" value="" data-itemid="" class="form-control" style="text-align: -webkit-right;">';
                        result += '</td>'
                        //  if(value.so_sno!=null)result += '<input type="hidden" value="'+value.so_disc._id+'" id="outnamea'+j+'"/><input type="text" name="so_disc" value="'+value.so_disc.prdt_desc+'" id="outnamea234'+j+'" class="form-control" style="text-align: -webkit-right;"/>';
                        //  else result += '<input type="text" name="so_disc"  value="" id="outnamea'+j+'" class="form-control" style="text-align: -webkit-right;"/>';
                        //  result += '</td>';
                        //  result +=  '<td>';
                        //  result +=  '<input type="text" value="'+value.sopacper_carten+'" name="outin_qty"oninput="calsalesorder(' + j +')"';
                        //  result +=  'id="inqtyoutb' + j +'" readonly="true"';
                        //  result +=  'class="form-control " style="text-align: -webkit-right;"';
                        //  result +=  'required>';
                        result += ' <td>';
                        // orqtyocc
                        result += '<input type="text" value="' + value.so_qty + '" name="so_qty"';
                        result += 'id="orqtyocc' + j + '" oninput="calsalesorder(' + j + ')" readonly="true"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '<input type="hidden" value="' + value._id + '" name="sales_ord_grp_id" oninput="calsalesorder(' + j + ')"';
                        result += 'id="sales_ord_grp_id' + j + '"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += '>';
                        result += '<input type="hidden" value="' + somast[i]._id + '" name="sales_ord_id" oninput="calsalesorder(' + j + ')"';
                        result += 'id="sales_ord_id' + j + '"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += '>';
                        result += '</td>';

                        //  result +=  '<td>';
                        //  result +=  '<input type="text" value="'+value.order_price+'" name="ocrate"';
                        //  result +=  'id="ocrated' + j +'" oninput="calsalesorder(' + j +')" readonly="true"';
                        //  result +=  'class="form-control "style="text-align: -webkit-right;"';
                        //  result +=  'required>';
                        //  result +=  '</td>';

                        //  result +=  '<td>';
                        //  result +=  '<input type="text"  value="'+value.so_discount+'" name="so_discount" readonly="true"';
                        //  result +=  'id="ocdiscounte' + j +'" oninput="calsalesorder(' + j +')"';
                        //  result +=  'class="form-control" style="text-align: -webkit-right;"';
                        //  result +=  'required>';
                        //  result +=  '</td>'; 

                        //   result +=  '<td>';
                        //  result +=  '<input type="text" value="'+value.total_amt+'" name="total_amt" readonly="true"';
                        //  result +=  'id="octotalAmountf' + j +'" oninput="calsalesorder(' + j +')"';
                        //  result +=  'class="form-control amountfocus" style="text-align: -webkit-right;"';
                        //  result +=  ' amountfocus>';
                        //  result +=  '</td>';

                        result += '<td>';
                        result += '<input type="number" name="delivery" value="' + value.so_qty_blc + '" id="delivery' + j + '"  class="form-control deliveryinputcheck" data-pid="' + somast[0].buy_cus_name + '" data-re="' + somast[0].buy_rmks + '" data-po="' + somast[0].buy_pono + '"  data-podt="' + somast[0].buy_podt + '" style="text-align: -webkit-right;">';
                        // result += '<input type="text" name="fr_cbm" value="'+value.fr_cbm+'" id="frcbms'+j+'" class="form-control" style="width: 112px;text-align: -webkit-right;"/>'
                        result += '</td>';
                        result += '</div>';
                        result += '</tr>';
                        glbidx = j;
                    });
                }
            }
            $('.dsi_repeat_row').html(result);
            if (party != '') {
                if (somast.length) {
                    $('#deliverysupport').modal('show');
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'No Pending Salesorder',
                        buttons: false,
                        timer: 1500
                    })
                }
            }
            $('.loader').hide();
        }
    });
    calgst(1)
}

$(document).on("click", ".update-slord", function () {
    if ($(this).closest('form').valid()) {
        for (let i = 1; i <= countslloop; i++) {
            var sales_ord_grp_id = $('#sales_ord_grp_id' + i).val();
            var sales_ord_id = $('#sales_ord_id' + i).val();
            var orqtydsi = $('#orqtydsi' + i).val();
            var arr = { 'sales_ord_grp_id': sales_ord_grp_id, 'sales_ord_id': sales_ord_id, 'orqtydsi': orqtydsi }
            countsl.push(arr);
        }
        console.log(countsl)
        sal_ord = JSON.stringify(countsl)
        for (let j = 0; j < countsl.length; j++) {
            $.ajax({
                type: 'POST',
                url: '/domes_salesinvoice/update_sales_ord',
                dataType: 'json',
                data: { 'countsl': countsl[j] },
                success: function (data) {
                    console.log(data)
                    if (data['success'] == 'true') {

                    }
                }
            })
        }
    }
})

$(document).on("keydown", ".update-slord", function (e) {
    if (e.keyCode == 13) {
        if ($(this).closest('form').valid()) {
            // alert(sales_or_group)
            for (let i = 1; i <= countslloop; i++) {
                var sales_ord_grp_id = $('#sales_ord_grp_id' + i).val();
                var sales_ord_id = $('#sales_ord_id' + i).val();
                var orqtydsi = $('#orqtydsi' + i).val();
                var arr = { 'sales_ord_grp_id': sales_ord_grp_id, 'sales_ord_id': sales_ord_id, 'orqtydsi': orqtydsi }
                countsl.push(arr);
            }
            console.log(countsl)
            sal_ord = JSON.stringify(countsl)
            for (let j = 0; j < countsl.length; j++) {
                $.ajax({
                    type: 'POST',
                    url: '/domes_salesinvoice/update_sales_ord',
                    dataType: 'json',
                    data: { 'countsl': countsl[j] },
                    success: function (data) {
                        console.log(data)
                        if (data['success'] == 'true') {

                        }
                    }
                })
            }
        }
    }
})

$(document).on('click', '.delete_dsimast', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/domes_salesinvoice/' + id,
                success: function (response) {
                    if (response['success'] == 'true') {
                        $.ajax({
                            type: 'POST',
                            url: '/domes_salesinvoice/update_salesord2',
                            data: { slin_id: id },
                            success: function (response) {
                                if (response['success'] == 'true') {
                                    window.location.href = '/domes_salesinvoice/dsi_list';
                                }
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});

$(document).on("click", "#domesticsales_entry", function () {
    var valid = '';
    $('.deliveryinputcheck').each(function () {
        if ($(this).val() != null && $(this).val() != '') {
            valid = true;
            $('#deliverysupport').modal('hide');
            return true;
        }
    })
    if (valid != true) {
        alert('Please add atleast one Delivery ');
        return false;
    }
    $.ajax({
        type: 'GET',
        url: '/domes_salesinvoice/productname',
        dataType: 'json',
        success: function (data) {
            console.log(data)
            if (data['success']) {
                // var result;
                var product = data['product'];
                var main_loop_id = 0;
                var tot_taxvalue = 0;
                var datapodt = $("#delivery1").attr('data-podt');
                //var datehidden = Date(datapodt);
                var filterstartdate = moment(datapodt).tz("Asia/Kolkata").format('DD/MM/YYYY');
                var podt = '<input type="text" name="buy_podt" id="podt" class="form-control datemask"  value="' + filterstartdate + '"/>'

                $('.podtvvv').html(podt);
                // alert(glbidx)
                for (i = 1; i <= glbidx; i++) {
                    var delivery = $('#delivery' + i).val();
                    var itemnameid = $('#itemnameid' + i).attr('data-itemid');
                    // alert(itemnameid)inqtyoutb
                    // var inqtyoutb = $('#inqtyoutb' + i).val();
                    // var orqtyocc = $('#orqtyocc' + i).val();
                    // var ocrated = $('#ocrated' + i).val();
                    // var ocdiscounte = $('#ocdiscounte' + i).val();
                    var octotalAmountf = $('#octotalAmountf' + i).val();
                    var sales_ord_grp_id = $('#sales_ord_grp_id' + i).val();
                    var sales_ord_id = $('#sales_ord_id' + i).val();

                    if (delivery > 0) {
                        countslloop++;
                        var result;
                        $("#delivery").each(function (i, val) {
                            main_loop_id++;
                            result += '<tr class="delivery-wrapper" id="rohit' + main_loop_id + '">';
                            result += '<td>';
                            result += '<input type="hidden" name="dsirn" value="' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')" id="dsirn' + main_loop_id + '">';
                            // for (p = 0; p < product.length; p++) {
                            //     if (itemnameid == product[p]['_id']) {
                            //           result += '<input type="hidden" name="sales_or_group['+main_loop_id+'][so_div]" value="'+product[p]['prdtdiv_code'][0]+'" >';
                            //     }
                            // }


                            result += '<input type="text" name="sales_or_group[' + main_loop_id + '][so_sno]"';
                            result += 'id="dsiitem_no' + main_loop_id + '" value="' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += '/>';
                            result += '</td>';
                            result += '<td>';
                            result += '<select name="sales_or_group[' + main_loop_id + '][so_disc]"';
                            result += 'class="form-control selectproductfocus productplace"';
                            result += ' onchange="getdsi(' + main_loop_id + ')" id="dsiname' + main_loop_id + '" placeholder="Select Item">';
                            result += '<option value=""></option>';
                            // console.log(product)
                            for (p = 0; p < product.length; p++) {
                                if (itemnameid == product[p]['_id']) {
                                    result += "<option value='" + product[p]['_id'] + "' selected>" + product[p]['Fg_Des'] + "</option>";
                                } else {
                                    result += "<option value='" + product[p]['_id'] + "'>" + product[p]['Fg_Des'] + "</option>";
                                }
                            }
                            result += '</select>';
                            //    result += '</td>';
                            //    result += '<td id="innerqtydsi'+main_loop_id+'">';
                            //    result += '<input type="number" value="'+inqtyoutb+'" name="sales_or_group['+main_loop_id+'][outin_qty]" id="inqtydsi'+main_loop_id+'" oninput="caldsi('+main_loop_id+')"';
                            //    result += 'class="form-control" style="text-align: -webkit-right;"';
                            //    result += 'required/>';
                            //    result += '</td>';

                            result += '<td>';
                            result += '<input type="number" value="' + delivery + '" name="sales_or_group[' + main_loop_id + '][so_qty]"';
                            result += 'id="orqtydsi' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += 'required/>';
                            result += '<input type="hidden" value="' + sales_ord_grp_id + '" name="sales_or_group[' + main_loop_id + '][sales_ord_grp_id]" id="sales_ord_grp_id' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += 'required/>';
                            result += '<input type="hidden" value="' + sales_ord_id + '" name="sales_or_group[' + main_loop_id + '][sales_ord_id]" id="sales_ord_id' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += 'required/>';
                            result += '</td>';

                            result += '<td id="ratedsi' + main_loop_id + '">';
                            result += '<input type="number"  name="sales_or_group[' + main_loop_id + '][ocrate]"';
                            for (p = 0; p < product.length; p++) {
                                if (itemnameid == product[p]['_id']) {
                                    result += 'value="' + product[p]['Fg_SPrice'] + '"';
                                }
                            }
                            result += 'id="dsirate' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            result += 'class="form-control "style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';

                            result += '<td>';
                            if (main_loop_id == glbidx) {
                                result += '<input type="number" value="' + 0 + '" name="sales_or_group[' + main_loop_id + '][so_discount]"';
                                result += 'id="dsidiscount' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                                result += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                                result += 'required>';
                            } else {
                                result += '<input type="number" value="' + 0 + '" name="sales_or_group[' + main_loop_id + '][so_discount]"';
                                result += 'id="dsidiscount' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                                result += 'class="form-control" style="text-align: -webkit-right;"';
                                result += 'required>';
                            }

                            result += '<input type="hidden" name="sales_or_group[' + main_loop_id + '][so_gstrate]"';
                            result += 'id="so_gstrate' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            // result += 'class="form-control" style="text-align: -webkit-right;"';
                            for (p = 0; p < product.length; p++) {
                                if (itemnameid == product[p]['_id']) {
                                    if (product[p]['Fg_GstRate'] == null || product[p]['Fg_GstRate'] == undefined) {
                                        result += 'value="' + 18 + '" class="form-control" style="text-align: -webkit-right;"';
                                    } else {
                                        result += 'value="' + product[p]['Fg_GstRate'] + '" class="form-control" style="text-align: -webkit-right;"';
                                    }
                                }
                            }
                            result += '>';
                            result += '<input type="hidden" name="sales_or_group[' + main_loop_id + '][so_taxvalue]"';
                            result += 'id="so_taxvalue' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            // result += 'class="form-control" style="text-align: -webkit-right;"';
                            for (p = 0; p < product.length; p++) {
                                if (itemnameid == product[p]['_id']) {
                                    var taxvalue = product[p]['Fg_GstRate'] * octotalAmountf / 100;
                                    result += 'value="' + taxvalue + '" class="form-control" style="text-align: -webkit-right;"';
                                    tot_taxvalue = tot_taxvalue + taxvalue;
                                    $("#tot_taxvalue").val(tot_taxvalue);
                                }
                            }
                            result += '>';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="number" value="' + octotalAmountf + '" name="sales_or_group[' + main_loop_id + '][total_amt]"';
                            result += 'id="dsitotalAmount' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += ' readonly="true">';
                            result += '<input type="hidden" name="sales_or_group[' + main_loop_id + '][so_beforedisamt]"';
                            result += 'id="so_beforedisamt' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            result += '>';
                            result += '<input type="hidden" name="sales_or_group[' + main_loop_id + '][so_afttaxvalue]"';
                            result += 'id="so_afttaxvalue' + main_loop_id + '" oninput="caldsi(' + main_loop_id + ')"';
                            result += '>';
                            result += '</td>';
                            if (main_loop_id != 1) {
                                result += "<td><a data-repeater-delete='inner-field-" + main_loop_id + "' data-brand-index='" + main_loop_id + "' class='delivery-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left: 32px;margin-top: 12px;'></i></a></td></tr>";
                            }
                            result += '</tr>';
                        });
                    }
                }
                $(".productplace").select2({
                    placeholder: "Select Product",
                    allowClear: true,
                });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                $(".domes_invoice_repete_row tbody tr").not('tr#contract_div').remove();
                $('tr#contract_div').before(result);
                caldsi(1);
                calgst(1);
                // calsaleadd(1);
            }

        }
    });
});

function getpurord() {
    $("#deliverypor").show();
    var party = $(".buy_cus_name").val();
    $.ajax({
        type: 'GET',
        url: '/mrn_challan/purorder',
        dataType: 'json',
        data: {
            party: party
        },
        success: function (data) {
            console.log(data)
            var i, j, resultpo, sau;
            resultpo = '';
            if (data['success'] == true) {
                var somast = data['pomast'];
                console.log(somast)
                j = 0;
                for (i = 0; i < somast.length; i++) {
                    var somastgroup = somast[i].sales_or_group;
                    $.each(somastgroup, function (index, value) {
                        j++;
                        resultpo += '<tr>';
                        resultpo += '<div id="delivery-' + index + '">';
                        resultpo += '<td>';

                        if (value.so_disc != null) { console.log(value.so_disc.Rm_Des); resultpo += '<input type="text" name="itemname" id="itemnameid' + j + '" value="' + value.so_disc.Rm_Des + '" data-itemid="' + value.so_disc._id + '" class="form-control" style="text-align: -webkit-left; width: 400px" readonly="true">'; }
                        else resultpo += '<input type="text" name="itemname" id="itemnameid' + j + '" value="" data-itemid="" class="form-control" style="text-align: -webkit-right;">';
                        resultpo += '</td>';

                        resultpo += '<td>';
                        resultpo += '<input type="number" value="' + value.order_price + '" name="ocrate"';
                        resultpo += 'id="ocrated' + j + '" oninput="calsalesorder(' + j + ')" readonly="true"';
                        resultpo += 'class="form-control "style="text-align: -webkit-right;"';
                        resultpo += 'required>';
                        resultpo += '<input type="hidden" value="' + value._id + '" name="pur_ord_grp_id" oninput="calsalesorder(' + j + ')"';
                        resultpo += 'id="pur_ord_grp_id' + j + '"';
                        resultpo += 'class="form-control " style="text-align: -webkit-right;"';
                        resultpo += '>';
                        resultpo += '<input type="hidden" value="' + somast[i]._id + '" name="pur_ord_id" oninput="calsalesorder(' + j + ')"';
                        resultpo += 'id="pur_ord_id' + j + '"';
                        resultpo += 'class="form-control " style="text-align: -webkit-right;"';
                        resultpo += '>';
                        resultpo += '</td>';

                        resultpo += '<td>';
                        resultpo += '<input type="number" value="' + value.so_qty + '" name="so_qty"';
                        resultpo += 'id="orqtyocc' + j + '" oninput="calsalesorder(' + j + ')" readonly="true"';
                        resultpo += 'class="form-control " style="text-align: -webkit-right;"';
                        resultpo += 'required>';
                        resultpo += '</td>';

                        resultpo += '<td>';
                        resultpo += '<input type="number"  value="' + value.so_discount + '" name="so_discount" readonly="true"';
                        resultpo += 'id="ocdiscounte' + j + '" oninput="calsalesorder(' + j + ')"';
                        resultpo += 'class="form-control" style="text-align: -webkit-right;"';
                        resultpo += 'required>';
                        resultpo += '</td>';

                        resultpo += '<td>';
                        resultpo += '<input type="number" value="' + value.total_amt + '" name="total_amt" readonly="true"';
                        resultpo += 'id="octotalAmountf' + j + '" oninput="calsalesorder(' + j + ')"';
                        resultpo += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                        resultpo += ' amountfocus>';
                        resultpo += '</td>';

                        resultpo += '<td>';
                        resultpo += '<input type="number" name="delivery" value="' + value.po_qty_blc + '" id="delivery' + j + '"  class="form-control deliveryinputcheck" data-pid="' + somast[0].buy_cus_name + '" data-re="' + somast[0].buy_rmks + '" data-po="' + somast[0].buy_pono + '"  data-podt="' + somast[0].buy_podt + '" style="text-align: -webkit-right;">';
                        // resultpo += '<input type="text" name="fr_cbm" value="'+value.fr_cbm+'" id="frcbms'+j+'" class="form-control" style="width: 112px;text-align: -webkit-right;"/>'
                        resultpo += '</td>';
                        resultpo += '</div>';
                        resultpo += '</tr>';
                        glbidx = j;
                    });

                }
            }
            $('.por_repeat_row').html(resultpo);
            if (party != '') {
                if (somast.length) {
                    $('#deliverysupportpor').modal('show');
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'No Pending Purchase order',
                        buttons: false,
                        timer: 1500
                    })
                }
            }
            $('.loader').hide();
        }
    });
}

$(document).on("click", ".update-porord", function () {
    if ($(this).closest('form').valid()) {
        for (let i = 1; i <= countslloop; i++) {
            var pur_ord_grp_id = $('#pur_ord_grp_id' + i).val();
            var pur_ord_id = $('#pur_ord_id' + i).val();
            var so_qty = $('#so_qty' + i).val();
            var arr = { 'pur_ord_grp_id': pur_ord_grp_id, 'pur_ord_id': pur_ord_id, 'so_qty': so_qty }
            countsl.push(arr);
        }
        console.log(countsl)
        sal_ord = JSON.stringify(countsl)
        for (let j = 0; j < countsl.length; j++) {
            // alert(j)
            $.ajax({
                type: 'POST',
                url: '/mrn_challan/update_pur_ord',
                dataType: 'json',
                data: { 'countsl': countsl[j] },
                success: function (data) {
                    console.log(data)
                    if (data['success'] == 'true') {

                    }
                }
            })
        }
    }
})
$(document).on("keydown", ".update-porord", function (e) {
    if (e.keyCode == 13) {
        if ($(this).closest('form').valid()) {
            for (let i = 1; i <= countslloop; i++) {
                var pur_ord_grp_id = $('#pur_ord_grp_id' + i).val();
                var pur_ord_id = $('#pur_ord_id' + i).val();
                var so_qty = $('#so_qty' + i).val();
                var arr = { 'pur_ord_grp_id': pur_ord_grp_id, 'pur_ord_id': pur_ord_id, 'so_qty': so_qty }
                countsl.push(arr);
            }
            console.log(countsl)
            sal_ord = JSON.stringify(countsl)
            for (let j = 0; j < countsl.length; j++) {
                // alert(j)
                $.ajax({
                    type: 'POST',
                    url: '/mrn_challan/update_pur_ord',
                    dataType: 'json',
                    data: { 'countsl': countsl[j] },
                    success: function (data) {
                        console.log(data)
                        if (data['success'] == 'true') {

                        }
                    }
                })
            }
        }
    }
})
$(document).on('click', '.delete_pomast', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/mrn_challan/' + id,
                success: function (response) {
                    if (response['success'] == 'true') {
                        $.ajax({
                            type: 'POST',
                            url: '/mrn_challan/update_purord2',
                            data: { slin_id: id },
                            success: function (response) {
                                if (response['success'] == 'true') {
                                    window.location.href = '/mrn_challan/mrn_list_mast';
                                }
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
$(document).on("click", "#domesticpor_entry", function () {
    var valid = '';
    $('.deliveryinputcheck').each(function () {
        if ($(this).val() != null && $(this).val() != '') {
            valid = true;
            $('#deliverysupportpor').modal('hide');
            return true;
        }
    })
    if (valid != true) {
        alert('Please add atleast one Delivery');
        return false;
    }
    $.ajax({
        type: 'GET',
        url: '/mrn_challan/productname',
        dataType: 'json',
        success: function (data) {
            console.log(data)
            if (data['success']) {
                // var result;
                var product = data['product'];
                var main_loop_id = 0;
                var datapodt = $("#delivery1").attr('data-podt');
                // console.log(datapodt);
                //var datehidden = Date(datapodt);
                var filterstartdate = moment(datapodt).tz("Asia/Kolkata").format('DD/MM/YYYY');
                // console.log(filterstartdate)
                // var podt = '<input type="text" name="buy_podt" id="podt" class="form-control datemask"  value="'+filterstartdate+'"/>'
                // $('.podtvvv').html(podt);
                // alert(glbidx)
                main_loop_id = -1;
                for (i = 0; i <= glbidx; i++) {
                    var delivery = $('#delivery' + i).val();
                    var itemnameid = $('#itemnameid' + i).attr('data-itemid');
                    // alert(itemnameid)inqtyoutb
                    var ocrated = $('#ocrated' + i).val();
                    var ocdiscounte = $('#ocdiscounte' + i).val();
                    var octotalAmountf = $('#octotalAmountf' + i).val();
                    var pur_ord_grp_id = $('#pur_ord_grp_id' + i).val();
                    var pur_ord_id = $('#pur_ord_id' + i).val();
                    console.log(itemnameid, ocrated, delivery, ocdiscounte, octotalAmountf);
                    if (delivery > 0) {
                        countslloop++;
                        console.log('vikas')
                        var result;
                        // $("#delivery").each(function (i, val) {
                        main_loop_id++;
                        result += '<tr class="delivery-wrapper" id="rohit' + main_loop_id + '">';
                        result += '<td>';
                        result += '<input type="hidden" name="buyrn" value="' + main_loop_id + '" oninput="calsalesorder(' + main_loop_id + ')" id="buyrn' + main_loop_id + '">';

                        result += '<select name="sales_or_group[' + main_loop_id + '][so_disc]"';
                        result += 'class="form-control selectproductfocus productplace"';
                        result += ' onchange="getpriMrn(' + main_loop_id + ')" id="descpso' + main_loop_id + '" placeholder="Select Item">';
                        result += '<option value=""></option>';
                        for (p = 0; p < product.length; p++) {
                            if (itemnameid == product[p]['_id']) {
                                result += "<option value='" + product[p]['_id'] + "' selected>" + product[p]['Rm_Des'] + "</option>";
                            } else {
                                result += "<option value='" + product[p]['_id'] + "'>" + product[p]['Rm_Des'] + "</option>";
                            }
                        }
                        result += '</select>';
                        result += '</td>';

                        result += '<td id="orderpriceso' + main_loop_id + '">';
                        result += '<input type="number"  name="sales_or_group[' + main_loop_id + '][order_price]"';
                        result += 'value="' + ocrated + '" id="orderprice' + main_loop_id + '"';
                        result += 'oninput="calsalesorder(' + main_loop_id + ')"';
                        result += 'class="form-control "style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '</td>';

                        result += '<td>';
                        result += '<input type="number" value="' + delivery + '" name="sales_or_group[' + main_loop_id + '][so_qty]"';
                        result += 'id="so_qty' + main_loop_id + '" oninput="calsalesorder(' + main_loop_id + ')"';
                        result += 'class="form-control" style="text-align: -webkit-right;"';
                        result += 'required/>';
                        result += '<input type="hidden" value="' + pur_ord_grp_id + '" name="sales_or_group[' + main_loop_id + '][pur_ord_grp_id]" id="pur_ord_grp_id' + main_loop_id + '" oninput="calsalesorder(' + main_loop_id + ')"';
                        result += 'class="form-control" style="text-align: -webkit-right;"';
                        result += '/>';
                        result += '<input type="hidden" value="' + pur_ord_id + '" name="sales_or_group[' + main_loop_id + '][pur_ord_id]" id="pur_ord_id' + main_loop_id + '" oninput="calsalesorder(' + main_loop_id + ')"';
                        result += 'class="form-control" style="text-align: -webkit-right;"';
                        result += '/>';
                        result += '</td>';
                        var aa = glbidx;
                        if (main_loop_id == (aa - 1)) {
                            result += '<td>';
                            result += '<input type="number" value="' + ocdiscounte + '" name="sales_or_group[' + main_loop_id + '][so_discount]"';
                            result += 'id="so_discount' + main_loop_id + '" oninput="calsalesorder(' + main_loop_id + ')"';
                            result += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';
                        } else {
                            result += '<td>';
                            result += '<input type="number" value="' + ocdiscounte + '" name="sales_or_group[' + main_loop_id + '][so_discount]"';
                            result += 'id="so_discount' + main_loop_id + '" oninput="calsalesorder(' + main_loop_id + ')"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';
                        }

                        result += '<td>';
                        result += '<input type="number" value="' + parseFloat(octotalAmountf).toFixed(2) + '" name="sales_or_group[' + main_loop_id + '][total_amt]"';
                        result += 'id="total_amt' + main_loop_id + '" oninput="calsalesorder(' + main_loop_id + ')"';
                        result += 'class="form-control"';
                        result += 'readonly="true">';
                        result += '<input type="hidden" name="sales_or_group[' + main_loop_id + '][total_amt_before]"';
                        result += 'id="total_amt_before' + main_loop_id + '" oninput="calsalesorder(' + main_loop_id + ')"';
                        result += '>';
                        result += '</td>';
                        if (main_loop_id != 1) {
                            result += "<td><a data-repeater-delete='inner-field-" + main_loop_id + "' data-brand-index='" + main_loop_id + "' class='delivery-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left: 32px;margin-top: 12px;'></i></a></td>";
                        }
                        result += '</tr>';
                        // });
                    }
                }
                $('#so_discount' + main_loop_id).addClass('amountfocus');

                $(".productplace").select2({
                    placeholder: "Select Product",
                    allowClear: true,
                });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                $(".mrn_por_repete_row tbody tr").not('tr#contract_div_po').remove();
                $('tr#contract_div_po').before(result);
                calsalesorder(1);
                // calgst(1);
            }

        }
    });
});


$(document).on("click", ".worksheet_delete_btn", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    var parent_id = $(this).closest('.worksheet_row-' + brandIndex).prop('id');
    $("#" + parent_id).remove();
    calc(1);
});
$(document).on("click", ".proforma_delete_btn", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    var parent_id = $(this).closest('.proforma_row-' + brandIndex).prop('id');
    $("#" + parent_id).remove();
    calproforma(1);
});
$(document).on("click", ".salesorder_delete_btn", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-bran-index');
    var parent_id = $(this).closest('.salesorder_row-' + brandIndex).prop('id');
    $("#" + parent_id).remove();
    calsalesorder(1);
})
$(document).on("click", ".salesorder_delete_btnadd", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    // alert(brandIndex)
    var parent_id = $(this).closest('.salesorder_rowadd-' + brandIndex).prop('id');
    $("#" + parent_id).remove();
    calsalesorder(1);
});
$(document).on("click", ".salesorder_delete_btnless", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    // alert(brandIndex)
    var parent_id = $(this).closest('.salesorder_rowless-' + brandIndex).prop('id');
    $("#" + parent_id).remove();
    calsalesorder(1);
});
$(document).on("click", ".outwards_delete_btn", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    //alert(brandIndex)
    var parent_id = $(this).closest('.outwards_row-' + brandIndex).prop('id');
    // alert(parent_id)
    $("#" + parent_id).remove();
    caloutward(1);
});
$(document).on("click", ".outwards_delete_btnadd", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    //alert(brandIndex)
    var parent_id = $(this).closest('.outwards_rowadd-' + brandIndex).prop('id');
    // alert(parent_id)
    $("#" + parent_id).remove();
    caloutward(1);
});
$(document).on("click", ".outwards_delete_btnless", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    //alert(brandIndex)
    var parent_id = $(this).closest('.outwards_rowless-' + brandIndex).prop('id');
    // alert(parent_id)
    $("#" + parent_id).remove();
    caloutward(1);
});
$(document).on("click", ".outwards_delete_btn", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    //alert(brandIndex)
    var parent_id = $(this).closest('.outwards_row-' + brandIndex).prop('id');
    // alert(parent_id)
    $("#" + parent_id).remove();
    caloutward(1);
});
$(document).on("click", ".domestic_delete_btn", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    //alert(brandIndex)
    var parent_id = $(this).closest('.domestic_row-' + brandIndex).prop('id');
    // alert(parent_id)
    $("#" + parent_id).remove();
    caldsi(1);
});
$(document).on("click", ".domestic_delete_btnadd", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    //alert(brandIndex)
    var parent_id = $(this).closest('.domestic_rowadd-' + brandIndex).prop('id');
    // alert(parent_id)
    $("#" + parent_id).remove();
    caldsi(1);
    calsaleadd(1);
});
$(document).on("click", ".domestic_delete_btnless", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    //alert(brandIndex)
    var parent_id = $(this).closest('.domestic_rowless-' + brandIndex).prop('id');
    // alert(parent_id)
    $("#" + parent_id).remove();
    caldsi(1);
    calsaleadd(1);
});
$(document).on("click", ".cashbank_delete_btn", function () {
    alert('Are you sure you want to delete this element');
    var brandIndex = $(this).attr('data-brand-index');
    //alert(brandIndex)
    var parent_id = $(this).closest('.cashbank_row-' + brandIndex).prop('id');
    // alert(parent_id)
    $("#" + parent_id).remove();
    calcashbank(1);
});
//Add Detals
var sd = 0;
var member = sd + 1;
var limit = 1000;

$(document).on("click", ".addmrndetails", function () {

    lstidx = $("input[name*='saleadd']").length + 1;
    lstidx = $("input[name*='saleadd']").length + 1;
    var values = $("input[name='saleadd']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    if (idx == undefined || idx == null) idx = 0;
    lstidx = parseInt(idx) + 1
    member = lstidx;
    if (s == limit) {
        alert("You have reached the limit of adding " + sd + " inputs");
    } else {
        var new_div = document.createElement('div');
        new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
        new_div += '<td>';
        new_div += '<input type="hidden" name="saleadd" value="' + lstidx + '" id="saleadd' + lstidx + '" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
        new_div += '<input type="text" name="add_details[' + lstidx + '][particular_add]" id="addparticular' + lstidx + '" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control" style="text-align: -webkit-left;"';
        new_div += '/>';
        new_div += '</td>';
        new_div += '<td>';
        new_div += '<input type="text" name="add_details[' + lstidx + '][particular_amount]"';
        new_div += 'id="AmountParticular' + lstidx + '" value="0" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control  amountfocus" style="text-align: -webkit-right;"';
        new_div += '/>';
        new_div += '</td>';
        new_div += "<td> <a data-repeater-delete='inner-field-" + lstidx + "' data-brand-index='" + member + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
        $(new_div).insertBefore("#prabal_div");
        sd++;
        lstidx--;
        member++;


        $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
    }
})

$(document).on("click", ".lessmrndetails", function () {
    //  lstidx = $("input[name*='saleless']").length + 1;
    lstidx = $("input[name*='saleless']").length + 1;
    var values = $("input[name='saleless']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    if (idx == undefined || idx == null) idx = 0;
    lstidx = parseInt(idx) + 1;
    member = lstidx;
    if (s == limit) {
        alert("You have reached the limit of adding " + sd + " inputs");
    } else {
        ;

        var new_div = document.createElement('div');
        new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
        new_div += '<td>';
        new_div += '<input type="hidden" name="saleless" value="' + lstidx + '" id="saleless' + lstidx + '" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
        new_div += '<input type="text" name="less_details[' + lstidx + '][particular_less]" id="lessparticular' + lstidx + '" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control" style="text-align: -webkit-left;"';
        new_div += '/>';
        new_div += '</td>';
        new_div += '<td>';
        new_div += '<input type="text" name="less_details[' + lstidx + '][particular_amtless]"';
        new_div += 'id="lessamtParticular' + lstidx + '"  value="0" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control  amountfocus" style="text-align: -webkit-right;"';
        new_div += '/>';
        new_div += '</td>';
        new_div += "<td> <a data-repeater-delete='inner-field-" + lstidx + "' data-brand-index='" + member + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
        $(new_div).insertBefore("#vipul_div");
        s++;
        lstidx--;
        member++;

        $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
    }
})

$(document).on("click", ".addsaledetails", function () {

    lstidx = $("input[name*='saleadd']").length + 1;
    var values = $("input[name='saleadd']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    if (idx == undefined || idx == null) idx = 0;
    lstidx = parseInt(idx) + 1
    member = lstidx;
    if (s == limit) {
        alert("You have reached the limit of adding " + sd + " inputs");
    } else {
        var new_div = document.createElement('div');
        new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
        new_div += '<td>';
        new_div += '<input type="hidden" name="saleadd" value="' + lstidx + '" id="saleadd' + lstidx + '" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
        new_div += '<input type="text" name="add_details[' + lstidx + '][particular_add]" id="addparticular' + lstidx + '" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control" style="text-align: -webkit-left;"';
        new_div += '/>';
        new_div += '</td>';
        new_div += '<td>';
        new_div += '<input type="text" name="add_details[' + lstidx + '][particular_amount]"';
        new_div += 'id="AmountParticular' + lstidx + '" value="0" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control  amountfocus" style="text-align: -webkit-right;"';
        new_div += '/>';
        new_div += '</td>';
        new_div += "<td> <a data-repeater-delete='inner-field-" + lstidx + "' data-brand-index='" + member + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
        $(new_div).insertBefore("#prabal_div");
        sd++;
        lstidx--;
        member++;


        $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
    }
})

$(document).on("click", ".lesssaledetails", function () {
    // lstidx = $("input[name*='saleless']").length + 1;
    lstidx = $("input[name*='saleless']").length + 1;
    var values = $("input[name='saleless']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    if (idx == undefined || idx == null) idx = 0;
    lstidx = parseInt(idx) + 1;
    member = lstidx;
    if (s == limit) {
        alert("You have reached the limit of adding " + sd + " inputs");
    } else {
        ;

        var new_div = document.createElement('div');
        new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
        new_div += '<td>';
        new_div += '<input type="hidden" name="saleless" value="1" id="saleless' + lstidx + '" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
        new_div += '<input type="text" name="less_details[' + lstidx + '][particular_less]" id="lessparticular' + lstidx + '" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control" style="text-align: -webkit-left;"';
        new_div += '/>';
        new_div += '</td>';
        new_div += '<td>';
        new_div += '<input type="text" name="less_details[' + lstidx + '][particular_amtless]"';
        new_div += 'id="lessamtParticular' + lstidx + '"  value="0" oninput="calsaleadd(' + lstidx + ')"';
        new_div += 'class="form-control  amountfocus" style="text-align: -webkit-right;"';
        new_div += '/>';
        new_div += '</td>';
        new_div += "<td> <a data-repeater-delete='inner-field-" + lstidx + "' data-brand-index='" + member + "' class='contract-delete-btn' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
        $(new_div).insertBefore("#vipul_div");
        s++;
        lstidx--;
        member++;

        $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
    }
})
function remove_cashbank(id) {
    // alert(id)
    // alert(id);
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $.ajax({
                type: 'DELETE',
                url: '/cash_bank/' + id,
                success: function (response) {
                    // $('.loader').hide();
                    $("#rohit" + id).remove();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
}

$(document).ready(function () {
    $(".prabal").focus(function () {
        //   alert("hh")
        document.getElementById("cashremark1").focus();
    });
});



// Apmc ##############################################################################################################################################
// Garu Aavak Entry Start
$('body').on('keydown', '.addgarufocus', function (e) {
    var tr = $(this).parents('tr').index();
    if (e.keyCode == 13) {
        var answer = true; //confirm('Do you want to add new Row?')
        if (answer) {
            $('#addgaru').trigger('click');
        } else { $('.delv_load').focus(); }
        // alert()
        var values = $("input[name='lotno']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1]
        var lotno = idx;
        // alert(lotno)
        setTimeout(function () {
            $('.addgaru tr:nth-child(' + (tr + 3) + ')').find('.selectproductfocus').focus();
            var values = $("input[name='dsirn']")
                .map(function () { return $(this).val(); }).get();
            var idx = values[values.length - 1]
            lstidx = parseInt(idx);
            $('#lot_No' + lstidx).val(parseInt(lotno) + 1)
            $('#lotno' + lstidx).val(parseInt(lotno) + 1)
        }, 150);
    }
});
$('body').on('keydown', '.addgarufocusOnRate', function (e) {
    // var tr = $(this).parents('tr').index();
    // if (e.keyCode == 13) {
    //     var answer = true; //confirm('Do you want to add new Row?')
    //     if(answer){
    //         $('#addgaru').trigger('click');
    //     }else{$('.delv_load').focus();}
    //     // alert()
    //     var values = $("input[name='lotno']")
    //           .map(function(){return $(this).val();}).get();
    //     var idx = values[values.length-1]
    //     var lotno = idx;
    //     // alert(lotno)
    //     setTimeout(function(){ 
    //         $('.addgaru tr:nth-child('+ (tr+4) +')').find('.selectproductfocus').focus(); 
    //         var values = $("input[name='dsirn']")
    //           .map(function(){return $(this).val();}).get();
    //         var idx = values[values.length-1]
    //         lstidx = parseInt(idx);
    //         $('#lot_No'+lstidx).val(parseInt(lotno)+1)
    //         $('#lotno'+lstidx).val(parseInt(lotno)+1)
    //     }, 150);
    // }
});
function focusOnIntrest(e, idx) {
    if (e.keyCode == 13) {
        e.preventDefault();
        setTimeout(function () { $('#entry_Tax' + idx).focus() }, 100);
    }
}
function GaruEsc(index, e) {
    if (e.keyCode == 27) {
        $('#GaruTr0' + index).remove();
        $('#GaruTr1' + index).remove();
        $('#GaruTr2' + index).remove();
        $('#GaruTr3' + index).remove();
        $(".delv_load").focus();
        CalRoundOff()
    }
}

function deleteGaruGroupEntry(i) {
    lstidx = $("input[name*='dsirn']").length
    var a = confirm('Are You Want To Delete It');
    if (a == true && lstidx > 1) {
        // $('#lot_No'+(i+1)).val($('#lot_No'+i).val());
        // $('#lotno'+(i+1)).val($('#lotno'+i).val());
        $('#GaruTr0' + i).remove();
        $('#GaruTr1' + i).remove();
        $('#GaruTr2' + i).remove();
        $('#GaruTr3' + i).remove();
        $("#gdn_Cd_Name" + (i - 1)).focus();
        CalGaruAvakEntry();
    }
}

var v = 1;
var memberp = v + 1;
var limitp = 1000;
$(document).on('click', '.addGaruEntry', function () {
    lstidx = $("input[name*='dsirn']").length + 1;
    var values = $("input[name='dsirn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    memberp = lstidx;
    $('#rate' + idx).removeClass('addgarufocusOnRate');
    $('#dana_Rt' + idx).removeClass('addgarufocus');
    $.ajax({
        type: 'Get',
        url: '/Garu_Aavak_Entry/productname',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                var product = data['product'];
                var gowdown = data['gowdown'];
                var account_masters = data['account_masters'];
                var newHtml = '';
                newHtml += '<tr id="GaruTr0' + lstidx + '">';
                // newHtml += '<td colspan="10" style="background-color:#4b77be">&nbsp;</td>';
                newHtml += '</tr>';
                newHtml += '<tr id="GaruTr1' + lstidx + '">';
                newHtml += '<td>';
                // newHtml += '<strong>Gdn-Cd</strong>';
                newHtml += '<input type="hidden" name="dsirn" value="' + lstidx + '" id="dsirn' + lstidx + '">';
                //    newHtml +='<input type="text" name="garu_Aavak_Group['+lstidx+'][gdn_Cd_Name]" id="gdn_Cd_Name'+lstidx+'" '; 
                //    newHtml +=' class="form-control " style="text-align: -webkit-right;"  placeholder="Gdn-Cd"/>';
                newHtml += '<select  name="garu_Aavak_Group[' + lstidx + '][gdn_Cd_Name]"id="gdn_Cd_Name' + lstidx + '"  class="form-control  prbank productitem" style="width:100%"';
                newHtml += 'placeholder="Select">';
                for (let i = 0; i < gowdown.length; i++) {
                    newHtml += '<option value="' + gowdown[i]['_id'] + '">' + gowdown[i]['Description'] + '</option>';
                }
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                // newHtml += '<strong>Lot No</strong>';
                newHtml += '<input type="hidden" name="lotno" id="lotno' + lstidx + '">';
                newHtml += '<input type="text" name="garu_Aavak_Group[' + lstidx + '][lot_No]"  id="lot_No' + lstidx + '" class="form-control selectproductfocus" style="text-align: -webkit-right;" placeholder="Lot No" oninput="getLot(' + lstidx + ')" onkeydown="GaruEsc(' + lstidx + ',event)"/>';
                newHtml += '</td>';
                newHtml += '<td colspan="3">';
                // newHtml += '<strong>Item Cd</strong>';
                newHtml += '<select  name="garu_Aavak_Group[' + lstidx + '][item_Code_Desc]" id="item_Code_Desc' + lstidx + '"  class="form-control prbank ItenCodeName" onchange="getItemData(' + lstidx + ')" style="width:100%"';
                newHtml += 'placeholder="Select Product" style="width: 100%">';
                newHtml += '<option value=""></option>';
                // for (let i = 0; i < product.length; i++)
                // {
                //     newHtml += '<option value="'+product[i]['_id']+'">'+product[i]['Fg_Des']+'</option>';
                // }
                newHtml += '</select>';
                // newHtml += '<input type="hidden" id="purchase_Ac_Title_Name' + lstidx + '" name="garu_Aavak_Group[' + lstidx + '][purchase_Ac_Title_Name]">';
                newHtml += '</td>';

                newHtml +='<td>'
                // newHtml +='<strong>Brand</strong>'
                newHtml += '<select name = "garu_Aavak_Group[' + lstidx + '][brand]" id = "brand' + lstidx + '" class="form-control prbank brandName" style = "width:100%" placeholder = "Select Product" style = "width: 100%" ><option value=""></option></select >'
                newHtml +='</td>'
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Purchase Ac Title</strong>';
                // //    newHtml +='<input type="text" name="garu_Aavak_Group['+lstidx+'][purchase_Ac_Title]" placeholder="Purchase Ac Title"  id="purchase_Ac_Title'+lstidx+'" class="form-control" style="text-align: -webkit-right;" />';
                // newHtml += '<select  name="garu_Aavak_Group[' + lstidx + '][purchase_Ac_Title]"id="purchase_Ac_Title' + lstidx + '"  class="form-control  prbank PurAcInSaleEntry" style="width:100%"';
                // newHtml += 'placeholder="Select Product" style="width: 100%">';
                // newHtml += '<option value=""></option>';
                // // for (let i = 0; i < account_masters.length; i++)
                // // {
                // //     newHtml += '<option value="'+account_masters[i]['_id']+'">'+account_masters[i]['ACName']+'</option>';
                // // }
                // newHtml += '</select>';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Marks</strong>';
                // newHtml += '<input type="text" name="garu_Aavak_Group[' + lstidx + '][marks]" placeholder="Marks"  id="marks' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Qntty</strong>';
                newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lstidx + '][qty_blc]" id="qty_blc' + lstidx + '">';
                newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lstidx + '][qty_exe]" id="qty_exe' + lstidx + '">';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][qntty]" placeholder="Qntty"  id="qntty' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" onkeydown="FocusOnRate(' + lstidx + ',event)" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Pkng</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][pkng]" placeholder="Pkng"  id="pkng' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Net wt</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][net_Wt]" placeholder="Net wt"  id="net_Wt' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += "<td></br></br><a onclick='deleteGaruGroupEntry(" + lstidx + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                
                newHtml += '</tr>';

                // newHtml += '<tr id="GaruTr2' + lstidx + '">';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Pkng</strong>';
                // newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][pkng]" placeholder="Pkng"  id="pkng' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Net wt</strong>';
                // newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][net_Wt]" placeholder="Net wt"  id="net_Wt' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td >';
                // newHtml += '<strong class="control-strong">Rate</strong>';
                // newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][rate]"  id="rate' + lstidx + '" placeholder="Rate" class="form-control addgarufocusOnRate" oninput="CalGaruAvakEntry()" onkeydown="focusOnIntrest(event,' + lstidx + ')" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td >';
                // newHtml += '<strong class="control-strong"></br></strong>';
                // newHtml += '<select name="garu_Aavak_Group[' + lstidx + '][QW]" placeholder="QW"  id="QW' + lstidx + '" class="form-control QW prbank" onchange="CalGaruAvakEntry()" style="width:100%">';
                // newHtml += '<option value="Q">Q</option>';
                // newHtml += '<option value="W" selected>W</option>  ';
                // newHtml += '</select>';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Amount</strong>';
                // newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][amount]"  id="amount' + lstidx + '" placeholder="Amount" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Discount %</strong>';
                // newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lstidx + '][Dis_Amt]"  id="Dis_Amt' + lstidx + '"/>';
                // newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][discount]" placeholder="Discount" id="discount' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" value="0" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Bardan Amt</strong>';
                // newHtml += '<input type="text" name="garu_Aavak_Group[' + lstidx + '][bardan_Gross_Amount]" placeholder="Bardan Gr Amt"  id="bardan_Gross_Amount' + lstidx + '" oninput="CalGaruAvakEntry()" class="form-control" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">APMC</strong>';
                // newHtml += '<select name="garu_Aavak_Group[' + lstidx + '][apmc]" placeholder="APMC"  id="apmc' + lstidx + '" onchange="CalGaruAvakEntry()" class="form-control YN">';
                // newHtml += '<option value="Y" selected>Y</option>';
                // newHtml += '<option value="N">N</option> ';
                // newHtml += '</select>';
                // newHtml += '</td>';
                // newHtml += '</tr>';

                // newHtml += '<tr id="GaruTr3' + lstidx + '">';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">APMC Amt</strong>';
                // newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][apmc_Amount]" placeholder="APMC Amt"  id="apmc_Amount' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Insurance%</strong>';
                // newHtml += '<select name="garu_Aavak_Group[' + lstidx + '][ec]" placeholder="Insurance %"  id="ec' + lstidx + '" class="form-control YN" style="width:100%">';
                // newHtml += '<option value="Y" selected>Y</option>';
                // newHtml += '<option value="N">N</option>';
                // newHtml += '</select>';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Insurance Amt</strong>';
                // newHtml += '<input type="text" name="garu_Aavak_Group[' + lstidx + '][entry_Tax]"  id="entry_Tax' + lstidx + '" placeholder="Insurance Amt" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">GST</strong>';
                // newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lstidx + '][tax_Amt]"  id="tax_Amt' + lstidx + '"/>';
                // newHtml += '<input type="text" name="garu_Aavak_Group[' + lstidx + '][GST]" placeholder="GST"  id="GST' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lstidx + '][Item_IGST]"  id="Item_IGST' + lstidx + '"/>';
                // newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lstidx + '][Item_SGST]"  id="Item_SGST' + lstidx + '"/>';
                // newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lstidx + '][Item_CGST]"  id="Item_CGST' + lstidx + '"/>';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Net Amt</strong>';
                // newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][net_Amount]" placeholder="Net Amt"  id="net_Amount' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Vakal Thok</strong>';
                // newHtml += '<input type="text" name="garu_Aavak_Group[' + lstidx + '][vakal_Thok]" placeholder="Vakal Thok"  id="vakal_Thok' + lstidx + '" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += '<td>';
                // newHtml += '<strong class="control-strong">Dana Rate</strong>';
                // newHtml += '<input type="number" name="garu_Aavak_Group[' + lstidx + '][dana_Rt]" placeholder="Dana Rate"  id="dana_Rt' + lstidx + '" class="form-control addgarufocus" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                // newHtml += '</td>';
                // newHtml += "<td></br></br><a onclick='deleteGaruGroupEntry(" + lstidx + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                // newHtml += '</tr>';
                $(newHtml).insertBefore("#Garu_Aavak_Entry_Group_Add");
                $(".productitem").select2({
                    placeholder: "Select Product",
                    allowClear: true,
                });
                $(".YN").select2({
                    placeholder: "Select Y/N",
                    allowClear: true,
                });
                $(".QW").select2({
                    placeholder: "Select Q/W",
                    allowClear: true,
                });
                $('.ItenCodeName').select2({
                    placeholder: 'Please select Item',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Garu_Aavak_Entry/ItenCodeName',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    templateSelection: formatcity,
                    escapeMarkup: function (m) { return m; }
                })
                $('.brandName').select2({
                    placeholder: 'Please select Brand',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Garu_Aavak_Entry/brandName',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    templateSelection: formatcity,
                    escapeMarkup: function (m) { return m; }
                })
                $('.PurAcInSaleEntry').select2({
                    placeholder: 'Select Purchase A/C',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Garu_Aavak_Entry/PurAcInSaleEntry',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    templateSelection: formatcity,
                    escapeMarkup: function (m) { return m; }
                })
                $("input").focus(function () {
                    $(this).select();
                });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
            }
        }
    });
});

async function CalGaruAvakEntry() {
    lstidx = $("input[name*='dsirn']").length + 1;
    var values = $("input[name='dsirn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx);
    var qntty = 0;
    var pkng = 0;
    var rate = 0;
    var QW = 0;
    var net_Wt = 0;
    var QWcal = 0;
    var amount = 0;
    var discount = 0;
    var net_Amount = 0;
    var entry_Taxcal = 0;
    var apmc_Amountcal = 0;
    var entry_Tax = 0;
    var apmc_Amount = 0;
    var bardan_Gross_Amount = 0;
    var GST = 0;
    var Dis_Amt = 0;
    var tax_Amt = 0;
    var tot_Dis_Amt = 0;
    var tot_tax_Amt = 0;
    var tot_AmtBeforeDis = 0;
    var tot_AmtBeforeTax = 0;
    var tot_Amt = 0
    var tot_Qtty = 0
    var gst_TaxAmtTot5 = 0;
    var apmcAmt75 = 0;
    var apmcAmt5 = 0;
    var tot_wt = 0;
    for (let i = 0; i <= lstidx; i++) {
        // console.log(lstidx,i)
        qntty = $("#qntty" + i).val();
        if (qntty == '') qntty = 0;
        $('#qty_blc' + i).val(qntty)
        $('#qty_exe' + i).val(0)
        tot_Qtty = tot_Qtty + parseFloat(qntty);
        pkng = $("#pkng" + i).val();
        if (pkng == '') pkng = 0;
        $("#net_Wt" + i).val((pkng * qntty)/100);
        net_Wt = $("#net_Wt" + i).val();
        if (net_Wt == '') net_Wt = 0;

        tot_wt = tot_wt + parseInt($("#net_Wt" + i).val());
        
        $("#tot_wt").val(tot_wt);
        
        rate = $('#rate' + i).val();
        if (rate == '') rate = 0;
        QW = $('#QW' + i).val();
        if (QW == 'Q') {
            QWcal = qntty;
            $("#amount" + i).val((rate * QWcal).toFixed(2));//according to ravi sir
        }
        if (QW == 'W') {
            QWcal = net_Wt;
            $("#amount" + i).val((rate * QWcal / 100).toFixed(2));//according to ravi sir
        }
        amount = $("#amount" + i).val();
        if (amount == '') amount = 0;
        // tot_AmtBeforeDis = parseFloat(tot_AmtBeforeDis) + parseFloat(amount)
        if ($('#apmc' + i).val() == 'Y') {
            $('#apmc_Amount' + i).val(((parseFloat(amount) * 0.8) / 100).toFixed(2));
            apmcAmt75 = parseFloat(apmcAmt75) + ((parseFloat(amount) * 0.75) / 100);
            apmcAmt5 = parseFloat(apmcAmt5) + ((parseFloat(amount) * 0.05) / 100);
        } else {
            $('#apmc_Amount' + i).val(0);
        }
        discount = $('#discount' + i).val();
        if (discount == '') discount = 0;
        Dis_Amt = (amount * discount) / 100;
        $('#Dis_Amt' + i).val(Dis_Amt);
        tot_Dis_Amt = parseFloat(tot_Dis_Amt) + parseFloat(Dis_Amt)
        net_Amount = parseFloat(amount) - (amount * discount) / 100;
        entry_Taxcal = net_Amount;
        apmc_Amountcal = net_Amount;
        bardan_Gross_Amount = $('#bardan_Gross_Amount' + i).val();
        if (bardan_Gross_Amount == '') bardan_Gross_Amount = 0;
        apmc_Amount = $('#apmc_Amount' + i).val();
        if (apmc_Amount == '') apmc_Amount = 0;
        entry_Tax = $('#entry_Tax' + i).val();
        if (entry_Tax == '') entry_Tax = 0;
        net_Amount = net_Amount + parseFloat(bardan_Gross_Amount) + parseFloat(entry_Tax);
        GST = $("#GST" + i).val();
        if (GST == '') GST = 0;
        tax_Amt = (net_Amount * GST) / 100;
        $('#tax_Amt' + i).val(tax_Amt);
        tot_tax_Amt = parseFloat(tot_tax_Amt) + parseFloat(tax_Amt);
        tot_AmtBeforeTax = parseFloat(tot_AmtBeforeTax) + parseFloat(net_Amount)
        $('#net_Amount' + i).val(net_Amount);
        tot_Amt = tot_Amt + parseFloat($('#net_Amount' + i).val());
        // console.log('GST',i,GST);
        if (GST == 5 || GST == '5') gst_TaxAmtTot5 = parseFloat(gst_TaxAmtTot5) + ((net_Amount) * GST) / 100;
        // console.log('GST',i,gst_TaxAmtTot5);
    }
    
    // console.log(apmcAmt75)
    $('#tot_Qtty').val(tot_Qtty);
    $('#tot_DisAmt').val(tot_Dis_Amt.toFixed(2));
    $('#tot_TaxAmt').val(tot_tax_Amt.toFixed(2));
    $('#AmountParticular5').val(apmcAmt75.toFixed(2));
    $('#AmountParticular6').val(apmcAmt5.toFixed(2));
    $('#tot_AmtBeforeDis').val(tot_AmtBeforeDis.toFixed(2));
    $('#tot_AmtBeforeTax').val(tot_AmtBeforeTax.toFixed(2))
    
    // $('#tot_Amt').val(tot_Amt.toFixed(2));

    $('#tot_Amt').val(tot_Qtty); //AkshatDalke
    CreatGaruNarration()
    
    $('#gst_TaxAmtTot5').val(gst_TaxAmtTot5.toFixed(2));
    var DisAmt = $("#lessamtParticular2").val();
    var tot_TaxAmtAfterDisc = 0;
    var Netamt = $("#tot_Amt").val();
    // var tot_Apmc = $('#tot_APMCAMT').val();
    // var TaxAmt   = (parseFloat(Netamt)+parseFloat(tot_Apmc))*5/100;
    // $("#gst_TaxAmtTot5").val(parseFloat(TaxAmt)-(parseFloat(DisAmt)*5/100));
    var values = $("input[name='dsirn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var lastidx = parseInt(idx);
    var DiscPerItem = 0;
    if (DisAmt > 0) DiscPerItem = (DisAmt / Netamt) * 100;
    for (let i = 0; i <= lastidx; i++) {
        var NetAmtPerItem = $('#net_Amount' + i).val();
        var apmcAmt = $('#apmc_Amount' + i).val();
        var gstRate = $('#GST' + i).val();
        if (gstRate == '' || gstRate == null || gstRate == undefined || isNaN(gstRate)) gstRate = 0;
        if (NetAmtPerItem == null || NetAmtPerItem == '' || NetAmtPerItem == undefined) flag = 0;
        else {
            var DiscAmtPerItem = 0;
            if (DiscPerItem > 0 || DiscPerItem < 0) DiscAmtPerItem = (NetAmtPerItem * DiscPerItem) / 100;
            if (DiscAmtPerItem > 0 || DiscAmtPerItem < 0) var PlusMinusAmt = parseFloat(apmcAmt) - parseFloat(DiscAmtPerItem);
            else var PlusMinusAmt = parseFloat(apmcAmt) - parseFloat(DiscAmtPerItem);
            var GstAmtPerItem = (parseFloat(NetAmtPerItem) + parseFloat(PlusMinusAmt)) * gstRate / 100;
            tot_TaxAmtAfterDisc = tot_TaxAmtAfterDisc + parseFloat(GstAmtPerItem);
            var a = await setItem_GSTAmtInGaru(GstAmtPerItem, i)
        }
    }

    $('#tot_TaxAmt').val(tot_TaxAmtAfterDisc.toFixed(2));
    $('#gst_TaxAmtTot5').val(tot_TaxAmtAfterDisc.toFixed(2));

    calGaruAddless()
    calGarugst()
    $("#gst_TaxAmtTot5").val()
    $("#gross_Amt").val((parseFloat($("#gst_TaxAmtTot5").val()) + tot_Amt + parseFloat(apmcAmt75) + parseFloat(apmcAmt5)).toFixed(2));
    CalRoundOff()
}
function setItem_GSTAmtInGaru(GstAmtPerItem, i) {
    var party = $("#party_Code").val();
    $.ajax({
        type: 'GET',
        url: '/Garu_Aavak_Entry/chackstate/' + party,
        dataType: 'json',
        success: function (data) {
            if (data['success'] == 'true') {
                if (GstAmtPerItem == null || GstAmtPerItem == '') {
                    $("#Item_IGST" + i).val(0);
                } else {
                    tot_taxvalue = GstAmtPerItem / 2;
                    $("#Item_SGST" + i).val(tot_taxvalue.toFixed(2));
                    $("#Item_CGST" + i).val(tot_taxvalue.toFixed(2));
                }
            }
            if (data['success'] == 'false') {
                if (GstAmtPerItem == null || GstAmtPerItem == '') {
                    $("#Item_SGST" + i).val(0);
                    $("#Item_CGST" + i).val(0);
                } else {
                    tot_taxvalue = parseFloat(GstAmtPerItem);
                    $("#Item_IGST" + i).val(tot_taxvalue.toFixed(2));
                }
            }
            return 'success'
        }
    });
}
async function calGaruGstWithDes(e, idx) {
    if (e.keyCode == 13) {
        var DisAmt = $("#lessamtParticular" + idx).val();
        var Netamt = $("#tot_Amt").val();
        var values = $("input[name='dsirn']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1]
        var lastidx = parseInt(idx);
        var DiscPerItem = (DisAmt / Netamt) * 100;
        var tot_TaxAmtAfterDisc = 0;
        for (let i = 0; i <= lastidx; i++) {
            var NetAmtPerItem = $('#net_Amount' + i).val();
            var apmcAmt = $('#apmc_Amount' + i).val();
            var gstRate = $('#GST' + i).val();
            if (gstRate == '' || gstRate == null || gstRate == undefined || isNaN(gstRate)) gstRate = 0;
            if (NetAmtPerItem == null || NetAmtPerItem == '' || NetAmtPerItem == undefined) flag = 0;
            else {
                var DiscAmtPerItem = (NetAmtPerItem * DiscPerItem) / 100;
                var PlusMinusAmt = parseFloat(apmcAmt) - parseFloat(DiscAmtPerItem);
                var GstAmtPerItem = (parseFloat(NetAmtPerItem) + parseFloat(PlusMinusAmt)) * gstRate / 100;
                tot_TaxAmtAfterDisc = tot_TaxAmtAfterDisc + parseFloat(GstAmtPerItem);
                var a = await setItem_GSTAmtInGaru(GstAmtPerItem, i)
            }
        }
        $('#tot_TaxAmt').val(tot_TaxAmtAfterDisc.toFixed(2));
        $('#gst_TaxAmtTot5').val(tot_TaxAmtAfterDisc.toFixed(2));
        var a = await calGarugst();
        setTimeout(async function () {
            var a = await calGaruAddless()
        }, 200);
    }
}
function CreatGaruNarration() {
    var Party = $('#party_Code').text()
    var Broker = $('#broker_Code').text()
    var date = $('#podt').val()
    var BillNo = $('#bill_No').val()
    var LorryNo = $('#lorry_Wagon_No').val()
    var Qty = $('#tot_Qtty').val()
    var date = $('#entryDate').val()
    $('#garu_Remarks').val('Bill No   ' + BillNo + "    Date  " + date + "  " + Party.trim() + "\nBags  " + Qty + "   Brok  " + Broker.trim() + "\nLorry No  " + LorryNo)
    // setTimeout(function(){ $('#lot_No0').focus(); }, 100);
}

function calGaruAddless(callback) {
    var subtotal = 0;
    var add = 0;
    var less = 0;
    addlstidx = $("input[name*='saleadd']").length;
    lesslstidx = $("input[name*='saleless']").length;
    addvalues = $("input[name='saleadd']")
        .map(function () { return $(this).val(); }).get();
    addidx = addvalues[addvalues.length - 1]
    lessvalues = $("input[name='saleless']")
        .map(function () { return $(this).val(); }).get();
    lessidx = lessvalues[lessvalues.length - 1]
    if (addidx >= lessidx) {
        idx = addidx;
    }
    if (lessidx > addidx) {
        idx = lessidx;
    }
    lstidx = parseInt(idx);
    member = lstidx;

    if (lstidx === undefined) lstidx = 1;
    else lstidx = member;
    for (i = 0; i <= lstidx; i++) {
        if ($("#AmountParticular" + i).val() != undefined) {
            add = add + parseFloat($("#AmountParticular" + i).val());
            subtotal = $("#tot_Amt").val();
            // console.log(subtotal)
        }
    }
    lstidx1 = $("input[name*='saleless1']").length;
    member = lstidx;
    if (lstidx1 === undefined) lstidx1 = 1;
    else lstidx1 = member;
    for (i = 0; i <= lstidx1; i++) {
        if ($("#lessamtParticular" + i).val() != undefined || NaN) {
            less = less + parseFloat($("#lessamtParticular" + i).val());
        }
    }
    $("#gross_Amt").val(((parseFloat(subtotal) + parseFloat(add)) - parseFloat(less)).toFixed(2));
}

$(document).on("click", ".addGaruAdddetails", function () {
    // lstidx = $("input[name*='saleadd']").length + 1;
    var values = $("input[name='saleadd']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    if (idx == undefined || idx == null) idx = 0;
    lstidx = parseInt(idx) + 1;
    member = lstidx;
    if (s == limit) {
        alert("You have reached the limit of adding " + sd + " inputs");
    } else {
        $.ajax({
            type: 'GET',
            url: '/Garu_Aavak_Entry/getadddesc',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    var addmast = data['addmast'];
                    var new_div = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='addselrow" + lstidx + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="saleadd" value="' + lstidx + '" id="saleadd' + lstidx + '" oninput="calGaruAddless(' + lstidx + ')"';
                    new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
                    new_div += '<select name="add_details[' + lstidx + '][particular_add]" id="addparticular' + lstidx + '" onchange="sal_roumdof(' + lstidx + ')" style="text-align: -webkit-left;width: 100%;" class="form-control selectproductfocus addremprt">';
                    new_div += '<option value=""></option>';
                    for (p = 0; p < addmast.length; p++) {
                        if (addmast[p]['Parameter_Type'] == '+') new_div += '<option value="' + addmast[p]['_id'] + '" data-val="' + addmast[p]['Description'] + '">' + addmast[p]['Description'] + ' ' + addmast[p]['Value'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="add_details[' + lstidx + '][particular_amount]"';
                    new_div += 'id="AmountParticular' + lstidx + '" value="0" oninput="calGaruAddless(' + lstidx + ')"';
                    new_div += 'class="form-control  amountaddfocus" style="text-align: -webkit-right;"';
                    new_div += ' onblur="sal_roumdof(1)"/>';
                    new_div += '</td>';
                    new_div += "<td> <a onclick='purchaseordradd_remove(" + lstidx + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#prabal_div");
                    sd++;
                    lstidx--;
                    member++;
                    $(".addremprt").select2({
                        placeholder: "--Select--",
                        allowClear: true,
                    });
                    $('.addParticular tr:nth-last-child(2)').find('.selectproductfocus').focus();
                }

            }
        });
    }
})
$(document).on("click", ".addGaruLessdetails", function () {
    lstidx = $("input[name*='saleless']").length + 1;
    var values = $("input[name='saleless']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    if (idx == undefined || idx == null) idx = 0;
    lstidx = parseInt(idx) + 1;
    member = lstidx;
    if (s == limit) {
        alert("You have reached the limit of adding " + sd + " inputs");
    } else {
        $.ajax({
            type: 'GET',
            url: '/Garu_Aavak_Entry/getadddesc',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    var lessmast = data['addmast'];
                    var new_div = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='purchaseless" + lstidx + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="saleless" value="' + lstidx + '" id="saleless' + lstidx + '" oninput="calGaruAddless(' + lstidx + ')"';
                    new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
                    new_div += '<select name="less_details[' + lstidx + '][particular_less]" onchange="sal_roumdof(' + lstidx + ')" style="text-align: -webkit-left;width: 100%;" id="lessparticular' + lstidx + '" class="form-control addlessremparam selectlessfocus">';
                    new_div += '<option value=""></option>';
                    for (p = 0; p < lessmast.length; p++) {
                        if (lessmast[p]['Parameter_Type'] == '-') new_div += '<option value="' + lessmast[p]['_id'] + '" data-val="' + lessmast[p]['Description'] + '">' + lessmast[p]['Description'] + ' ' + lessmast[p]['Value'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="less_details[' + lstidx + '][particular_amtless]"';
                    new_div += 'id="lessamtParticular' + lstidx + '"  value="0" oninput="calGaruAddless(' + lstidx + ')"';
                    new_div += 'class="form-control  addlessfocus" style="text-align: -webkit-right;"';
                    new_div += 'onblur="sal_roumdof(1)"/>';
                    new_div += '</td>';
                    new_div += "<td> <a onclick='purchaseless_remove(" + lstidx + ")'  style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#vipul_div");
                    s++;
                    lstidx--;
                    member++;
                    $(".addlessremparam").select2({
                        placeholder: "--Select--",
                        allowClear: true,
                    });
                    $('.addlessjustmentstable tr:nth-last-child(2)').find('.selectlessfocus').focus();
                }
            }
        });
    }
})
function calDuaDate() {
    var crdays = $('#cr_Days').val();
    var curnDate = $('#offerstartdate').val()
    var bill_DateObject = moment(curnDate, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata").add(crdays, 'days');
    var newdate = moment(bill_DateObject).format('DD/MM/YYYY')
    $('#due_On').val(newdate)
}
function calGarugst() {
    var gst_TaxAmtTot5 = $("#gst_TaxAmtTot5").val();
    // var gsttaxamtot18 = $("#gsttaxamtot18").val();
    $("#AmountParticular1").val(0);
    $("#AmountParticular2").val(0);
    $("#AmountParticular3").val(0);
    var tot_taxvalue = 0;
    party = $("#party_Code").val();
    $.ajax({
        type: 'GET',
        url: '/Garu_Aavak_Entry/chackstate/' + party,
        dataType: 'json',
        success: function (data) {
            if (data['success'] == 'true') {
                if (gst_TaxAmtTot5 == null || gst_TaxAmtTot5 == '') {
                    $("#AmountParticular3").val(0);
                } else {
                    tot_taxvalue = parseFloat(gst_TaxAmtTot5) / 2;
                    $("#AmountParticular1").val(tot_taxvalue.toFixed(2));
                    $("#AmountParticular2").val(tot_taxvalue.toFixed(2));
                }
            }
            if (data['success'] == 'false') {
                if (gst_TaxAmtTot5 == null || gst_TaxAmtTot5 == '') {
                    $("#AmountParticular1").val(0);
                    $("#AmountParticular2").val(0);
                } else {
                    tot_taxvalue = parseFloat(gst_TaxAmtTot5);
                    $("#AmountParticular3").val(tot_taxvalue.toFixed(2));
                }
            }
            // CalRoundOff()
        }
    });
}

function getpartyData() {
    var party = $('#party_Code').val()
    $.ajax({
        type: 'GET',
        url: '/Garu_Aavak_Entry/party',
        dataType: 'json',
        data: {
            party: party
        },
        success: function (data) {
            console.log(data)
            if (data['success']) {
                var product = data['account_masters']
                $('#cr_Days').val(product.ac_creditdys)
                calDuaDate()
            }
        }
    });
}
function getItemData(i) {
    var item = $('#item_Code_Desc' + i).val()
    var party = $('#party_Code').val()
    var idx = i;
    if (party == '' || party == null || party == undefined) {
        swal({
            title: 'Warning',
            text: 'Please Select Party',
            buttons: false,
            timer: 1500
        })
    } else {
        $.ajax({
            type: 'GET',
            url: '/Garu_Aavak_Entry/productlist',
            dataType: 'json',
            data: {
                item: item,
                party: party
            },
            success: function (data) {
                console.log(data)
                if (data['success']) {
                    var product = data['product']
                    var PartyType = data['partytype']
                    var State = data['State']
                    var GaruAavakRate = data['GaruAavakRate']
                    $('#pkng' + i).val(product[0].packing)
                    $('#dana_Rt' + i).val(product[0].packing)
                    $('#GST' + i).val(product[0].GST)
                    $('#bardan_Gross_Amount' + i).val(0)
                    $('#discount' + i).val(product[0].desper)
                    $('#apmc' + i).val(product[0].apmc_typ).trigger('change');
                    $('#ec' + i).val(product[0].entry_tax).trigger('change');
                    // $('#apmc'+i).val(product[0].apmc_typ).trigger('change');
                    if (product[0].rate_basedon == null || product[0].rate_basedon == undefined || product[0].rate_basedon == '') $('#QW' + i).val('W').trigger('change');
                    else $('#QW' + i).val(product[0].rate_basedon).trigger('change');
                    if (GaruAavakRate == null || GaruAavakRate == [] || GaruAavakRate == '') {
                        $('#rate' + i).val(0);
                    } else {
                        for (let j = 0; j < GaruAavakRate[0].garu_Aavak_Group.length; j++) {
                            if (GaruAavakRate[0].garu_Aavak_Group[j].item_Code_Desc == item) $('#rate' + i).val(GaruAavakRate[0].garu_Aavak_Group[j].rate);
                        }
                    }
                    for (let i = 0; i < product[0].product_posting_setup.length; i++) {
                        if (product[0].product_posting_setup[i].selesid.ModuleName == 'Garu Aavak Entry') {
                            if (PartyType == null || PartyType == '' || PartyType == undefined) {
                                if (State == 'true') {
                                    if ((product[0].product_posting_setup[i].partypid.Description).toUpperCase() == 'STATE') {
                                        var divnames = product[0].product_posting_setup[i].accontnm.ACName;
                                        var divnameids = product[0].product_posting_setup[i].accontnm._id;
                                        var option = new Option(divnames, divnameids, true, true);
                                        $('#purchase_Ac_Title' + idx).append(option).trigger('change');
                                        $('#purchase_Ac_Title' + idx).trigger({
                                            type: 'select2:select',
                                            params: {
                                                data: { "id": divnameids, "text": divnames }
                                            }
                                        });
                                        $('#purchase_Ac_Title_Name' + idx).val(divnames);
                                    }
                                }
                                if (State == 'false') {
                                    if ((product[0].product_posting_setup[i].partypid.Description).toUpperCase() == 'I.S') {
                                        var divnames = product[0].product_posting_setup[i].accontnm.ACName;
                                        var divnameids = product[0].product_posting_setup[i].accontnm._id;
                                        var option = new Option(divnames, divnameids, true, true);
                                        $('#purchase_Ac_Title' + idx).append(option).trigger('change');
                                        $('#purchase_Ac_Title' + idx).trigger({
                                            type: 'select2:select',
                                            params: {
                                                data: { "id": divnameids, "text": divnames }
                                            }
                                        });
                                        $('#purchase_Ac_Title_Name' + idx).val(divnames);
                                    }
                                }
                            } else {
                                if (PartyType == product[0].product_posting_setup[i].partypid._id) {
                                    var divnames = product[0].product_posting_setup[i].accontnm.ACName;
                                    var divnameids = product[0].product_posting_setup[i].accontnm._id;
                                    var option = new Option(divnames, divnameids, true, true);
                                    $('#purchase_Ac_Title' + idx).append(option).trigger('change');
                                    $('#purchase_Ac_Title' + idx).trigger({
                                        type: 'select2:select',
                                        params: {
                                            data: { "id": divnameids, "text": divnames }
                                        }
                                    });
                                    $('#purchase_Ac_Title_Name' + idx).val(divnames);
                                }
                            }
                        }
                    }
                }
                $('#marks' + i).focus();
            }
        });
    }
}
function FocusOnRate(id, e) {
    if (e.keyCode == 13) {
        setTimeout(function () {
            if ($('#qntty' + id).val() == null || $('#qntty' + id).val() == '') $('#qntty' + id).focus();
            else {
                if ($('#pkng' + id).val() == null || $('#pkng' + id).val() == '') $('#pkng' + id).focus();
                else {
                    $('#rate' + id).focus();
                }
            }
        }, 100);
    }
}
function CalRoundOff() {
    var amt = $("#gross_Amt").val()
    var rate = Math.round(amt);
    var r = rate - parseFloat(amt);
    var decimals = amt - Math.floor(amt);
    if (decimals != 0) {
        var a = parseFloat(amt) + parseFloat(r)
        $("#gross_Amt").val(a.toFixed(2));
        if (r < 0) {
            $("#AmountParticular4").val(0)
            $("#lessamtParticular1").val(((r.toFixed(2)) * -1))
        }
        if (r > 0) {
            $("#lessamtParticular1").val(0)
            $("#AmountParticular4").val((r.toFixed(2)))
        }
        // setTimeout(function(){ calGaruAddless() }, 200);
    }
}

$(document).on('click', '.delete_GaruAavakEntry', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'DELETE',
                url: '/Garu_Aavak_Entry/delete/' + id,
                success: function (response) {
                    $('.loader').hide();
                    window.location.href = '/Garu_Aavak_Entry/Garu_Aavak_Entry_List';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    })
});
// Garu Aavak Entry End

// Sales Entry Start ##################################################################################################################################################
$(document).on('keydown', '#SalesEntry_Submit_Btn', function (e) {
    if (e.keyCode == 13) {
        $("#SalesEntry_Submit_Btn").click();
    }
})
$(document).on('click', '#SalesEntry_Submit_Btn', async function (e) {
    if ($('#SalesEntryAdd').valid()) {
        // var a = await CalSaleEntry();
        // var b = await calRoundoffSale();
        // setTimeout(function(){ 
        $('#SalesEntryAdd').submit();
        $("#SalesEntry_Submit_Btn").hide();
        // }, 100);
    }
})
$('body').on('keydown', '.addsaleentryfocus', function (e) {
    var tr = $(this).parents('tr').index();
    if (e.keyCode == 13) {
        var values = $("input[name='dsirn']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1]
        if ($('#rate' + idx).val() == 0 || $('#rate' + idx).val() == '') {
            var values = $("input[name='dsirn']")
                .map(function () { return $(this).val(); }).get();
            var idx = values[values.length - 1]
            $('#rate' + idx).focus();
        } else {
            var answer = true; //confirm('Do you want to add new Row?')Sales Entry Start
            if (answer) {
                $('#addgaru').trigger('click');
            } else { $('.delv_load').focus(); }
            // alert()
            setTimeout(function () { $('.addgaru tr:nth-child(' + (tr + 3) + ')').find('.selectproductfocus').focus(); }, 150);
        }
    }
})
$('body').on('keydown', '.addsaleentryfocusOnRate', function (e) {
    var tr = $(this).parents('tr').index();
    if (e.keyCode == 13) {
        var values = $("input[name='dsirn']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1]
        if ($(this).val() == '' || $(this).val() == 0 || $(this).val() == null || $('#rate' + idx).val() == 0 || $('#rate' + idx).val() == '') {
            setTimeout(function () {
                var values = $("input[name='dsirn']")
                    .map(function () { return $(this).val(); }).get();
                var idx = values[values.length - 1]
                $('#rate' + idx).focus()
            }, 150);
        } else {
            var amt = $(this).val()
            var rate = Math.round(amt);
            var r = rate - parseFloat(amt);
            if (r == 0) {
                $(this).val(parseInt($(this).val()) + 0.10);
                CalSaleEntry();
            }
            var answer = true; //confirm('Do you want to add new Row?')
            if (answer) {
                $('#addgaru').trigger('click');
            } else { $('.delv_load').focus(); }
            var values = $("input[name='lotno']")
                .map(function () { return $(this).val(); }).get();
            var idx = values[values.length - 1]
            var lotno = idx;
            setTimeout(function () {
                $('.addgaru tr:nth-child(' + (tr + 4) + ')').find('.selectproductfocus').focus();
            }, 150);
        }
    }
});
$('body').on('focus', '#broker_Code', function (e) {
    if ($('#broker_Code').val() == null || $('#broker_Code').val() == '') {
        $(this).select2('open');
    }
});
// $('body').on('focus','#sl_Person',function(e){
//     if($('#sl_Person').val() == null || $('#sl_Person').val() == ''){
//     $(this).select2('open');
//     }
// });
$('body').on('focus', '.ItenCodeName', async function (e) {
    await sleep(100);
    if ($(this).val() == null || $(this).val() == '') {
        $(this).select2('open');
    }
});
$('.PagupPagDown').on('keydown', function (e) {
    var vouc_code = '';
    var book = '';
    if (e.keyCode == 34) {//pg Down
        e.preventDefault();
        $(this).css("background-color", "rgb(211, 253, 122)");
        $(this).val(parseInt($(this).val()) - 1);
        vouc_code = $(this).val();
        book = $('#c_j_s_p').val();
    }
    if (e.keyCode == 33) {//pg Up
        e.preventDefault();
        $(this).css("background-color", "rgb(211, 253, 122)");
        $(this).val(parseInt($(this).val()) + 1);
        vouc_code = $(this).val();
        book = $('#c_j_s_p').val();
    }
    if (vouc_code != '' && book != '') {
        $.ajax({
            type: 'GET',
            url: '/Sales_Entry/getBillNumberWiseConfirm',
            dataType: 'json',
            data: {
                vouc_code: vouc_code,
                book: book
            },
            success: function (data) {
                if (data['success']) {
                    window.location.href = '/Sales_Entry/getBillNumberWise?vouc_code=' + vouc_code + '&book=' + book + '';
                } else {
                    swal({
                        title: 'Warning',
                        text: 'Entry Not Found / Not Exist',
                        buttons: false,
                        timer: 500
                    })
                }
            }
        });
    }
})
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms || DEF_DELAY));
}
function SalesEsc(index, e) {
    if (e.keyCode == 27) {
        $('#GaruTr0' + index).remove();
        $('#GaruTr1' + index).remove();
        $('#GaruTr2' + index).remove();
        $('#GaruTr3' + index).remove();
        $(".delv_load").focus();
    }
}
function deleteSalesGroupEntry(i) {
    lstidx = $("input[name*='dsirn']").length
    var a = confirm('Are You Want To Delete It');
    if (a == true && lstidx > 1) {
        $('#GaruTr0' + i).remove();
        $('#GaruTr1' + i).remove();
        $('#GaruTr2' + i).remove();
        $('#GaruTr3' + i).remove();
        $("#gdn_Cd_Name" + (i - 1)).focus();
        CalSaleEntry()
    }
}

function getLot(id) {
    $('#lotno' + id).val($('#lot_No' + id).val());
}

$(document).on('click', '.addSalesEntry', function () {
    var values = $("input[name='dsirn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var lastidx = parseInt(idx) + 1;
    // $('#rate'+idx).removeClass('addsaleentryfocusOnRate');
    // $('#dana_Rt'+idx).removeClass('addsaleentryfocus');
    $.ajax({
        type: 'GET',
        url: '/Garu_Aavak_Entry/productname',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {

                var product = data['product'];
                var gowdown = data['gowdown'];
                var account_masters = data['account_masters'];
                var newHtml = '';
                newHtml += '<tr id="GaruTr0' + lastidx + '">';
                newHtml += '<td colspan="8" style="background-color:#4b77be">&nbsp;</td>';
                newHtml += '</tr>';
                newHtml += '<tr id="GaruTr1' + lastidx + '">';
                newHtml += '<td>';
                newHtml += '<strong>Gdn-Cd</strong>';
                newHtml += '<input type="hidden" name="dsirn" value="' + lastidx + '" id="dsirn' + lastidx + '">';
                //    newHtml +='<input type="text" name="garu_Aavak_Group['+lastidx+'][gdn_Cd_Name]" id="gdn_Cd_Name'+lastidx+'" '; 
                //    newHtml +=' class="form-control " style="text-align: -webkit-right;"  placeholder="Gdn-Cd"/>';
                newHtml += '<select  name="garu_Aavak_Group[' + lastidx + '][gdn_Cd_Name] "id="gdn_Cd_Name' + lastidx + '"  class="form-control  prbank productitem" style="width:100%"';
                newHtml += 'placeholder="Select">';
                for (let i = 0; i < gowdown.length; i++) {
                    newHtml += '<option value="' + gowdown[i]['_id'] + '">' + gowdown[i]['Description'] + '</option>';
                }
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong>Lot No</strong>';
                newHtml += '<input type="hidden" name="lotno" id="lotno' + lastidx + '">';
                newHtml += '<input type="text" name="garu_Aavak_Group[' + lastidx + '][lot_No]" onkeydown="getLotNoData(' + lastidx + ',event)" onkeyup="SalesEsc(' + lastidx + ',event)"  id="lot_No' + lastidx + '" data-id="' + lastidx + '" class="form-control selectproductfocus lotNo" oninput="getLot(' + lastidx + ')" style="text-align: -webkit-right;" placeholder="Lot No" />';
                newHtml += '</td>';
                newHtml += '<td colspan="3">';
                newHtml += '<strong>Item Cd</strong>';
                newHtml += '<select  name="garu_Aavak_Group[' + lastidx + '][item_Code_Desc]" id="item_Code_Desc' + lastidx + '"  class="form-control ItenCodeName" onchange="getsaleItemData(' + lastidx + ')" style="width:100%"';
                newHtml += 'placeholder="Select Product" style="width: 100%">';
                newHtml += '<option value=""></option>';
                // for (let i = 0; i < product.length; i++)
                // {
                //     newHtml += '<option value="'+product[i]['_id']+'">'+product[i]['Fg_Des']+'</option>';
                // }
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Sale Ac Title</strong>';
                // newHtml +='<input type="text" name="garu_Aavak_Group['+lastidx+'][sale_Ac_Title]" placeholder="Purchase Ac Title"  id="purchase_Ac_Title'+lastidx+'" class="form-control" style="text-align: -webkit-right;" />';
                newHtml += '<select  name="garu_Aavak_Group[' + lastidx + '][sale_Ac_Title]"id="sale_Ac_Title' + lastidx + '"  class="form-control  prbank SaleAcInSaleEntry" style="width:100%"';
                newHtml += 'placeholder="Select Sale A/C" style="width: 100%">';
                newHtml += '<option value=""></option>';
                // for (let i = 0; i < account_masters.length; i++)
                // {
                //     newHtml += '<option value="'+account_masters[i]['_id']+'">'+account_masters[i]['ACName']+'</option>';
                // }
                newHtml += '</select>';
                newHtml += '<input type="hidden" id="sale_Ac_Title_Name' + lastidx + '" name="garu_Aavak_Group[' + lastidx + '][sale_Ac_Title_Name]">';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Marks</strong>';
                newHtml += '<input type="text" name="garu_Aavak_Group[' + lastidx + '][marks]" placeholder="Marks"  id="marks' + lastidx + '" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lastidx + '][LotMain_id]" id="LotMain_id' + lastidx + '">';
                newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lastidx + '][LotArMain_id]" id="LotArMain_id' + lastidx + '">';

                newHtml += '<strong class="control-strong">Qntty</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lastidx + '][qntty]" placeholder="Qntty Pkng"  id="qntty' + lastidx + '" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" onkeydown="FocusOnRate(' + lastidx + ',event)"/>';
                newHtml += '</td>';
                newHtml += '</tr>';

                newHtml += '<tr id="GaruTr2' + lastidx + '">';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Pkng</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lastidx + '][pkng]" placeholder="Pkng"  id="pkng' + lastidx + '" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Net wt</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lastidx + '][net_Wt]" placeholder="Net wt"  id="net_Wt' + lastidx + '" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td >';
                newHtml += '<strong class="control-strong">Rate</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lastidx + '][rate]" onkeydown="addAmtInRate(' + lastidx + ',event)"  id="rate' + lastidx + '" placeholder="Rate" class="form-control addsaleentryfocusOnRate" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td >';
                newHtml += '<strong class="control-strong"></br></strong>';
                newHtml += '<select name="garu_Aavak_Group[' + lastidx + '][QW]" placeholder="QW"  id="QW' + lastidx + '" class="form-control QW prbank" onchange="CalSaleEntry()" style="width:100%">';
                newHtml += '<option value="Q">Q</option>';
                newHtml += '<option value="W" selected>W</option>  ';
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Amount</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lastidx + '][amount]"  id="amount' + lastidx + '" placeholder="Amount" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Discount %</strong>';
                newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lastidx + '][Dis_Amt]"  id="Dis_Amt' + lastidx + '"/>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lastidx + '][discount]" placeholder="Discount" id="discount' + lastidx + '" class="form-control" oninput="CalSaleEntry()" value="0" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Bardan Amt</strong>';
                newHtml += '<input type="text" name="garu_Aavak_Group[' + lastidx + '][bardan_Gross_Amount]" placeholder="Bardan Gr Amt"  id="bardan_Gross_Amount' + lastidx + '" oninput="CalSaleEntry()" class="form-control" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">APMC</strong>';
                newHtml += '<select name="garu_Aavak_Group[' + lastidx + '][apmc]" placeholder="APMC"  id="apmc' + lastidx + '" onchange="CalSaleEntry()" class="form-control YN">';
                newHtml += '<option value="Y" selected>Y</option>';
                newHtml += '<option value="N">N</option> ';
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '</tr>';

                newHtml += '<tr id="GaruTr3' + lastidx + '">';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">APMC Amt</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lastidx + '][apmc_Amount]" placeholder="APMC Amt"  id="apmc_Amount' + lastidx + '" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Insurance%</strong>';
                newHtml += '<select name="garu_Aavak_Group[' + lastidx + '][ec]" placeholder="Insurance %"  id="ec' + lastidx + '" class="form-control YN" style="width:100%">';
                newHtml += '<option value="Y" selected>Y</option>';
                newHtml += '<option value="N">N</option>';
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Insurance Amt</strong>';
                newHtml += '<input type="text" name="garu_Aavak_Group[' + lastidx + '][entry_Tax]"  id="entry_Tax' + lastidx + '" placeholder="Insurance Amt" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">GST</strong>';
                newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lastidx + '][tax_Amt]"  id="tax_Amt' + lastidx + '"/>';
                newHtml += '<input type="text" name="garu_Aavak_Group[' + lastidx + '][GST]" placeholder="GST"  id="GST' + lastidx + '" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lastidx + '][Item_IGST]"  id="Item_IGST' + lastidx + '"/>';
                newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lastidx + '][Item_SGST]"  id="Item_SGST' + lastidx + '"/>';
                newHtml += '<input type="hidden" name="garu_Aavak_Group[' + lastidx + '][Item_CGST]"  id="Item_CGST' + lastidx + '"/>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Net Amt</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lastidx + '][net_Amount]" placeholder="Net Amt"  id="net_Amount' + lastidx + '" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Vakal Thok</strong>';
                newHtml += '<input type="text" name="garu_Aavak_Group[' + lastidx + '][vakal_Thok]" placeholder="Vakal Thok"  id="vakal_Thok' + lastidx + '" class="form-control" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Dana Rate</strong>';
                newHtml += '<input type="number" name="garu_Aavak_Group[' + lastidx + '][dana_Rt]" placeholder="Dana Rate"  id="dana_Rt' + lastidx + '" class="form-control addsaleentryfocus" oninput="CalSaleEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += "<td></br></br><a onclick='deleteSalesGroupEntry(" + lastidx + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                newHtml += '</tr>';
                $(newHtml).insertBefore("#Garu_Aavak_Entry_Group_Add");
                //    CalSaleEntry()
                $(".productitem").select2({
                    placeholder: "Select Sale A/C",
                    allowClear: true,
                });
                $(".YN").select2({
                    placeholder: "Select Y/N",
                    allowClear: true,
                });
                $(".QW").select2({
                    placeholder: "Select Q/W",
                    allowClear: true,
                });
                $('.ItenCodeName').select2({
                    placeholder: 'Please select Item',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Garu_Aavak_Entry/ItenCodeName',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    templateSelection: formatcity,
                    escapeMarkup: function (m) { return m; }
                })
                $('.SaleAcInSaleEntry').select2({
                    placeholder: 'Select Sale A/C',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Sales_Entry/SaleAcInSaleEntry',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    templateSelection: formatcity,
                    escapeMarkup: function (m) { return m; }
                })
                $("input").focus(function () {
                    $(this).select();
                });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
            }
        }

    });
    // 
});
function addAmtInRate(idx, e) {
    // if(e.keyCode == 13){
    //     var rate = $('#rate'+idx).val()
    //     if($('#accountAPMC').val() == 'Y'){
    //         $('#rate'+idx).val((parseInt(rate)+0.10).toFixed(2))
    //     }
    //     // CalSaleEntry();
    // }
}
async function CalSaleEntry() {
    // lstidx = $("input[name*='dsirn']").length + 1;
    var values = $("input[name='dsirn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx);
    var qntty = 0;
    var pkng = 0;
    var rate = 0;
    var QW = 0;
    var net_Wt = 0;
    var QWcal = 0;
    var amount = 0;
    var discount = 0;
    var net_Amount = 0;
    var entry_Taxcal = 0;
    var apmc_Amountcal = 0;
    var entry_Tax = 0;
    var apmc_Amount = 0;
    var bardan_Gross_Amount = 0;
    var GST = 0;
    var Dis_Amt = 0;
    var tax_Amt = 0;
    var tot_Dis_Amt = 0;
    var tot_tax_Amt = 0;
    var tot_AmtBeforeDis = 0;
    var tot_AmtBeforeTax = 0;
    var tot_Amt = 0
    var gst_TaxAmtTot5 = 0;
    var tot_Qtty = 0;
    var apmcAmt75 = 0;
    var apmcAmt5 = 0;
    var apmcAmt = 0;
    for (let i = 0; i <= lstidx; i++) {
        qntty = $("#qntty" + i).val();
        if (qntty == '') qntty = 0;
        tot_Qtty = tot_Qtty + parseFloat(qntty)
        pkng = $("#pkng" + i).val();
        if (pkng == '') pkng = 0;
        $("#net_Wt" + i).val(pkng * qntty);
        net_Wt = $("#net_Wt" + i).val();
        if (net_Wt == '') net_Wt = 0;
        rate = $('#rate' + i).val();
        if (rate == '') rate = 0;
        QW = $('#QW' + i).val();
        if (QW == 'Q') {
            QWcal = qntty;
            $("#amount" + i).val((rate * QWcal).toFixed(2));//according to ravi sir
        }
        if (QW == 'W') {
            QWcal = net_Wt;
            $("#amount" + i).val((rate * QWcal / 100).toFixed(2));//according to ravi sir
        }
        // $("#amount"+i).val(rate*QWcal/100);
        amount = $("#amount" + i).val();
        if (amount == '') amount = 0;
        tot_AmtBeforeDis = parseFloat(tot_AmtBeforeDis) + parseFloat(amount)
        if ($('#apmc' + i).val() == 'Y') {
            $('#apmc_Amount' + i).val(((parseFloat(amount) * 0.8) / 100).toFixed(2));
            apmcAmt = parseFloat(amount) * 0.8 / 100;
            apmcAmt75 = parseFloat(apmcAmt75) + ((parseFloat(amount) * 0.75) / 100);
            apmcAmt5 = parseFloat(apmcAmt5) + ((parseFloat(amount) * 0.05) / 100);
        } else {
            $('#apmc_Amount' + i).val(0);
        }
        discount = $('#discount' + i).val();
        if (discount == '') discount = 0;
        Dis_Amt = (amount * discount) / 100
        $('#Dis_Amt' + i).val(Dis_Amt);
        tot_Dis_Amt = parseFloat(tot_Dis_Amt) + parseFloat(Dis_Amt)
        net_Amount = parseFloat(amount) - (amount * discount) / 100;
        entry_Taxcal = net_Amount;
        apmc_Amountcal = net_Amount;
        bardan_Gross_Amount = $('#bardan_Gross_Amount' + i).val();
        if (bardan_Gross_Amount == '') bardan_Gross_Amount = 0;
        apmc_Amount = $('#apmc_Amount' + i).val();
        if (apmc_Amount == '') apmc_Amount = 0;
        entry_Tax = $('#entry_Tax' + i).val();
        if (entry_Tax == '') entry_Tax = 0;
        net_Amount = net_Amount + parseFloat(bardan_Gross_Amount) + parseFloat(entry_Tax);
        GST = $("#GST" + i).val();
        if (GST == '') GST = 0;
        tax_Amt = ((net_Amount + apmcAmt) * GST) / 100;
        $('#tax_Amt' + i).val(tax_Amt);
        tot_tax_Amt = parseFloat(tot_tax_Amt) + parseFloat(tax_Amt);
        tot_AmtBeforeTax = parseFloat(tot_AmtBeforeTax) + parseFloat(net_Amount)
        $('#net_Amount' + i).val(net_Amount);
        tot_Amt = tot_Amt + parseFloat($('#net_Amount' + i).val());
        if (GST == 5) gst_TaxAmtTot5 = parseFloat(gst_TaxAmtTot5) + ((apmcAmt + net_Amount) * GST) / 100;
    }
    if (apmcAmt75 == '' || apmcAmt75 == '' || apmcAmt75 == undefined || isNaN(apmcAmt75)) apmcAmt75 = 0;
    if (apmcAmt5 == '' || apmcAmt5 == '' || apmcAmt5 == undefined || isNaN(apmcAmt5)) apmcAmt5 = 0;
    $('#AmountParticular5').val(apmcAmt75.toFixed(2));
    $('#AmountParticular6').val(apmcAmt5.toFixed(2));
    var totApmc = parseFloat(apmcAmt75) + parseFloat(apmcAmt5);
    $('#tot_APMCAMT').val(totApmc.toFixed(2));
    if ($('#accountAPMC').val() == 'Y') $('#lessamtParticular2').val(totApmc.toFixed(2));
    else $('#lessamtParticular2').val(0);
    if (tot_Qtty == '' || tot_Qtty == '' || tot_Qtty == undefined || isNaN(tot_Qtty)) tot_Qtty = 0;
    $('#tot_Qtty').val(tot_Qtty);
    if (tot_Dis_Amt == '' || tot_Dis_Amt == '' || tot_Dis_Amt == undefined || isNaN(tot_Dis_Amt)) tot_Dis_Amt = 0;
    $('#tot_DisAmt').val(tot_Dis_Amt.toFixed(2));
    if (tot_tax_Amt == '' || tot_tax_Amt == '' || tot_tax_Amt == undefined || isNaN(tot_tax_Amt)) tot_tax_Amt = 0;
    $('#tot_TaxAmt').val(tot_tax_Amt.toFixed(2));
    if (tot_AmtBeforeDis == '' || tot_AmtBeforeDis == '' || tot_AmtBeforeDis == undefined || isNaN(tot_AmtBeforeDis)) tot_AmtBeforeDis = 0;
    $('#tot_AmtBeforeDis').val(tot_AmtBeforeDis.toFixed(2));
    if (tot_AmtBeforeTax == '' || tot_AmtBeforeTax == '' || tot_AmtBeforeTax == undefined || isNaN(tot_AmtBeforeTax)) tot_AmtBeforeTax = 0;
    $('#tot_AmtBeforeTax').val(tot_AmtBeforeTax.toFixed(2))
    if (tot_Amt == '' || tot_Amt == '' || tot_Amt == undefined || isNaN(tot_Amt)) tot_Amt = 0;
    $('#tot_Amt').val(tot_Amt.toFixed(2));
    if (gst_TaxAmtTot5 == '' || gst_TaxAmtTot5 == '' || gst_TaxAmtTot5 == undefined || isNaN(gst_TaxAmtTot5)) gst_TaxAmtTot5 = 0;
    $('#gst_TaxAmtTot5').val(gst_TaxAmtTot5.toFixed(2));

    var DisAmt = $("#lessamtParticular2").val();
    var tot_TaxAmtAfterDisc = 0;
    if (DisAmt > 0) {
        var Netamt = $("#tot_Amt").val();
        // var tot_Apmc = $('#tot_APMCAMT').val();
        // var TaxAmt   = (parseFloat(Netamt)+parseFloat(tot_Apmc))*5/100;
        // $("#gst_TaxAmtTot5").val(parseFloat(TaxAmt)-(parseFloat(DisAmt)*5/100));
        var values = $("input[name='dsirn']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1]
        var lastidx = parseInt(idx);
        var DiscPerItem = (DisAmt / Netamt) * 100;
        for (let i = 0; i <= lastidx; i++) {
            var NetAmtPerItem = $('#net_Amount' + i).val();
            var apmcAmt = $('#apmc_Amount' + i).val();
            var gstRate = $('#GST' + i).val();
            if (gstRate == '' || gstRate == null || gstRate == undefined || isNaN(gstRate)) gstRate = 0;
            if (NetAmtPerItem == null || NetAmtPerItem == '' || NetAmtPerItem == undefined) flag = 0;
            else {
                var DiscAmtPerItem = (NetAmtPerItem * DiscPerItem) / 100;
                var PlusMinusAmt = parseFloat(apmcAmt) - parseFloat(DiscAmtPerItem);
                var GstAmtPerItem = (parseFloat(NetAmtPerItem) + parseFloat(PlusMinusAmt)) * gstRate / 100;
                tot_TaxAmtAfterDisc = tot_TaxAmtAfterDisc + parseFloat(GstAmtPerItem);
                var a = await setItem_GSTAmt(GstAmtPerItem, i)
            }
        }
        $('#tot_TaxAmt').val(tot_TaxAmtAfterDisc.toFixed(2));
        $('#gst_TaxAmtTot5').val(tot_TaxAmtAfterDisc.toFixed(2));
    }
    var a = await calSalegst()
    CreatSaleNarration()
    var tot = parseFloat($("#gst_TaxAmtTot5").val()) + tot_Amt + parseFloat(apmcAmt75) + parseFloat(apmcAmt5);
    $("#gross_Amt").val(tot.toFixed(2));
    setTimeout(async function () {
        var a = await calSaleAddless()
    }, 200);
}

function calSaleAddless(callback) {
    var subtotal = 0;
    var add = 0;
    var less = 0;
    addlstidx = $("input[name*='saleadd']").length;
    lesslstidx = $("input[name*='saleless']").length;
    addvalues = $("input[name='saleadd']")
        .map(function () { return $(this).val(); }).get();
    addidx = addvalues[addvalues.length - 1]
    lessvalues = $("input[name='saleless']")
        .map(function () { return $(this).val(); }).get();
    lessidx = lessvalues[lessvalues.length - 1]
    // if(addidx>=lessidx){
    //     idx = addidx;
    // }
    // if(lessidx>addidx){
    //     idx = lessidx;
    // }
    // lstidx = parseInt(idx);
    // member = lstidx;

    // if (lstidx === undefined) lstidx = 1;
    // else lstidx = member;
    // for (i = 0;i<= lstidx;i++) {
    //     if($("#AmountParticular" + i).val()!=undefined)
    //     {
    //         add = add+parseFloat($("#AmountParticular" + i).val());
    //         subtotal = $("#tot_Amt").val();
    //     }
    // }
    // lstidx1 = $("input[name*='saleless1']").length;
    // member = lstidx;
    // if (lstidx1 === undefined) lstidx1 = 1;
    // else lstidx1 = member;
    // for (i = 0;i<= lstidx1;i++) {
    //     if($("#lessamtParticular" + i).val()!=undefined||NaN)
    //     {
    //      less = less+parseFloat($("#lessamtParticular" + i).val());
    //     }
    // }
    subtotal = $("#tot_Amt").val();
    // console.log(addidx,lessidx)
    for (i = 0; i <= addidx; i++) {
        var addval = $("#AmountParticular" + i).val();
        if (addval == undefined || addval == null || isNaN(addval == undefined)) addval = 0;
        add = add + parseFloat(addval);
    }
    for (i = 0; i <= lessidx; i++) {
        var lessVal = $("#lessamtParticular" + i).val()
        if (lessVal == undefined || lessVal == null || isNaN(lessVal == undefined)) lessVal = 0;
        less = less + parseFloat(lessVal);
    }
    // console.log(subtotal,add,less)
    $("#gross_Amt").val(((parseFloat(subtotal) + parseFloat(add)) - parseFloat(less)).toFixed(2));
}
$(document).on("click", ".addSaleAdddetails", function () {
    // lstidx = $("input[name*='saleadd']").length + 1;
    var values = $("input[name='saleadd']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    if (idx == undefined || idx == null) idx = 0;
    lstidx = parseInt(idx) + 1;
    member = lstidx;
    if (s == limit) {
        alert("You have reached the limit of adding " + sd + " inputs");
    } else {
        $.ajax({
            type: 'GET',
            url: '/Sales_Entry/getadddesc',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    var addmast = data['addmast'];
                    var new_div = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='addselrow" + lstidx + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="saleadd" value="' + lstidx + '" id="saleadd' + lstidx + '" oninput="calSaleAddless(' + lstidx + ')"';
                    new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
                    new_div += '<select name="add_details[' + lstidx + '][particular_add]" id="addparticular' + lstidx + '" onchange="sal_roumdof(' + lstidx + ')" style="text-align: -webkit-left;width: 100%;" class="form-control selectproductfocus addremprt">';
                    new_div += '<option value=""></option>';
                    for (p = 0; p < addmast.length; p++) {
                        if (addmast[p]['Parameter_Type'] == '+') new_div += '<option value="' + addmast[p]['_id'] + '" data-val="' + addmast[p]['Description'] + '">' + addmast[p]['Description'] + ' ' + addmast[p]['Value'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="add_details[' + lstidx + '][particular_amount]"';
                    new_div += 'id="AmountParticular' + lstidx + '" value="0" oninput="calSaleAddless(' + lstidx + ')"';
                    new_div += 'class="form-control  amountaddfocus" style="text-align: -webkit-right;"';
                    new_div += ' onblur="sal_roumdof(1)"/>';
                    new_div += '</td>';
                    new_div += "<td> <a onclick='purchaseordradd_remove(" + lstidx + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#prabal_div");
                    sd++;
                    lstidx--;
                    member++;
                    $(".addremprt").select2({
                        placeholder: "--Select--",
                        allowClear: true,
                    });
                    $('.addParticular tr:nth-last-child(2)').find('.selectproductfocus').focus();
                }

            }
        });
    }
})
$(document).on("click", ".addSaleLessdetails", function () {
    lstidx = $("input[name*='saleless']").length + 1;
    var values = $("input[name='saleless']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    if (idx == undefined || idx == null) idx = 0;
    lstidx = parseInt(idx) + 1;
    member = lstidx;
    if (s == limit) {
        alert("You have reached the limit of adding " + sd + " inputs");
    } else {
        $.ajax({
            type: 'GET',
            url: '/Sales_Entry/getadddesc',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    var lessmast = data['addmast'];
                    var new_div = document.createElement('div');
                    new_div = "<tr class='contract_wrapper' id='purchaseless" + lstidx + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="saleless" value="' + lstidx + '" id="saleless' + lstidx + '" oninput="calSaleAddless(' + lstidx + ')"';
                    new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
                    new_div += '<select name="less_details[' + lstidx + '][particular_less]" onchange="sal_roumdof(' + lstidx + ')" style="text-align: -webkit-left;width: 100%;" id="lessparticular' + lstidx + '" class="form-control addlessremparam selectlessfocus">';
                    new_div += '<option value=""></option>';
                    for (p = 0; p < lessmast.length; p++) {
                        if (lessmast[p]['Parameter_Type'] == '-') new_div += '<option value="' + lessmast[p]['_id'] + '" data-val="' + lessmast[p]['Description'] + '">' + lessmast[p]['Description'] + ' ' + lessmast[p]['Value'] + '</option>';
                    }
                    new_div += '</select>';
                    new_div += '</td>';
                    new_div += '<td>';
                    new_div += '<input type="text" name="less_details[' + lstidx + '][particular_amtless]"';
                    new_div += 'id="lessamtParticular' + lstidx + '"  value="0" oninput="calSaleAddless(' + lstidx + ')"';
                    new_div += 'class="form-control  addlessfocus" style="text-align: -webkit-right;"';
                    new_div += 'onblur="sal_roumdof(1)"/>';
                    new_div += '</td>';
                    new_div += "<td> <a onclick='purchaseless_remove(" + lstidx + ")'  style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#vipul_div");
                    s++;
                    lstidx--;
                    member++;
                    $(".addlessremparam").select2({
                        placeholder: "--Select--",
                        allowClear: true,
                    });
                    $('.addlessjustmentstable tr:nth-last-child(2)').find('.selectlessfocus').focus();
                }
            }
        });
    }
})
function CreatSaleNarration() {
    var Party = $('#party_Code').text()
    var Broker = $('#broker_Code').text()
    var date = $('#offerstartdate').val()
    var BillNo = $('#vouc_code').val()
    var LorryNo = $('#lorry_Wagon_No').val()
    var Qty = $('#tot_Qtty').val()
    $('#garu_Remarks').val('Bill No   ' + BillNo + "    Date  " + date + "  " + Party.trim() + "\nBags  " + Qty + "   Brok  " + Broker.trim() + "\nLorry No  " + LorryNo)
}
async function calSaleGstWithDes(e, idx) {
    if (e.keyCode == 13) {
        var DisAmt = $("#lessamtParticular" + idx).val();
        var Netamt = $("#tot_Amt").val();
        // var tot_Apmc = $('#tot_APMCAMT').val();
        // var TaxAmt   = (parseFloat(Netamt)+parseFloat(tot_Apmc))*5/100;
        // $("#gst_TaxAmtTot5").val(parseFloat(TaxAmt)-(parseFloat(DisAmt)*5/100));
        var values = $("input[name='dsirn']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1]
        var lastidx = parseInt(idx);
        var DiscPerItem = (DisAmt / Netamt) * 100;
        var tot_TaxAmtAfterDisc = 0;
        for (let i = 0; i <= lastidx; i++) {
            var NetAmtPerItem = $('#net_Amount' + i).val();
            var apmcAmt = $('#apmc_Amount' + i).val();
            var gstRate = $('#GST' + i).val();
            if (gstRate == '' || gstRate == null || gstRate == undefined || isNaN(gstRate)) gstRate = 0;
            if (NetAmtPerItem == null || NetAmtPerItem == '' || NetAmtPerItem == undefined) flag = 0;
            else {
                var DiscAmtPerItem = (NetAmtPerItem * DiscPerItem) / 100;
                var PlusMinusAmt = parseFloat(apmcAmt) - parseFloat(DiscAmtPerItem);
                var GstAmtPerItem = (parseFloat(NetAmtPerItem) + parseFloat(PlusMinusAmt)) * gstRate / 100;
                tot_TaxAmtAfterDisc = tot_TaxAmtAfterDisc + parseFloat(GstAmtPerItem);
                var a = await setItem_GSTAmt(GstAmtPerItem, i)
            }
        }
        $('#tot_TaxAmt').val(tot_TaxAmtAfterDisc.toFixed(2));
        $('#gst_TaxAmtTot5').val(tot_TaxAmtAfterDisc.toFixed(2));
        var a = await calSalegst();
        setTimeout(async function () {
            var a = await calSaleAddless()
        }, 200);
        if ($('#Form').val() == 'Sales_Return_Update_Form') $('#garu_Remarks').focus();
    }
}
function setItem_GSTAmt(GstAmtPerItem, i) {
    var party = $("#party_Code").val();
    $.ajax({
        type: 'GET',
        url: '/Garu_Aavak_Entry/chackstate/' + party,
        dataType: 'json',
        success: function (data) {
            if (data['success'] == 'true') {
                if (GstAmtPerItem == null || GstAmtPerItem == '') {
                    $("#Item_IGST" + i).val(0);
                } else {
                    tot_taxvalue = GstAmtPerItem / 2;
                    $("#Item_SGST" + i).val(tot_taxvalue.toFixed(2));
                    $("#Item_CGST" + i).val(tot_taxvalue.toFixed(2));
                }
            }
            if (data['success'] == 'false') {
                if (GstAmtPerItem == null || GstAmtPerItem == '') {
                    $("#Item_SGST" + i).val(0);
                    $("#Item_CGST" + i).val(0);
                } else {
                    tot_taxvalue = parseFloat(GstAmtPerItem);
                    $("#Item_IGST" + i).val(tot_taxvalue.toFixed(2));
                }
            }
            return 'success'
        }
    });
}
function calSalegst() {
    var gst_TaxAmtTot5 = $("#gst_TaxAmtTot5").val();
    $("#AmountParticular1").val(0);
    $("#AmountParticular2").val(0);
    $("#AmountParticular3").val(0);
    var tot_taxvalue = 0;
    party = $("#party_Code").val();
    $.ajax({
        type: 'GET',
        url: '/Garu_Aavak_Entry/chackstate/' + party,
        dataType: 'json',
        success: function (data) {
            if (data['success'] == 'true') {
                if (gst_TaxAmtTot5 == null || gst_TaxAmtTot5 == '') {
                    $("#AmountParticular3").val(0);
                } else {
                    tot_taxvalue = gst_TaxAmtTot5 / 2;
                    $("#AmountParticular1").val(tot_taxvalue.toFixed(2));
                    $("#AmountParticular2").val(tot_taxvalue.toFixed(2));
                }
            }
            if (data['success'] == 'false') {
                if (gst_TaxAmtTot5 == null || gst_TaxAmtTot5 == '') {
                    $("#AmountParticular1").val(0);
                    $("#AmountParticular2").val(0);
                } else {
                    tot_taxvalue = parseFloat(gst_TaxAmtTot5);
                    $("#AmountParticular3").val(tot_taxvalue.toFixed(2));
                }
            }
        }
    });
}

function getsalepartyData() {
    var party = $('#party_Code').val()
    $.ajax({
        type: 'GET',
        url: '/Garu_Aavak_Entry/party',
        dataType: 'json',
        data: {
            party: party,
            brCode: 'D1'
        },
        success: function (data) {
            if (data['success']) {
                getSaleBillModal();
                var product = data['account_masters']
                var Broker = data['LastBrokerParty']
                var SLMan = data['lastEntryNoSlPerson']
                var Direct = data['Direct']
                // console.log(Direct);
                $('#cr_Days').val(product.ac_creditdys)
                $('#GSTIN').val(product.GSTIN)
                $('#FssiNo').val(product.ac_fccino)
                $('#FSS_DATE').val(product.FSS_DATE)
                if (product.ac_APMC == '' || product.ac_APMC == undefined || product.ac_APMC == '') $('#accountAPMC').val('Y');
                else $('#accountAPMC').val(product.ac_APMC);

                if (product.broker_Code == '' || product.broker_Code == [] || product.broker_Code == undefined) {
                    if (Broker == null || Broker == [] || Broker == '') {
                        var divnames = Direct.ACName;
                        var divnameids = Direct._id;
                        var option = new Option(divnames, divnameids, true, true);
                        $('#broker_Code').append(option).trigger('change');
                        $('#broker_Code').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": divnameids, "text": divnames }
                            }
                        });
                    } else {
                        var divnames = Broker[0].accountSchema.ACName;
                        var divnameids = Broker[0].Garu_Aavak_Schema.broker_Code;
                        // console.log(divnames,divnameids)
                        var option = new Option(divnames, divnameids, true, true);
                        $('#broker_Code').append(option).trigger('change');
                        $('#broker_Code').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": divnameids, "text": divnames }
                            }
                        });
                    }
                } else {
                    var divnames = product.broker_Code.ACName;
                    var divnameids = product.broker_Code._id;
                    // console.log(divnames,divnameids)
                    var option = new Option(divnames, divnameids, true, true);
                    $('#broker_Code').append(option).trigger('change');
                    $('#broker_Code').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": divnameids, "text": divnames }
                        }
                    });
                }
                if (product.sl_Person == '' || product.sl_Person == [] || product.sl_Person == undefined) {
                    if (SLMan == null || SLMan == [] || SLMan == '') flag = 1;
                    else {
                        var divnames = SLMan[0].accountSchema.ACName;
                        var divnameids = SLMan[0].Garu_Aavak_Schema.sl_Person;
                        var option = new Option(divnames, divnameids, true, true);
                        $('#sl_Person').append(option).trigger('change');
                        $('#sl_Person').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": divnameids, "text": divnames }
                            }
                        });
                    }
                }
                else {
                    var divnamesSl = product.sl_Person.ACName;
                    var divnameidsSl = product.sl_Person._id;
                    var option = new Option(divnamesSl, divnameidsSl, true, true);
                    $('#sl_Person').append(option).trigger('change');
                    $('#sl_Person').trigger({
                        type: 'select2:select',
                        params: {
                            data: { "id": divnameidsSl, "text": divnamesSl }
                        }
                    });
                }
                calDuaDate()
            }
            $('#FssiNo').focus()
            getOutstandingBalanceInSale()
        }
    });
}

function getsaleItemData(i) {
    var item = $('#item_Code_Desc' + i).val()
    var party = $('#party_Code').val()
    var idx = i;
    if (party == '' || party == null || party == undefined) {
        swal({
            title: 'Warning',
            text: 'Please Select Party',
            buttons: false,
            timer: 1500
        })
    } else {
        $.ajax({
            type: 'GET',
            url: '/Garu_Aavak_Entry/productlist',
            dataType: 'json',
            data: {
                item: item,
                party: party
            },
            success: function (data) {
                console.log(data)
                if (data['success']) {
                    var product = data['product']
                    var PartyType = data['partytype']
                    var State = data['State']
                    var SaleRate = data['SaleRate']
                    $('#pkng' + i).val(product[0].packing)
                    $('#dana_Rt' + i).val(product[0].packing)
                    $('#GST' + i).val(product[0].GST)
                    $('#bardan_Gross_Amount' + i).val(0)
                    $('#discount' + i).val(product[0].desper)
                    $('#apmc' + i).val(product[0].apmc_typ).trigger('change');
                    $('#ec' + i).val(product[0].entry_tax).trigger('change');
                    $('#apmc' + i).val(product[0].apmc_typ).trigger('change');
                    if (product[0].rate_basedon == undefined || product[0].rate_basedon == null || product[0].rate_basedon == '') $('#QW' + i).val('W').trigger('change');
                    else $('#QW' + i).val(product[0].rate_basedon).trigger('change');
                    if (SaleRate == null || SaleRate == [] || SaleRate == '') {
                        $('#rate' + i).val(0);
                    } else {
                        for (let j = 0; j < SaleRate[0].garu_Aavak_Group.length; j++) {
                            if (SaleRate[0].garu_Aavak_Group[j].item_Code_Desc == item) $('#rate' + i).val(SaleRate[0].garu_Aavak_Group[j].rate);
                        }
                    }
                    for (let i = 0; i < product[0].product_posting_setup.length; i++) {
                        if (product[0].product_posting_setup[i].selesid.ModuleName == 'Sale Entry') {
                            if (PartyType == null || PartyType == '' || PartyType == undefined) {
                                if (State == 'true') {
                                    if ((product[0].product_posting_setup[i].partypid.Description).toUpperCase() == 'STATE') {
                                        var divnames = product[0].product_posting_setup[i].accontnm.ACName;
                                        var divnameids = product[0].product_posting_setup[i].accontnm._id;
                                        var option = new Option(divnames, divnameids, true, true);
                                        $('#sale_Ac_Title' + idx).append(option).trigger('change');
                                        $('#sale_Ac_Title' + idx).trigger({
                                            type: 'select2:select',
                                            params: {
                                                data: { "id": divnameids, "text": divnames }
                                            }
                                        });
                                        $('#sale_Ac_Title_Name' + idx).val(divnames);
                                    }
                                }
                                if (State == 'false') {
                                    if ((product[0].product_posting_setup[i].partypid.Description).toUpperCase() == 'I.S') {
                                        var divnames = product[0].product_posting_setup[i].accontnm.ACName;
                                        var divnameids = product[0].product_posting_setup[i].accontnm._id;
                                        var option = new Option(divnames, divnameids, true, true);
                                        $('#sale_Ac_Title' + idx).append(option).trigger('change');
                                        $('#sale_Ac_Title' + idx).trigger({
                                            type: 'select2:select',
                                            params: {
                                                data: { "id": divnameids, "text": divnames }
                                            }
                                        });
                                        $('#sale_Ac_Title_Name' + idx).val(divnames);
                                    }
                                }
                            } else {
                                if (PartyType == product[0].product_posting_setup[i].partypid._id) {
                                    var divnames = product[0].product_posting_setup[i].accontnm.ACName;
                                    var divnameids = product[0].product_posting_setup[i].accontnm._id;
                                    var option = new Option(divnames, divnameids, true, true);
                                    $('#sale_Ac_Title' + idx).append(option).trigger('change');
                                    $('#sale_Ac_Title' + idx).trigger({
                                        type: 'select2:select',
                                        params: {
                                            data: { "id": divnameids, "text": divnames }
                                        }
                                    });
                                    $('#sale_Ac_Title_Name' + idx).val(divnames);
                                }
                            }
                        }
                    }
                }
                CalSaleEntry()
                $('#qntty' + i).focus();
            }
        });
    }
}

function getLotNoData(i, e) {
    if (e.keyCode == 13) {
        var lot_No = $('#lot_No' + i).val()
        if (lot_No == null || lot_No == '' || lot_No == undefined) {

        } else {
            var idx = i
            $.ajax({
                type: 'GET',
                url: '/Sales_Entry/LotNoData',
                dataType: 'json',
                data: {
                    lot_No: lot_No
                },
                success: function (data) {
                    console.log(data)
                    var count = 0;
                    if (data['success']) {
                        var lotdata = data['GaruLotData'];
                        if (lotdata[0].qntty > 0) {
                            $('#gdn_Cd_Name' + idx).val(lotdata[0].gdn_Cd_Name)
                            $('#marks' + idx).val(lotdata[0].marks)
                            $('#qntty' + idx).val(lotdata[0].qntty)
                            // $('#pkng'+idx).val(lotdata[0].pkng)
                            // $('#net_Wt'+idx).val(lotdata[0].qntty*lotdata[0].pkng);
                            // $('#rate'+idx).val(0)
                            // $('#QW'+idx).val(lotdata[0].QW).trigger('change')
                            // $('#Dis_Amt'+idx).val(0)
                            // $('#amount'+idx).val(0)
                            // $('#bardan_Gross_Amount'+idx).val(lotdata[0].bardan_Gross_Amount)
                            // $('#apmc'+idx).val(lotdata[0].apmc).trigger('change')
                            // $('#apmc_Amount'+i).val(lotdata[0].apmc_Amount)
                            // $('#ec'+idx).val(lotdata[0].ec).trigger('change')
                            // $('#entry_Tax'+idx).val(lotdata[0].entry_Tax)
                            // $('#GST'+idx).val(lotdata[0].GST)
                            // $('#vakal_Thok'+idx).val(lotdata[0].vakal_Thok)
                            // $('#dana_Rt'+idx).val(lotdata[0].dana_Rt)
                            var divname = lotdata[0].item_Code_Desc.item_title;
                            var divnameid = lotdata[0].item_Code_Desc._id;
                            var option = new Option(divname, divnameid, true, true);
                            $('#item_Code_Desc' + idx).append(option).trigger('change');
                            $('#item_Code_Desc' + idx).trigger({
                                type: 'select2:select',
                                params: {
                                    data: { "id": divnameid, "text": divname }
                                }
                            });
                            // var divnames = lotdata[0].purchase_Ac_Title.ACName;
                            // var divnameids = lotdata[0].purchase_Ac_Title._id;
                            // var option = new Option(divnames,divnameids, true, true);
                            // $('#sale_Ac_Title'+idx).append(option).trigger('change');
                            // $('#sale_Ac_Title'+idx).trigger({
                            //     type: 'select2:select',
                            //     params: {
                            //         data: {"id": divnameids, "text" : divnames }
                            //     }
                            // });
                            // $('#sale_Ac_Title'+idx).val(lotdata[0].purchase_Ac_Title).trigger('change')
                            CalSaleEntry()
                            $('#qntty' + idx).focus()
                        } else {
                            swal({
                                title: 'Oops!',
                                text: 'Lot Is Not In Stock',
                                buttons: false,
                                timer: 1500
                            })
                            if ($('#lot_No' + idx).val() == null || $('#lot_No' + idx).val() == '' || $('#lot_No' + idx).val() == undefined) {

                            } else $('#lot_No' + idx).focus()
                        }
                    }
                }
            });
        }
    }
}

// Hide Bill Collection Model In Sale Entry 
$('#billCollactionModal').on('keydown', function (e) {
    e.preventDefault();
    if (e.keyCode == 13) {
        $('#hideSaleModel').click();
        $('#FssiNo').focus();
    }
})
//Show Bill Collection Model In Sale Entry
function getOutstandingBalanceInSale() {
    var party_Code = $('#party_Code').val();
    if (party_Code == null || party_Code == '') {
    } else {
        $.ajax({
            type: 'GET',
            url: '/Bill_CollectionEntry/getSaleBillModal',
            dataType: 'json',
            data: {
                party_Code: party_Code  //billCollactionModal
            },
            success: function (data) {
                var result = '';
                if (data['success'] == true) {
                    var out = data['outstanding'];
                    var OutBal = 0;
                    for (let i = 0; i < out.length; i++) {
                        OutBal = OutBal + parseFloat(out[i].outstanding_balance);
                    }
                    $('#OutBal').text(OutBal);
                }
            }
        });
    }
}
function ShowSaleEntryDetail(idx) {
    var main_bk = '';
    var c_j_s_p = '';
    var vouc_code;
    var Form = $('#Form').val();
    if (Form == 'BillCollection_Add_Form') {
        vouc_code = $('#Bill_No_In_modal' + idx).attr('data-voucCode');
        var main_bk = $('#Bill_No_In_modal' + idx).attr('data-mainbk');
        var c_j_s_p = $('#Bill_No_In_modal' + idx).attr('data-cjsp');
    }
    if (Form == 'SaleBillEntry') {
        vouc_code = $('#Bill_no' + idx).attr('data-voucCode');
        main_bk = $('#Bill_no' + idx).attr('data-mainbk');
        c_j_s_p = $('#Bill_no' + idx).attr('data-cjsp');
    }
    $.ajax({
        type: 'GET',
        url: '/Sales_Entry/ShowSaleEntryDetail',
        dataType: 'json',
        data: {
            main_bk: main_bk,
            c_j_s_p: c_j_s_p,
            vouc_code: vouc_code,
        },
        success: function (data) {
            console.log(data)
            if (data['success']) {
                var SaleEntry = data['GaruAavak'];
                var result = '';
                result += '<tr style=""><td colspan="10" style="height: 2em;" align="left"><a style="margin-left: 5px;color: black">Sale Entry Details</a></td></tr>'
                result += '<tr style="background-color: #4b77be">'
                result += '<th style="text-align: center;color: white" colspan="2">Description</th>'
                result += '<th style="height: 1.5em;text-align: center;color: white">Marks</th>'
                result += '<th style="height: 1.5em;text-align: center;color: white">Bag</th>'
                result += '<th style="height: 1.5em;text-align: center;color: white">Pack</th>'
                result += '<th style="height: 1.5em;text-align: center;color: white">Net Wght</th>'
                result += '<th style="height: 1.5em;text-align: center;color: white">Net Rate</th>'
                result += '<th style="height: 1.5em;text-align: center;color: white">Bardan</th>'
                result += '<th style="height: 1.5em;text-align: center;color: white">Item Amt</th>'
                result += '</tr>'
                $.each(SaleEntry.garu_Aavak_Group, function (index, value) {
                    result += '<tr>';
                    result += '<td colspan="2"><input type="text" id="" value="' + value.item_Code_Desc.item_title + '" class="form-control" style="text-align: center" readonly></td>';
                    result += '<td><input type="text" id="" value="' + value.marks + '" class="form-control nofocus" readonly style="text-align: center"></td>';
                    if (value.qntty == null || value.qntty == '' || value.qntty == undefined) value.qntty = 0;
                    result += '<td><input type="number" id="" value="' + value.qntty + '" class="form-control nofocus"  readonly></td>';
                    if (value.pkng == null || value.pkng == '' || value.pkng == undefined) value.pkng = 0;
                    result += '<td><input type="number" id="" value="' + value.pkng + '" class="form-control nofocus"  readonly></td>';
                    if (value.net_Wt == null || value.net_Wt == '' || value.net_Wt == undefined) value.net_Wt = 0;
                    result += '<td><input type="number" id="" value="' + value.net_Wt.toFixed(2) + '" class="form-control nofocus"  readonly></td>';
                    if (value.rate == null || value.rate == '' || value.rate == undefined) value.rate = 0;
                    result += '<td><input type="number" id="" value="' + parseFloat(value.rate).toFixed(2) + '" class="form-control nofocus"  readonly></td>';
                    if (value.bardan_Gross_Amount == null || value.bardan_Gross_Amount == '' || value.bardan_Gross_Amount == undefined) value.bardan_Gross_Amount = 0;
                    result += '<td><input type="number" id="" value="' + value.bardan_Gross_Amount.toFixed(2) + '" class="form-control nofocus" readonly></td>';
                    if (value.amount == null || value.amount == '' || value.amount == undefined) value.amount = 0;
                    result += '<td colspan="2"><input type="number" id="" value="' + value.amount.toFixed(2) + '" class="form-control nofocus" readonly></td>';
                    result += '</tr>';
                });
                $('#Sale_Entry_Detail').html(result);
            }
        }
    })
}
function FocusNextSaleEntryDetail(e, idx) {
    if (e.keyCode == 38) {
        var idx = parseInt(idx) - 1;
        setTimeout(function () { $('#Bill_no' + idx).focus() }, 100);
    }
    if (e.keyCode == 40) {
        var idx = parseInt(idx) + 1;
        setTimeout(function () { $('#Bill_no' + idx).focus() }, 100);
    }
}
function getSaleBillModal() {
    var party_Code = $('#party_Code').val();
    var Form = $('#Form').val();
    if (Form == 'SaleBillEntry') {
        if (party_Code == null || party_Code == '') {
            swal({
                title: 'Oops!',
                text: 'Please Select Party First',
                buttons: false,
                timer: 1500
            })
        } else {
            $.ajax({
                type: 'GET',
                url: '/Bill_CollectionEntry/getSaleBillModal',
                dataType: 'json',
                data: {
                    party_Code: party_Code //billCollactionModal
                },
                success: function (data) {
                    console.log(data);
                    var result = '';
                    if (data['success'] == true) {
                        var delveryentry1 = data['outstanding'];
                        var div = data['division'];
                        if (delveryentry1.length > 0) $("#billCollactionModal").modal('show');
                        else $('#FssiNo').focus()
                        $.each(delveryentry1, function (index, value) {
                            // if(value['outstanding_amount']>0)
                            // {
                            var filterstartdate = moment(value.cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                            result += '<tr>';
                            result += '<td><input type="text" id="Bill_no' + index + '" value="' + value.main_bk + '/' + value.c_j_s_p + '/' + value.vouc_code + '" data-mainbk = "' + value.main_bk + '" data-cjsp = "' + value.c_j_s_p + '" data-voucCode = "' + value.vouc_code + '" onfocus="ShowSaleEntryDetail(' + index + ')" onkeydown="FocusNextSaleEntryDetail(event,' + index + ')" class="form-control" style="text-align: center"></td>';
                            result += '<td><input type="text" name="BillDate" id="BillDate' + index + '" value="' + filterstartdate + '" class="form-control nofocus" readonly style="text-align: center"></td>';
                            if (value.Bill_Amount == null || value.Bill_Amount == '' || value.Bill_Amount == undefined) value.Bill_Amount = 0;
                            if (value.cash_amount == null || value.cash_amount == '' || value.cash_amount == undefined) value.cash_amount = 0;
                            result += '<td><input type="number" name="BillAmt" id="BillAmt' + index + '" value="' + value.Bill_Amount + '" class="form-control nofocus"  readonly></td>';
                            if (value.Rec_Amount == null || value.Rec_Amount == '' || value.Rec_Amount == undefined) value.Rec_Amount = 0;
                            result += '<td><input type="number" name="BillAmt" id="BillAmt' + index + '" value="' + value.Rec_Amount.toFixed(2) + '" class="form-control nofocus"  readonly></td>';
                            if (value.Add_Ded_Amt_Tot == null || value.Add_Ded_Amt_Tot == '' || value.Add_Ded_Amt_Tot == undefined) value.Add_Ded_Amt_Tot = 0;
                            result += '<td><input type="number" name="BillAmt" id="BillAmt' + index + '" value="' + parseFloat(value.Add_Ded_Amt_Tot).toFixed(2) + '" class="form-control nofocus"  readonly></td>';
                            if (value.outstanding_balance == null || value.outstanding_balance == '' || value.outstanding_balance == undefined) value.outstanding_balance = 0;
                            result += '<td><input type="number" name="BalanceDue" id="BalanceDue' + index + '" value="' + value.outstanding_balance.toFixed(2) + '" class="form-control nofocus" readonly></td>';
                            result += '<td><input type="number" name="IntDue" id="IntDue' + index + '" value="" class="form-control nofocus" readonly></td>';
                            if (value.broker_Code == null || value.broker_Code == undefined || value.broker_Code == '') var brname = '';
                            else var brname = value.broker_Code.ACName;
                            result += '<td><input type="text" name="BrokerName" id="BrokerName' + index + '" value="' + brname + '" class="form-control nofocus" readonly></td>';
                            // result += '<input type="hidden" name="BrokerName" id="BrokerNameId' + index + '" value="' + value.broker_Code._id + '" class="form-control" readonly></td>';
                            for (let i = 0; i < div.length; i++) {
                                if (div[i]._id == value.div_code) result += '<td><input type="text" name="Firm" id="Firm' + index + '" value="' + div[i].div_mast + '" class="form-control nofocus" readonly></td>';
                                else result += '<td><input type="text" name="Firm" id="Firm' + index + '" value="" class="form-control nofocus" readonly></td>';
                            }
                            result += '</tr>';
                            // }
                        });
                        // sau = '<input type="button"  value="OK" id="delivery_sauda" class="btn btn-primary" />';
                    }
                    $('.Bill_Collection_Modal').html(result);
                    $('#Bill_no0').focus();
                    if (delveryentry1.length) {
                        $('#deliverysupport').modal('show');
                    } else {
                        swal({
                            title: 'Oops!',
                            text: 'No Pending Outstanding',
                            buttons: false,
                            timer: 1500
                        })
                    }
                }
            });
        }
    }
}
function SaleDetailModalPartyWise() {
    var party_Code = $('#party_Code').val();
    if (party_Code == null || party_Code == '') {
        swal({
            title: 'Oops!',
            text: 'Please Select Party First',
            buttons: false,
            timer: 1500
        })
    } else {
        $.ajax({
            type: 'GET',
            url: '/Sales_Entry/SaleDetailModalPartyWise',
            dataType: 'json',
            data: {
                party_Code: party_Code //SaleDetailModalPartyWise
            },
            success: function (data) {
                var result = '';
                if (data['success'] == true) {
                    var SaleDetail = data['GaruAavak'];
                    console.log('SaleDetail', SaleDetail)
                    if (SaleDetail.length > 0) $("#SaleDetailModalPartyWise").modal('show');
                    else $('#FssiNo').focus()
                    result += '<table class="tabler userTable table-striped table-bordered table-hover" id="userTable">';
                    result += '<thead style="background-color:#4b77be;color: white;">';
                    result += '<tr>';
                    result += '<th style="width: 10em;">Rate</th>';
                    result += '<th style="width: 8em;">Item Code</th>';
                    result += '<th>Description</th>';
                    result += '<th style="width: 8em">Marks</th>';
                    result += '<th style="width: 8em">Bags</th>';
                    result += '<th style="width: 8em">Broker</th>';
                    result += '<th style="width: 8em">Sales Man</th>';
                    result += '<th style="width: 8em">Date</th>';
                    result += '<th style="width: 8em">Bill No</th>';
                    result += '</tr>';
                    result += '</thead>';
                    result += '<tbody>';
                    for (let i = 0; i < SaleDetail.length; i++) {
                        $.each(SaleDetail[i].garu_Aavak_Group, function (index, value) {
                            var filterstartdate = moment(SaleDetail[i].cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                            result += '<tr>';
                            result += '<td style="text-align:center">' + value.rate + '</td>';
                            result += '<td style="text-align:center">' + value.item_Code_Desc.item_code + '</td>';
                            result += '<td style="text-align:center">' + value.item_Code_Desc.item_title + '</td>';
                            result += '<td style="text-align:center">' + value.marks + '</td>';
                            if (value.qntty == null || value.qntty == '' || value.qntty == undefined) value.qntty = 0;
                            result += '<td style="text-align:center">' + value.qntty + '</td>';
                            if (SaleDetail[i].broker_Code == null || SaleDetail[i].broker_Code == undefined || SaleDetail[i].broker_Code == '') var brname = '';
                            else var brname = SaleDetail[i].broker_Code.ACCode;
                            result += '<td style="text-align:center">' + brname + '</td>';
                            if (SaleDetail[i].sl_Person == null || SaleDetail[i].sl_Person == undefined || SaleDetail[i].sl_Person == '') var slname = '';
                            else var slname = SaleDetail[i].sl_Person.ACCode;
                            result += '<td style="text-align:center">' + slname + '</td>';
                            result += '<td style="text-align:center">' + filterstartdate + '</td>';
                            result += '<td style="text-align:center">' + SaleDetail[i].c_j_s_p + '/' + SaleDetail[i].vouc_code + '</td>';
                            result += '</tr>';
                        });
                    }
                    result += '</tbody>';
                    result += '<tfoot>';
                    result += '<tr>';
                    result += '<th>Rate</th>';
                    result += '<th>Item Code</th>';
                    result += '<th>Description</th>';
                    result += '<th>Marks</th>';
                    result += '<th>Bags</th>';
                    result += '<th>Broker</th>';
                    result += '<th>Sales Man</th>';
                    result += '<th>Date</th>';
                    result += '<th>Bill No</th>';
                    result += '</tr>';
                    result += '</tfoot>';
                    result += '</table>';
                }
                $('.SaleDetailModalPartyWise_Tr').html(result);
                dattable = jQuery('.userTable').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "processing": false,
                    "serverSide": false,
                    "colReorder": true,
                    "autoWidth": false,
                    "ordering": false,
                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf',
                            exportOptions: {

                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                            footer: true,
                            orientation: 'landscape',
                            customize: function (doc) {
                                doc.content.splice(0, 0, {
                                    margin: [0, 0, 0, 12],
                                    alignment: 'center',
                                    text: 'Soft Sauda'
                                });
                            },
                            messageBottom: 'Exported from Soft Sauda'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                    ],
                    "order": [1, 'asc'],
                    "columnDefs": [{
                        "className": "actioncell",
                        "orderable": false,
                        "searchable": false,
                        "sortable": false,
                        "targets": [0],
                        "width": "5%"
                    }],
                })
                $('#userTable tfoot th').not('.excludesearch').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                    function resizeInput() {
                        var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }
                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });
                $('#userTable tfoot').insertBefore('#userTable thead');
                $('#userTableOut tfoot th').not('.excludesearchout').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                    function resizeInput() {
                        var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }
                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });
                $('#userTableOut tfoot').insertBefore('#userTableOut thead');
                dattable.columns().every(function () {
                    var that = this;
                    $('input', this.footer()).on('keyup change clear', function () {
                        if (that.search() !== this.value) {
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                });
                $('#Rate0').focus();
            }
        });
    }
}
//Show Bill Collection Model In Sale Entry 
function getAccMastModalInSateBillEntry() {
    var party_Code = $('#party_Code').val();
    if (party_Code == null || party_Code == '') {
        swal({
            title: 'Oops!',
            text: 'Please Select Party First',
            buttons: false,
            timer: 1500
        })
    } else {
        $.ajax({
            type: 'GET',
            url: '/Sales_Entry/getAccMastModalInSateBillEntry',
            dataType: 'json',
            data: {
                party_Code: party_Code  //billCollactionModal
            },
            success: function (response) {
                console.log(response);
                var result = '';
                if (response['success'] == true) {
                    $('#updateParty').modal('show');
                    setTimeout(function () { $('#ac_nameupdate').focus() }, 150);
                    var ctgid = response['a_mast']._id;
                    var vhpxaccount = response['a_mast']._id;
                    var ac_name = response['a_mast'].ACName;
                    var ac_opbal = response['a_mast'].OpBalance;
                    var ac_groupname = response['a_mast'].GroupName;
                    var broker_Code = response['a_mast'].broker_Code;
                    var sl_Person = response['a_mast'].sl_Person;
                    var ac_pan = response['a_mast'].PanNumber;
                    var ac_code = response['a_mast'].ACCode;
                    var ac_add1 = response['a_mast'].Address1;
                    var ac_city = response['a_mast'].CityName;
                    var ac_state = response['a_mast'].StateName;
                    var ac_area = response['a_mast'].Area;
                    var ac_gstin = response['a_mast'].GSTIN;
                    var ac_ptype = response['a_mast'].PartyType;
                    var ac_crelimit = response['a_mast'].CrLimit;
                    var ac_iecno = response['a_mast'].ac_iecno;
                    var ac_website = response['a_mast'].ac_website;
                    var ac_email = response['a_mast'].Email;
                    var ac_phoff = response['a_mast'].ac_phoff;
                    var ac_phres = response['a_mast'].ac_phres;
                    var ac_phmob = response['a_mast'].MobileNo;
                    var ac_phfax = response['a_mast'].ac_phfax;
                    var ac_cont = response['a_mast'].ac_cont;
                    var ac_PrintType = response['a_mast'].ac_PrintType;
                    var ac_APMC = response['a_mast'].ac_APMC;
                    var ac_add2 = response['a_mast'].ac_add2;
                    var ac_intrestper = response['a_mast'].ac_intrestper;
                    var ac_taxnm = response['a_mast'].ac_taxnm;
                    var ac_fccino = response['a_mast'].ac_fccino;
                    var ac_creditdys = response['a_mast'].ac_creditdys;
                    var ac_pincode = response['a_mast'].ac_pincode;
                    var ac_transportCode = response['a_mast'].ac_transportCode;

                    $('#pincodeupdate').html(ac_pincode);
                    $('.ac_add2').val(ac_add2);
                    $('.ac_intrestper').val(ac_intrestper);
                    $('.ac_taxnm').val(ac_taxnm).trigger('change');
                    $('.ac_fccino').val(ac_fccino);
                    $('.ac_creditdys').val(ac_creditdys);
                    $('.vhpxaccount').val(vhpxaccount);
                    $('.ac_name').val(ac_name);
                    $('.ac_pan').val(ac_pan);
                    $('.ac_code').val(ac_code);
                    $('.ac_add1').val(ac_add1);
                    $('.ac_area').val(ac_area);
                    $('.ac_gstin').val(ac_gstin);
                    $('.ac_crelimit').val(ac_crelimit);
                    $('.ac_iecno').val(ac_iecno);
                    $('.ac_website').val(ac_website);
                    $('.ac_email').val(ac_email);
                    $('.ac_phoff').val(ac_phoff);
                    $('.ac_phres').val(ac_phres);
                    $('.ac_phmob').val(ac_phmob);
                    $('.ac_phfax').val(ac_phfax);
                    $('.ac_cont').val(ac_cont);
                    $('.ac_transportCode').val(ac_transportCode);
                    $('.ac_PrintType').val(ac_PrintType).trigger('change');
                    $('.ac_APMC').val(ac_APMC).trigger('change');
                    if (broker_Code != null) {
                        var brnm = broker_Code.ACName;
                        var brid = broker_Code._id;
                        var option = new Option(brnm, brid, true, true);
                        $('#broker').append(option).trigger('change');
                        $('#broker').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": brid, "text": brnm }
                            }
                        });
                    }
                    if (sl_Person != null) {
                        var slnm = sl_Person.ACName;
                        var slid = sl_Person._id;
                        var option = new Option(slnm, slid, true, true);
                        $('#SaleMan').append(option).trigger('change');
                        $('#SaleMan').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": slid, "text": slnm }
                            }
                        });
                    }
                    if (ac_groupname != null) {
                        var ac_GroupName = ac_groupname.GroupName;
                        var ac_GroupNameid = ac_groupname._id;
                        var option = new Option(ac_GroupName, ac_GroupNameid, true, true);
                        $('#groupnameupdate').append(option).trigger('change');
                        $('#groupnameupdate').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": ac_GroupNameid, "text": ac_GroupName }
                            }
                        });
                    }
                    if (ac_city != null) {
                        var cityname = ac_city.CityName;
                        var citynameid = ac_city._id;
                        var option = new Option(cityname, citynameid, true, true);
                        $('#cityupdate').append(option).trigger('change');
                        $('#cityupdate').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": citynameid, "text": cityname }
                            }
                        });
                    }
                    if (ac_state != null) {
                        var statename = ac_state.StateName;
                        var stateid = ac_state._id;
                        var option = new Option(statename, stateid, true, true);
                        $('#stateupdate').append(option).trigger('change');
                        $('#stateupdate').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": stateid, "text": statename }
                            }
                        });
                    }
                    if (ac_ptype != null) {
                        var partytypdes = ac_ptype.Description;
                        var parttypeid = ac_ptype._id;
                        var option = new Option(partytypdes, parttypeid, true, true);
                        $('#ptypeupdate').append(option).trigger('change');
                        $('#ptypeupdate').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": parttypeid, "text": partytypdes }
                            }
                        });
                    }
                    if (ac_taxnm != null) {
                        var taxname = ac_taxnm.tx_Thead;
                        var taxnameid = ac_taxnm._id;
                        var option = new Option(taxname, taxnameid, true, true);
                        $('#taxnmupdate').append(option).trigger('change');
                        $('#taxnmupdate').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": taxnameid, "text": taxname }
                            }
                        });
                    }
                }

            }
        });
    }
}
// Sale Entry Modal According Lot
function ShowLotDataModalInSaleBill() {
    var values = $("input[name='lotno']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var lotno = idx;
    // alert(lotno)
    // $('#ShowLotData').modal('show');
    $.ajax({
        type: 'GET',
        url: '/Sales_Entry/GetLotDataInModal',
        dataType: 'json',
        data: {
            lotno: lotno
        },
        success: function (data) {
            console.log(data)
            var newHtml = '';
            if (data['success']) {
                var garudata = data['LotDataArr']
                $('#ShowLotData').modal('show');
                if (lotno == '' || lotno == null || isNaN(lotno)) {
                    $.each(garudata, function (index, value) {
                        // var trfl;
                        // if(lotno == '' || lotno == null || isNaN(lotno)){trfl = true}
                        // else{trfl = false}
                        // if((value.qty_blc>0) && ((value.lot_No == lotno)||trfl)){
                        // if(value.lot_No == lotno){}
                        newHtml += '<tr>';
                        newHtml += '<td style="text-align:left">' + value.gdn_Cd_Name.Description + '</td>';
                        newHtml += '<td style="text-align:center">' + value.lot_No + '</td>';
                        newHtml += '<td style="text-align:left">' + value.item_Code_Desc.item_title + '</td>';
                        newHtml += '<td style="text-align:left">' + value.purchase_Ac_Title.ACName + '</td>';
                        newHtml += '<td style="text-align:left">' + value.marks + '</td>';
                        newHtml += '<td style="text-align:right">' + value.qntty + '</td>';
                        if (value.pkng == '' || value.pkng == null) value.pkng = 0;
                        newHtml += '<td style="text-align:right">' + value.pkng + '</td>';
                        newHtml += '<td style="text-align:center">' + value.QW + '</td>';
                        if (value.bardan_Gross_Amount == '' || value.bardan_Gross_Amount == null) value.bardan_Gross_Amount = 0;
                        newHtml += '<td style="text-align:right">' + value.bardan_Gross_Amount + '</td>';
                        newHtml += '<td style="text-align:center">' + value.apmc + '</td>';
                        if (value.apmc_Amount == '' || value.apmc_Amount == null) value.apmc_Amount = 0;
                        newHtml += '<td style="text-align:right">' + value.apmc_Amount + '</td>';
                        newHtml += '<td style="text-align:center">' + value.ec + '</td>';
                        if (value.entry_Tax == '' || value.entry_Tax == null) value.entry_Tax = 0;
                        newHtml += '<td style="text-align:right">' + value.entry_Tax + '</td>';
                        if (value.GST == '' || value.GST == null) value.GST = 0;
                        newHtml += '<td style="text-align:right">' + value.GST + '</td>';
                        if (value.vakal_Thok == '' || value.vakal_Thok == null) value.vakal_Thok = 0;
                        newHtml += '<td style="text-align:right">' + value.vakal_Thok + '</td>';
                        newHtml += '<td style="text-align:right">' + value.dana_Rt + '</td>';
                        newHtml += '</tr>';
                    });
                } else {
                    $.each(garudata, function (index, value) {
                        if (value.lot_No == lotno) {
                            newHtml += '<tr>';
                            newHtml += '<td style="text-align:left">' + value.gdn_Cd_Name.Description + '</td>';
                            newHtml += '<td style="text-align:center">' + value.lot_No + '</td>';
                            newHtml += '<td style="text-align:left">' + value.item_Code_Desc.item_title + '</td>';
                            newHtml += '<td style="text-align:left">' + value.purchase_Ac_Title.ACName + '</td>';
                            newHtml += '<td style="text-align:left">' + value.marks + '</td>';
                            newHtml += '<td style="text-align:right">' + value.qntty + '</td>';
                            if (value.pkng == '' || value.pkng == null) value.pkng = 0
                            newHtml += '<td style="text-align:right">' + value.pkng + '</td>';
                            newHtml += '<td style="text-align:center">' + value.QW + '</td>';
                            if (value.bardan_Gross_Amount == '' || value.bardan_Gross_Amount == null) value.bardan_Gross_Amount = 0
                            newHtml += '<td style="text-align:right">' + value.bardan_Gross_Amount + '</td>';
                            newHtml += '<td style="text-align:center">' + value.apmc + '</td>';
                            if (value.apmc_Amount == '' || value.apmc_Amount == null) value.apmc_Amount = 0
                            newHtml += '<td style="text-align:right">' + value.apmc_Amount + '</td>';
                            newHtml += '<td style="text-align:center">' + value.ec + '</td>';
                            if (value.entry_Tax == '' || value.entry_Tax == null) value.entry_Tax = 0
                            newHtml += '<td style="text-align:right">' + value.entry_Tax + '</td>';
                            if (value.GST == '' || value.GST == null) value.GST = 0
                            newHtml += '<td style="text-align:right">' + value.GST + '</td>';
                            if (value.vakal_Thok == '' || value.vakal_Thok == null) value.vakal_Thok = 0;
                            newHtml += '<td style="text-align:right">' + value.vakal_Thok + '</td>';
                            newHtml += '<td style="text-align:right">' + value.dana_Rt + '</td>';
                            newHtml += '</tr>';
                        } else {

                        }
                    });
                }
            }
            $('.dsi_repeat_row').html(newHtml);
            $('#closeLotData').focus();
        }
    });

}
$(document).on("keydown", function (e) {
    if (e.keyCode == 113) {
        var values = $("input[name='lotno']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1]
        var lotno = idx;
        // alert(lotno)
        // $('#ShowLotData').modal('show');
        $.ajax({
            type: 'GET',
            url: '/Sales_Entry/GetLotDataInModal',
            dataType: 'json',
            data: {
                lotno: lotno
            },
            success: function (data) {
                console.log(data)
                var newHtml = '';
                if (data['success']) {
                    var garudata = data['LotDataArr']
                    $('#ShowLotData').modal('show');
                    if (lotno == '' || lotno == null || isNaN(lotno)) {
                        $.each(garudata, function (index, value) {
                            // var trfl;
                            // if(lotno == '' || lotno == null || isNaN(lotno)){trfl = true}
                            // else{trfl = false}
                            // if((value.qty_blc>0) && ((value.lot_No == lotno)||trfl)){
                            // if(value.lot_No == lotno){}
                            newHtml += '<tr>';
                            newHtml += '<td style="text-align:left">' + value.gdn_Cd_Name.Description + '</td>';
                            newHtml += '<td style="text-align:center">' + value.lot_No + '</td>';
                            newHtml += '<td style="text-align:left">' + value.item_Code_Desc.item_title + '</td>';
                            newHtml += '<td style="text-align:left">' + value.purchase_Ac_Title.ACName + '</td>';
                            newHtml += '<td style="text-align:left">' + value.marks + '</td>';
                            newHtml += '<td style="text-align:right">' + value.qntty + '</td>';
                            if (value.pkng == '' || value.pkng == null) value.pkng = 0;
                            newHtml += '<td style="text-align:right">' + value.pkng + '</td>';
                            newHtml += '<td style="text-align:center">' + value.QW + '</td>';
                            if (value.bardan_Gross_Amount == '' || value.bardan_Gross_Amount == null) value.bardan_Gross_Amount = 0;
                            newHtml += '<td style="text-align:right">' + value.bardan_Gross_Amount + '</td>';
                            newHtml += '<td style="text-align:center">' + value.apmc + '</td>';
                            if (value.apmc_Amount == '' || value.apmc_Amount == null) value.apmc_Amount = 0;
                            newHtml += '<td style="text-align:right">' + value.apmc_Amount + '</td>';
                            newHtml += '<td style="text-align:center">' + value.ec + '</td>';
                            if (value.entry_Tax == '' || value.entry_Tax == null) value.entry_Tax = 0;
                            newHtml += '<td style="text-align:right">' + value.entry_Tax + '</td>';
                            if (value.GST == '' || value.GST == null) value.GST = 0;
                            newHtml += '<td style="text-align:right">' + value.GST + '</td>';
                            if (value.vakal_Thok == '' || value.vakal_Thok == null) value.vakal_Thok = 0;
                            newHtml += '<td style="text-align:right">' + value.vakal_Thok + '</td>';
                            newHtml += '<td style="text-align:right">' + value.dana_Rt + '</td>';
                            newHtml += '</tr>';
                        });
                    } else {
                        $.each(garudata, function (index, value) {
                            if (value.lot_No == lotno) {
                                newHtml += '<tr>';
                                newHtml += '<td style="text-align:left">' + value.gdn_Cd_Name.Description + '</td>';
                                newHtml += '<td style="text-align:center">' + value.lot_No + '</td>';
                                newHtml += '<td style="text-align:left">' + value.item_Code_Desc.item_title + '</td>';
                                newHtml += '<td style="text-align:left">' + value.purchase_Ac_Title.ACName + '</td>';
                                newHtml += '<td style="text-align:left">' + value.marks + '</td>';
                                newHtml += '<td style="text-align:right">' + value.qntty + '</td>';
                                if (value.pkng == '' || value.pkng == null) value.pkng = 0
                                newHtml += '<td style="text-align:right">' + value.pkng + '</td>';
                                newHtml += '<td style="text-align:center">' + value.QW + '</td>';
                                if (value.bardan_Gross_Amount == '' || value.bardan_Gross_Amount == null) value.bardan_Gross_Amount = 0
                                newHtml += '<td style="text-align:right">' + value.bardan_Gross_Amount + '</td>';
                                newHtml += '<td style="text-align:center">' + value.apmc + '</td>';
                                if (value.apmc_Amount == '' || value.apmc_Amount == null) value.apmc_Amount = 0
                                newHtml += '<td style="text-align:right">' + value.apmc_Amount + '</td>';
                                newHtml += '<td style="text-align:center">' + value.ec + '</td>';
                                if (value.entry_Tax == '' || value.entry_Tax == null) value.entry_Tax = 0
                                newHtml += '<td style="text-align:right">' + value.entry_Tax + '</td>';
                                if (value.GST == '' || value.GST == null) value.GST = 0
                                newHtml += '<td style="text-align:right">' + value.GST + '</td>';
                                if (value.vakal_Thok == '' || value.vakal_Thok == null) value.vakal_Thok = 0;
                                newHtml += '<td style="text-align:right">' + value.vakal_Thok + '</td>';
                                newHtml += '<td style="text-align:right">' + value.dana_Rt + '</td>';
                                newHtml += '</tr>';
                            } else {

                            }
                        });
                    }
                }
                $('.dsi_repeat_row').html(newHtml);
                $('#closeLotData').focus();
            }
        });
    }
})
$('#closeLotData').on('keydown', function (e) {
    if (e.keyCode == 13 || e.keyCode == 27) {
        $('#ShowLotData').modal('hide');
        $('#lot_No0').focus();
    }
});
$(document).on('keydown', '.CalRoundOff', function (e) {
    if (e.keyCode == 82) calRoundoffSale()
})
async function calRoundoffSale() {
    // alert('s')
    $("#AmountParticular4").val(0)
    $("#lessamtParticular1").val(0)
    var a = await calSaleAddless();
    var amt = $("#gross_Amt").val();
    var r = amt - Math.floor(amt);
    var addlessRoundoff = 1 - parseFloat(r);
    console.log(r, addlessRoundoff)
    if (r != 0) {
        if (addlessRoundoff >= 0.50) {
            $("#AmountParticular4").val(0)
            $("#lessamtParticular1").val(((r.toFixed(2))))
        }
        if (addlessRoundoff < 0.50) {
            $("#lessamtParticular1").val(0)
            $("#AmountParticular4").val((addlessRoundoff.toFixed(2)))
        }
        calSaleAddless()
    }
}

function FocusNextSaleEntryUpdate(e, i) {
    e.preventDefault();
    if (e.keyCode == 13) {
        var a = i + 1;
        $('#lot_No' + a).focus()
    }
}

$(document).on('click', '.delete_SaleEntry', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'DELETE',
                url: '/Sales_Entry/delete/' + id,
                success: function (response) {
                    $('.loader').hide();
                    window.location.href = '/Sales_Entry/Sales_Entry_List';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    })
});

$(document).on('click', '.CNCL_SaleEntry', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    let idx = $(this).attr('data-idx');
    swal({
        title: "Confirm",
        text: "Are you Sure you want to Cancel This Invoice?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'GET',
                url: '/Sales_Entry/Sales_Entry_CNCL/' + id,
                success: function (response) {
                    $('.loader').hide();
                    $('#SaleEntry_List' + idx).css({ "backgroundColor": "red", "color": "black" });
                    // window.location.href = '/Sales_Entry/Sales_Entry_List';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    })
});
// Sales Entry End



// ##################################################################################################################################################################################//
// Bill Collection Start 
$(document).on('keydown', '#bill_Collection_Entry_Add', function (e) {
    if (e.keyCode == 13) {
        $("#bill_Collection_Entry_Add").click();
    }
})
$(document).on('click', '#bill_Collection_Entry_Add', async function (e) {
    if ($('#Bill_CollectionEntrySubmit').valid()) {
        $('#Bill_CollectionEntrySubmit').submit();
        $("#bill_Collection_Entry_Add").hide();
    }
})
$('body').on('keydown', '.addBillColfocus', function (e) {
    var tr = $(this).parents('tr').index();
    if (e.keyCode == 13) {
        var answer = true; //confirm('Do you want to add new Row?') $('#BillCollectionEntryData').click();
        if (answer) {
            var kasar = $(this).val();
            if (kasar > 50) {
                $(this).focus();
            }
            else $('#addgaru').click();
        } else { $('.delv_load').focus(); }
        setTimeout(function () { $('.addbillColl tr:nth-child(' + (tr + 3) + ')').find('.selectproductfocus').focus(); }, 150);
    }
})
function deleteBilColGroupEntry(i) {
    lstidx = $("input[name*='cashtrn']").length
    var a = confirm('Are You Want To Delete It');
    if (a == true && lstidx > 1) {
        $('#GaruTr0' + i).remove();
        $('#GaruTr1' + i).remove();
        $('#GaruTr2' + i).remove();
        $('#GaruTr3' + i).remove();
        $("#Bill_No" + (i - 1)).focus();
    }
}
function BillCollEsc(index, e) {
    if (e.keyCode == 27) {
        $('#GaruTr0' + index).remove();
        $('#GaruTr1' + index).remove();
        $('#GaruTr2' + index).remove();
        $('#GaruTr3' + index).remove();
        $(".delv_load").focus();
    }
}

function FocusNextBCDetail(e, idx, index) {
    if (e.keyCode == 38) {
        var idx = parseInt(idx) - 1;
        setTimeout(function () { $('#Bill_No_In_modal' + idx).focus() }, 100);
    }
    if (e.keyCode == 40) {
        var idx = parseInt(idx) + 1;
        setTimeout(function () { $('#Bill_No_In_modal' + idx).focus() }, 100);
    }
    if (e.keyCode == 13) {
        alert(index);
        $('#Bill_No' + index).val($('#Bill_No_In_modal' + idx).attr('data-vouccode'));
        setTimeout(function () { $('#Bill_No' + index).focus() }, 100);
        $('#OutstandingModalIn_BC').modal('hide');
    }
}
function getOutstandingModalInBC(idx) {
    var party_Code = $('#cashac_name' + idx).val();
    var Form = $('#Form').val();
    if (Form == 'BillCollection_Add_Form') {
        if (party_Code == null || party_Code == '') {
            swal({
                title: 'Oops!',
                text: 'Please Select Party First',
                buttons: false,
                timer: 1500
            })
        } else {
            $.ajax({
                type: 'GET',
                url: '/Bill_CollectionEntry/getSaleBillModal',
                dataType: 'json',
                data: {
                    party_Code: party_Code //billCollactionModal
                },
                success: function (data) {
                    var result = '';
                    if (data['success'] == true) {
                        var delveryentry1 = data['outstanding'];
                        var div = data['division'];
                        if (delveryentry1.length > 0) $("#OutstandingModalIn_BC").modal('show');
                        else $('#FssiNo').focus()
                        $.each(delveryentry1, function (index, value) {
                            var filterstartdate = moment(value.cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                            result += '<tr>';
                            result += '<td><input type="text" id="Bill_No_In_modal' + index + '" value="' + value.main_bk + '/' + value.c_j_s_p + '/' + value.vouc_code + '" data-mainbk = "' + value.main_bk + '" data-cjsp = "' + value.c_j_s_p + '" data-voucCode = "' + value.vouc_code + '" onfocus="ShowSaleEntryDetail(' + index + ')" onkeydown="FocusNextBCDetail(event,' + index + ',' + idx + ')" class="form-control" style="text-align: center"></td>';
                            result += '<td><input type="text" name="BillDate" id="BillDate' + index + '" value="' + filterstartdate + '" class="form-control nofocus" readonly style="text-align: center"></td>';
                            if (value.Bill_Amount == null || value.Bill_Amount == '' || value.Bill_Amount == undefined) value.Bill_Amount = 0;
                            if (value.cash_amount == null || value.cash_amount == '' || value.cash_amount == undefined) value.cash_amount = 0;
                            result += '<td><input type="number" name="BillAmt" id="BillAmt' + index + '" value="' + value.Bill_Amount + '" class="form-control nofocus"  readonly></td>';
                            if (value.Rec_Amount == null || value.Rec_Amount == '' || value.Rec_Amount == undefined) value.Rec_Amount = 0;
                            result += '<td><input type="number" name="BillAmt" id="BillAmt' + index + '" value="' + value.Rec_Amount.toFixed(2) + '" class="form-control nofocus"  readonly></td>';
                            if (value.Add_Ded_Amt_Tot == null || value.Add_Ded_Amt_Tot == '' || value.Add_Ded_Amt_Tot == undefined) value.Add_Ded_Amt_Tot = 0;
                            result += '<td><input type="number" name="BillAmt" id="BillAmt' + index + '" value="' + parseFloat(value.Add_Ded_Amt_Tot).toFixed(2) + '" class="form-control nofocus"  readonly></td>';
                            if (value.outstanding_balance == null || value.outstanding_balance == '' || value.outstanding_balance == undefined) value.outstanding_balance = 0;
                            result += '<td><input type="number" name="BalanceDue" id="BalanceDue' + index + '" value="' + value.outstanding_balance.toFixed(2) + '" class="form-control nofocus" readonly></td>';
                            result += '<td><input type="number" name="IntDue" id="IntDue' + index + '" value="" class="form-control nofocus" readonly></td>';
                            if (value.broker_Code == null || value.broker_Code == undefined || value.broker_Code == '') var brname = '';
                            else var brname = value.broker_Code.ACName;
                            result += '<td><input type="text" name="BrokerName" id="BrokerName' + index + '" value="' + brname + '" class="form-control nofocus" readonly></td>';
                            // result += '<input type="hidden" name="BrokerName" id="BrokerNameId' + index + '" value="' + value.broker_Code._id + '" class="form-control" readonly></td>';
                            for (let i = 0; i < div.length; i++) {
                                if (div[i]._id == value.div_code) result += '<td><input type="text" name="Firm" id="Firm' + index + '" value="' + div[i].div_mast + '" class="form-control nofocus" readonly></td>';
                                else result += '<td><input type="text" name="Firm" id="Firm' + index + '" value="" class="form-control nofocus" readonly></td>';
                            }
                            result += '</tr>';
                        });
                        // sau = '<input type="button"  value="OK" id="delivery_sauda" class="btn btn-primary" />';
                    }
                    $('#Outstanding_Modal_In_BC').html(result);
                    setTimeout(function () { $('#Bill_No_In_modal0').focus(); }, 100);
                    if (delveryentry1.length) {
                        $('#deliverysupport').modal('show');
                    } else {
                        swal({
                            title: 'Oops!',
                            text: 'No Pending Outstanding',
                            buttons: false,
                            timer: 1500
                        })
                    }
                }
            });
        }
    }
}
$(document).on('click', '.addBillCollectionEntry', function () {
    var count = 0;
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    var billno = $('#Bill_No' + idx).val()
    if (billno == null || billno == '' || billno == undefined) {
        alert('Please Fill Bill No.');
        $('#Bill_No' + idx).focus();
    }
    else {
        $('#Kasar' + idx).removeClass('addBillColfocus');
        $.ajax({
            type: 'GET',
            url: '/Garu_Aavak_Entry/productname',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    var product = data['product'];
                    var gowdown = data['gowdown'];
                    var account_masters = data['account_masters'];
                    var newHtml = '';
                    newHtml += '<tr id="GaruTr0' + lstidx + '">';
                    newHtml += '<td colspan="10" style="background-color:#4b77be">&nbsp;</td>';
                    newHtml += '</tr>';
                    newHtml += '<tr id="GaruTr1' + lstidx + '">';
                    newHtml += '<td>';
                    newHtml += '<strong>Bill No</strong>';
                    newHtml += '<input type="hidden" name="cashtrn" value="' + lstidx + '" id="dsirn' + lstidx + '">';
                    newHtml += '<input type="text" name="Bill_No" id="Bill_No' + lstidx + '" onkeyup="BillCollEsc(' + lstidx + ',event)" onkeydown="getBillData(' + lstidx + ',event)" ';
                    newHtml += ' class="form-control selectproductfocus" style="text-align: -webkit-right;"  placeholder="Bill No"  required/>';//onclick="getBillDataOnClick('+lstidx+')"
                    newHtml += '</td>';
                    newHtml += '<td>';
                    newHtml += '<strong>Date</strong>';
                    newHtml += '<input type="text" name="Date"  id="Date' + lstidx + '" data-id="' + lstidx + '" class="form-control datemask" style="text-align: -webkit-right;" placeholder="Date" />';
                    newHtml += '</td>';
                    newHtml += '<td colspan="3">';
                    newHtml += '<strong>Name Of The Party</strong>';
                    newHtml += '<select  name="cashac_name" id="cashac_name' + lstidx + '"  class="form-control party" style="width:100%"';
                    newHtml += 'placeholder="Select Product" style="width: 100%">';
                    newHtml += '<option value=""></option>';
                    newHtml += '</select>';
                    newHtml += '</td>';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Place</strong>';
                    newHtml += '<input type="text" name="place" placeholder="Place"  id="place' + lstidx + '" class="form-control" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += '<td colspan="3">';
                    newHtml += '<strong class="control-strong">Broker</strong>';
                    newHtml += '<input type="hidden" name="out_id" id="out_id' + lstidx + '">';
                    newHtml += '<select  name="broker_Code" id="broker_Code' + lstidx + '"  class="form-control prbank broker" style="width:100%"';
                    newHtml += 'placeholder="Select Product" style="width: 100%">';
                    newHtml += '<option value=""></option>';
                    newHtml += '</select>';
                    newHtml += '</td>';

                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Bill Amount</strong>';
                    newHtml += '<input type="number" name="Bill_Amt" placeholder="Bill Amount"  id="Bill_Amt' + lstidx + '" oninput="calBillCollection(' + lstidx + ')" class="form-control" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += '</tr>';

                    newHtml += '<tr id="GaruTr2' + lstidx + '">';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Balance Due</strong>';
                    newHtml += '<input type="number" name="Balance_Due" placeholder="Balance Due"  id="Balance_Due' + lstidx + '" oninput="calBillCollection(' + lstidx + ')" class="form-control" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    //    newHtml +='<td>';
                    //    newHtml +='<strong class="control-strong">Int_Due</strong>';
                    //    newHtml +='<input type="number" name="Int_Due" placeholder="Int Due"  id="Int Due'+lstidx+'" class="form-control" oninput="calBillCollection('+lstidx+')"  style="text-align: -webkit-right;" />';
                    //    newHtml +='</td>';
                    //    newHtml +='<td >';
                    //    newHtml +='<strong class="control-strong">Bal Int</strong>';
                    //    newHtml +='<input type="number" name="Bal_Int"  id="Bal_Int'+lstidx+'" placeholder="Bal Int" class="form-control" oninput="calBillCollection('+lstidx+')" style="text-align: -webkit-right;" />';
                    //    newHtml +='</td>';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Days</strong>';
                    newHtml += '<input type="number" name="Days"  id="Days' + lstidx + '" placeholder="Days" class="form-control" oninput="calBillCollection(' + lstidx + ')" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Int Per</strong>';
                    newHtml += '<input type="hidden" name="Intrestdays" placeholder="Intrest" id="Intrestdays' + lstidx + '" oninput="calBillCollection(' + lstidx + ')"/>';
                    newHtml += '<input type="number" name="Int Per"  id="Int_Per' + lstidx + '" placeholder="Int Per" class="form-control" oninput="calBillCollection(' + lstidx + ')" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Intrest</strong>';
                    newHtml += '<input type="number" name="Intrest" placeholder="Intrest" id="Intrest' + lstidx + '" class="form-control" value="0" oninput="calBillCollection(' + lstidx + ')" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Discount</strong>';
                    newHtml += '<input type="number" name="Dis_Amt" placeholder="Discount %" id="Dis_Amt' + lstidx + '" class="form-control" value="0" oninput="calBillCollection(' + lstidx + ')" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">CRChgs</strong>';
                    newHtml += '<input type="text" name="CRChgs" placeholder="CRChgs"  id="CRChgs' + lstidx + '" class="form-control" oninput="calBillCollection(' + lstidx + ')" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Chithi</strong>';
                    newHtml += '<input type="text" name="Chithi" placeholder="Chithi"  id="Chithi' + lstidx + '" class="form-control" oninput="calBillCollection(' + lstidx + ')" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Amt Settled</strong>';
                    newHtml += '<input type="hidden" name="amtset" id="amtset' + lstidx + '" oninput="calBillCollection(' + lstidx + ')"/>';
                    newHtml += '<input type="text" name="Amt_Settled" placeholder="Amt Settled"  id="Amt_Settled' + lstidx + '" class="form-control" oninput="calBillCollection(' + lstidx + ')" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += '<td>';
                    newHtml += '<strong class="control-strong">Kasar</strong>';
                    newHtml += '<input type="text" name="Kasar" placeholder="Kasar"  id="Kasar' + lstidx + '" class="form-control addBillColfocus" oninput="calBillCollection(' + lstidx + ')" style="text-align: -webkit-right;" />';
                    newHtml += '</td>';
                    newHtml += "<td></br></br><a onclick='deleteBilColGroupEntry(" + lstidx + ")' style='cursor:pointer;'><i class='fa fa-times'  style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                    newHtml += '</tr>';
                    $(newHtml).insertBefore("#Garu_Aavak_Entry_Group_Add");
                    $('.party').select2({
                        placeholder: 'Please select Party',
                        allowClear: true,
                        ajax: {
                            type: "GET",
                            url: '/Garu_Aavak_Entry/customerName',
                            dataType: 'json',
                            data: function (term) {
                                return {
                                    term: term
                                };
                            },
                            success: function (data) {
                            },
                        },
                        templateResult: formatcity,
                        templateSelection: formatcity,
                        escapeMarkup: function (m) { return m; }
                    });
                    $(".BillDate").datepicker({
                        changeMonth: true,
                        changeYear: true,
                        dateFormat: 'dd/mm/yy',
                    });
                    $('.datemask').inputmask("99/99/9999");
                    $('.BillDate').on('changeDate', function (ev) {
                        $(this).datepicker('hide');
                    });
                    $('.broker').select2({
                        placeholder: 'Please select Broker',
                        allowClear: true,
                        ajax: {
                            type: "GET",
                            url: '/Garu_Aavak_Entry/broker_Code',
                            dataType: 'json',
                            data: function (term) {
                                return {
                                    term: term
                                };
                            },
                            success: function (data) {
                            },
                        },
                        templateResult: formatcity,
                        templateSelection: formatcity,
                        escapeMarkup: function (m) { return m; }
                    })
                    $("input").focus(function () {
                        $(this).select();
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
                    count = 0;
                }
            }
        });
    }
});
// Bill Collection Calculation
function calBillCollection(i) {
    var Intrest = 0;
    var discount = 0;
    var CRChgs = 0;
    var Chithi = 0;
    var amtset = 0;
    var Amt_Settled = 0
    // amt = $('#cash_amount'+idx).val();
    // Balance_Due = $('#Balance_Due'+idx).val();
    // $('#Balance_Due'+idx).val(parseFloat(Balance_Due)-parseFloat(amt));
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var lst = parseInt(idx);
    var amt = 0
    var tot_amt = 0;
    var stamt = 0;
    var DueAmt = 0;
    for (let i = 0; i <= lst; i++) {
        amt = $('#Bill_Amt' + i).val();
        stamt = $('#Amt_Settled' + i).val();
        if (amt == '') amt = 0;
        if (stamt == '') stamt = 0;
        tot_amt = tot_amt + parseFloat(stamt);
        Intrest = $('#Intrest' + i).val()
        if (Intrest == '') Intrest = 0;
        discount = $('#discount' + i).val()
        if (discount == '') discount = 0;
        CRChgs = $('#CRChgs' + i).val();
        if (CRChgs == '') CRChgs = 0;
        Chithi = $('#Chithi' + i).val();
        if (Chithi == '') Chithi = 0;
        // console.log(amt,Intrest,discount,CRChgs,Chithi)
        DueAmt = $('#Balance_Due' + i).val();
        amtset = parseFloat(DueAmt) + parseFloat(Intrest) + parseFloat(CRChgs) + parseFloat(CRChgs) + parseFloat(Chithi) - parseFloat(discount)
        $('#amtset' + i).val(amtset);
        Amt_Settled = $('#Amt_Settled' + i).val();
        if (Amt_Settled == '') Amt_Settled = 0;
        // calKasar(i)
        // totamtset(i)
        // $('#Amt_Settled'+i).val(amtset.toFixed(2));
        // $('#Kasar'+i).val((amtset-parseFloat(Amt_Settled)).toFixed(2));
    }
    $('#tot_Amt').val(tot_amt);
    $('#tot_Cash_Amount').val(tot_amt);
    CreatBillCollRemark()
}

// bill Collection Outstanding Modal In BillCOllection
function getBillData(idx, e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        var BillNo = $('#Bill_No' + idx).val();
        if (BillNo == null || BillNo == '') {
            swal({
                title: 'Oops!',
                text: 'Please Fill Bill Number',
                buttons: false,
                timer: 1500
            }).then(function () { $('#Bill_No' + idx).focus() })
        } else { getBillCollectionModal(BillNo, idx) }
    }
}
function FocusNextSaleEntryInBillCollection(e, idx) {
    if (e.keyCode == 38) {
        var index = parseInt(idx) - 1;
        setTimeout(function () {
            $('#Selection' + index).focus();
            // $('#Selection'+idx).attr('checked',true);
        }, 100);
    }
    if (e.keyCode == 40) {
        var index = parseInt(idx) + 1;
        setTimeout(function () {
            $('#Selection' + index).focus();
            // $('#Selection'+idx).attr('checked',true);
        }, 100);
    }
    if (e.keyCode == 32) {
        $('#Selection' + idx).click();
    }
}
function getBillCollectionModal(BillNo, idx) {
    var BillNo = BillNo;
    $.ajax({
        type: 'GET',
        url: '/Bill_CollectionEntry/GetBillCollectionModal',
        dataType: 'json',
        data: {
            BillNo: BillNo
        },
        success: function (data) {
            console.log(data);
            var result = '';
            var autoFocus = 0;
            if (data['success'] == true) {
                var delveryentry1 = data['garudata'];
                if (delveryentry1 == null || delveryentry1 == '' || delveryentry1 == []) {
                    swal({
                        title: 'Oops!',
                        text: 'Outstanding Is Not Panding',
                        buttons: false,
                        timer: 2000
                    })
                }
                else {

                    $("#billCollactionModal").modal('show');
                    // console.log(delveryentry1);
                    $.each(delveryentry1, function (index, value) {
                        // if(value['Kasar'] == 0)
                        // {
                        var filterstartdate = moment(value.cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        result += '<tr>';
                        if (BillNo == value.vouc_code) {
                            autoFocus = index;
                            result += '<td align="center"><input type="checkbox" name="Selection" id="Selection' + index + '" onkeydown="FocusNextSaleEntryInBillCollection(event,' + index + ')" checked value="' + index + '"></td>';
                        }
                        else { result += '<td align="center"><input type="checkbox" name="Selection" id="Selection' + index + '" onkeydown="FocusNextSaleEntryInBillCollection(event,' + index + ')" value="' + index + '"></td>'; }
                        if (BillNo == value.vouc_code) { result += '<td><input type="text" name="Status" id="Status' + index + '"  value="Main" class="form-control" readonly><td>'; }
                        else { result += '<td><input type="text" name="Status" id="Status' + index + '" value="" class="form-control" readonly><td>'; }
                        result += '<td>';
                        result += '<input type="text" id="Bill_noInModal' + index + '" value="' + value.vouc_code + '" class="form-control" readonly>';
                        result += '<input type="hidden" id="div_code' + index + '" value="' + value.div_code + '">';
                        result += '<input type="hidden" id="co_code' + index + '" value="' + value.co_code + '">';
                        result += '<input type="hidden" id="c_j_s_p' + index + '" value="' + value.c_j_s_p + '">';
                        result += '<td>';
                        result += '<td><input type="text" name="c_j_s_p"  value="' + value.c_j_s_p + '" class="form-control" readonly></td>';
                        result += '<td><input type="text" name="BillDate"   id="BillDate' + index + '" value="' + filterstartdate + '" class="form-control" readonly></td>';
                        result += '<td><input type="text" name="BillAmt"    id="BillAmt' + index + '" value="' + (value.cash_amount).toFixed(2) + '" class="form-control"  readonly></td>';
                        result += '<td><input type="text" name="BalanceDue" id="BalanceDue' + index + '" value="' + (value.outstanding_balance).toFixed(2) + '" class="form-control" readonly></td>';
                        result += '<td><input type="text" name="IntDue"     id="IntDue' + index + '" value="" class="form-control" readonly></td>';
                        result += '<td><input type="text" name="BrokerName" id="BrokerName' + index + '" value="' + value.broker_Code.ACName + '" class="form-control" readonly>';
                        result += '<input type="hidden"   name="BrokerName" id="BrokerNameId' + index + '" value="' + value.broker_Code._id + '" class="form-control" readonly></td>';
                        result += '<td><input type="text" name="Firm"       id="Firm' + index + '" value="" class="form-control"></td>';
                        result += '</tr>';
                        // }
                    });
                }
                sau = '<input type="button"  value="OK" id="delivery_sauda" class="btn btn-primary" />';
            } else {
                swal({
                    title: 'Oops!',
                    text: 'Please Enter A Valid Sales Entry Number',
                    buttons: false,
                    timer: 2000
                }).then(function () { $('#Bill_No' + idx).focus() })
            }
            $('.Bill_Collection_Modal').html(result);
            $('#Selection' + autoFocus).focus();
        }
    });
}

function totamtset(i) {
    var amt = parseFloat($('#amtset' + i).val())
    $('#Amt_Settled' + i).val(amt.toFixed(2))
    calBillCollection(1)
    CreatBillCollRemark()
}
function calKasar(e, i) {
    if (e.keyCode == 13) {
        var Amt_Settled = $('#Amt_Settled' + i).val();
        var amtset = $('#amtset' + i).val();
        var kasar = (parseFloat(amtset) - parseFloat(Amt_Settled)).toFixed(2)
        $('#Kasar' + i).val(kasar);
        calBillCollection(1)
        CreatBillCollRemark()
    }
}
function FocusNextBill(e, i) {
    if (e.keyCode == 13) {
        e.preventDefault();
        var kasar = $('#Kasar' + i).val();
        if (kasar > 50) $('#Kasar' + i).focus();
        else {
            var a = i + 1;
            $('#Days' + a).focus()
        }
    }
}
function FocusNextBillInUpdate(e, i) {
    e.preventDefault();
    if (e.keyCode == 13) {
        var a = i + 1;
        $('#Bill_No' + a).focus()
    }
}
function FocusNextBillSeccond(e, i) {
    if (e.keyCode == 13) {
        e.preventDefault();

        $('#Bill_No' + (i + 1)).focus()
    }
    if (e.keyCode == 27) {
        $('#tot_Cash_Amount').focus()
    }
}

$('#billCollactionModal').on('keydown', function (e) {
    e.preventDefault();
    if (e.keyCode == 13) {
        $('#BillCollectionEntryData').click();
    }
})

function setBillData() {
    $("#billCollactionModal").modal('hide');
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var indx = parseInt(idx);
    console.log('Bill', indx);
    // if(indx == 0){
    $('#bilThead').remove();
    $('#GaruTr0' + indx).remove();
    $('#GaruTr1' + indx).remove();
    $('#GaruTr2' + indx).remove();
    $('#GaruTr3' + indx).remove();
    // }
    var j = indx;
    var len = $("input[name*='Selection']").length;
    // var lenchecked = $("[name='Selection']:checked").length;
    var lenchecked = $("[name='Selection']:checked")
        .map(function () { return $(this).val(); }).get();
    var chidx = lenchecked[lenchecked.length - 1]
    console.log(lenchecked, chidx);
    console.log(len + indx)
    // chidx = len+indx-1;
    for (let i = 0; i < len + indx; i++) {
        if ($("#Selection" + i).prop("checked")) {
            var BillNo = $('#Bill_noInModal' + i).val();
            var c_j_s_p = $('#c_j_s_p' + i).val();
            var co_code = $('#co_code' + i).val();
            var div_code = $('#div_code' + i).val();
            $.ajax({
                type: 'GET',
                url: '/Sales_Entry/BillNoData',
                dataType: 'json',
                data: {
                    BillNo: BillNo,
                    c_j_s_p: c_j_s_p
                },
                success: function (data) {
                    console.log(data)
                    if (data['success']) {
                        var value = data['garudata'];
                        var newHtml = '';
                        newHtml += '<tr id="GaruTr0' + j + '">';
                        newHtml += '<td colspan="11" style="background-color:#4b77be">&nbsp;</td>';
                        newHtml += '</tr>';
                        newHtml += '<tr id="GaruTr1' + j + '">';
                        newHtml += '<td>';
                        newHtml += '<strong>Bill No</strong>';
                        newHtml += '<input type="hidden" name="cashtrn" value="' + j + '" id="dsirn' + j + '">'; //onkeydown="getBillData('+j+',event)"
                        newHtml += '<input type="text" name="Bill_No[' + j + ']" id="Bill_No' + j + '" onkeyup="BillCollEsc(' + j + ',event)" onkeydown="getBillData(' + j + ',event)"';
                        newHtml += ' class="form-control selectproductfocus" style="text-align: -webkit-right;"  placeholder="Bill No" value="' + value.vouc_code + '"/>';
                        newHtml += '</td>';
                        var dt = moment(value.cash_date).format('DD/MM/YYYY');
                        newHtml += '<td>';
                        newHtml += '<strong>Date</strong>';
                        newHtml += '<input type="text" name="Date[' + j + ']" value="' + dt + '"  id="Date' + j + '" data-id="' + j + '" class="form-control BillDate" style="text-align: -webkit-right;" placeholder="Lot No" />';
                        newHtml += '</td>';
                        newHtml += '<td colspan="3">';
                        newHtml += '<strong>Name Of The Party</strong>';
                        newHtml += '<select  name="cashac_name[' + j + ']" id="cashac_name' + j + '"  class="form-control party" style="width:100%"';
                        newHtml += 'placeholder="Select Product" style="width: 100%">';
                        newHtml += '<option value="' + value.cashac_name._id + '">' + value.cashac_name.ACName + '</option>';
                        newHtml += '</select>';
                        newHtml += '</td>';
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Place</strong>';
                        newHtml += '<input type="text" value="' + value.cashac_name.CityName.CityName + '" name="place[' + j + ']" placeholder="Place"  id="place' + j + '" class="form-control" style="text-align: -webkit-right;" />';
                        newHtml += '</td>';
                        newHtml += '<td colspan="3">';
                        newHtml += '<strong class="control-strong">Broker</strong>';
                        newHtml += '<input type="hidden" name="out_id" id="out_id' + j + '">';
                        newHtml += '<select  name="broker_Code[' + j + ']" id="broker_Code' + j + '"  class="form-control broker" style="width:100%"';
                        newHtml += 'placeholder="Select Product" style="width: 100%">';
                        if (value.broker_Code == null || value.broker_Code == '') {
                            var brokernm = ''
                            var brokerid = ''
                        } else {
                            var brokernm = value.broker_Code.ACName;
                            var brokerid = value.broker_Code._id;
                        }
                        newHtml += '<option value="' + brokerid + '">' + brokernm + '</option>';
                        newHtml += '</select>';
                        newHtml += '</td>';

                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Bill Amount</strong>';
                        newHtml += '<input type="number" value="' + value.cash_amount + '" name="Bill_Amt[' + j + ']" placeholder="Bill Amount"  id="Bill_Amt' + j + '" oninput="calBillCollection(' + j + ')" class="form-control" style="text-align: -webkit-right;" />';
                        newHtml += '</td>';
                        newHtml += '</tr>';

                        newHtml += '<tr id="GaruTr2' + j + '">';
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Balance Due</strong>';
                        newHtml += '<input type="number" value="' + (value.outstanding_balance).toFixed(2) + '" name="Balance_Due[' + j + ']" placeholder="Balance Due"  id="Balance_Due' + j + '" oninput="calBillCollection(' + j + ')" class="form-control" style="text-align: -webkit-right;" />';
                        newHtml += '<input type="hidden" value="' + value.main_bk + '" name="op_main_bk[' + j + ']"/>';
                        newHtml += '<input type="hidden" value="' + value.c_j_s_p + '" name="op_c_j_s_p[' + j + ']"/>';
                        newHtml += '<input type="hidden" value="' + value.co_code + '" name="op_co_code[' + j + ']"/>';
                        newHtml += '<input type="hidden" value="' + value.div_code + '" name="op_div_code[' + j + ']"/>';
                        newHtml += '</td>';

                        var cashdat = moment(value.cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        var csh_dt = $('#offerstartdate').val();
                        var DateObject = moment(csh_dt, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                        var cashdat2 = moment(DateObject).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        var dat1 = new Date(cashdat.substr(6, 4), Number(cashdat.substr(3, 2)) - 1, cashdat.substr(0, 2), 0, 0, 0, 0);
                        var dat2 = new Date(cashdat2.substr(6, 4), Number(cashdat2.substr(3, 2)) - 1, cashdat2.substr(0, 2), 0, 0, 0, 0);// moment($('#offerstartdate').val(), "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                        var days = Math.floor((Date.UTC(dat2.getFullYear(), dat2.getMonth(), dat2.getDate()) - Date.UTC(dat1.getFullYear(), dat1.getMonth(), dat1.getDate())) / (1000 * 60 * 60 * 24));
                        var intrest = 0
                        var intper = 0;
                        if (days > 31) {
                            intrest = (days * value.outstanding_balance * 2.25 * 12 / 36500).toFixed(2);
                            intper = 2.25;
                        }
                        if (days < 31 && days > 7) {
                            intrest = (days * value.outstanding_balance * 1.75 * 12 / 36500).toFixed(2);
                            intper = 1.75;
                        }
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Days</strong>';
                        newHtml += '<input type="number" value="' + days + '" name="Days[' + j + ']"  id="Days' + j + '" placeholder="Days" class="form-control" oninput="calBillCollection(' + j + ')" style="text-align: -webkit-right;" />';
                        newHtml += '</td>';
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Int Per</strong>';
                        newHtml += '<input type="number" name="Int_Per[' + j + ']" value="' + intper + '" id="Int_Per' + j + '" placeholder="Int Per" class="form-control" oninput="calBillCollection(' + j + ')" style="text-align: -webkit-right;" />';
                        newHtml += '</td>';
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Intrest</strong>';

                        newHtml += '<input type="number" name="Intrest[' + j + ']" value="' + intrest + '" placeholder="Intrest" id="Intrest' + j + '" class="form-control" value="0" oninput="calBillCollection(' + j + ')" onblur="totamtset(' + j + ')" style="text-align: -webkit-right;" />';
                        newHtml += '</td>';
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Discount</strong>';                                                                                   // 
                        newHtml += '<input type="number" name="discount[' + j + ']" placeholder="Discount %" id="discount' + j + '" class="form-control" value="0" oninput="calBillCollection(' + j + ')" onblur="totamtset(' + j + ')" style="text-align: -webkit-right;" />';
                        newHtml += '</td>';
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">CRChgs</strong>';                                                                                     // 
                        newHtml += '<input type="text" name="CRChgs[' + j + ']" placeholder="CRChgs"  id="CRChgs' + j + '" class="form-control" oninput="calBillCollection(' + j + ')" onblur="totamtset(' + j + ')"  style="text-align: -webkit-right;" />';
                        newHtml += '</td>';
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Chithi</strong>';                                                                                     //
                        newHtml += '<input type="text" name="Chithi[' + j + ']" placeholder="Chithi"  id="Chithi' + j + '" class="form-control" oninput="calBillCollection(' + j + ')" onblur="totamtset(' + j + ')" style="text-align: -webkit-right;" />';
                        newHtml += '</td>';
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Amt Settled</strong>';
                        newHtml += '<input type="hidden" name="amtset" id="amtset' + j + '" oninput="calBillCollection(' + j + ')"/>';                                                           //
                        newHtml += '<input type="text" name="Amt_Settled[' + j + ']" placeholder="Amt Settled"  id="Amt_Settled' + j + '" class="form-control" oninput="calBillCollection(' + j + ')" onkeydown="calKasar(event,' + j + ')" style="text-align: -webkit-right;" />';
                        newHtml += '</td>';
                        newHtml += '<td>';
                        newHtml += '<strong class="control-strong">Kasar</strong>';
                        // console.log(i,chidx)                                                                                                                                                 // oninput="calBillCollection('+j+')"
                        if (i == chidx) newHtml += '<input type="text" name="Kasar[' + j + ']" placeholder="Kasar" data-index="' + j + '"  id="Kasar' + j + '" onkeydown="FocusNextBillSeccond(event,' + j + ')" class="form-control addBillColfocus" style="text-align: -webkit-right;" /><span style="display:none;" id="KaserIns' + j + '">Kaser Should Be Less Then 50</span>';
                        else newHtml += '<input type="text" name="Kasar[' + j + ']" placeholder="Kasar"  id="Kasar' + j + '" data-index="' + j + '" onkeydown="FocusNextBill(event,' + j + ')" class="form-control "  style="text-align: -webkit-right;" /><span style="display:none;" id="KaserIns' + j + '">Kaser Should Be Less Then 50</span>';
                        newHtml += '</td>';
                        newHtml += "<td></br></br>";
                        newHtml += "<a onclick='deleteBilColGroupEntry(" + j + ")' style='cursor:pointer;'><i class='fa fa-times'  style='font-size: 20px;color: red;margin-left:12px;'></i></a>";
                        newHtml += "<a class='addBillCollectionEntry nofocus' style='cursor:pointer;float:center' id='addgaru'><i class='fa fa-plus' style='font-size: 25px;color: #4b77be;margin-left:12px;'></i></a>";
                        newHtml += "</td>";
                        newHtml += '</tr>';

                        $(newHtml).insertBefore("#Garu_Aavak_Entry_Group_Add");
                        // $('body').on('keydown','.addBillColfocus',function(e){
                        //     var tr = $(this).parents('tr').index();
                        //     if (e.keyCode == 13) {
                        //         var answer = true; //confirm('Do you want to add new Row?')
                        //         if(answer){
                        //             $('#addgaru').click();
                        //         }else{$('.delv_load').focus();}
                        //         setTimeout(function(){ $('.addbillColl tr:nth-child('+ (tr+3) +')').find('.selectproductfocus').focus(); }, 150);
                        //     }
                        // })
                        $('.party').select2({
                            placeholder: 'Please select Party',
                            allowClear: true,
                            ajax: {
                                type: "GET",
                                url: '/Garu_Aavak_Entry/brparty',
                                dataType: 'json',
                                data: function (term) {
                                    return {
                                        term: term
                                    };
                                },
                                success: function (data) {
                                },
                            },
                            templateResult: formatcity,
                            templateSelection: formatcity,
                            escapeMarkup: function (m) { return m; }
                        });
                        $(".BillDate").datepicker({
                            changeMonth: true,
                            changeYear: true,
                            dateFormat: 'dd/mm/yy',
                        });
                        $('.BillDate').on('changeDate', function (ev) {
                            $(this).datepicker('hide');
                        });
                        $('.broker').select2({
                            placeholder: 'Please select Broker',
                            allowClear: true,
                            ajax: {
                                type: "GET",
                                url: '/Garu_Aavak_Entry/broker_Code',
                                dataType: 'json',
                                data: function (term) {
                                    return {
                                        term: term
                                    };
                                },
                                success: function (data) {
                                },
                            },
                            templateResult: formatcity,
                            templateSelection: formatcity,
                            escapeMarkup: function (m) { return m; }
                        })
                        $("input").focus(function () {
                            if ($(this).val() != null) {
                                $(this).select();
                            }
                        });
                    }
                    j = j + 1;
                    calBillCollection(1)
                }
            });
        }
    }
    setTimeout(function () {
        console.log(indx)
        $('#Days' + indx).focus()
    }, 500);
    CreatBillCollRemark()
}

function focusDraweeBank() {
    $('#cash_remarks').focus();
}
function calCashAmt(e) {
    if (e.keyCode == 13) {
        var finAmtchq = parseFloat($('#tot_Amt').val()) - parseFloat($('#tot_Cash_Amount').val());
        $('#Cheq_Amount').val(finAmtchq.toFixed(2))
        var finAmtcsh = parseFloat($('#tot_Amt').val()) - parseFloat($('#Cheq_Amount').val());
        $('#tot_Cash_Amount').val(finAmtcsh.toFixed(2))
    }
}
function calChqAmt(e) {
    if (e.keyCode == 13) {
        var finAmtcsh = parseFloat($('#tot_Amt').val()) - parseFloat($('#Cheq_Amount').val());
        $('#tot_Cash_Amount').val(finAmtcsh.toFixed(2))
        var finAmtchq = parseFloat($('#tot_Amt').val()) - parseFloat($('#tot_Cash_Amount').val());
        $('#Cheq_Amount').val(finAmtchq.toFixed(2))
    }
}
function chqAmt(e) {
    if (e.keyCode == 13) {
        var Chq_No = $('#Chq_No').val();
        if (Chq_No == '' || Chq_No == 0) {
            var amt = $('#tot_Amt').val()
            $('#tot_Cash_Amount').val(amt);
            $('#Cheq_Amount').val(0);
            $.ajax({
                type: 'GET',
                url: '/Bill_CollectionEntry/CashAcName',
                dataType: 'json',
                success: function (data) {
                    console.log(data)
                    if (data['success']) {
                        var acnm = data['acnm'];
                        var acid = data['acid'];
                        console.log(acnm, acid);
                        var option = new Option(acnm, acid, true, true);
                        $('#cash_bank_name').append(option).trigger('change');
                        $('#cash_bank_name').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": acid, "text": acnm }
                            }
                        });
                        $('#cash_remarks').focus();
                        CreatBillCollRemark();
                    }
                }
            });
        }
        else {//if(Chq_No != '' || Chq_No != 0)
            var party = $('#cashac_name0').val();
            var amt = $('#tot_Cash_Amount').val()
            if (amt == 0 || amt == '' || amt == null) amt = $('#tot_Cash_Amount').val();
            var chqAmt = $('#Cheq_Amount').val();
            var amt = $('#tot_Amt').val()
            var cshAmt = $('#tot_Cash_Amount').val();
            if (chqAmt == 0) {
                $('#Cheq_Amount').val(cshAmt)
                $('#tot_Cash_Amount').val(0)
            } else {
                var finAmtchq = parseFloat($('#tot_Amt').val()) - parseFloat($('#tot_Cash_Amount').val());
                $('#Cheq_Amount').val(finAmtchq.toFixed(2))
                var finAmtcsh = parseFloat($('#tot_Amt').val()) - parseFloat($('#Cheq_Amount').val());
                $('#tot_Cash_Amount').val(finAmtcsh.toFixed(2))
            }
            $.ajax({
                type: 'GET',
                url: '/Bill_CollectionEntry/GetLastDepositBank',
                dataType: 'json',
                data: {
                    party: party,
                },
                success: function (data) {
                    console.log(data)
                    if (data['success']) {
                        var acnm = data['acnm'];
                        var acid = data['acid'];
                        // console.log(acnm,acid);
                        var option = new Option(acnm, acid, true, true);
                        $('#cash_bank_name').append(option).trigger('change');
                        $('#cash_bank_name').trigger({
                            type: 'select2:select',
                            params: {
                                data: { "id": acid, "text": acnm }
                            }
                        });
                        $('#chq_date').focus();
                        CreatBillCollRemark();
                        calCheqDepositDate();
                    }
                }
            });
            $('#chq_date').focus();
            CreatBillCollRemark()
        }
    }
}

function calCheqDepositDate() {
    var chq_date = $('#chq_date').val();
    var bill_DateObject = moment(chq_date, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata").add(1, 'days');
    var newdate = moment(bill_DateObject).format('YYYY-MM-DD')
    const date = moment(newdate);
    const dow = date.day();
    if (dow != 0) {
        var chDepdate = moment(bill_DateObject).format('DD/MM/YYYY')
        $('#deposit_date').val(chDepdate);
    }
    if (dow == 0) {
        var bill_DateObject = moment(chq_date, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata").add(2, 'days');
        var newdate = moment(bill_DateObject).format('DD/MM/YYYY')
        $('#deposit_date').val(newdate);
    }
    // if(dow == 6){
    //     var bill_DateObject =  moment(chq_date, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata").add(3,'days');
    //     var newdate = moment(bill_DateObject).format('DD/MM/YYYY')
    //     $('#deposit_date').val(newdate);
    // }
}

function CreatBillCollRemark() {
    // var Party = $('#party_Code').text();
    var Chq_No = $('#Chq_No').val();
    var date = $('#offerstartdate').val();
    var BillNo = $('#vouc_code').val();
    var tot_Cash_Amount = $('#tot_Cash_Amount').val();
    if (tot_Cash_Amount == null || tot_Cash_Amount == '') tot_Cash_Amount == 0;
    var Cheq_Amount = $('#Cheq_Amount').val();
    if (Cheq_Amount == null || Cheq_Amount == '') Cheq_Amount == 0;
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var Bill_arr = [];
    for (let i = 0; i <= idx; i++) {
        var bill = $('#Bill_No' + i).val();
        if (bill == null || bill == '' || bill == undefined) flag = 1;
        else {
            Bill_arr.push(bill);
        }
    }
    $('#cash_remarks').val('Bill Collection - ' + BillNo + ", Date - " + date + ", Cash Amt - " + tot_Cash_Amount + ",\nCheque Amt - " + Cheq_Amount + ",  Cheque No - " + Chq_No + ", Bill No-" + Bill_arr)
}

function addDraweeBank() {
    $('#addDraweeBank').modal('show')
}

$(document).on('click', '.delete_BillCollection', function () {
    $('.loader').show();
    let vouc_code = $(this).attr('data-vouc');
    var cjsp = $(this).attr('data-cjsp');
    var main_bk = $(this).attr('data-mainbk');
    swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'POST',
                url: '/Bill_CollectionEntry/delete',
                data: {
                    vouc_code: vouc_code,
                    cjsp: cjsp,
                    main_bk: main_bk,
                },
                success: function (response) {
                    $('.loader').hide();
                    window.location.href = '/Bill_CollectionEntry/Bill_CollectionEntry_List';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    })
});
// bill collection End 



// Save Part Model ####################################################################################################################################################
function SaveParty() {
    $('#addparty').modal('show');
    $('#aananjns').addClass('lock-account');
}
function SaveItem() {
    $('#addItem').modal('show');
    setProductSetupValue();
}
// Delete Product Mast ################################################################################################################################################
$(document).on('click', '.delet_product_btn', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/product_mast/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Item Master",
                    text: "This Item Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false
                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/product_mast/' + id,
                            success: function (response) {
                                window.location.href = '/product_mast/product_mast';
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});

// Neeraj Module ######################################################################################################################################################

//add daily grocery entry
function DelDailyGrocMastArr(id) {
    var strconfirm = confirm("Are you sure want to delete?");
    if (strconfirm == true) {
        $('#prabal' + id).remove();
    }
}
// function DailyGrocceryEsc(index,e){
//     if(e.keyCode ==27){
//         $('#prabal'+index).remove();
//         $(".delv_load").focus();
//     }
// }
$('body').on('keydown', '.productplace + .select2-container', function (event) {
    if (event.keyCode == 27) {
        $(this).parents('tr').remove();
        $('.delv_load').focus();
    }
})
$(document).on('click', '.adddailygrocery', function () {
    lstidx = $("input[name*='cntrer']").length + 1;
    var values = $("input[name='cntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    counter = lstidx;
    $.ajax({
        type: 'GET',
        url: '/daily_grocery_entry/rawmatmastname',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                groceryMaster = data['groceryMaster'];
                var new_div = document.createElement('div');
                var new_div = "<tr class='product_wrapper' id='prabal" + counter + "'>";
                new_div += '<td>';
                new_div += '<input type="hidden" name="cntrer" value="' + counter + '" id="cntrer' + counter + '">';
                new_div += '<select  name="daily_grocery_entry_group[' + counter + '][natureOfWork]" id="natureOfWork' + counter + '" onchange="getGrocery(' + counter + ')"  class="form-control productplace selectproductfocus prbank natureOfWork" style="width:100%"';
                new_div += 'placeholder="Select Product" style="width: 100%">';
                new_div += '<option value=""></option>';
                for (let i = 0; i < groceryMaster.length; i++) {
                    new_div += '<option value="' + groceryMaster[i]['_id'] + '">' + groceryMaster[i]['natureOfWork'] + '</option>';
                }
                new_div += '</select>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<input class="form-control daily_grocery_entry_group[' + counter + '][pck]" oninput="calDailyGrocery(' + counter + ')" placeholder="Pck" id="pck' + counter + '"  name="daily_grocery_entry_group[' + counter + '][pck]" type="text" style="width:100%"/></td>';

                new_div += '<td>';
                new_div += '<input type="hidden" class="form-control"  name="daily_grocery_entry_group[' + counter + '][masterRate]" id="masterRate' + counter + '">';
                new_div += '<input class="form-control" oninput="calDailyGrocery(' + counter + ')" placeholder="Qty" id="qty' + counter + '"  name="daily_grocery_entry_group[' + counter + '][qty]" type="text" style="width:100%"/></td>';
                new_div += '<td>';
                new_div += '<input class="form-control" oninput="calDailyGrocery(' + counter + ')" placeholder="Basic" id="basic' + counter + '" name="daily_grocery_entry_group[' + counter + '][basic]" type="text" style="width:100%"/></td>';
                new_div += '<td>';
                new_div += '<input class="form-control" oninput="calDailyGrocery(' + counter + ')" placeholder="Levy" id="levy' + counter + '" name="daily_grocery_entry_group[' + counter + '][levy]" type="text" style="width:100%"/></td>';
                new_div += '<td>';
                new_div += '<input class="form-control amountfocus  daily_grocery_entry_group[' + counter + '][entryRemark]" oninput="calDailyGrocery()" placeholder="Remark" id="entryRemark' + counter + '" name="daily_grocery_entry_group[' + counter + '][entryRemark]" type="text" style="width:100%"/>';
                new_div += '<input type="hidden" name="daily_grocery_entry_group[' + counter + '][Amt]" oninput="calDailyGrocery(' + counter + ')" id="Amt' + counter + '">';
                new_div += '</td>';
                new_div += "<td><a onclick='DelDailyGrocMastArr(" + counter + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                $(new_div).insertBefore("#insert_product");
                $(".natureOfWork").select2({
                    placeholder: "Nature Of Work",
                    allowClear: true,
                });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()
            }
        }
    });
});
//end add daily grocery entry

//Save Daily grocery entry
$(".lock-dailygrocery").click(function (ev) {
    ev.preventDefault();
    if ($(this).closest('form').valid()) {
        var data = $(this).closest('form').serialize();
        var id = $("#vhpxproduct").val();
        var date = $('#date').val();
        var toliCode = $('#toliCode').val();
        if (id == "" || id == undefined) {
            $.ajax({
                url: '/daily_grocery_entry/daily_grocery_entry_add',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    //    alert("data")
                    // alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Daily Grocery Entry",
                            text: "Daily Grocery Entry Saved",
                            icon: "success",
                            timer: 4000,
                            buttons: false
                        })
                        window.location.href = '/daily_grocery_entry/daily_grocery_print?date=' + date + '&toliCodeInGrocceryEntry=' + toliCode + '';
                    }
                    else {
                        swal({
                            title: "Daily Grocery Entry",
                            text: "Duplicate Grocery Entry is not allowed",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }
            })
        } else {
            $.ajax({
                url: '/daily_grocery_entry/edit_daily_grocery_entry/' + id + '',
                method: 'POST',
                dataType: 'json',
                data: data,

                success: function (dat) {
                    //    alert("updata")
                    //    console.log(data);
                    // alert(data);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Daily Grocery Entry",
                            text: "Daily Grocery Entry Succesfully Update",
                            icon: "success",
                            timer: 4000,
                            buttons: false
                        })
                        window.location.href = "/daily_grocery_entry/daily_grocery_entry";
                    } else {
                        swal({
                            title: "Daily Grocery Entry",
                            text: "Error",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                        //  window.location.href = "/customer/customer_list";
                    }
                }
            })
        }
    }
})

$(".lock-dailygrocery").on("keydown", function (ev) {
    // ev.preventDefault();
    if (ev.keyCode == 13) {
        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxproduct").val();
            // alert("p"+id)
            var date = $('#date').val();
            var toliCode = $('#toliCode').val();
            if (id == "" || id == undefined) {
                $.ajax({

                    url: '/daily_grocery_entry/daily_grocery_entry_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //      alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Daily Grocery Entry",
                                text: "Daily Grocery Entry Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            window.location.href = '/daily_grocery_entry/daily_grocery_print?date=' + date + '&toliCodeInGrocceryEntry=' + toliCode + '';
                        }
                        else {
                            swal({
                                title: "Daily Grocery Entry",
                                text: "Duplicate Daily Grocery name is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/daily_grocery_entry/edit_daily_grocery_entry/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Daily Grocery Entry",
                                text: "Daily Grocery Entry Update Succesfully",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/daily_grocery_entry/daily_grocery_entry";
                        } else {
                            swal({
                                title: "Daily Grocery Entry",
                                text: "Error",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    }
})
//end save Daily grocery entry
function getGrocery(id) {
    var grocery = $('#natureOfWork' + id).val();
    // alert(grocery);
    $.ajax({
        type: 'GET',
        url: '/daily_grocery_entry/get_grocery_data',
        dataType: 'json',
        data: { grocery: grocery },
        success: function (response) {
            console.log(response);
            if (response['success'] == true) {
                var grocery = response['grocery'];
                console.log(grocery);
                var values = $("input[name='cntrer']")
                    .map(function () { return $(this).val(); }).get();
                var idx = values[values.length - 1]
                lstidx = parseInt(idx) + 1;
                var groceryGroup = grocery.grocery_master_group;
                for (let i = 0; i <= lstidx; i++) {
                    for (let j = 0; j < groceryGroup.length; j++) {
                        var pck = $('#pck' + id).val();
                        if (groceryGroup[j].upToPacking == pck) {
                            var qty = $('#qty' + id).val();
                            var rate = (groceryGroup[j].qty) / (groceryGroup[j].basic)
                            $('#basic' + id).val(qty * rate)
                        }
                    }
                }
            }
        }
    });
}

function calDailyGrocery(index) {
    var values = $("input[name='cntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx);
    console.log(lstidx)
    var tot_basic = 0;
    var tot_levy = 0;
    var tot_Amt = 0;
    for (let i = 0; i <= lstidx; i++) {
        var grocery = $('#natureOfWork' + i).val();
        // alert(grocery);
        $.ajax({
            type: 'GET',
            url: '/daily_grocery_entry/get_grocery_data',
            dataType: 'json',
            data: { grocery: grocery },
            success: function (response) {
                // console.log(response);
                if (response['success'] == true) {
                    var grocery = response['grocery'];
                    var Amt = 0;
                    var groceryGroup = grocery.grocery_master_group;
                    for (let j = 0; j < groceryGroup.length; j++) {
                        var pck = $('#pck' + i).val();
                        if (groceryGroup[j].upToPacking == pck) {
                            var qty = $('#qty' + i).val();
                            var rate = (groceryGroup[j].basic) / (groceryGroup[j].qty)
                            var qty_rate = qty * rate;
                            $('#basic' + i).val(qty_rate.toFixed(2));
                            $('#masterRate' + i).val(groceryGroup[j].basic)
                            var basic = $('#basic' + i).val();
                            $('#levy' + i).val(((groceryGroup[j].levyPer * basic) / 100).toFixed(2))
                            $('#Amt' + i).val((parseFloat(basic) + parseFloat($('#levy' + i).val())).toFixed(2));

                            tot_basic = tot_basic + parseFloat(basic)

                            tot_levy = tot_levy + parseFloat($('#levy' + i).val())

                            tot_Amt = tot_Amt + parseFloat($('#Amt' + i).val())

                        }
                    }
                    // }
                }
                $('#tot_basic').val(tot_basic.toFixed(2));
                $('#tot_levy').val(tot_levy.toFixed(2));
                $('#tot_Amt').val(tot_Amt.toFixed(2));
            }
        });
    }

}
//edit daily grocery entry
$(document).on('click', '.edit_daily_grocery_entry_btn', function () {
    $('.loader').show();
    var daily_grocery_entry_id = $(this).attr('data-id');
    // alert(daily_grocery_entry_id);
    $.ajax({
        type: 'GET',
        url: '/daily_grocery_entry/' + daily_grocery_entry_id,
        dataType: 'json',
        success: function (response) {
            console.log(response);
            if (response['success'] == true) {
                var grocery_master = response['grocery_master']
                // groceryMaster = data['groceryMaster'];
                var remark = response['d_grocery'].remark;
                var c_j_s_p = response['d_grocery'].c_j_s_p;
                var vouc_code = response['d_grocery'].vouc_code;
                var vhpxproduct = response['d_grocery']._id;
                var tot_levy = response['d_grocery'].tot_levy;
                var tot_basic = response['d_grocery'].tot_basic;
                var date = response['d_grocery'].date;
                date = moment(date).format('DD/MM/YYYY');
                var toliCode = response['d_grocery'].toliCode;

                var daily_grocery_entry_group = response['d_grocery'].daily_grocery_entry_group;
                var len = $("input[name='cntrer']").length;
                if (len > 1) {
                    for (let i = 0; i < len; i++) {
                        $('#prabal' + i).remove();
                    }
                } else { if (daily_grocery_entry_group.length != '') $('#prabal0').remove(); }
                $('.c_j_s_p').val(c_j_s_p);
                $('.vouc_code').val(vouc_code);
                $('.vhpxproduct').val(vhpxproduct);
                $('.date').val(date);
                $('#toliCode').val(toliCode).trigger('change');
                $('.remark').val(remark);

                var new_div;
                for (let index = 0; index < daily_grocery_entry_group.length; index++) {
                    var brandvariation = daily_grocery_entry_group[index];
                    var new_div = "<tr class='product_wrapper' id='prabal" + index + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="cntrer" value="' + index + '" id="cntrer' + index + '">';
                    new_div += '';

                    // new_div +='<td>';
                    new_div += '<select name="daily_grocery_entry_group[' + index + '][natureOfWork]" id="natureOfWork' + index + '"  value="" class="form-control select2 natureOfWork"  style="width:100%;" onchange="getGrocery(0)">';
                    new_div += '<option value=""></option>';
                    for (let i = 0; i < grocery_master.length; i++) {
                        if (grocery_master[i]['_id'] == daily_grocery_entry_group[index].natureOfWork) {
                            new_div += '<option value="' + grocery_master[i]['_id'] + '" selected="true ">' + grocery_master[i]['natureOfWork'] + '</option>';
                        } else {
                            new_div += '<option value="' + grocery_master[i]['_id'] + '">' + grocery_master[i]['natureOfWork'] + '</option>';
                        }
                    }
                    new_div += '</select>';
                    new_div += '</td>';


                    new_div += '<td>';
                    new_div += '<input class="form-control daily_grocery_entry_group[' + index + '][pck] " oninput="calDailyGrocery(' + index + ')" placeholder="Pck" value="' + brandvariation.pck + '"id="pck' + index + '" name="daily_grocery_entry_group[' + index + '][pck]" type="text" style="width:100%"/></td>';
                    new_div += '<td>';
                    new_div += '<input class="form-control " value="' + brandvariation.masterRate + '"  name="daily_grocery_entry_group[' + index + '][masterRate]" id="masterRate' + index + '"  type="hidden">'
                    new_div += '<input class="form-control daily_grocery_entry_group[' + index + '][qty]"  oninput="calDailyGrocery(' + index + ')" placeholder="Qty" value="' + brandvariation.qty + '" id="qty' + index + '" name="daily_grocery_entry_group[' + index + '][qty]" type="text" style="width:100%"/></td>';
                    new_div += '<td>';
                    new_div += '<input class="form-control daily_grocery_entry_group[' + index + '][basic]"  oninput="calDailyGrocery(' + index + ')" placeholder="Basic" value="' + brandvariation.basic + '" id="basic' + index + '" name="daily_grocery_entry_group[' + index + '][basic]" type="text" style="width:100%"/></td>';
                    new_div += '<td>';
                    new_div += '<input class="form-control daily_grocery_entry_group[' + index + '][levy]"  oninput="calDailyGrocery(' + index + ')" placeholder="Levy" value="' + brandvariation.levy + '"  id="levy' + index + '"  name="daily_grocery_entry_group[' + index + '][levy]" type="text" style="width:100%"/></td>';
                    new_div += '<td>';
                    if (index == daily_grocery_entry_group.length - 1) new_div += '<input class="form-control amountfocus"  oninput="calDailyGrocery(' + index + ')" placeholder="Remark" value="' + brandvariation.entryRemark + '"  id="entryRemark' + index + '"  name="daily_grocery_entry_group[' + index + '][entryRemark]" type="text" style="width:100%"/>';
                    else new_div += '<input class="form-control daily_grocery_entry_group[' + index + '][entryRemark]"  oninput="calDailyGrocery(' + index + ')" placeholder="Remark" value="' + brandvariation.entryRemark + '"  id="entryRemark' + index + '"  name="daily_grocery_entry_group[' + index + '][entryRemark]" type="text" style="width:100%" onkeydown="FocusNextDailyGrocEntry(' + index + ',event)"/>';
                    new_div += '<input type="hidden" name="daily_grocery_entry_group[' + index + '][Amt]" oninput="calDailyGrocery(' + index + ')" id="Amt' + index + '">';
                    new_div += '</td>';
                    // new_div +="</tr>";
                    new_div += "<td><a onclick='DelDailyGrocMastArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                    new_div += "</tr>";
                    $(new_div).insertBefore("#insert_product");
                    $(".natureOfWork").select2({
                        placeholder: "Nature Of Work",
                        allowClear: true,
                    });
                    // $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus() 
                    $('#vouc_code').focus();
                }
                $('#tot_basic').val(tot_basic)
                $('#tot_levy').val(tot_levy)
                $("#daily_grocery_entry").attr("action", "/daily_grocery_entry/edit_daily_grocery_entry/" + vhpxproduct);
            }
        },
        error: function (err) {
            console.log(err);
        }
    });
});
function FocusNextDailyGrocEntry(id, e) {
    if (e.keyCode == 13) {
        id = parseInt(id) + 1;
        $('#pck' + id).focus();
    }
}
//end daily grocery entry
function remove_updateproduct(id) {
    var strconfirm = confirm("Are you sure want to delete?");
    counter--;
    member--;
    $("#prabal" + id).remove();
}
//delete daily grocery entry
$(document).on('click', '.delete_daily_grocery_entry', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {

            $.ajax({
                type: 'DELETE',
                url: '/daily_grocery_entry/' + id,
                success: function (response) {
                    window.location.href = '/daily_grocery_entry/daily_grocery_entry';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    });
});
//end delete daily grocery entry 

//Save Grocery Master
$(".lock-grocery").click(function (ev) {
    ev.preventDefault();

    if ($(this).closest('form').valid()) {

        var data = $(this).closest('form').serialize();
        var id = $("#vhpxproduct").val();
        //   alert("p"+id)
        // alert(vhpxproduct);
        if (id == "" || id == undefined) {
            $.ajax({

                url: '/grocery_master/grocery_master_add',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    //    alert("data")
                    // alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Grocery Master",
                            text: "Grocery Saved",
                            icon: "success",
                            timer: 4000,
                            buttons: false

                        })
                        window.location.href = "/grocery_master/grocery_master";
                    }
                    else {
                        swal({
                            title: "Grocery Master",
                            text: "Duplicate Grocery is not allowed",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }
            })
        } else {
            $.ajax({
                url: '/grocery_master/edit_grocery_master/' + id + '',
                method: 'POST',
                dataType: 'json',
                data: data,

                success: function (dat) {
                    //    alert("updata")
                    //    console.log(data);
                    // alert(data);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Grocery Master",
                            text: "Grocery Succesfully Update",
                            icon: "success",
                            timer: 4000,
                            buttons: false
                        })
                        window.location.href = "/grocery_master/grocery_master";
                    } else {
                        swal({
                            title: "Grocery Master",
                            text: "Error",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                        //  window.location.href = "/customer/customer_list";
                    }
                }
            })
        }
    }
})

$(".lock-grocery").on("keydown", function (ev) {
    // ev.preventDefault();
    if (ev.keyCode == 13) {
        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxproduct").val();
            // alert("p"+id)
            if (id == "" || id == undefined) {
                $.ajax({

                    url: '/grocery_master/grocery_master_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //      alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Grocery Master",
                                text: "Grocery Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            window.location.href = "/grocery_master/grocery_master";
                        }
                        else {
                            swal({
                                title: "Grocery Master",
                                text: "Duplicate Grocery name is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/grocery_master/edit_grocery_master/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Grocery Master",
                                text: "Grocery Update Succesfully",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/grocery_master/grocery_master";
                        } else {
                            swal({
                                title: "Grocery Master",
                                text: "Error",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    }
})
//end Save Grocery Master

//add grocery master
function CalGrocery() {
    lstidx = $("input[name*='cntrer']").length + 1;
    var values = $("input[name='cntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    for (let i = 0; i <= lstidx; i++) {
        var basic = $('#basic' + i).val();
        if (basic == '' || basic == null) basic = 0;
        var levyPer = $('#levyPer' + i).val();
        if (levyPer == '' || levyPer == null) levyPer = 0;
        $('#levy' + i).val((basic * levyPer / 100).toFixed(2));
    }
}


function DelGrocMastArr(id) {
    var strconfirm = confirm("Are you sure want to delete?");
    if (strconfirm == true) {
        $('#prabal' + id).remove();
    }
}
function EscGrocArr(id, e) {
    if (e.keyCode == 27) {
        $('#prabal' + id).remove();
        $('.delv_load').focus();
    }
}
$(document).on('click', '.addgrocery', function () {
    lstidx = $("input[name*='cntrer']").length + 1;
    var values = $("input[name='cntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    counter = lstidx;

    var new_div = document.createElement('div');
    var new_div = "<tr class='product_wrapper' id='prabal" + counter + "'>";
    new_div += '<td>';
    new_div += '<input type="hidden" name="cntrer" value="' + counter + '" id="cntrer' + counter + '">';
    new_div += '<input class="form-control selectproductfocus" id="upToPacking' + counter + '" oninput="CalGrocery()" placeholder="Up To Packing"  name="grocery_master_group[' + counter + '][upToPacking]" type="text" style="width:100%" onkeyup="EscGrocArr(' + counter + ',event)"/>';
    new_div += '</td>';
    new_div += '<td>';
    new_div += '<input class="form-control grocery_master_group[' + counter + '][qty]" placeholder="Qty" id="qty' + counter + '" oninput="CalGrocery()" name="grocery_master_group[' + counter + '][qty]" type="text" style="width:100%"/>';
    new_div += '</td>';
    new_div += '<td>';
    new_div += '<input class="form-control grocery_master_group[' + counter + '][basic]" placeholder="Basic" id="basic' + counter + '" oninput="CalGrocery()"  name="grocery_master_group[' + counter + '][basic]" type="text" style="width:100%"/>';
    new_div += '</td>';
    new_div += '<td>';
    new_div += '<input class="form-control grocery_master_group[' + counter + '][levyPer]" placeholder="Levy%" id="levyPer' + counter + '" oninput="CalGrocery()" name="grocery_master_group[' + counter + '][levyPer]" type="text" style="width:100%"/>';
    new_div += '</td>';
    new_div += '<td>';
    new_div += '<input class="form-control amountfocus grocery_master_group[' + counter + '][levy]" placeholder="levy" id="levy' + counter + '" oninput="CalGrocery()" name="grocery_master_group[' + counter + '][levy]" type="text" style="width:100%"/>';
    new_div += "</td>";
    new_div += '<td>';
    new_div += "<a onclick='DelGrocMastArr(" + counter + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a>";
    new_div += "</td>";
    new_div += "</tr>";
    $(new_div).insertBefore("#insert_product");
    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()
});
//end add grocery master

//edit grocery master
$(document).on('click', '.edit_grocery_master_btn', function () {
    $('.loader').show();
    var grocery_master_id = $(this).attr('data-id');
    $.ajax({
        type: 'GET',
        url: '/grocery_master/' + grocery_master_id,
        dataType: 'json',
        success: function (response) {
            // console.log(response);
            if (response['success'] == true) {
                var natureOfWork = response['g_mast'].natureOfWork;
                var vhpxproduct = response['g_mast']._id;
                var effectiveDate = response['g_mast'].effectiveDate;
                effectiveDate = moment(effectiveDate).format('DD/MM/YYYY');
                var short_name = response['g_mast'].short_name;
                var hsn_code = response['g_mast'].hsn_code;
                var item_name = response['g_mast'].item_name;
                var item_unit = response['g_mast'].item_unit;
                var grocery_master_group = response['g_mast'].grocery_master_group;
                var len = $("input[name='cntrer']").length;
                if (len > 1) {
                    for (let i = 0; i < len; i++) {
                        $('#prabal' + i).remove();
                    }
                } else { if (grocery_master_group.length != '') $('#prabal0').remove(); }
                $('.natureOfWork').val(natureOfWork);
                $('.vhpxproduct').val(vhpxproduct);
                $('.effectiveDate').val(effectiveDate);
                $('.short_name').val(short_name);
                $('.hsn_code').val(hsn_code);
                $('.item_name').val(item_name);
                $('.item_unit').val(item_unit);
                var new_div;
                for (let index = 0; index < grocery_master_group.length; index++) {
                    var brandvariation = grocery_master_group[index];
                    var new_div = "<tr class='product_wrapper' id='prabal" + index + "'>";
                    new_div += '<td>';
                    new_div += '<input type="hidden" name="cntrer" value="' + index + '" id="cntrer' + index + '">';
                    new_div += '';
                    new_div += '<input class="form-control selectproductfocus" value="' + brandvariation.upToPacking + '" placeholder="Up To Packing" oninput="CalGrocery()" id="upToPacking' + index + '" name="grocery_master_group[' + index + '][upToPacking]" type="text" style="width:100%"/>';

                    new_div += '<td>';
                    new_div += '<input class="form-control grocery_master_group[' + index + '][qty] " placeholder="Qty" value="' + brandvariation.qty + '" oninput="CalGrocery()" id="qty' + index + '" name="grocery_master_group[' + index + '][qty]" type="text" style="width:100%"/></td>';
                    new_div += '<td>';
                    new_div += '<input class="form-control grocery_master_group[' + index + '][basic]" placeholder="Basic" value="' + brandvariation.basic + '" oninput="CalGrocery()" id="basic' + index + '" name="grocery_master_group[' + index + '][basic]" type="text" style="width:100%"/></td>';
                    new_div += '<td>';
                    new_div += '<input class="form-control grocery_master_group[' + index + '][levyPer]" placeholder="Levy%" value="' + brandvariation.levyPer + '" oninput="CalGrocery()" id="levyPer' + index + '" name="grocery_master_group[' + index + '][levyPer]" type="text" style="width:100%"/></td>';
                    new_div += '<td>';
                    if (index == grocery_master_group.length - 1) new_div += '<input class="form-control amountfocus" placeholder="Levy" value="' + brandvariation.levy + '" oninput="CalGrocery()" id="levy' + index + '"  name="grocery_master_group[' + index + '][levy]" type="text" style="width:100%"/></td>';
                    else new_div += '<input class="form-control" placeholder="Levy" value="' + brandvariation.levy + '" oninput="CalGrocery()" id="levy' + index + '"  name="grocery_master_group[' + index + '][levy]" type="text" style="width:100%" onkeydown="FocusNextGrocArr(' + index + ',event)"/></td>';
                    new_div += "<td><a onclick='DelGrocMastArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                    new_div += "</tr>";
                    $(new_div).insertBefore("#insert_product");
                    // $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus() 
                    $('#natureOfWork').focus();
                }
                $("#grocery_master").attr("action", "/grocery_master/edit_grocery_master/" + vhpxproduct);
            }
        },
        error: function (err) {
            console.log(err);
        }
    });
});
function FocusNextGrocArr(id, e) {
    if (e.keyCode == 13) {
        id = parseInt(id) + 1;
        $('#upToPacking' + id).focus();
    }
}
//end edit grocery master

//delete grocery master
$(document).on('click', '.delete_grocery_master', function (event) {
    event.preventDefault();
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/grocery_master/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Grocery Master",
                    text: "This Grocery Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false
                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/grocery_master/' + id,
                            success: function (response) {
                                window.location.href = '/grocery_master/grocery_master';
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
//end delete grocery master

///ADD TOLI MASTER
$(".lock-toli").click(function (ev) {
    ev.preventDefault();

    if ($(this).closest('form').valid()) {

        var data = $(this).closest('form').serialize();
        var id = $("#vhpxstate").val();
        //  alert("p"+id)
        if (id == "" || id == undefined) {
            $.ajax({

                url: '/toli_master/toli_add',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    //   alert("data")
                    //  alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Toli Master",
                            text: "Toli Saved",
                            icon: "success",
                            timer: 4000,
                            buttons: false

                        })
                        window.location.href = "/toli_master/toli_master";
                    }
                    else {
                        swal({
                            title: "Toli Master",
                            text: "Duplicate Toli is not allowed",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }
            })
        } else {
            $.ajax({
                url: '/toli_master/edit_toli/' + id + '',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    //   alert("updata")
                    //  alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Toli Master",
                            text: "Toli Succefully Update",
                            icon: "success",
                            timer: 4000,
                            buttons: false
                        })
                        window.location.href = "/toli_master/toli_master";
                    } else {
                        swal({
                            title: "Toli Master",
                            text: "Error",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                        //  window.location.href = "/customer/customer_list";
                    }
                }
            })
        }
    }
})
$(".lock-toli").on("keydown", function (ev) {
    // ev.preventDefault();
    if (ev.keyCode == 13) {
        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxstate").val();
            //  alert("p"+id)
            if (id == "" || id == undefined) {
                $.ajax({

                    url: '/toli_master/toli_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //   alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Toli Master",
                                text: "Toli Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            window.location.href = "/toli_master/toli_master";
                        }
                        else {
                            swal({
                                title: "Toli Master",
                                text: "Duplicate Toli is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/toli_master/edit_toli/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //   alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Toli Master",
                                text: "Toli Update SuccesFully",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/toli_master/toli_master";
                        } else {
                            swal({
                                title: "Toli Master",
                                text: "Error",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    }
})
//END ADD TOLI MASTER

//add bank details
$(".lock-bankdetails").click(function (ev) {
    ev.preventDefault();
    if ($(this).closest('form').valid()) {
        var data = $(this).closest('form').serialize();
        var id = $("#vhpxstate").val();
        //  alert("p"+id)
        if (id == "" || id == undefined) {
            $.ajax({
                url: '/bank_details/bank_details_add',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    //    alert("data")
                    // alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Bank Details Master",
                            text: "Bank Details Saved",
                            icon: "success",
                            timer: 4000,
                            buttons: false

                        })
                        $('#addDraweeBank').modal('hide');
                        if (dat.GaruEntryModel == 'GaruEntryModel') $('#party_Code').focus();
                        else window.location.href = "/bank_details/bank_details";
                    }
                    else {
                        $('#addDraweeBank').modal('hide');
                        swal({
                            title: "Bank Details Master",
                            text: "Duplicate Bank Details is not allowed",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                    }
                }
            })
        } else {
            $.ajax({
                url: '/bank_details/edit_bank_details/' + id + '',
                method: 'POST',
                dataType: 'json',
                data: data,
                success: function (dat) {
                    //   alert("updata")
                    //  alert(dat.success);
                    if (dat.success == true) {
                        $('#addcity').modal('hide');
                        swal({
                            title: "Bank Details Master",
                            text: "Bank Details Succefully Update",
                            icon: "success",
                            timer: 4000,
                            buttons: false
                        })
                        window.location.href = "/bank_details/bank_details";
                    } else {
                        swal({
                            title: "Bank Details Master",
                            text: "Error",
                            icon: "error",
                            timer: 4000,
                            buttons: false
                        })
                        //  window.location.href = "/customer/customer_list";
                    }
                }
            })
        }
    }
})
$(".lock-bankdetails").on("keydown", function (ev) {
    // ev.preventDefault();
    if (ev.keyCode == 13) {
        if ($(this).closest('form').valid()) {

            var data = $(this).closest('form').serialize();
            var id = $("#vhpxstate").val();
            //  alert("p"+id)
            if (id == "" || id == undefined) {
                $.ajax({

                    url: '/bank_details/bank_details_add',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //   alert("data")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Bank Details Master",
                                text: "Bank Details Saved",
                                icon: "success",
                                timer: 4000,
                                buttons: false

                            })
                            $('#addDraweeBank').modal('hide');
                            if (dat.GaruEntryModel == 'GaruEntryModel') $('#party_Code').focus();
                            else window.location.href = "/bank_details/bank_details";
                        }
                        else {
                            $('#addDraweeBank').modal('hide');
                            swal({
                                title: "Bank Details Master",
                                text: "Duplicate Bank Details is not allowed",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                        }
                    }
                })
            } else {
                $.ajax({
                    url: '/bank_details/edit_bank_details/' + id + '',
                    method: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (dat) {
                        //   alert("updata")
                        //  alert(dat.success);
                        if (dat.success == true) {
                            $('#addcity').modal('hide');
                            swal({
                                title: "Toli Master",
                                text: "Bank Details Update SuccesFully",
                                icon: "success",
                                timer: 4000,
                                buttons: false
                            })
                            window.location.href = "/bank_details/bank_details";
                        } else {
                            swal({
                                title: "Bank Details Master",
                                text: "Error",
                                icon: "error",
                                timer: 4000,
                                buttons: false
                            })
                            //  window.location.href = "/customer/customer_list";
                        }
                    }
                })
            }
        }
    }
})
//end add bank details

//edit toli master
$(document).on('click', '.edit_toli_btn', function () {
    var stateid = $(this).attr('data-id');
    $('.loader').show();
    // alert(stateid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/toli_master/' + stateid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // //console.log(response);
                var toli_name = response['toli_master'].ToliName;
                var stateid = response['toli_master']._id;
                var vhpxstate = response['toli_master']._id;
                var toli_code = response['toli_master'].ToliCode;
                // var state_capital = response['state_master'].StateCapital;
                $('.toli_name').val(toli_name);
                $('.vhpxstate').val(vhpxstate);
                $('.toli_code').val(toli_code);
                // $('.state_capital').val(state_capital);
                $('#edit_state').show();
                $('#edit').show();
                $('#addstate').hide();
                $('#add').hide();
                $('.state_name').focus();
                $("#edit_state").attr("action", "/toli_master/edit_toli/" + stateid);

            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
//end edit toli master

//edit bank details
$(document).on('click', '.edit_bank_details_btn', function () {
    var stateid = $(this).attr('data-id');
    $('.loader').show();
    // alert(stateid)
    // alert(brandid);
    $.ajax({
        type: 'GET',
        url: '/bank_details/' + stateid,
        dataType: 'json',
        success: function (response) {

            // alert(response);
            if (response['success'] == true) {
                // //console.log(response);
                var bankName = response['bank_details'].bankName;
                var stateid = response['bank_details']._id;
                var vhpxstate = response['bank_details']._id;
                var branchName = response['bank_details'].branchName;
                var ifscCode = response['bank_details'].ifscCode;
                var micrCode = response['bank_details'].micrCode;
                var address = response['bank_details'].address;
                var address3 = response['bank_details'].address3;
                var address2 = response['bank_details'].address2;
                var contact = response['bank_details'].contact;
                var remark = response['bank_details'].remark;
                // var state_capital = response['state_master'].StateCapital;
                $('.bankName').val(bankName);
                $('.vhpxstate').val(vhpxstate);
                $('.branchName').val(branchName);
                $('.ifscCode').val(ifscCode);
                $('.micrCode').val(micrCode);
                $('.address').val(address);
                $('.address3').val(address3);
                $('.address2').val(address2);
                $('.contact').val(contact);
                $('.remark').val(remark);
                // $('.state_capital').val(state_capital);
                $('#edit_state').show();
                $('#edit').show();
                $('#addstate').hide();
                $('#add').hide();
                $('.state_name').focus();
                $("#edit_state").attr("action", "/bank_details/edit_bank_details/" + stateid);

            } else {
                $('.branddanger').html(response['message']);
                $('.branddanger').show();
                $('.brandsuccess').hide();
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
//end edit bank details

//delete toli master
$(document).on('click', '.delete-toli', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/toli_master/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Toli Master",
                    text: "This Toli Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false
                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/toli_master/' + id,
                            success: function (response) {
                                window.location.href = '/toli_master/toli_master';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });
});
//end delete toli master

//delete bank details
$(document).on('click', '.delete-bank_details', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    $.ajax({
        type: 'DELETE',
        url: '/bank_details/confirm/' + id,
        success: function (response) {
            console.log(response)
            if (response['success'] == "true") {
                swal({
                    title: "Bank Details Master",
                    text: "This Bank Details Is Used",
                    icon: "warning",
                    timer: 1000,
                    buttons: false
                })
            }
            if (response['success'] == "false") {
                swal({
                    icon: 'warning',
                    title: "Sure",
                    text: 'Are you sure you want to delete it?',
                    buttons: ["Cancel", "Confirm"],
                    dangerMode: true
                }).then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: 'DELETE',
                            url: '/bank_details/' + id,
                            success: function (response) {
                                // $('.loader').hide();
                                window.location.href = '/bank_details/bank_details';
                                $('.loader').hide();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            }
            // window.location.href = '/state_master/state_master';
            $('.loader').hide();
        },
        error: function (err) {
            console.log(err);
        }
    });


});
//end delete bank details

//add voucher type master
$(document).on('click', '.addvoucher', function () {
    lstidx = $("input[name*='cntrer']").length + 1;
    var values = $("input[name='cntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    if (isNaN(lstidx)) lstidx = 1;
    if (lstidx == null || lstidx == '') lstidx = 1;

    counter = lstidx;
    $.ajax({
        type: 'GET',
        url: '/voucher_type_master/getDivision',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                div = data['div'];
                StockUnit = data['StockUnit'];
                var new_div = document.createElement('div');
                var new_div = "<tr class='product_wrapper' id='prabal" + counter + "'>";
                new_div += '<td>';
                new_div += '<input type="hidden" name="cntrer" value="' + counter + '" id="cntrer' + counter + '">';
                new_div += '<input type="hidden" name="vouchArray[' + counter + '][id]" value="" id="id0">';
                new_div += '<input class="form-control  selectproductfocus " placeholder="Description"  name="vouchArray[' + counter + '][Vo_des]" type="text" style="width:100%"/>';

                new_div += '<td>';
                new_div += '<input class="form-control " placeholder="Book"  name="vouchArray[' + counter + '][Vo_book]" type="text" style="width:100%"/></td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Vo_notyp]" id="no_type" value="" class="form-control  notype select2" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '<option >Auto</option>';
                new_div += '<option >Menual</option>';

                new_div += '</select></td>';

                new_div += '<td>';
                new_div += '<input class="form-control " placeholder="Start No"  name="vouchArray[' + counter + '][Vo_startNo]" type="text" style="width:100%"/></td>';

                new_div += '<td>';
                new_div += '<input class="form-control " placeholder="End No"  name="vouchArray[' + counter + '][Vo_endNo]" type="text" style="width:100%"/></td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Vo_ReStartNo]" id="restart" value="" class="form-control  restart select2" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '<option >Daily</option>';
                new_div += '<option >Monthly</option>';
                new_div += '<option >Yearly</option>';
                new_div += '<option >Never</option>';
                new_div += '<option >Last+One</option>';

                new_div += '</select></td>';

                new_div += '<td>';
                new_div += '<input class="form-control datepicker" placeholder="Last Date"  name="vouchArray[' + counter + '][Vo_Ldate]" type="text" style="width:100%"/></td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Vo_Active]" id="active" value="" class="form-control  active select2" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '<option >Y</option>';
                new_div += '<option >N</option>';

                new_div += '</select></td>';

                // new_div +='<td>';
                // new_div +='<input class="form-control " placeholder="Division"  name="vouchArray['+counter+'][Vo_Division]" type="text" style="width:100%"/></td>';
                new_div += '<td>';
                new_div += '<select   name="vouchArray[' + counter + '][Vo_Division]" "value=""  class="form-control  division" style="width:100%;">';
                new_div += '<option value=""></option>';
                for (j = 0; j < div.length; j++) {
                    new_div += "<option value='" + div[j]['_id'] + "'>" + div[j]['div_mast'] + "</option>";
                }
                new_div += '</select></td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Vo_ItemList]" id="item" value="" class="form-control  item select2" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '<option >List With Packing</option>';
                new_div += '<option >List W/O Packing</option>';

                new_div += '</select></td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Vo_CsCr]" id="credit_debit" value="" class="form-control  productplace select2" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '<option >Credit</option>';
                new_div += '<option >Debit</option>';
                new_div += '<option >Both</option>';
                new_div += '</select></td>';
                // new_div +='<input class="form-control amountfocus" placeholder="Min Stk"  name="product_raw_master_group['+counter+'][minstk]" type="text" style="width:100%"/></td>';
                new_div += "<td><a onclick='remove_updateproduct(" + counter + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                $(new_div).insertBefore("#insert_product");

                $(".productplace").select2({
                    placeholder: " Cash Credit",
                    allowClear: true,
                });
                $(".notype").select2({
                    placeholder: "No Type",
                    allowClear: true,
                });
                $(".restart").select2({
                    placeholder: "Restart",
                    allowClear: true,
                });
                $(".active").select2({
                    placeholder: "Active",
                    allowClear: true,
                });
                $(".division").select2({
                    placeholder: "Division",
                    multiple: true,
                    allowClear: true,
                });

                $(".item").select2({
                    placeholder: "Item",
                    allowClear: true,
                });
                $('.datepicker').datepicker({ format: 'dd/mm/yyyy', autoclose: true, });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()

            }
        }
    });
});
//end add voucher type master
//add add less parameter master
$(document).on('click', '.addAddLessParameter', function () {
    lstidx = $("input[name*='cntrer']").length + 1;
    var values = $("input[name='cntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    if (isNaN(lstidx)) lstidx = 1;
    if (lstidx == null || lstidx == '') lstidx = 1;
    counter = lstidx;
    $.ajax({
        type: 'GET',
        url: '/voucher_type_master/getDivision',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                div = data['div'];
                StockUnit = data['StockUnit'];
                var new_div = document.createElement('div');
                var new_div = "<tr class='product_wrapper' id='prabal" + counter + "'>";
                new_div += '<td>';
                new_div += '<input type="hidden" name="cntrer" value="' + counter + '" id="cntrer' + counter + '">';
                new_div += '<input class="form-control  selectproductfocus " placeholder="Description"  name="vouchArray[' + counter + '][Description]" id="Description' + counter + '" type="text" style="width:100%"/>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Parameter_Type]" id="Parameter_Type' + counter + '" value="" class="form-control notype" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '<option value="+">+</option>';
                new_div += '<option value="-">-</option>';
                new_div += '</select>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<input class="form-control " placeholder="Order"  name="vouchArray[' + counter + '][Order]" type="text" style="width:100%"/>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<input class="form-control " placeholder="Value"  name="vouchArray[' + counter + '][Value]" type="text" style="width:100%"/>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Calculation]" id="Calculation" class="form-control restart select2" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '<option value="SGST">SGST</option>';
                new_div += '<option value="CGST">CGST</option>';
                new_div += '<option value="IGST">IGST</option>';
                new_div += '<option value="QTY">QTY</option>';
                new_div += '<option value="WEIGHT">WEIGHT</option>';
                new_div += '<option value="% OF GROSS">% OF GROSS</option>';
                new_div += '<option value="ROUND OFF">ROUND OFF</option>';
                new_div += '<option value="APMC">APMC</option>';
                new_div += '</select>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Active]" id="Active' + counter + '" value="" class="form-control active" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '<option value="Y">Y</option>';
                new_div += '<option value="N">N</option>';
                new_div += '</select>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Posting_Ac]" id="Posting_Ac' + counter + '" value="" class="form-control Posting_Ac" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '</select>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<select name="vouchArray[' + counter + '][Deduction_Par]" id="Deduction_Par' + counter + '" value="" class="form-control Deduction_Par" style="width:100%;">';
                new_div += '<option value=""></option>';
                new_div += '<option value="Y">Y</option>';
                new_div += '<option value="N">N</option>';
                new_div += '</select>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<select   name="vouchArray[' + counter + '][Division]" "value=""  class="form-control Division" style="width:100%;">';
                new_div += '<option value=""></option>';
                for (j = 0; j < div.length; j++) {
                    new_div += "<option value='" + div[j]['_id'] + "'>" + div[j]['div_mast'] + "</option>";
                }
                new_div += '</select>';
                new_div += '</td>';
                new_div += "<td><a onclick='remove_updateproduct(" + counter + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                $(new_div).insertBefore("#insert_product");

                $('.Posting_Ac').select2({
                    placeholder: 'Select Posting_Ac',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Garu_Aavak_Entry/Posting_Ac',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    templateSelection: formatcity,
                    escapeMarkup: function (m) { return m; }
                })
                $(".notype").select2({
                    placeholder: "+/-",
                    allowClear: true,
                });
                $(".restart").select2({
                    placeholder: "Calculation",
                    allowClear: true,
                });
                $(".active").select2({
                    placeholder: "Active",
                    allowClear: true,
                });
                $(".Division").select2({
                    placeholder: "Division",
                    multiple: 'true',
                    allowClear: true,
                });
                $(".Deduction_Par").select2({
                    placeholder: "Deduction Par",
                    allowClear: true,
                });
                $('.datepicker').datepicker({ format: 'dd/mm/yyyy', autoclose: true, });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()
            }
        }
    });
});
//end add voucher type master

//add unit setup master
$(document).on('click', '.addunit', function () {
    lstidx = $("input[name*='cntrer']").length + 1;
    var values = $("input[name='cntrer']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    if (isNaN(lstidx)) lstidx = 1;
    memberp = lstidx;
    counter = lstidx;
    if (counter == limit) {
        alert("You have reached the limit of adding " + counter + " inputs");
    }
    else {
        $.ajax({
            type: 'GET',
            url: '/unit_setup_master/rawmatmastname',
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    rowmatname = data['rowmatname'];
                    StockUnit = data['StockUnit'];
                    var new_div = document.createElement('div');
                    var new_div = "<tr class='product_wrapper' id='prabal" + counter + "'>";
                    // new_div +='<td>';
                    // new_div +='<input type="hidden" name="cntrer" value="'+counter+'" id="cntrer'+counter+'">';
                    // new_div +='';
                    // new_div +='<input class="form-control selectproductfocus " placeholder="Description"  name="vouchArray['+counter+'][Vo_des]" type="text" style="width:100%"/>';

                    // new_div +='<td>';
                    // new_div +='<input class="form-control " placeholder="Book"  name="vouchArray['+counter+'][Vo_book]" type="text" style="width:100%"/></td>';

                    new_div += '<td>';
                    new_div += '<input type="hidden" name="cntrer" value="' + counter + '" id="cntrer' + counter + '">';
                    new_div += '<select name="unitArray[' + counter + '][Qty_Unit]" id="Qty_Unit" value="" class="form-control selectproductfocus  qtyunit select2" style="width:100%;">';
                    new_div += '<option value=""></option>';
                    new_div += '<option >PCS</option>';
                    new_div += '<option >Truck</option>';
                    new_div += '<option >KG</option>';
                    new_div += '<option >Ton</option>';
                    new_div += '<option >Box</option>';
                    new_div += '<option >GMS</option>';

                    new_div += '</select></td>';

                    new_div += '<td>';
                    new_div += '<select name="unitArray[' + counter + '][M_Packing]" id="M_Packing" value="" class="form-control  packing select2" style="width:100%;">';
                    new_div += '<option value=""></option>';
                    new_div += '<option >Y</option>';
                    new_div += '<option >N</option>';

                    new_div += '</select></td>';

                    new_div += '<td>';
                    new_div += '<input class="form-control " placeholder="Weight Division"  name="unitArray[' + counter + '][W_Division]" type="text" style="width:100%"/></td>';

                    new_div += '<td>';
                    new_div += '<input class="form-control " placeholder="Est.Cap Unit"  name="unitArray[' + counter + '][Est_Capunit]" type="text" style="width:100%"/></td>';

                    new_div += '<td>';
                    new_div += '<select name="unitArray[' + counter + '][Sub_Unit]" id="Sub_Unit" value="" class="form-control  subunit select2" style="width:100%;">';
                    new_div += '<option value=""></option>';
                    new_div += '<option >PCS</option>';
                    new_div += '<option >Truck</option>';
                    new_div += '<option >KG</option>';
                    new_div += '<option >Ton</option>';
                    new_div += '<option >Box</option>';
                    new_div += '<option >GMS</option>';

                    new_div += '</select></td>';

                    new_div += '<td>';
                    new_div += '<select name="unitArray[' + counter + '][D_Balancing]" id="D_Balancing" value="" class="form-control  balancing select2" style="width:100%;">';
                    new_div += '<option value=""></option>';
                    new_div += '<option >Q</option>';
                    new_div += '<option >W</option>';

                    new_div += '</select></td>';

                    // new_div +='<td>';
                    // new_div +='<input class="form-control " placeholder="Division"  name="vouchArray['+counter+'][Vo_Division]" type="text" style="width:100%"/></td>';
                    new_div += '<td>';
                    new_div += '<select   name="vouchArray[' + counter + '][Division_Name]" "value=""  class="form-control  division" style="width:100%;">';
                    new_div += '<option value=""></option>';
                    for (j = 0; j < rowmatname.length; j++) {
                        new_div += "<option value='" + rowmatname[j]['_id'] + "' data-product_id='" + rowmatname[j]['_id'] + "'>" + rowmatname[j]['div_mast'] + "</option>";
                    }
                    new_div += '</select></td>';

                    // new_div +='<input class="form-control amountfocus" placeholder="Min Stk"  name="product_raw_master_group['+counter+'][minstk]" type="text" style="width:100%"/></td>';
                    new_div += "<td><a onclick='remove_updateproduct(" + counter + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";
                    $(new_div).insertBefore("#insert_product");
                    counter++;
                    member++;
                    $(".qtyunit").select2({
                        placeholder: " Qty Unit",
                        allowClear: true,
                    });
                    $(".packing").select2({
                        placeholder: "Multiply Packing",
                        allowClear: true,
                    });
                    $(".subunit").select2({
                        placeholder: "Sub(Weight) Unit",
                        allowClear: true,
                    });
                    $(".balancing").select2({
                        placeholder: "Default Balancing",
                        allowClear: true,
                    });
                    $(".division").select2({
                        placeholder: "Division",
                        allowClear: true,
                    });

                    $(".item").select2({
                        placeholder: "Item",
                        allowClear: true,
                    });
                    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()

                }
            }
        });
    }
});
//end add unit setup master

//addVachhati Entry Master
$(document).on('click', '.addVachhatiEntry', function () {
    lstidx = $("input[name*='dsirn']").length + 1;
    var values = $("input[name='dsirn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    memberp = lstidx;

    $.ajax({
        type: 'Get',
        url: '/Vachhati_Aavak_Entry/productname',
        dataType: 'json',
        success: function (data) {
            if (data['success']) {
                var product = data['product'];
                var gowdown = data['gowdown'];
                var account_masters = data['account_masters'];
                var newHtml = '';
                newHtml += '<tr id="GaruTr0' + lstidx + '">';
                newHtml += '<td colspan="8" style="background-color:#4b77be"></td>';
                newHtml += '</tr>';
                newHtml += '<tr id="GaruTr1' + lstidx + '">';
                newHtml += '<td>';
                newHtml += '<strong>Gdn-Cd</strong>';
                newHtml += '<input type="hidden" name="dsirn" value="' + lstidx + '" id="dsirn' + lstidx + '">';
                //    newHtml +='<input type="text" name="garu_Aavak_Group['+lstidx+'][gdn_Cd_Name]" id="gdn_Cd_Name'+lstidx+'" '; 
                //    newHtml +=' class="form-control " style="text-align: -webkit-right;"  placeholder="Gdn-Cd"/>';
                newHtml += '<select  name="vachhati_Aavak_Group[' + lstidx + '][gdn_Cd_Name]"id="gdn_Cd_Name' + lstidx + '"  class="form-control  prbank productitem" style="width:100%"';
                newHtml += 'placeholder="Select">';
                for (let i = 0; i < gowdown.length; i++) {
                    newHtml += '<option value="' + gowdown[i]['_id'] + '">' + gowdown[i]['Description'] + '</option>';
                }
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong>Lot No</strong>';
                newHtml += '<input type="text" name="vachhati_Aavak_Group[' + lstidx + '][lot_No]"  id="lot_No' + lstidx + '" class="form-control selectproductfocus" style="text-align: -webkit-right;" placeholder="Lot No" onkeydown="GaruEsc(' + lstidx + ',event)"/>';
                newHtml += '</td>';
                newHtml += '<td colspan="3">';
                newHtml += '<strong>Item Cd</strong>';
                newHtml += '<select  name="vachhati_Aavak_Group[' + lstidx + '][item_Code_Desc]" id="item_Code_Desc' + lstidx + '"  class="form-control  prbank ItenCodeName" onchange="getItemData(' + lstidx + ')" style="width:100%"';
                newHtml += 'placeholder="Select Product" style="width: 100%">';
                newHtml += '<option value=""></option>';
                // for (let i = 0; i < product.length; i++)
                // {
                //     newHtml += '<option value="'+product[i]['_id']+'">'+product[i]['Fg_Des']+'</option>';
                // }
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Purchase Ac Title</strong>';
                //    newHtml +='<input type="text" name="garu_Aavak_Group['+lstidx+'][purchase_Ac_Title]" placeholder="Purchase Ac Title"  id="purchase_Ac_Title'+lstidx+'" class="form-control" style="text-align: -webkit-right;" />';
                newHtml += '<select  name="vachhati_Aavak_Group[' + lstidx + '][purchase_Ac_Title]"id="purchase_Ac_Title' + lstidx + '"  class="form-control  prbank productitem" style="width:100%"';
                newHtml += 'placeholder="Select Product" style="width: 100%">';
                // newHtml +='<option value=""></option>';
                for (let i = 0; i < account_masters.length; i++) {
                    newHtml += '<option value="' + account_masters[i]['_id'] + '">' + account_masters[i]['ACName'] + '</option>';
                }
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Marks</strong>';
                newHtml += '<input type="text" name="vachhati_Aavak_Group[' + lstidx + '][marks]" placeholder="Marks"  id="marks' + lstidx + '" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Qntty</strong>';
                newHtml += '<input type="number" name="vachhati_Aavak_Group[' + lstidx + '][qntty]" placeholder="Qntty Pkng"  id="qntty' + lstidx + '" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '</tr>';

                newHtml += '<tr id="GaruTr2' + lstidx + '">';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Pkng</strong>';
                newHtml += '<input type="number" name="vachhati_Aavak_Group[' + lstidx + '][pkng]" placeholder="Pkng"  id="pkng' + lstidx + '" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Net wt</strong>';
                newHtml += '<input type="number" name="vachhati_Aavak_Group[' + lstidx + '][net_Wt]" placeholder="Net wt"  id="net_Wt' + lstidx + '" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td >';
                newHtml += '<strong class="control-strong">Rate</strong>';
                newHtml += '<input type="number" name="vachhati_Aavak_Group[' + lstidx + '][rate]"  id="rate' + lstidx + '" placeholder="Rate" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td >';
                newHtml += '<strong class="control-strong"></br></strong>';
                newHtml += '<select name="vachhati_Aavak_Group[' + lstidx + '][QW]" placeholder="QW"  id="QW' + lstidx + '" class="form-control QW prbank" onchange="CalVachhatiAvakEntry()" style="width:100%">';
                newHtml += '<option value="Q" selected>Q</option>';
                newHtml += '<option value="W">W</option>  ';
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Amount</strong>';
                newHtml += '<input type="number" name="vachhati_Aavak_Group[' + lstidx + '][amount]"  id="amount' + lstidx + '" placeholder="Amount" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Discount %</strong>';
                newHtml += '<input type="hidden" name="vachhati_Aavak_Group[' + lstidx + '][Dis_Amt]"  id="Dis_Amt' + lstidx + '"/>';
                newHtml += '<input type="number" name="vachhati_Aavak_Group[' + lstidx + '][discount]" placeholder="Discount" id="discount' + lstidx + '" class="form-control" oninput="CalVachhatiAvakEntry()" value="0" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Bardan Amt</strong>';
                newHtml += '<input type="text" name="vachhati_Aavak_Group[' + lstidx + '][bardan_Gross_Amount]" placeholder="Bardan Gr Amt"  id="bardan_Gross_Amount' + lstidx + '" oninput="CalVachhatiAvakEntry()" class="form-control" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">APMC</strong>';
                newHtml += '<select name="vachhati_Aavak_Group[' + lstidx + '][apmc]" placeholder="APMC"  id="apmc' + lstidx + '" class="form-control YN prbank">';
                newHtml += '<option value="Y" selected>Y</option>';
                newHtml += '<option value="N">N</option> ';
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '</tr>';

                newHtml += '<tr id="GaruTr3' + lstidx + '">';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">APMC Amt</strong>';
                newHtml += '<input type="number" name="vachhati_Aavak_Group[' + lstidx + '][apmc_Amount]" placeholder="APMC Amt"  id="apmc_Amount' + lstidx + '" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Et%</strong>';
                newHtml += '<select name="vachhati_Aavak_Group[' + lstidx + '][ec]" placeholder="Ec"  id="ec' + lstidx + '" class="form-control YN prbank" style="width:100%">';
                newHtml += '<option value="Y" selected>Y</option>';
                newHtml += '<option value="N">N</option>';
                newHtml += '</select>';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Comm Gdn Rent</strong>';
                newHtml += '<input type="text" name="vachhati_Aavak_Group[' + lstidx + '][commission_gdn_rent]"  id="commission_gdn_rent' + lstidx + '" placeholder="Commission Gdn Rent" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                   newHtml +='<td>';
                   newHtml +='<strong class="control-strong">Entry Tax</strong>';
                   newHtml +='<input type="text" name="garu_Aavak_Group['+lstidx+'][entry_Tax]"  id="entry_Tax'+lstidx+'" placeholder="Entry Tax" class="form-control" oninput="CalGaruAvakEntry()" style="text-align: -webkit-right;" />';
                   newHtml +='</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">GST</strong>';
                newHtml += '<input type="hidden" name="vachhati_Aavak_Group[' + lstidx + '][tax_Amt]"  id="tax_Amt' + lstidx + '"/>';
                newHtml += '<input type="text" name="vachhati_Aavak_Group[' + lstidx + '][GST]" placeholder="GST"  id="GST' + lstidx + '" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Net Amt</strong>';
                newHtml += '<input type="number" name="vachhati_Aavak_Group[' + lstidx + '][net_Amount]" placeholder="Net Amt"  id="net_Amount' + lstidx + '" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Vakal Thok</strong>';
                newHtml += '<input type="text" name="vachhati_Aavak_Group[' + lstidx + '][vakal_Thok]" placeholder="Vakal Thok"  id="vakal_Thok' + lstidx + '" class="form-control" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += '<td>';
                newHtml += '<strong class="control-strong">Dana Rate</strong>';
                newHtml += '<input type="number" name="vachhati_Aavak_Group[' + lstidx + '][dana_Rt]" placeholder="Dana Rate"  id="dana_Rt' + lstidx + '" class="form-control addgarufocus" oninput="CalVachhatiAvakEntry()" style="text-align: -webkit-right;" />';
                newHtml += '</td>';
                newHtml += "<td></br></br><a onclick='deleteGaruGroupEntry(" + lstidx + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                newHtml += '</tr>';
                $(newHtml).insertBefore("#Vachhati_Aavak_Entry_Group_Add");
                $(".productitem").select2({
                    placeholder: "Select Product",
                    allowClear: true,
                });
                $(".YN").select2({
                    placeholder: "Select Y/N",
                    allowClear: true,
                });
                $(".QW").select2({
                    placeholder: "Select Q/W",
                    allowClear: true,
                });
                $('.ItenCodeName').select2({
                    placeholder: 'Please select Item',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Vachhati_Aavak_Entry/ItenCodeName',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    templateSelection: formatcity,
                    escapeMarkup: function (m) { return m; }
                })
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
            }
        }
    });
});
// end addVachhati Entry Master

///grocery report summary ################################################################################################################
$(document).on("click", "#groceryprint", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var toliCode = $('#toliCode').val();
    window.open('/daily_grocery_entry/daily_grocery_summary_print?start_date=' + start_date + '&end_date=' + end_date + '&toliCode=' + toliCode + '');
})
$(document).on("click", "#grocerysubmit", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var toliCode = $('#toliCode').val();
    if (toliCode != '') {
        // $('.loader').show();
        $.ajax({
            type: "POST",
            url: '/daily_grocery_entry/grocery_report_summary',
            dataType: 'json',
            data: {
                start_date: start_date,
                end_date: end_date,
                toliCode: toliCode,
            },
            success: function (data) {
                console.log(data);
                if (data['success'] == true) {
                    // console.log("length",data.ledger.length);
                    if (data.ledger == '' || data.ledger == null) $('.loader').hide();
                    var html = '<div class="showsearchdata">';
                    html += '<div class="row">';
                    html += '<div class="col-md-12">';
                    html += '<div class="table-responsive">';
                    html += '<table id="userTable" class="userTable table table-striped table-bordered table-hover adsearch">';
                    html += '<thead>';
                    html += '<tr>';
                    html += '<th>Date</th>';
                    html += '<th>Amount Payable</br>by Wages</th>';
                    html += '<th>The Employee</br>Levy</th>';
                    html += '<th>Cash Received</br>Wages</th>';
                    html += '<th>From Toli</br>Levy</th>';
                    html += '<th>Total</th>';
                    html += '</tr>';
                    html += '</thead>';
                    html += '<tbody>';
                    $.each(data.GrocArray, function (index, value) {
                        html += "<tr>";
                        html += "<td style='text-align: center'>" + value.date + "</td>";
                        html += "<td style='text-align: right'>" + value.tot_basic + "</td>";
                        html += "<td style='text-align: right'>" + value.tot_levy + "</td>";
                        html += "<td style='text-align: center'>--</td>";
                        html += "<td style='text-align: center'>--</td>";
                        html += "<td style='text-align: right'>" + value.tot_Amt + "</td>";
                        html += "</tr>"
                    });
                    html += '</tbody>';
                    html += '</table>';
                    $("#datatablegrocerysummary").html(html);
                    dattable = jQuery('#userTable').DataTable({
                        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                        "processing": false,
                        "serverSide": false,
                        "colReorder": true,
                        "autoWidth": false,
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],

                        "buttons": [
                            {
                                extend: 'excel',
                                className: 'btn-default btn-excel',
                                exportOptions: {
                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                            },
                            {
                                extend: 'pdf',
                                className: 'btn-default btn-pdf',
                                exportOptions: {

                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                                footer: true,
                                orientation: 'landscape',
                                customize: function (doc) {
                                    doc.content.splice(0, 0, {
                                        margin: [0, 0, 0, 12],
                                        alignment: 'center',
                                        text: 'Soft Sauda'
                                    });
                                },
                                messageBottom: 'Exported from Soft Sauda'
                            },
                            {
                                extend: 'print',
                                className: 'btn-default btn-print',
                                exportOptions: {
                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                            },
                        ],
                        "order": [1, 'asc'],
                        "columnDefs": [{
                            "className": "actioncell",
                            "orderable": false,
                            "searchable": false,
                            "sortable": false,
                            "targets": [0],
                            "width": "5%"
                        }],
                    })


                    $('.loader').hide();
                }
            }
        });
    }
    else {
        swal({
            title: "Grocery Report Summary",
            text: "Please Select Toli Code",
            icon: "warning",
            timer: 1000,
            buttons: false
        })
    }

});
$(document).on("click", "#grocerypriprint", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var toliCode = $('#toliCode').val();
    window.open('/daily_grocery_entry/daily_grocery_summary_pri_print?start_date=' + start_date + '&end_date=' + end_date + '&toliCode=' + toliCode + '');
})
//end grocery report summary

// Cash Bank Module ######################################################################################################################################
function getcashbank() {
    if ($('#cashtype').val() == 'CONTRA') {

    }
}
$(document).on('click', '.addcashbank', function () {
    lstidx = $("input[name*='cashtrn']").length + 1;
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    if (lstidx == null || lstidx == '' || isNaN(lstidx)) lstidx = 1;
    var Form = $('#Form').val();
    $.ajax({
        type: "GET",
        url: '/cash_bank/AddLess',
        dataType: 'json',
        data: {
            lstidx: lstidx,
        },
        success: function (data) {
            console.log(data);
            if (data['success'] == true) {
                var addlessmast = data['addlessmast'];
                var newdiv = document.createElement('div');
                new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
                if (Form == 'CashBankUpdate') new_div += '<td><input type="radio" name="CheckReturn" id="CheckReturn' + lstidx + '"></td>';
                new_div += '<td>';
                new_div += '<input type="hidden" name="cashtrn" value="' + lstidx + '" id="cashtrn ' + lstidx + '"';
                new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
                new_div += '<select name="cashac_name" id="cashac_name' + lstidx + '" onchange="ConfirmDublicateParty(' + lstidx + ')"  class="form-control productplace selectproductfocus AllAccount">';
                new_div += '<option value=""></option>';
                new_div += '</select>';

                new_div += '</td>';
                new_div += '<td>';
                new_div += '<input type="text" name="cash_chequeno" id="cashchequeno' + lstidx + '"';
                new_div += 'class="form-control" style="text-align: -webkit-right;"';
                new_div += '/>';
                new_div += '</td>';
                new_div += '<td>';
                new_div += '<input type="text" name="cash_chequedate"';
                new_div += 'id="cashchequedate' + lstidx + '"';
                new_div += 'class="form-control datepicker" autocomplete="off" style="text-align: -webkit-right;"';
                new_div += '/>';
                new_div += '</td>';
                new_div += '<td>';
                new_div += '<input type="number" name="cash_amount"   required oninput="calcashbank(' + lstidx + ')"';
                new_div += 'id="cashamount' + lstidx + '" onkeydown="getOutStanding(' + lstidx + ',event)"';
                new_div += 'class="form-control FocusCashAmt" style="text-align: -webkit-right;"';
                new_div += '/>';
                new_div += '</td>';

                if (addlessmast == null || addlessmast == '' || addlessmast == undefined) flag = 1;
                else {
                    for (let a = 0; a < addlessmast.Add_Less_Parameter_Master_Array.length; a++) {
                        if (addlessmast.Add_Less_Parameter_Master_Array[a].Deduction_Par == 'Y') {
                            new_div += '<td>';
                            new_div += '<input type="hidden" value="' + a + '" name="YDed_Par_len" id="YDed_Par_len' + lstidx + '">';
                            new_div += '<input type="text"   name="YDed_Par_value"';
                            new_div += ' id="YDed_Par_value' + lstidx + '' + a + '"  oninput="calcashbank(' + lstidx + ')"';
                            new_div += 'class="form-control "style="text-align: -webkit-right;"';
                            new_div += '>';
                            new_div += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + '" name="YDed_Par_dsc" id="YDed_Par_dsc' + lstidx + '' + a + '">'
                            new_div += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a]._id + '" name="YDed_Par_dsc_id" id="YDed_Par_dsc_id' + lstidx + '' + a + '">'
                            new_div += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a].Parameter_Type + '" name="YDed_Par_typ" id="YDed_Par_typ' + lstidx + '' + a + '">'
                            new_div += '</td>';
                        }
                    }
                }
                new_div += '<td>';
                new_div += '<input type="hidden" name="cash_narr" id="cashnarr' + lstidx + '">';
                new_div += '<input type="text" name="cash_narrone"';
                new_div += 'id="cashnarrone' + lstidx + '" oninput="calcashbank(' + lstidx + ')"';
                new_div += 'class="form-control"  style="text-align: -webkit-right;"';
                new_div += '>';
                new_div += '</td>';

                new_div += '<td>';
                new_div += '<input type="hidden" name="YPara_Array" id="YPara_Array' + lstidx + '">';
                // new_div +='<input type="hidden" name="Amount_Deduction" id="Amount_Deduction'+lstidx+'">';
                new_div += '<input type="hidden" name="Add_Amount_Deduction[' + lstidx + ']" id="Add_Amount_Deduction' + lstidx + '">';
                new_div += '<input type="hidden" name="Less_Amount_Deduction[' + lstidx + ']" id="Less_Amount_Deduction' + lstidx + '">';
                new_div += '<input type="hidden" name="outSaveArr" id="outSaveArr' + lstidx + '">';
                new_div += '<input type="text" name="cash_narrtwo"';
                new_div += 'id="cashnarrtwo' + lstidx + '" oninput="calcashbank(' + lstidx + ')"';
                new_div += 'class="form-control amountfocus" style="text-align: -webkit-right;"';
                new_div += '/>';
                new_div += '</td>';

                new_div += "<td><a data-repeater-delete='inner-field-" + lstidx + "' onclick='delCashBankArr(" + lstidx + ")' data-brand-index='" + membern + "' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                new_div += "</tr>";
                $(new_div).insertBefore("#contract_div");
                $('.AllAccount').select2({
                    placeholder: 'Please Select',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Garu_Aavak_Entry/AllAccount',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    escapeMarkup: function (m) { return m; }
                });
                $('.datepicker').datepicker({ format: 'dd/mm/yyyy', autoclose: true, });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
            }
        }
    });
});
function ConfirmDublicateParty(index) {
    var CurrentParty = $('#cashac_name' + index).val();
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx);
    for (let i = 1; i <= idx; i++) {
        if (CurrentParty) { }
    }
}
function calcashbank(callback) {
    var amount = 0;
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx);
    if (lstidx == null || isNaN(lstidx)) lstidx = 1;
    for (i = 0; i <= lstidx; i++) {
        var Add_Ded_Amt_Tot = 0;
        var Less_Ded_Amt_Tot = 0;
        var dedlen = parseInt($("#YDed_Par_len" + i).val());
        if (dedlen >= 0) {
            for (let d = 0; d <= 5; d++) {
                var ded_Amt = $('#YDed_Par_value' + i + '' + d + '').val();
                if (ded_Amt == null || ded_Amt == '' || ded_Amt == undefined) ded_Amt = 0;
                var ded_typ = $('#YDed_Par_typ' + i + '' + d + '').val();
                if (ded_typ == '+') {
                    Add_Ded_Amt_Tot = parseFloat(Add_Ded_Amt_Tot) + parseFloat(ded_Amt);
                }
                if (ded_typ == '-') {
                    Less_Ded_Amt_Tot = parseFloat(Less_Ded_Amt_Tot) + parseFloat(ded_Amt);
                }
            }
            $('#Add_Amount_Deduction' + i).val(Add_Ded_Amt_Tot.toFixed(2));
            $('#Less_Amount_Deduction' + i).val(Less_Ded_Amt_Tot.toFixed(2));
        }
        if ($("#cashamount" + i).val() != undefined) {
            amount = amount + parseFloat($("#cashamount" + i).val());
        }
    }
    $("#totcash_amt").val((amount).toFixed(2));
}
$(document).on("keydown", "#OutStandingModel", function (event) {
    if (event.keyCode == 27) {
        event.preventDefault();
        $('#OutStandingModel').modal('hide');
        $('.adjustmentstable tr:nth-last-child(2)').find('.FocusCashAmt').focus();
    }
})
function getOutStanding(index, e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        getOutStandingOnClick(index);
    }
}
async function getOutStandingOnClick(index, Diffrence) {
    var cashamount = $('#cashamount' + index).val();
    if (Diffrence == 'Diffrence_Amount') {
        var OutArr = JSON.parse($('#outSaveArr' + index).val());
        var Tot_Adj_Amt = 0;
        if (OutArr == null || OutArr == '' || OutArr == []) {
        } else {
            for (let j = 0; j < OutArr.length; j++) {
                var recamt = OutArr[j].ReceiveAmt;
                var lessamt = OutArr[j].Less_Ded_Amt_Tot;
                if (lessamt == null || lessamt == '' || lessamt == undefined || isNaN(lessamt)) lessamt = 0;
                Tot_Adj_Amt = Tot_Adj_Amt + parseFloat(recamt) + parseFloat(lessamt);
            }
            cashamount = parseFloat(cashamount) - parseFloat(Tot_Adj_Amt)
        }
    }
    var party = $('#cashac_name' + index).val();
    var aaaaaa = index;
    if (cashamount != '' && party != '') {
        cbindex = index;
        var button_index = index;
        $('#totReceiveAmt').val(0);
        var party = $("#cashac_name" + index).val();
        var d_c = $("#cashtype").val();
        if (d_c != 'CONTRA') {
            if (d_c == 'RECEIPT') d_c = 'C';
            if (d_c == 'PAYMENT') d_c = 'D';
            $.ajax({
                type: 'GET',
                url: '/cash_bank/getOut',
                dataType: 'json',
                data: {
                    party: party,
                    d_c: d_c
                },
                success: function (data) {
                    console.log(data)
                    var i, j, result, sau;
                    result = '';
                    html = '';
                    if (data['success'] == true) {
                        var somast = data['accnametyp'];
                        var addlessmast = data['addlessmast'];
                        var division = data['division'];
                        $('#OutStandingModel').modal('show');
                        html += '<tr>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th>';
                        html += '<input type="number" class="form-control" name="EnterAmt" value="' + cashamount + '" id="EnterAmt" style="text-align:center" readonly>';
                        html += '<input type="hidden" value="' + cashamount + '" id="EnterAmt_hidden">';
                        html += '</th>';
                        if (addlessmast == null || addlessmast == '' || addlessmast == undefined) flag = 1;
                        else {
                            for (let a = 0; a < addlessmast.Add_Less_Parameter_Master_Array.length; a++) {
                                if (addlessmast.Add_Less_Parameter_Master_Array[a].Deduction_Par == 'N') {
                                    html += '<th></th>';
                                }
                            }
                        }
                        html += '<th></th>';
                        html += '</tr>';
                        html += '<tr>';
                        html += '<th>Date</th>';
                        html += '<th>Entry no</th>';
                        html += '<th>Amount</th>';
                        html += '<th>Panding Amount</th>';
                        html += '<th>Receive Amount</th>';
                        if (addlessmast == null || addlessmast == '' || addlessmast == undefined) flag = 1;
                        else {
                            for (let a = 0; a < addlessmast.Add_Less_Parameter_Master_Array.length; a++) {
                                for (let d = 0; d < addlessmast.Add_Less_Parameter_Master_Array[a].Division.length; d++) {
                                    if (addlessmast.Add_Less_Parameter_Master_Array[a].Deduction_Par == 'N' && addlessmast.Add_Less_Parameter_Master_Array[a].Division[d] == division) {
                                        html += '<th>' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + '</th>';
                                    }
                                }
                            }
                        }
                        html += '<th>Balance</th>';
                        html += '</tr>';
                        $('#OutStandingModelHead').html(html);
                        var totPandingAmt = 0;
                        if (somast != '') {
                            $.each(somast, function (index, value) {
                                result += '<tr>';
                                result += '<div id="delivery-' + index + '">';

                                result += '<td>';
                                var dat = moment(value.cash_date).format('DD/MM/YYYY');
                                result += '<input type="text" value="' + dat + '" name="outArray[' + index + '][cash_date]"';
                                result += 'id="cash_date' + index + '" readonly="true" class="form-control "style="text-align: -webkit-right;">';
                                result += '<input type="hidden" value="' + value.main_bk + '" name="outArray[' + index + '][main_bk]" id="main_bk' + index + '">';
                                result += '<input type="hidden" value="' + value.c_j_s_p + '" name="outArray[' + index + '][c_j_s_p]" id="c_j_s_p' + index + '">';
                                result += '<input type="hidden" value="' + value.c_j_s_p + '" id="c_j_s_p_Name' + index + '">';
                                // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray['+index+'][c_j_s_p]" id="c_j_s_p'+index+'">';
                                result += '<input type="hidden" value="' + value.co_code + '" name="outArray[' + index + '][co_code]" id="co_code' + index + '">';
                                result += '<input type="hidden" value="' + value.div_code + '" name="outArray[' + index + '][div_code]" id="div_code' + index + '">';
                                result += '</td>';

                                result += '<td>';
                                result += '<input type="hidden" value="' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]"';
                                result += 'id="vouc_code' + index + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                                result += '<input type="text" class="form-control" value="' + value.main_bk + '/' + value.c_j_s_p + '/' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]" readonly>';
                                result += '</td>';
                                // result += '<td>';  (SALES PERSON NAME IS USED IN OTHER SOFTWARE ONLY NOT USED IN GORANI)
                                // if(value.so_disc != null)result += '<input type="text" name="itemname" id="itemnameid'+j+'" value="'+value.so_disc.Fg_Des+'" data-itemid="'+value.so_disc._id+'" class="form-control" style="text-align: -webkit-left;" readonly="true">';
                                // else result += '<input type="text" name="itemname" id="itemnameid'+j+'" value="" data-itemid="" class="form-control" style="text-align: -webkit-right;">';
                                // result += '</td>';

                                result += '<td>';
                                result += '<input type="hidden" value="' + value.Bill_Amount + '" name="outArray[' + index + '][Bill_Amount]" id="Bill_Amount' + index + '">';
                                result += '<input type="text" value="' + value.cash_amount + '" name="outArray[' + index + '][cash_amount]"';
                                result += 'id="Amount' + index + '" readonly="true"';
                                result += 'class="form-control " style="text-align: -webkit-right;"';
                                result += 'required>';
                                result += '<input type="hidden" value="' + value.cashac_name + '" name="outArray[' + index + '][party_id]"';
                                result += 'id="party_id' + index + '"';
                                result += 'class="form-control " style="text-align: -webkit-right"';
                                result += '>';
                                result += '<input type="hidden" value="' + value._id + '" name="outArray[' + index + '][out_id]"';
                                result += 'id="out_id' + index + '"';
                                result += 'class="form-control " style="text-align: -webkit-right"';
                                result += '>';
                                result += '</td>';

                                result += '<td>';
                                var out = 0;
                                out = value.outstanding_balance;
                                if (out == undefined || out == null) out = '';
                                totPandingAmt = parseFloat(totPandingAmt) + parseFloat(out)
                                result += '<input type="text" value="' + out + '" name="outArray[' + index + '][outstanding_amount]" readonly="true"';
                                result += 'id="outstanding_amount' + index + '"';
                                result += 'class="form-control" style="text-align: -webkit-right;"';
                                result += '>';
                                result += '</td>';

                                result += '<td>';
                                result += '<input type="text" value="' + 0 + '" name="outArray[' + index + '][ReceiveAmt]" onkeydown="calEnterAmt(' + somast.length + ',event,' + index + ')"';
                                result += 'id="ReceiveAmt' + index + '" oninput="calOutStanding(' + somast.length + ')"';
                                result += 'class="form-control "style="text-align: -webkit-right;"';
                                result += 'required>';
                                result += '</td>';

                                if (addlessmast == null || addlessmast == '' || addlessmast == undefined) flag = 1;
                                else {
                                    for (let a = 0; a < addlessmast.Add_Less_Parameter_Master_Array.length; a++) {
                                        for (let d = 0; d < addlessmast.Add_Less_Parameter_Master_Array[a].Division.length; d++) {
                                            if (addlessmast.Add_Less_Parameter_Master_Array[a].Deduction_Par == 'N' && addlessmast.Add_Less_Parameter_Master_Array[a].Division[d] == division) {
                                                result += '<td>';
                                                result += '<input type="hidden" value="' + a + '" name="Ded_Par_len" id="Ded_Par_len' + lstidx + '">';
                                                result += '<input type="text" value="" name="outArray[' + index + '][' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + ']"';
                                                result += 'id="Ded_Par_value' + index + '' + a + '" oninput="calOutStanding(' + somast.length + ')" onkeydown="FocusSaveBtnInCBOutWindow(event)"';
                                                result += 'class="form-control" data-Type="' + addlessmast.Add_Less_Parameter_Master_Array[a].Parameter_Type + '" style="text-align: -webkit-right;"';
                                                result += 'data-dscr="' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + '">';
                                                result += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + '" name="outArray[' + index + '][Ded_Par_dsc]" id="Ded_Par_dsc' + index + '' + a + '">'
                                                result += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a]._id + '" name="outArray[' + index + '][Ded_Par_dsc_id]" id="Ded_Par_dsc_id' + index + '' + a + '">'
                                                result += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a].Parameter_Type + '" name="outArray[' + index + '][Ded_Par_typ]" id="Ded_Par_typ' + index + '' + a + '">'
                                                result += '</td>';
                                            }
                                        }
                                    }
                                }
                                result += '<td>'; '+value.order_price+'
                                result += '<input type="text" name="outArray[' + index + '][BalanceAmt]"';
                                result += 'id="BalanceAmt' + index + '" onkeydown="CashBankOutFocusNext(' + index + ',event)"';
                                result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                                result += '>';
                                result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                                result += '</td>';

                                //  result +=  '<td>'; 
                                //  result +=  '<input type="text" value="'+value.total_amt+'" name="total_amt" readonly="true"';
                                //  result +=  'id="octotalAmountf' + j +'" oninput="calsalesorder(' + j +')"';
                                //  result +=  'class="form-control amountfocus" style="text-align: -webkit-right;"';
                                //  result +=  ' amountfocus>';
                                //  result +=  '</td>';

                                result += '</div>';
                                result += '</tr>';
                                glbidx = j;
                            });

                            result += '<tr>';
                            result += '<td>';
                            var dat = $("#offerstartdate").val()
                            result += '<input type="text" value="' + dat + '" name="outArray[' + somast.length + '][cash_date]"';
                            result += 'id="cash_date0" readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '<input type="hidden" value="CB" name="outArray[' + somast.length + '][main_bk]" id="main_bk' + somast.length + '">';
                            result += '<input type="hidden" value="OnAcc" name="outArray[' + somast.length + '][c_j_s_p]" id="c_j_s_p' + somast.length + '">';
                            result += '<input type="hidden" value="OnaAcc" id="c_j_s_p_Name' + somast.length + '">';
                            // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray[0][c_j_s_p]" id="c_j_s_p0">';
                            result += '<input type="hidden" value="" name="outArray[' + somast.length + '][co_code]" id="co_code' + somast.length + '">';
                            result += '<input type="hidden" value="" name="outArray[' + somast.length + '][div_code]" id="div_code' + somast.length + '">';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="text" value="One Acc" name="outArray[' + somast.length + '][vouc_code]"';
                            result += 'id="vouc_code' + somast.length + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][Bill_Amount]" id="Bill_Amount' + somast.length + '">';
                            result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][cash_amount]"';
                            result += 'id="Amount' + somast.length + '" readonly="true"';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '<input type="hidden" value="' + party + '" name="outArray[' + somast.length + '][party_id]"';
                            result += 'id="party_id' + somast.length + '"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '<input type="hidden" value="" name="outArray[' + somast.length + '][out_id]"';
                            result += 'id="out_id' + somast.length + '"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '</td>';


                            result += '<td>';
                            result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][outstanding_amount]" readonly="true"';
                            result += 'id="outstanding_amount' + somast.length + '"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += '>';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][ReceiveAmt]" onkeydown="calEnterAmt(' + somast.length + ',event,' + somast.length + ')"';
                            result += 'id="ReceiveAmt' + somast.length + '" oninput="calOutStanding(' + somast.length + ')"';
                            result += 'class="form-control "style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';

                            if (addlessmast == null || addlessmast == '' || addlessmast == undefined) flag = 1;
                            else {
                                for (let a = 0; a < addlessmast.Add_Less_Parameter_Master_Array.length; a++) {
                                    for (let d = 0; d < addlessmast.Add_Less_Parameter_Master_Array[a].Division.length; d++) {
                                        if (addlessmast.Add_Less_Parameter_Master_Array[a].Deduction_Par == 'N' && addlessmast.Add_Less_Parameter_Master_Array[a].Division[d] == division) {
                                            result += '<td>';
                                            result += '<input type="hidden" value="' + a + '" name="Ded_Par_len" id="Ded_Par_len' + lstidx + '">';
                                            result += '<input type="text" value="0" name="outArray[0][' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + ']"';
                                            result += 'id="Ded_Par_value' + somast.length + '' + a + '" oninput="calOutStanding(' + somast.length + ')" onkeydown="FocusSaveBtnInCBOutWindow(event)"';
                                            result += 'class="form-control" data-Type="' + addlessmast.Add_Less_Parameter_Master_Array[a].Parameter_Type + '" style="text-align: -webkit-right;"';
                                            result += 'data-dscr="' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + '">';
                                            result += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + '" name="outArray[0][Ded_Par_dsc]" id="Ded_Par_dsc' + somast.length + '' + a + '">'
                                            result += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a]._id + '" name="outArray[0][Ded_Par_dsc_id]" id="Ded_Par_dsc_id' + somast.length + '' + a + '">'
                                            result += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a].Parameter_Type + '" name="outArray[0][Ded_Par_typ]" id="Ded_Par_typ' + somast.length + '' + a + '">'
                                            result += '</td>';
                                        }
                                    }
                                }
                            }
                            result += '<td>'; '+value.order_price+'
                            result += '<input type="text" name="outArray[' + somast.length + '][BalanceAmt]"';
                            result += 'id="BalanceAmt' + somast.length + '"';
                            result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                            result += '>';
                            result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                            result += '</td>';
                            result += '</tr>';
                        } else {
                            result += '<tr>';
                            result += '<td>';
                            var dat = $("#offerstartdate").val();
                            result += '<input type="text" value="' + dat + '" name="outArray[0][cash_date]"';
                            result += 'id="cash_date0" readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '<input type="hidden" value="CB" name="outArray[0][main_bk]" id="main_bk0">';
                            result += '<input type="hidden" value="OnAcc" name="outArray[0][c_j_s_p]" id="c_j_s_p0">';
                            result += '<input type="hidden" value="OnaAcc" id="c_j_s_p_Name0">';
                            // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray[0][c_j_s_p]" id="c_j_s_p0">';
                            result += '<input type="hidden" value="" name="outArray[0][co_code]" id="co_code0">';
                            result += '<input type="hidden" value="" name="outArray[0][div_code]" id="div_code0">';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="text" value="One Acc" name="outArray[0][vouc_code]"';
                            result += 'id="vouc_code0"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '</td>';

                            // result += '<td>';  (SALES PERSON NAME IS USED IN OTHER SOFTWARE ONLY NOT USED IN GORANI)
                            // if(value.so_disc != null)result += '<input type="text" name="itemname" id="itemnameid'+j+'" value="'+value.so_disc.Fg_Des+'" data-itemid="'+value.so_disc._id+'" class="form-control" style="text-align: -webkit-left;" readonly="true">';
                            // else result += '<input type="text" name="itemname" id="itemnameid'+j+'" value="" data-itemid="" class="form-control" style="text-align: -webkit-right;">';
                            // result += '</td>';

                            result += '<td>';
                            result += '<input type="hidden" value="0" name="outArray[0][Bill_Amount]" id="Bill_Amount0">';
                            result += '<input type="text" value="0" name="outArray[0][cash_amount]"';
                            result += 'id="Amount0" readonly="true"';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '<input type="hidden" value="' + party + '" name="outArray[0][party_id]"';
                            result += 'id="party_id0"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '<input type="hidden" value="" name="outArray[0][out_id]"';
                            result += 'id="out_id0"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '</td>';


                            result += '<td>';
                            result += '<input type="text" value="0" name="outArray[0][outstanding_amount]" readonly="true"';
                            result += 'id="outstanding_amount0"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += '>';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="text" value="' + 0 + '" name="outArray[0][ReceiveAmt]" onkeydown="calEnterAmt(1,event,0)"';
                            result += 'id="ReceiveAmt0" oninput="calOutStanding(1)"';
                            result += 'class="form-control "style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';

                            if (addlessmast == null || addlessmast == '' || addlessmast == undefined) flag = 1;
                            else {
                                for (let a = 0; a < addlessmast.Add_Less_Parameter_Master_Array.length; a++) {
                                    for (let d = 0; d < addlessmast.Add_Less_Parameter_Master_Array[a].Division.length; d++) {
                                        if (addlessmast.Add_Less_Parameter_Master_Array[a].Deduction_Par == 'N' && addlessmast.Add_Less_Parameter_Master_Array[a].Division[d] == division) {
                                            result += '<td>';
                                            result += '<input type="hidden" value="' + a + '" name="Ded_Par_len" id="Ded_Par_len' + lstidx + '">';
                                            result += '<input type="text" value="0" name="outArray[0][' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + ']"';
                                            result += 'id="Ded_Par_value0' + a + '" oninput="calOutStanding(' + somast.length + ')"';
                                            result += 'class="form-control" data-Type="' + addlessmast.Add_Less_Parameter_Master_Array[a].Parameter_Type + '" style="text-align: -webkit-right;"';
                                            result += 'data-dscr="' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + '">';
                                            result += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a].Description + '" name="outArray[0][Ded_Par_dsc]" id="Ded_Par_dsc0' + a + '">'
                                            result += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a]._id + '" name="outArray[0][Ded_Par_dsc_id]" id="Ded_Par_dsc_id0' + a + '">'
                                            result += '<input type="hidden" value="' + addlessmast.Add_Less_Parameter_Master_Array[a].Parameter_Type + '" name="outArray[0][Ded_Par_typ]" id="Ded_Par_typ0' + a + '">'
                                            result += '</td>';
                                        }
                                    }
                                }
                            }
                            result += '<td>'; '+value.order_price+'
                            result += '<input type="text" name="outArray[0][BalanceAmt]"';
                            result += 'id="BalanceAmt0" onkeydown="CashBankOutFocusNext(0,event)"';
                            result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                            result += '>';
                            result += '<input type="hidden" id="outLength" value="1">';
                            result += '</td>';

                            result += '</div>';
                            result += '</tr>';
                        }
                        var save = 'Save_OutEntry';
                        var button = '<button type="button" class="btn btn-primary" id="GetOutStInCBBtnId" onclick="GetOutStInCB(' + button_index + ',\'' + save + '\')">Save</button>';
                        $('#OutstandingModelSaveButton').html(button);
                        $('.out_repeat_row').html(result);
                        $('#ReceiveAmt0').focus();
                        $('#totPandingAmt').val(totPandingAmt.toFixed(2));
                        $('#ReceiveAmt0').val($('#EnterAmt').val());
                        $("input").focus(function () {
                            $(this).select();
                        });
                    } else {
                        swal({
                            title: 'Oops!',
                            text: 'Not Set In Group Master For Maintain Outstanding',
                            buttons: false,
                            timer: 1500
                        })
                    }
                }
            });
        }
    } else {
        if (e.keyCode == 13) {
            e.preventDefault();
            if ($('#cashac_name' + aaaaaa).val() == '') {
                setTimeout(function () { $('#cashac_name' + aaaaaa).focus(); }, 100);
            }
            if ($('#cashamount' + aaaaaa).val() == '') {
                setTimeout(function () { $('#cashamount' + aaaaaa).focus(); }, 100);
            }
        }
    }
}
function FocusSaveBtnInCBOutWindow(e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        var EnterAmt = $('#EnterAmt').val();
        if (EnterAmt == 0) setTimeout(function () { $('#GetOutStInCBBtnId').focus() }, 100);
    }
}
async function calEnterAmt(idx, e, index) {
    var bal = await calOutStanding(idx);
    if (e.keyCode == 13) {
        var EnterAmt = $('#EnterAmt').val();
        if (EnterAmt > 0) {
            for (let d = 0; d <= 5; d++) {
                var ded_Desc = $('#Ded_Par_dsc' + index + '' + d + '').val();
                if (ded_Desc == 'Discount') {
                    if (idx != index) $('#Ded_Par_value' + index + '' + d + '').val($('#BalanceAmt' + index).val());
                    break;
                }
            }
        }
    }
}
function CashBankOutFocusNext(idx, e) {
    if (e.keyCode == 13) {
        var a = parseInt(idx) + 1;
        setTimeout(function () {
            $('#ReceiveAmt' + a).focus();
            $('#ReceiveAmt' + a).val($('#EnterAmt').val());
        }, 100);
    }
}
function calOutStanding(len) {
    var EnterAmt = $('#EnterAmt').val();
    var EnterAmt_hidden = $('#EnterAmt_hidden').val();
    var totrec = 0;
    // if(EnterAmt>=0){
    for (let i = 0; i < len + 1; i++) {
        var amt = $('#Amount' + i).val();
        var recamt = $('#ReceiveAmt' + i).val();
        if (recamt == '' || recamt == null || recamt == undefined) recamt = 0;
        var out = $('#outstanding_amount' + i).val();
        var recAmt = $('#ReceiveAmt' + i).val();
        EnterAmt_hidden = parseFloat(EnterAmt_hidden) - parseFloat(recAmt);
        console.log(EnterAmt_hidden);
        for (let d = 0; d <= 5; d++) {
            var ded_Amt = $('#Ded_Par_value' + i + '' + d + '').val();
            if (ded_Amt == null || ded_Amt == '' || ded_Amt == undefined || isNaN(ded_Amt)) ded_Amt = 0;
            var ded_typ = $('#Ded_Par_typ' + i + '' + d + '').val();
            if (ded_typ == '+') {
                recamt = parseFloat(recamt) + parseFloat(ded_Amt);
            }
            if (ded_typ == '-') {
                EnterAmt_hidden = parseFloat(EnterAmt_hidden) - parseFloat(ded_Amt);
            }
        }
        // if($('#EnterAmt').val() <= 0)setTimeout(function () {$('#GetOutStInCBBtnId').focus()}, 100);
        if (EnterAmt_hidden < 0) {
            alert('Totle Adjust Amount Should Be Equal To Entred Amount');
            $('#EnterAmt').css({ "backgroundColor": "red", "color": "black" });
        } else {
            $('#EnterAmt').css({ "backgroundColor": "rgb(211, 253, 122)", "color": "black" });
        }
        var balamt = parseFloat(out) - parseFloat(recamt);
        $('#BalanceAmt' + i).val(balamt.toFixed(2));
        $('#EnterAmt').val(EnterAmt_hidden.toFixed(2));

    }
    return balamt.toFixed(2)
    // }
}
var cbindex = 0;
var outMainArray = [];
var outArray = [];
var Para_Array = [];
function GetOutStInCB(idx, notfocus) {
    outArray = [];
    Para_Array = [];
    var Narr1 = [];
    var Narr2 = '';
    if (notfocus == 'Save_OutEntry' || notfocus == 'notfocus') {
        $('#OutStandingModel').modal('hide');
        var len = $('#outLength').val();
        var cashac_name = $('#cashac_name' + idx).val();
        var cashac_name_Str = $('#cashac_name' + idx).text();
        var cash_chequeno = $('#cashchequeno' + idx).val();
        if (cash_chequeno == undefined || cash_chequeno == '' || cash_chequeno == null) cash_chequeno = '';
        var cash_chequedate = $('#cashchequedate' + idx).val();
        var cash_amount = $('#cashamount' + idx).val();
        var cash_narrone = $('#cashnarrone' + idx).val();
        var cash_narrtwo = $('#cashnarrtwo' + idx).val();
        for (let i = 0; i <= len; i++) {
            Para_Array = [];
            var Add_Ded_Amt_Tot = 0;
            var Less_Ded_Amt_Tot = 0
            for (let d = 0; d <= 5; d++) {
                var ded_Amt = $('#Ded_Par_value' + i + '' + d + '').val();
                if (ded_Amt == null || ded_Amt == '' || ded_Amt == undefined) ded_Amt = 0;
                var ded_typ = $('#Ded_Par_typ' + i + '' + d + '').val();
                if (ded_typ == '+') {
                    Add_Ded_Amt_Tot = parseFloat(Add_Ded_Amt_Tot) + parseFloat(ded_Amt);
                }
                if (ded_typ == '-') {
                    Less_Ded_Amt_Tot = parseFloat(Less_Ded_Amt_Tot) + parseFloat(ded_Amt);
                }
                if ($('#Ded_Par_dsc' + i + '' + d + '').val() == null || $('#Ded_Par_dsc' + i + '' + d + '').val() == '' || $('#Ded_Par_dsc' + i + '' + d + '').val() == undefined) flag = 1;
                else {
                    if ($('#ReceiveAmt' + i).val() > 0) {
                        var arr = { 'Ded_Par_dsc': $('#Ded_Par_dsc' + i + '' + d + '').val(), 'Ded_Par_dsc_id': $('#Ded_Par_dsc_id' + i + '' + d + '').val(), 'Ded_Par_value': $('#Ded_Par_value' + i + '' + d + '').val(), 'Ded_Par_typ': $('#Ded_Par_typ' + i + '' + d + '').val() };
                        Para_Array.push(arr);
                        outArray[i] = {
                            'cashac_name': cashac_name, 'cash_chequeno': cash_chequeno, 'cash_chequedate': cash_chequedate, 'cash_amount': cash_amount, 'cash_narrone': cash_narrone, 'cash_narrtwo': cash_narrtwo,
                            'cash_date': $('#offerstartdate').val(), 'vouc_code': $('#vouc_code' + i).val(), 'Bill_Amt': $('#Amount' + i).val(), 'out_id': $('#out_id' + i).val(), 'BalanceAmt': $('#BalanceAmt' + i).val(),
                            'ReceiveAmt': $('#ReceiveAmt' + i).val(), 'outstanding_amount': $('#outstanding_amount' + i).val(), 'Para_Array': Para_Array, 'main_bk': $('#main_bk' + i).val(), 'c_j_s_p': $('#c_j_s_p' + i).val(),
                            'div_code': $('#div_code' + i).val(), 'co_code': $('#co_code' + i).val(), 'Add_Ded_Amt_Tot': Add_Ded_Amt_Tot, 'Less_Ded_Amt_Tot': Less_Ded_Amt_Tot, 'Bill_Date': $('#cash_date' + i).val()
                        };
                        Narr1[i] = { 'main_bk': $('#main_bk' + i).val(), 'c_j_s_p': $('#c_j_s_p_Name' + i).val(), 'vouc_code': $('#vouc_code' + i).val(), 'Para_Array': Para_Array };
                    }
                }
            }
        }
        var OutFinArr = [];
        for (let o = 0; o < outArray.length; o++) {
            if (outArray[o] == [] || outArray[o] == null || outArray[o] == '') flag = 1;
            else OutFinArr.push(outArray[o]);
        }
        if ($('#Form').val() == 'CashBankUpdate') {
            var values = $("input[name='OutArrCount']")
                .map(function () { return $(this).val(); }).get();
            var poutidx = values[values.length - 1];
            for (let pout = 0; pout <= poutidx; pout++) {
                if ($('#Rec_Amount_in_Prev' + pout).val() > 0) {
                    var Para_Array = JSON.parse($('#Para_Array' + pout).val());
                    for (let parr = 0; parr < Para_Array.length; parr++) {
                        if (Para_Array[parr].Ded_Par_typ == '+') Para_Array[parr].Ded_Par_value = $('#Add_Ded_Amt_Tot_in_Prev' + pout).val();
                        if (Para_Array[parr].Ded_Par_typ == '-') Para_Array[parr].Ded_Par_value = $('#Less_Ded_Amt_Tot_in_Prev' + pout).val();
                    }
                    // var arr = {'Ded_Par_dsc':$('#Ded_Par_dsc'+i+''+d+'').val(),'Ded_Par_dsc_id':$('#Ded_Par_dsc_id'+i+''+d+'').val(),'Ded_Par_value':$('#Ded_Par_value'+i+''+d+'').val(),'Ded_Par_typ':$('#Ded_Par_typ'+i+''+d+'').val()};
                    // Para_Array.push(arr);
                    var arr = {
                        'cashac_name': $('#Bill_cashac_name' + pout).val(), 'cash_chequeno': cash_chequeno, 'cash_chequedate': cash_chequedate, 'cash_amount': cash_amount, 'cash_narrone': cash_narrone, 'cash_narrtwo': cash_narrtwo,
                        'cash_date': $('#offerstartdate').val(), 'vouc_code': $('#Bill_vouc_code' + pout).val(), 'Bill_Amt': $('#Bill_Amount_in_Prev' + pout).val(), 'out_id': $('#oustanding_id' + pout).val(), 'BalanceAmt': $('#outstanding_balance_in_Prev' + pout).val(),
                        'ReceiveAmt': $('#Rec_Amount_in_Prev' + pout).val(), 'outstanding_amount': $('#Rec_Amount_in_Prev' + pout).val(), 'Para_Array': Para_Array, 'main_bk': $('#Bill_main_bk' + pout).val(), 'c_j_s_p': $('#Bill_c_j_s_p' + pout).val(),
                        'div_code': $('#Bill_div_code' + pout).val(), 'co_code': $('#Bill_co_code' + pout).val(), 'Add_Ded_Amt_Tot': $('#Add_Ded_Amt_Tot_in_Prev' + pout).val(), 'Less_Ded_Amt_Tot': $('#Less_Ded_Amt_Tot_in_Prev' + pout).val(), 'Bill_Date': $('#Bill_Date' + pout).val(),
                        'OutEntry_id': $('#OutEntryId' + pout).val()
                    };
                    OutFinArr.push(arr)
                    var narr = { 'main_bk': $('#Bill_main_bk' + pout).val(), 'c_j_s_p': $('#Bill_c_j_s_p' + pout).val(), 'vouc_code': $('#Bill_vouc_code' + pout).val(), 'Para_Array': Para_Array };
                    Narr1.push(narr);
                }
            }
        }
        outArray = OutFinArr;
        console.log('OutFinArr', outArray);
        // console.log('Narr1',Narr1)
        $('#cashnarr' + idx).val(JSON.stringify(Narr1));
        $('#outSaveArr' + idx).val(JSON.stringify(outArray));

        if (outArray != null) {
            for (let i = 0; i < outArray.length; i++) {
                if (outArray[i].Para_Array != null) {
                    for (let j = 0; j < outArray[i].Para_Array.length; j++) {
                        for (let d = 0; d <= 5; d++) {
                            if ($('#YDed_Par_dsc' + idx + '' + d + '').val() == outArray[i].Para_Array[j].Ded_Par_dsc) {
                                if ($('#YDed_Par_value' + idx + '' + d + '').val() == null || $('#YDed_Par_value' + idx + '' + d + '').val() == '' || isNaN($('#YDed_Par_value' + idx + '' + d + '').val()) || $('#YDed_Par_value' + idx + '' + d + '').val() == undefined) var amt = 0;
                                else {
                                    if (i == 0) var amt = 0;
                                    else var amt = $('#YDed_Par_value' + idx + '' + d + '').val();
                                }
                                if (outArray[i].Para_Array[j].Ded_Par_value == null || outArray[i].Para_Array[j].Ded_Par_value == '' || isNaN(outArray[i].Para_Array[j].Ded_Par_value) || outArray[i].Para_Array[j].Ded_Par_value == undefined) var dedamt = 0;
                                else var dedamt = outArray[i].Para_Array[j].Ded_Par_value;
                                var tot = parseFloat(dedamt) + parseFloat(amt);
                                $('#YDed_Par_value' + idx + '' + d + '').val(tot.toFixed(2));
                            }
                        }
                    }
                }
            }
        }
        calcashbank(1);
        setTimeout(function () {
            var YPara_Array = [];
            for (let d = 0; d <= 5; d++) {
                if ($('#YDed_Par_dsc' + idx + '' + d + '').val() == null || $('#YDed_Par_dsc' + idx + '' + d + '').val() == '' || $('#YDed_Par_dsc' + idx + '' + d + '').val() == undefined) flag = 1;
                else {
                    if ($('#YDed_Par_value' + idx + '' + d + '').val() == null || $('#YDed_Par_value' + idx + '' + d + '').val() == '' || $('#YDed_Par_value' + idx + '' + d + '').val() == undefined || isNaN($('#YDed_Par_value' + idx + '' + d + '').val())) $('#YDed_Par_value' + idx + '' + d + '').val(0);
                    var arr = { 'YDed_Par_dsc': $('#YDed_Par_dsc' + idx + '' + d + '').val(), 'YDed_Par_dsc_id': $('#YDed_Par_dsc_id' + idx + '' + d + '').val(), 'YDed_Par_value': $('#YDed_Par_value' + idx + '' + d + '').val(), 'YDed_Par_typ': $('#YDed_Par_typ' + idx + '' + d + '').val() };
                    YPara_Array.push(arr);
                }
            }
            $('#YPara_Array' + idx).val(JSON.stringify(YPara_Array));
            if (notfocus == 'notfocus') { }
            else $('#cashnarrone' + idx).focus();
        }, 100);
    }
}

function YParaMeterArrInCb() {
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    for (let i = 0; i <= idx; i++) {
        var YPara_Array = [];
        for (let d = 0; d <= 5; d++) {
            if ($('#YDed_Par_dsc' + i + '' + d + '').val() == null || $('#YDed_Par_dsc' + i + '' + d + '').val() == '' || $('#YDed_Par_dsc' + i + '' + d + '').val() == undefined) flag = 1;
            else {
                if ($('#YDed_Par_value' + i + '' + d + '').val() == null || $('#YDed_Par_value' + i + '' + d + '').val() == '' || $('#YDed_Par_value' + i + '' + d + '').val() == undefined || isNaN($('#YDed_Par_value' + i + '' + d + '').val())) $('#YDed_Par_value' + i + '' + d + '').val(0);
                var arr = { 'YDed_Par_dsc': $('#YDed_Par_dsc' + i + '' + d + '').val(), 'YDed_Par_dsc_id': $('#YDed_Par_dsc_id' + i + '' + d + '').val(), 'YDed_Par_value': $('#YDed_Par_value' + i + '' + d + '').val(), 'YDed_Par_typ': $('#YDed_Par_typ' + i + '' + d + '').val() };
                YPara_Array.push(arr);
            }
        }
        $('#YPara_Array' + i).val(JSON.stringify(YPara_Array));
    }
}

function delCashBankArr(idx) {
    var aa = confirm('Are yo sure to want to delete it');
    if (aa == true) {
        var p_id = $('#cashac_name' + idx).val();
        var p_amt = $('#cashamount' + idx).val();
        for (let i = 0; i < outMainArray.length; i++) {
            console.log(p_id, outMainArray[i].party_id);
            if (p_id == outMainArray[i].party_id && idx == outMainArray[i].CbArrIdx) {
                for (let j = 0; j < outMainArray[i].outArray.length; j++) {
                    console.log(outMainArray[i].outArray[j].ReceiveAmt, parseFloat(p_amt));
                    if (outMainArray[i].outArray[j].ReceiveAmt > 0 && parseFloat(p_amt) > 0) {
                        outMainArray[i].outArray[j].ReceiveAmt = 0;
                    }
                }
                break;
            }
        }
        console.log(outMainArray);
        $('#rohit' + idx).remove();
    }
    calcashbank(1)

}

function UpdateCity() {
    $.ajax({
        type: "POST",
        url: '/account_mast/amast_GroupUpdate',
        dataType: 'json',
        data: {
            qty_bal: '1200'
        },
        success: function (data) { }
    });
}

$(".lock-Item").on('keydown', function (ev) {
    ev.preventDefault();
    if (ev.keyCode == 13) {
        var data = $(this).closest('form').serialize();
        $.ajax({
            url: '/product_mast/product_mast_add_In_Model',
            method: 'POST',
            dataType: 'json',
            data: data,
            success: function (dat) {
                if (dat.success == true) {
                    $('#addcity').modal('hide');
                    swal({
                        title: "Item Master",
                        text: "Item Saved",
                        icon: "success",
                        timer: 2000,
                        buttons: false
                    })
                    $('#addItem').modal('hide');
                } else {
                    $('#addItem').modal('hide');
                    // swal({
                    //         title: "Item Master",
                    //         text: "Duplicate Item with same city is not allowed",
                    //         icon: "error",
                    //         timer: 2000,
                    //         buttons: false
                    //     }) 
                }
            }
        })
    }
})
$(".lock-Item").click(function (ev) {
    ev.preventDefault();
    if ($(this).closest('form').valid()) {
        var data = $(this).closest('form').serialize();
        $.ajax({
            url: '/product_mast/product_mast_add_In_Model',
            method: 'POST',
            dataType: 'json',
            data: data,
            success: function (dat) {
                if (dat.success == true) {
                    $('#addcity').modal('hide');
                    swal({
                        title: "Item Master",
                        text: "Item Saved",
                        icon: "success",
                        timer: 3000,
                        buttons: false
                    })
                    $('#addItem').modal('hide');
                } else {
                    $('#addItem').modal('hide');
                    // swal({
                    //         title: "Account",
                    //         text: "Duplicate account with same city is not allowed",
                    //         icon: "error",
                    //         timer: 4000,
                    //         buttons: false
                    //     }) 
                }
            }
        })
    }
})
function getBookInCheqReturn() {
    var c_j_s_p = $("#c_j_s_p_chaq").val();
    var Module = $('#c_j_s_p_chaq').attr('data-Module');
    if (Module == 'Bill Collection' || Module == 'Cash/Bank') {
        $.ajax({
            type: 'GET',
            url: '/Bill_CollectionEntry/GetBook',
            dataType: 'json',
            data: {
                c_j_s_p: c_j_s_p,
                Module: Module,
            },
            success: function (data) {
                if (data['success']) {
                    // console.log(data);
                    $('#vouc_code').val(data.last);
                    $('#vouc_code_chaq').val(data.last);
                }
            }
        })
    }
}
function chaqReturnEntry() {
    if ($('#Form').val() == 'CashBankUpdate') {
        var CheckReturn = $('input[name="CheckReturn"]:checked').val();
        if (CheckReturn == null || CheckReturn == undefined) {
            alert('Please Check Any On Entry');
        } else {
            // $('#chaqReturnEntryRadio1').attr('checked',false);
            $('#chaqReturnEntryRadio2').attr('checked', false);
            $('#chaqReturnEntryRadio3').attr('checked', false);
            var c_j_s_p = $("#c_j_s_p_chaq").val();
            var Module = $('#c_j_s_p_chaq').attr('data-Module');
            $.ajax({
                type: 'GET',
                url: '/Bill_CollectionEntry/GetBook',
                dataType: 'json',
                data: {
                    c_j_s_p: c_j_s_p,
                    Module: Module,
                },
                success: function (data) {
                    if (data['success']) {
                        $('#ChaqReturnSno').val(CheckReturn);
                        $('#vouc_code_chaq').val(data.last);
                        $('#CheqReturn').modal('show');
                        $('#chaqReturnEntryRadio1').focus();
                    }
                }
            });
        }
    }
}
function focusChaqReturnSaveButton(e) {
    if (e.keyCode == 13) {
        $('#SaveChaqReturnEntry').focus();
    }
}
$(document).on('focus', '#SaveChaqReturnEntry', function (e) {
    $('#SaveChaqReturnEntry').css('background-color', "green")
})
function SaveChaqReturnEntry() {
    swal({
        title: "Confirm",
        text: "Are you Sure you want to Save it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            var c_j_s_p = $('#c_j_s_p').val();
            var vouc_code = $('#vouc_code').val();
            var ChqReturn = $('input[name="CheckReturn"]:checked').val();
            var cash_bank_id = $('#cash_bank_id' + ChqReturn).val();

            var c_j_s_p_chaq = $('#c_j_s_p_chaq').val();
            var vouc_code_chaq = $('#vouc_code_chaq').val();
            var cash_remarks_chaq = $('#cash_remarks_chaq').val();
            var ChaqReturnDate = $('#ReturnDate_chaq').val();

            var Remark = $('#cash_remarks_chaq').val();
            var cash_bank_name = $('#cash_bank_name').val();
            var cashac_name = $('#cashac_name' + ChqReturn).val();
            var cashchequeno = $('#cashchequeno' + ChqReturn).val();
            var cashchequedate = $('#cashchequedate' + ChqReturn).val();
            var cashamount = $('#cashamount' + ChqReturn).val();

            var chaqReturnEntryRadio = $('input[name="chaqReturnEntryRadio"]:checked').val();
            $.ajax({
                type: 'GET',
                url: '/cash_bank/SaveChaqReturnEntry',
                dataType: 'json',
                data: {
                    c_j_s_p: c_j_s_p,
                    vouc_code: vouc_code,
                    mainbk: 'CB',
                    cashac_name: cashac_name,
                    cash_bank_id: cash_bank_id,
                    Sno: parseInt(ChqReturn - 1),
                    chaqReturnEntryRadio: chaqReturnEntryRadio,

                    c_j_s_p_chaq: c_j_s_p_chaq,
                    vouc_code_chaq: vouc_code_chaq,
                    cash_remarks_chaq: cash_remarks_chaq,
                    ChaqReturnDate: ChaqReturnDate,
                },
                success: function (data) {
                    if (data['success']) {
                        alert('success');
                        $('#CheckReturn' + ChqReturn).attr('checked', false);
                        $('#rohit' + ChqReturn).css('background-color', "#ff6666")
                        $('#cashac_name' + ChqReturn).css('background-color', "#ff6666");
                        $('#cashchequeno' + ChqReturn).css('background-color', "#ff6666");
                        $('#cashchequedate' + ChqReturn).css('background-color', "#ff6666");
                        $('#cashamount' + ChqReturn).css('background-color', "#ff6666");
                        $('#cashnarrone' + ChqReturn).css('background-color', "#ff6666");
                        $('#cashnarrtwo' + ChqReturn).css('background-color', "#ff6666");
                        $('#YDed_Par_value' + ChqReturn + '0').css('background-color', "#ff6666");
                        $('#YDed_Par_value' + ChqReturn + '1').css('background-color', "#ff6666");
                        $('#YDed_Par_value' + ChqReturn + '2').css('background-color', "#ff6666");
                        $('#YDed_Par_value' + ChqReturn + '3').css('background-color', "#ff6666");
                        $('#CheqReturn').modal('hide');
                    }
                }
            });
        }
    });
}

function showAdjustEntryInCbUpdate(idx) {
    var cashBankId = $('#cash_bank_id' + idx).val();
    $.ajax({
        type: 'GET',
        url: '/cash_bank/showAdjustEntryInCbUpdate',
        dataType: 'json',
        data: {
            cashBankId: cashBankId,
            Module: 'CB'
        },
        success: function (data) {
            if (data['success']) {
                console.log(data['outstandingEntry']);
                var outstandingEntry = data['outstandingEntry'];
                var html = '';
                html += '<div class="row" style="width: 100%;background-color: dodgerblue;margin-left:1px" align="center"><h4 style="color: white">Outstanding Entry</h4></div>';
                html += '<table class="table tabler table-bordered adsearch">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>Delete</th>';
                html += '<th>Date</th>';
                html += '<th>Entry No</th>';
                html += '<th>Type</th>';
                html += '<th>Bill Amount</th>';
                html += '<th style="width:5em">Receive Amount</th>';
                html += '<th style="width:5em">Discount</th>';
                html += '<th style="width:5em">Interest</th>';
                html += '<th style="width:5em">Balance</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                for (let i = 0; i < outstandingEntry.length; i++) {
                    html += '<tr id="delCBAdjustAmtEntry' + i + '">';
                    html += "<td>";
                    html += '<input type="hidden" name="OutArrCount" value="' + i + '" id="cashtrn"/>';
                    html += "<a onclick='delCBAdjustAmtEntry(" + i + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a>";
                    html += "<input type='hidden' id='OutEntryId" + i + "'     value='" + outstandingEntry[i]._id + "' data-recAmt='" + outstandingEntry[i].Rec_Amount + "' data-addAmt='" + outstandingEntry[i].Add_Ded_Amt_Tot + "' data-lessAmt='" + outstandingEntry[i].Less_Ded_Amt_Tot + "'>";
                    html += "<input type='hidden' id='oustanding_id" + i + "'  value='" + outstandingEntry[i].outstanding_id + "'>";
                    html += "<input type='hidden' id='CashBank_id" + i + "'    value='" + outstandingEntry[i].CashBank_id + "'>";
                    html += "<input type='hidden' id='Bill_vouc_code" + i + "' value='" + outstandingEntry[i].vouc_code + "'>";
                    html += "<input type='hidden' id='Entry_c_j_s_p" + i + "'  value='" + outstandingEntry[i].c_j_s_p + "'>";
                    html += "<input type='hidden' id='Bill_c_j_s_p" + i + "'   value='" + outstandingEntry[i].op_c_j_s_p + "'>";
                    html += "<input type='hidden' id='Bill_main_bk" + i + "'   value='" + outstandingEntry[i].op_main_bk + "'>";
                    html += "<input type='hidden' id='Bill_co_code" + i + "'   value='" + outstandingEntry[i].op_co_code + "'>";
                    html += "<input type='hidden' id='Bill_div_code" + i + "'  value='" + outstandingEntry[i].op_div_code + "'>";
                    html += "<input type='hidden' id='Bill_Date" + i + "'      value='" + outstandingEntry[i].Bill_Date + "'>";
                    html += "<input type='hidden' id='Bill_cashac_name" + i + "'  value='" + outstandingEntry[i].cashac_name._id + "'>";//cashac_name
                    html += "<input type='hidden' id='Para_Array" + i + "'        value='" + JSON.stringify(outstandingEntry[i].addlessParameter) + "'>";//cashac_name
                    html += "</td>";
                    html += '<td>' + outstandingEntry[i].Bill_Date + '</td>';//moment(outstandingEntry[i].cash_date).format('DD/MM/YYYY')
                    html += '<td style="text-align:center">' + outstandingEntry[i].op_c_j_s_p + '/' + outstandingEntry[i].vouc_code + '</td>';
                    if (outstandingEntry[i].d_c == 'C') html += '<td style="text-align:center">Receipt</td>';
                    if (outstandingEntry[i].d_c == 'D') html += '<td style="text-align:center">Payment</td>';
                    html += '<td style="text-align:right">' + outstandingEntry[i].Bill_Amount + '<input type="hidden" id="Bill_Amount_in_Prev' + i + '" value="' + outstandingEntry[i].Bill_Amount + '"></td>';
                    html += '<td>';
                    html += '<input type="number" id="Rec_Amount_in_Prev' + i + '" value="' + outstandingEntry[i].Rec_Amount + '" oninput="calOutBalAmtInCBUpdate(' + idx + ')">';
                    html += '<input type="hidden" id="Rec_Amount_Prev' + i + '" value="' + outstandingEntry[i].Rec_Amount + '">';
                    html += '</td>';//outstandingEntry[i].Rec_Amount
                    html += '<td>';
                    html += '<input type="number" id="Add_Ded_Amt_Tot_in_Prev' + i + '" value="' + outstandingEntry[i].Add_Ded_Amt_Tot + '" oninput="calOutBalAmtInCBUpdate(' + idx + ')">';
                    html += '<input type="hidden" id="Add_Ded_Amt_Tot_Prev' + i + '" value="' + outstandingEntry[i].Add_Ded_Amt_Tot + '">';
                    html += '</td>';//outstandingEntry[i].Add_Ded_Amt_Tot
                    html += '<td>';
                    html += '<input type="number" id="Less_Ded_Amt_Tot_in_Prev' + i + '" value="' + outstandingEntry[i].Less_Ded_Amt_Tot + '" oninput="calOutBalAmtInCBUpdate(' + idx + ')">';
                    html += '<input type="hidden" id="Less_Ded_Amt_Tot_Prev' + i + '" value="' + outstandingEntry[i].Less_Ded_Amt_Tot + '">';
                    html += '</td>';//outstandingEntry[i].Less_Ded_Amt_Tot
                    html += '<td>';
                    html += '<input type="number"  id="outstanding_balance_in_Prev' + i + '" value="' + outstandingEntry[i].outstanding_balance + '" readonly>';
                    html += '<input type="hidden"  id="outstanding_balance_Prev' + i + '" value="' + outstandingEntry[i].outstanding_balance + '" readonly>';
                    html += '</td>';
                    html += '</tr>';
                }
                html += '</tbody>';
                html += '</table>';
                $('#showAdjustEntryInCbUpdate').html(html);
                $("input").focus(function () {
                    $(this).select();
                });
                GetOutStInCB(idx, 'notfocus');
            }
        }
    });
}
function refreshAdjOutEntryInCB() {
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    for (let i = 0; i <= idx; i++) {
        var cashBankId = $('#cash_bank_id' + i).val()
        if (cashBankId == null || cashBankId == undefined || cashBankId == '') { }
        else {
            $.ajax({
                type: 'GET',
                url: '/cash_bank/showAdjustEntryInCbUpdate',
                dataType: 'json',
                data: {
                    cashBankId: cashBankId,
                    Module: 'CB'
                },
                success: function (data) {
                    if (data['success']) {
                        console.log(data['outstandingEntry']);
                        var outstandingEntry = data['outstandingEntry'];
                        var outArray = [];
                        for (let j = 0; j < outstandingEntry.length; j++) {
                            var arr = {
                                'cashac_name': $('#cashac_name' + i).val(), 'cash_chequeno': $('#cashchequeno' + i).val(), 'cash_chequedate': $('#cashchequedate' + i).val(), 'cash_amount': $('#cashamount' + i).val(),
                                'cash_narrone': $('#cashnarrone' + i).val(), 'cash_narrtwo': $('#cashnarrtwo' + i).val(), 'cash_date': $('#offerstartdate').val(), 'vouc_code': outstandingEntry[j].vouc_code,
                                'Bill_Amt': outstandingEntry[j].Bill_Amount, 'out_id': outstandingEntry[j].outstanding_id, 'BalanceAmt': outstandingEntry[j].outstanding_balance, 'ReceiveAmt': outstandingEntry[j].Rec_Amount,
                                'outstanding_amount': outstandingEntry[j].outstanding_amount, 'Add_Ded_Amt_Tot': outstandingEntry[j].Add_Ded_Amt_Tot, 'Less_Ded_Amt_Tot': outstandingEntry[j].Less_Ded_Amt_Tot,
                                'Para_Array': outstandingEntry[j].addlessParameter, 'main_bk': outstandingEntry[j].op_main_bk, 'c_j_s_p': outstandingEntry[j].op_c_j_s_p, 'div_code': outstandingEntry[j].op_div_code,
                                'co_code': outstandingEntry[j].op_co_code, 'Bill_Date': outstandingEntry[j].Bill_Date, 'OutEntry_id': outstandingEntry[j]._id
                            };
                            outArray.push(arr);
                        }
                        console.log('refreshAdjOutEntry_In_CB', outArray);
                        $('#outSaveArr' + i).val(JSON.stringify(outArray));
                    }
                }
            });
        }
    }
}
async function calOutBalAmtInCBUpdate(idx) {
    // var aa = await GetOutStInCB(idx,'notfocus');
    var tot_Amt = $('#cashamount' + idx).val();
    if ($('#Form').val() == 'journalEntry_Update_Form') {
        var aa = await GetOutStInJE(idx, 'notfocus');
        if ($('#cashtypejv' + idx).val() == 'Debit') tot_Amt = $('#cashamountjv' + idx).val();
        if ($('#cashtypejv' + idx).val() == 'Credit') tot_Amt = $('#cashamountcr' + idx).val();
    } else { var aa = await GetOutStInCB(idx, 'notfocus'); }

    var values = $("input[name='OutArrCount']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    var tot_rec_Amt = 0;
    if (tot_Amt == null || tot_Amt == '' || tot_Amt == undefined || isNaN(tot_Amt)) tot_Amt = 0;
    for (let i = 0; i <= idx; i++) {
        var Rec_Amount_Prev = $('#Rec_Amount_Prev' + i).val();
        var Add_Ded_Amt_Tot_Prev = $('#Add_Ded_Amt_Tot_Prev' + i).val();
        var Less_Ded_Amt_Tot_Prev = $('#Less_Ded_Amt_Tot_Prev' + i).val();
        var outstanding_balance = $('#outstanding_balance_Prev' + i).val();
        var op_c_j_s_p = $('#Bill_c_j_s_p' + i).val();
        var Rec_Amount = $('#Rec_Amount_in_Prev' + i).val();
        var Add_Ded_Amt_Tot = $('#Add_Ded_Amt_Tot_in_Prev' + i).val();
        var Less_Ded_Amt_Tot = $('#Less_Ded_Amt_Tot_in_Prev' + i).val();
        if (Rec_Amount_Prev == null || Rec_Amount_Prev == '' || Rec_Amount_Prev == undefined || isNaN(Rec_Amount_Prev)) Rec_Amount_Prev = 0;
        if (Add_Ded_Amt_Tot_Prev == null || Add_Ded_Amt_Tot_Prev == '' || Add_Ded_Amt_Tot_Prev == undefined || isNaN(Add_Ded_Amt_Tot_Prev)) Add_Ded_Amt_Tot_Prev = 0;
        if (Less_Ded_Amt_Tot_Prev == null || Less_Ded_Amt_Tot_Prev == '' || Less_Ded_Amt_Tot_Prev == undefined || isNaN(Less_Ded_Amt_Tot_Prev)) Less_Ded_Amt_Tot_Prev = 0;
        if (outstanding_balance == null || outstanding_balance == '' || outstanding_balance == undefined || isNaN(outstanding_balance)) outstanding_balance = 0;
        if (Rec_Amount == null || Rec_Amount == '' || Rec_Amount == undefined || isNaN(Rec_Amount)) Rec_Amount = 0
        if (Add_Ded_Amt_Tot == null || Add_Ded_Amt_Tot == '' || Add_Ded_Amt_Tot == undefined || isNaN(Add_Ded_Amt_Tot)) Add_Ded_Amt_Tot = 0
        if (Less_Ded_Amt_Tot == null || Less_Ded_Amt_Tot == '' || Less_Ded_Amt_Tot == undefined || isNaN(Less_Ded_Amt_Tot)) Less_Ded_Amt_Tot = 0
        tot_rec_Amt = tot_rec_Amt + parseFloat(Rec_Amount) + parseFloat(Less_Ded_Amt_Tot);
        if (tot_rec_Amt > tot_Amt) {
            alert('Adjust Amount ' + tot_rec_Amt + ' is Greater Than Totel Amount ' + tot_Amt + '');
            $('#Rec_Amount_in_Prev' + i).css({ "backgroundColor": "red", "color": "black" });
        } else {
            $('#Rec_Amount_in_Prev' + i).css({ "backgroundColor": "rgb(211, 253, 122)", "color": "black" });
            var bal = 0;
            if (op_c_j_s_p == 'OnAcc') {
                bal = Rec_Amount;
            } else {
                bal = parseFloat(Rec_Amount_Prev) + parseFloat(Add_Ded_Amt_Tot_Prev) - parseFloat(Less_Ded_Amt_Tot_Prev) + parseFloat(outstanding_balance);
                bal = bal - parseFloat(Rec_Amount) - parseFloat(Add_Ded_Amt_Tot) + parseFloat(Less_Ded_Amt_Tot);
            }
            $('#outstanding_balance_in_Prev' + i).val(bal);
        }
    }
}
function delCBAdjustAmtEntry(idx) {
    swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            var OutEntryId = $('#OutEntryId' + idx).val();
            var CashBank_id = $('#CashBank_id' + idx).val();
            var Bill_vouc_code = $('#Bill_vouc_code' + idx).val();
            var Bill_c_j_s_p = $('#Bill_c_j_s_p' + idx).val();
            var Bill_main_bk = $('#Bill_main_bk' + idx).val();
            var Bill_co_code = $('#Bill_co_code' + idx).val();
            var Bill_div_code = $('#Bill_div_code' + idx).val();

            var OutEntry_recAmt = $('#OutEntryId' + idx).attr('data-recAmt');
            var OutEntry_addAmt = $('#OutEntryId' + idx).attr('data-addAmt');
            var OutEntry_lessAmt = $('#OutEntryId' + idx).attr('data-lessAmt');
            $.ajax({
                type: 'GET',
                url: '/cash_bank/delCBAdjustAmtEntry',
                dataType: 'json',
                data: {
                    OutEntryId: OutEntryId,
                    CashBank_id: CashBank_id,
                    Bill_vouc_code: Bill_vouc_code,
                    Bill_c_j_s_p: Bill_c_j_s_p,
                    Bill_main_bk: Bill_main_bk,
                    Bill_co_code: Bill_co_code,
                    Bill_div_code: Bill_div_code,
                    OutEntry_recAmt: OutEntry_recAmt,
                    OutEntry_addAmt: OutEntry_addAmt,
                    OutEntry_lessAmt: OutEntry_lessAmt,
                },
                success: function (data) {
                    if (data['success']) {
                        alert('success');
                        $('#delCBAdjustAmtEntry' + idx).remove();
                        GetOutStInCB(idx, 'notfocus');
                    }
                }
            });
        }
    })
}
$(document).on('keydown', '#CashBankUpdateBtn', function (e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        CashBankUpdateOnClick()
    }
})
async function CashBankUpdateOnClick() {
    YParaMeterArrInCb();
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    var count = 0;
    for (let i = 0; i <= idx; i++) {
        // var a = await GetOutStInCB(i,'notfocus');
        var Tot_Amt = $('#cashamount' + i).val();
        if (Tot_Amt > 0) {
            var OutArr = JSON.parse($('#outSaveArr' + i).val());
            var Tot_Adj_Amt = 0;
            if (OutArr == null || OutArr == '' || OutArr == []) {

            } else {
                for (let j = 0; j < OutArr.length; j++) {
                    var recamt = OutArr[j].ReceiveAmt;
                    var lessamt = OutArr[j].Less_Ded_Amt_Tot;
                    if (lessamt == null || lessamt == '' || lessamt == undefined || isNaN(lessamt)) lessamt = 0;
                    Tot_Adj_Amt = Tot_Adj_Amt + parseFloat(recamt) + parseFloat(lessamt);
                }
                var diff = parseFloat(Tot_Amt) - parseFloat(Tot_Adj_Amt)
                if (diff > 0.50) {
                    var Diffrence = 'Diffrence_Amount';
                    alert('Total Amount ' + Tot_Amt + ' is Greater Than Adjust Amount ' + Tot_Adj_Amt + ' Diffrence ' + diff + '')
                    if ($('#Form').val() == 'CashBankUpdate') {
                        // showAdjustEntryInCbUpdate(i); // Need When multiple Entry Are Come 
                        getOutStandingOnClick(i, Diffrence);
                    }
                    count = count + 1;
                    break;
                } else {
                    if (diff < 0) {
                        alert('Adjust Amount ' + Tot_Adj_Amt + ' is Greater Than Total Amount ' + Tot_Amt + ' Diffrence ' + diff + '');
                        count = count + 1;
                        break;
                    }
                }
            }
        }
    }
    if (count == 0) {
        // var a = await GetOutStInCN('Save_OutEntry');
        alert('save');
        if ($('#Form').val() == 'CashBankUpdate') if ($('#CashBankUpdateForm_id').valid()) $('#CashBankUpdateForm_id').submit();
    }
}

// Cheq Return Entry In Bill Collection ########################################################################################################################
function chaqReturnEntryInBC() {
    if ($('#Form').val() == 'BillCollUpdate') {
        var CheckReturn = $('input[name="CheckReturn"]:checked').val();
        if (CheckReturn == null || CheckReturn == undefined) {
        } else {
            // $('#chaqReturnEntryRadio1').attr('checked',false);
            $('#chaqReturnEntryRadio2').attr('checked', false);
            $('#chaqReturnEntryRadio3').attr('checked', false);
            var c_j_s_p = $("#c_j_s_p_chaq").val();
            var Module = $('#c_j_s_p_chaq').attr('data-Module');
            $.ajax({
                type: 'GET',
                url: '/Bill_CollectionEntry/GetBook',
                dataType: 'json',
                data: {
                    c_j_s_p: c_j_s_p,
                    Module: Module,
                },
                success: function (data) {
                    if (data['success']) {
                        $('#ChaqReturnSno').val(CheckReturn);
                        $('#vouc_code_chaq').val(data.last);
                        $('#CheqReturn').modal('show');
                        $('#chaqReturnEntryRadio1').focus();
                    }
                }
            });
        }
    }
}

function SaveChaqReturnEntryInBC() {
    swal({
        title: "Confirm",
        text: "Are you Sure you want to Save it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            var c_j_s_p = $('#c_j_s_p').val();
            var vouc_code = $('#vouc_code').val();
            var ChqReturn = $('input[name="CheckReturn"]:checked').val();
            var BillColl_Id = $('#BillColl_Id' + ChqReturn).val();
            var c_j_s_p_chaq = $('#c_j_s_p_chaq').val();
            var vouc_code_chaq = $('#vouc_code_chaq').val();
            var cash_remarks_chaq = $('#cash_remarks_chaq').val();
            var ChaqReturnDate = $('#ReturnDate_chaq').val();

            var Remark = $('#cash_remarks_chaq').val();
            var cash_bank_name = $('#cash_bank_name').val();
            var cashac_name = $('#cashac_name' + ChqReturn).val();
            var cashchequeno = $('#Chq_No').val();
            var cashchequedate = $('#chq_date').val();
            var cashamount = $('#Amt_Settled' + ChqReturn).val();

            var chaqReturnEntryRadio = $('input[name="chaqReturnEntryRadio"]:checked').val();
            $.ajax({
                type: 'GET',
                url: '/Bill_CollectionEntry/SaveChaqReturnEntryInBC',
                dataType: 'json',
                data: {
                    c_j_s_p: c_j_s_p,
                    vouc_code: vouc_code,
                    mainbk: 'CB',
                    cashac_name: cashac_name,
                    BillColl_Id: BillColl_Id,
                    Sno: parseInt(ChqReturn),
                    chaqReturnEntryRadio: chaqReturnEntryRadio,

                    c_j_s_p_chaq: c_j_s_p_chaq,
                    vouc_code_chaq: vouc_code_chaq,
                    cash_remarks_chaq: cash_remarks_chaq,
                    ChaqReturnDate: ChaqReturnDate,
                },
                success: function (data) {
                    if (data['success']) {
                        alert('success');
                        GaruTr20
                        $('#CheckReturn' + ChqReturn).attr('checked', false);
                        $('#GaruTr1' + ChqReturn).css('background-color', "#ff6666")
                        $('#GaruTr2' + ChqReturn).css('background-color', "#ff6666")
                        $('#CheqReturn').modal('hide');
                    }
                }
            });
        }
    });
}

// function showAdjustEntryInBCUpdate(idx){
//     var BillCollId = $('#BillColl_Id'+idx).val();
//     $.ajax({
//         type:'GET',
//         url:'/Bill_CollectionEntry/showAdjustEntryInBCUpdate',
//         dataType:'json',
//         data:{
//             BillCollId:BillCollId
//         },
//         success:function(data){
//             if(data['success']){
//                 console.log(data['outstandingEntry']);
//                 var outstandingEntry = data['outstandingEntry'];
//                 var html = '';
//                 html += '<table class="table tabler table-bordered adsearch">';
//                 html += '<thead>';
//                 html += '<tr>';
//                 html += '<th>Date</th>';
//                 html += '<th>Entry No</th>';
//                 html += '<th>Type</th>';
//                 html += '<th>Bill Amount</th>';
//                 html += '<th>Receive Amount</th>';
//                 html += '<th>Discount</th>';
//                 html += '<th>Interest</th>';
//             //  html = '<th>Balance</th>';
//                 html += '</tr>';
//                 html += '</thead>';
//                 html += '<tbody>';
//                 for(let i=0; i<outstandingEntry.length; i++){
//                     html += '<tr>';
//                     html += '<td>'+moment(outstandingEntry[i].cash_date).format('DD/MM/YYYY')+'</td>';
//                     html += '<td style="text-align:center">'+outstandingEntry[i].c_j_s_p+'/'+outstandingEntry[i].vouc_code+'</td>';
//                     if(outstandingEntry[i].d_c == 'C')html += '<td style="text-align:center">Receipt</td>';
//                     if(outstandingEntry[i].d_c == 'D')html += '<td style="text-align:center">Payment</td>';
//                     html += '<td style="text-align:right">'+outstandingEntry[i].Bill_Amount+'</td>';
//                     html += '<td style="text-align:right">'+outstandingEntry[i].Rec_Amount+'</td>';
//                     html += '<td style="text-align:right">'+outstandingEntry[i].Add_Ded_Amt_Tot+'</td>';
//                     html += '<td style="text-align:right">'+outstandingEntry[i].Less_Ded_Amt_Tot+'</td>';
//                     html += '</tr>';
//                 }
//                 html += '</tbody>';
//                 html += '</table>';
//                 $('#showAdjustEntryInBCUpdate').html(html);
//             }
//         }
//     });
// }

// Opening Outstanding Module ######################################################################################################################################################
function getopsmodule() {
    var partyid = $('#partyid').val();
    if (partyid == null || partyid == '') {
        swal({
            title: 'Oops!',
            text: 'Please Select Party',
            buttons: false,
            timer: 800
        })
    } else {
        $.ajax({
            type: "GET",
            url: '/op_os_module/getlistopmodule',
            dataType: 'json',
            data: {
                partyid: partyid,
            },
            success: function (data) {
                console.log(data)
                if (data['success'] == true) {
                    var oposmodule = data['oposmodule'];
                    var html = '';
                    var vouchMast = data['vouchMast'];
                    // var html = '<tr><td><input type="hidden" name="update" value="update"><td></tr>';
                    $.each(oposmodule, function (index, value) {
                        counter = index;
                        html += '<tr id="delOpOsArr' + counter + '">';
                        html += '<td>';
                        html += '<input type="hidden" name="opmoduleid[' + counter + ']" id="opmoduleid' + counter + '" value="' + value._id + '">';
                        html += '<input type="hidden" name="OpOsArrNum" id="OpOsArrNum' + counter + '" value="' + counter + '">';
                        html += '<input type="hidden" name="OpOsArrUpdate[' + counter + ']" id="OpOsArrUpdate' + counter + '" value="OpOsArrUpdate">';
                        html += '<select name="OS_Type[' + counter + ']" id="OS_Type' + counter + '" style="width:100%;" class="form-control prbank select2Class" placeholder="Please Select">';
                        html += '<option value="" ></option>';
                        html += '<option value="REF"';
                        if (value.OS_Type == 'REF') html += 'selected';
                        html += '>REF</option>';
                        html += '<option value="ONA"'
                        if (value.OS_Type == 'ONA') html += 'selected';
                        html += '>ONA</option>';
                        html += '<option value="SB"';
                        if (value.OS_Type == 'SB') html += 'selected';
                        html += '>SB</option>';
                        html += '<option value="PB"'
                        if (value.OS_Type == 'PB') html += 'selected';
                        html += '>PB</option>';
                        html += '</select>';
                        html += '</td>';

                        html += '<td>';
                        html += '<select name="OS_Book[' + counter + ']" id="OS_Book' + counter + '" style="width: 100%;" class="form-control prbank select2Class" placeholder="Please Select">';
                        html += '<option value="" selected></option>';
                        if (value.OS_Book == 'REF') html += '<option value="REF" selected="true">REF</option>';
                        else html += '<option value="REF">REF</option>';
                        if (value.OS_Book == 'ONA') html += '<option value="ONA" selected="true">ONA</option>';
                        else html += '<option value="ONA">ONA</option>';
                        for (let i = 0; i < vouchMast.length; i++) {
                            console.log(value.OS_Book, vouchMast[i].Vo_book)
                            if (value.OS_Book == vouchMast[i].Vo_book) html += '<option value="' + vouchMast[i].Vo_book + '" selected="true">' + vouchMast[i].Vo_book + '</option>';
                            else html += '<option value="' + vouchMast[i].Vo_book + '">' + vouchMast[i].Vo_book + '</option>';
                        }
                        html += '</select>';
                        html += '</td>';

                        html += '<td>';
                        html += '<input type="text" value="' + value.vouc_code + '" required name="vouc_code[' + counter + ']" id="vouc_code' + counter + '" placeholder="Voucher No" class="form-control number">';
                        html += '</td>';

                        html += '<td>';
                        html += '<input type="text" value="' + value.Chr + '" name="Chr[' + counter + ']" id="Chr' + counter + '" placeholder="Chr" class="form-control">';
                        html += '</td>';

                        html += '<td>';
                        var dt = moment(value.cash_date).format('DD/MM/YYYY');
                        html += '<input type="text" required value="' + dt + '" name="date[' + counter + ']" class="form-control datemask BillDate" id="date' + counter + '" value="" placeholder="Date">';
                        html += '</td>';

                        html += '<td>';
                        html += '<select name="broker_Code[' + counter + ']" id="broker_Code' + counter + '" required style="width: 100%;" class="form-control prbank broker_Code">';
                        html += '<option value="' + value.broker_Code._id + '">' + value.broker_Code.ACName + '</option>';
                        html += '</select>';
                        html += '</td>';

                        html += '<td>';
                        html += '<input type="text" value="' + value.partyBillNo + '" name="partyBillNo[' + counter + ']" class="form-control numerals" id="partyBillNo' + counter + '" placeholder="Party Bill No">';
                        html += '</td>';

                        html += '<td>';
                        var pdt = moment(value.partyBillDate).format('DD/MM/YYYY');
                        html += '<input type="text" value="' + pdt + '" name="partyBillDate[' + counter + ']" class="form-control datemask BillDate" id="partyBillDate' + counter + '" placeholder="Party Bill Date">';
                        html += '</td>';

                        html += '<td>';
                        html += '<input type="number" value="' + value.cash_amount + '" name="Amount[' + counter + ']" class="form-control" id="Amount' + counter + '" placeholder="Amount" required>';
                        html += '</td>';

                        html += '<td>';
                        html += '<select name="d_c[' + counter + ']" id="d_c' + counter + '" style="width: 100%;" class="form-control prbank select2Class" placeholder="Please Select">';
                        html += '<option value=""></option>';
                        if (value.d_c == 'D') html += '<option value="Debit" selected>Debit</option>';
                        else html += '<option value="Debit">Debit</option>';
                        if (value.d_c == 'C') html += '<option value="Credit" selected>Credit</option>';
                        else html += '<option value="Credit">Credit</option>';
                        html += '</select>';
                        html += '</td>';

                        html += '<td>';
                        html += '<input type="text" value="' + value.discount + '" name="discount[' + counter + ']" class="form-control" id="discount' + counter + '" placeholder="Discount %">';
                        html += '</td>';

                        html += '<td>';
                        html += '<input type="text"  value="' + value.cr_Days + '" name="cr_Days[' + counter + ']" class="form-control" id="cr_Days' + counter + '" placeholder="Cr Days">';
                        html += '</td>';

                        html += '<td>';
                        if (counter < oposmodule.length - 1) html += '<input type="text"  value="' + value.cash_remarks + '" name="remarks[' + counter + ']" class="form-control" id="remarks' + counter + '" placeholder="Remarks">';
                        if (counter == oposmodule.length - 1) html += '<input type="text"  value="' + value.cash_remarks + '" name="remarks[' + counter + ']" class="form-control amountfocus" id="remarks' + counter + '" placeholder="Remarks">';
                        html += '</td>';

                        html += "<td><a onclick='delOpOsArr(" + counter + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                        html += '</tr>';
                    });
                    $(".adjustmentstable tbody tr").not('tr#OpOsArrNum').remove();
                    $('tr#OpOsArrNum').before(html);
                    $(".select2Class").select2({
                        placeholder: "Please Select",
                        allowClear: true,
                    });
                    $('.broker_Code').select2({
                        placeholder: 'Please select Broker',
                        allowClear: true,
                        ajax: {
                            type: "GET",
                            url: '/Garu_Aavak_Entry/broker_Code',
                            dataType: 'json',
                            data: function (term) {
                                return {
                                    term: term
                                };
                            },
                            success: function (data) {
                            },
                        },
                        templateResult: formatcity,
                        templateSelection: formatcity,
                        escapeMarkup: function (m) { return m; }
                    })
                    $(".BillDate").datepicker({
                        changeMonth: true,
                        changeYear: true,
                        format: "dd/mm//yyyy",
                        autoclose: true,
                    });
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'There Is No data in OP O/S Module',
                        buttons: false,
                        timer: 1000
                    })
                }
            }
        })
    }
}

$(document).on('click', '.addOpOSModule', function () {
    var values = $("input[name='OpOsArrNum']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    if (lstidx == null || lstidx == '' || isNaN(lstidx)) lstidx = 0;
    var counter = lstidx;
    $.ajax({
        type: 'GET',
        url: '/op_os_module/getBook',
        dataType: 'json',
        data: {
            id: 'cityid'
        },
        success: function (data) {
            if (data['success']) {
                var vouchMast = data['vouchMast'];
                var html = '';
                html += '<tr id="delOpOsArr' + counter + '">';
                html += '<td>';
                html += '<input type="hidden" name="opmoduleid[' + counter + ']" id="opmoduleid' + counter + '" value="">';
                html += '<input type="hidden" name="OpOsArrNum" id="OpOsArrNum' + counter + '" value="' + counter + '">';
                html += '<select name="OS_Type" id="OS_Type' + counter + '" style="width:100%;" class="form-control prbank select2Class productplace selectproductfocus" placeholder="Please Select">';
                html += '<option value=""></option>';
                html += '<option value="REF">REF</option>';
                html += '<option value="ONA">ONA</option>';
                html += '<option value="SB">SB</option>';
                html += '<option value="PB">PB</option>';
                html += '</select>';
                html += '</td>';

                html += '<td>';
                html += '<select name="OS_Book" id="OS_Book' + counter + '" style="width: 100%;" class="form-control prbank select2Class" placeholder="Please Select">';
                html += '<option value=""></option>';
                for (let i = 0; i < vouchMast.length; i++) {
                    html += '<option value="' + vouchMast[i].Vo_book + '">' + vouchMast[i].Vo_book + '</option>';
                }
                html += '<option value="REF">REF</option>';
                html += '<option value="ONA">ONA</option>';
                html += '</select>';
                html += '</td>';

                html += '<td>';
                html += '<input type="text" required name="vouc_code" id="vouc_code' + counter + '" placeholder="Voucher No" class="form-control number">';
                html += '</td>';

                html += '<td>';
                html += '<input type="text" name="Chr" id="Chr' + counter + '" placeholder="Chr" class="form-control">';
                html += '</td>';

                html += '<td>';
                html += '<input type="text" required name="date" class="form-control datemask BillDate" id="date' + counter + '" value="" placeholder="Date">';
                html += '</td>';

                html += '<td>';
                html += '<select name="broker_Code" id="broker_Code' + counter + '" required style="width: 100%;" class="form-control prbank broker_Code">';
                html += '<option value=""></option>';
                html += '</select>';
                html += '</td>';

                html += '<td>';
                html += '<input type="text" name="partyBillNo" class="form-control numerals" id="partyBillNo' + counter + '" placeholder="Party Bill No">';
                html += '</td>';

                html += '<td>';
                html += '<input type="text" name="partyBillDate" class="form-control datemask BillDate" id="partyBillDate' + counter + '" placeholder="Party Bill Date">';
                html += '</td>';

                html += '<td>';
                html += '<input type="number" name="Amount" class="form-control" id="Amount' + counter + '" placeholder="Amount" required>';
                html += '</td>';

                html += '<td>';
                html += '<select name="d_c" id="d_c' + counter + '" style="width: 100%;" class="form-control prbank select2Class" placeholder="Please Select">';
                html += '<option value=""></option>';
                html += '<option value="Debit">Debit</option>';
                html += '<option value="Credit">Credit</option>';
                html += '</select>';
                html += '</td>';

                html += '<td>';
                html += '<input type="text" name="discount" class="form-control" id="discount' + counter + '" placeholder="Discount %">';
                html += '</td>';

                html += '<td>';
                html += '<input type="text" name="cr_Days" class="form-control" id="cr_Days' + counter + '" placeholder="Cr Days">';
                html += '</td>';

                html += '<td>';
                html += '<input type="text" name="remarks" class="form-control amountfocus" id="remarks' + counter + '" placeholder="Remarks">';
                html += '</td>';

                html += "<td><a onclick='delOpOsArr(" + counter + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                html += '</tr>';

                $(html).insertBefore("#OpOsArrNum");
                $('.broker_Code').select2({
                    placeholder: 'Please select Broker',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Garu_Aavak_Entry/broker_Code',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    templateSelection: formatcity,
                    escapeMarkup: function (m) { return m; }
                })
                $(".BillDate").datepicker({
                    changeMonth: true,
                    changeYear: true,
                    format: "dd/mm//yyyy",
                    autoclose: true,
                });
                $(".select2Class").select2({
                    placeholder: "Please Select",
                    allowClear: true,
                });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()
            }
        }
    });
});

function delOpOsArr(idx) {
    var aa = confirm('Are yo sure to want to delete it');
    if (aa == true) {
        var id = $('#opmoduleid' + idx).val();
        $.ajax({
            type: 'GET',
            url: '/OP_OS_module/delete',
            dataType: 'json',
            data:
            {
                id: id,
            },
            success: function (response) {
                console.log(response);
                if (response['success'] == true) {
                    $('#delOpOsArr' + idx).remove();
                }
            }
        })
    }
}


// Gowdown Wise Opening Stock ######################################################################################################################################################
function getproductdesc() {
    var Godown = $('#Godown').val();
    var item_group = $('#item_group').val();
    var subquality = $('#subquality').val();

    $.ajax({
        type: 'GET',
        url: '/stock_opening_module_rm/rmproductdetails',
        dataType: 'json',
        data:
        {
            Godown: Godown,
            item_group: item_group,
            subquality: subquality,
        },
        success: function (response) {
            console.log(response);
            if (response['success'] == true) {
                $('.loader').show();
                $('.stockdescpritiondetail').show();
                $('#sevid').show();
                var prdtrm = response['prdtrm'];
                var Stock_Unit = response['Stock_Unit'];
                var MRN = response['MRN'];
                var html = '';
                for (p = 0; p < prdtrm.length; p++) {
                    var mrnid = '';
                    var soqty = '';
                    var so_rate = '';
                    var unit = '';
                    var minStkQty = '';
                    var reOrderQty = '';
                    var maxStkQty = '';
                    var masterPack = '';
                    var groupid = '';
                    if (MRN != undefined) {
                        for (let m = 0; m < MRN.length; m++) {
                            var mrngroup = MRN[m].garu_Aavak_Group;
                            for (g = 0; g < mrngroup.length; g++) {
                                if (mrngroup[g]['item_Code_Desc'] == prdtrm[p]['_id']) {
                                    mrnid = MRN[m]._id;
                                    soqty = mrngroup[g]['qntty'];
                                    so_rate = mrngroup[g]['rate'];
                                    unit = mrngroup[g]['unit'];
                                    minStkQty = mrngroup[g]['minStkQty'];
                                    reOrderQty = mrngroup[g]['reOrderQty'];
                                    maxStkQty = mrngroup[g]['maxStkQty'];
                                    masterPack = mrngroup[g]['masterPack'];
                                    groupid = mrngroup[g]['_id'];
                                }
                            }
                        }
                    }
                    if (mrnid == null || mrnid == '' || mrnid == undefined) mrnid = '';
                    if (soqty == null || soqty == '' || soqty == undefined) soqty = '';
                    if (so_rate == null || so_rate == '' || so_rate == undefined) so_rate = '';
                    if (unit == null || unit == '' || unit == undefined) unit = '';
                    if (minStkQty == null || minStkQty == '' || minStkQty == undefined) minStkQty = '';
                    if (reOrderQty == null || reOrderQty == '' || reOrderQty == undefined) reOrderQty = '';
                    if (maxStkQty == null || maxStkQty == '' || maxStkQty == undefined) maxStkQty = '';
                    if (masterPack == null || masterPack == '' || masterPack == undefined) masterPack = '';
                    if (groupid == null || groupid == '' || groupid == undefined) groupid = '';

                    html += '<tr id="prabal' + p + '">';
                    html += '<td>';
                    html += '<input type="hidden" name="stock_opening_module_group[' + p + '][groupid]" value="' + groupid + '">';
                    html += '<input type="hidden" name="stock_opening_module_group[' + p + '][mrn_id]" id="mrn_id' + p + '" value="' + mrnid + '">';
                    html += '<input type="hidden" name="cntrer" value="' + p + '" id="cntrer0">';
                    html += '<input class="form-control reminput selectproductfocus" value="' + prdtrm[p]['item_title'] + '" id="prdt_id' + p + '" placeholder="Product Desc" style="width: 377px;" type="text"/>';
                    html += '<input type="hidden" style="width: 232px;" value="' + prdtrm[p]['_id'] + '" name="stock_opening_module_group[' + p + '][item_Code_Desc]"/>';
                    html += '</td>';

                    html += '<td>';
                    html += '<input class="form-control" value="' + soqty + '" placeholder="Qty" name="stock_opening_module_group[' + p + '][qntty]" type="text"/>';
                    html += '</td>';

                    html += '<td>';
                    html += '<input class="form-control " value="' + so_rate + '" placeholder="Rate" name="stock_opening_module_group[' + p + '][rate]" type="text"/>';
                    html += '</td>';

                    html += '<td>';
                    html += '<select class="form-control unitselect2 prbank select2" name="stock_opening_module_group[' + p + '][unit]"  style="width: 120px;">';
                    html += '<option value=""></option>';
                    for (s = 0; s < Stock_Unit.length; s++) {
                        if (unit == Stock_Unit[s]['_id']) {
                            html += '<option value="' + Stock_Unit[s]['_id'] + '" selected>' + Stock_Unit[s]['SKUName'] + '</option>';
                        } else {
                            html += '<option value="' + Stock_Unit[s]['_id'] + '">' + Stock_Unit[s]['SKUName'] + '</option>';
                        }
                    }
                    html += '</select>';
                    html += '</td>';
                    html += '<td>';
                    html += '<input class="form-control " value="' + minStkQty + '" placeholder="Min Stk Qty" name="stock_opening_module_group[' + p + '][minStkQty]" type="text"/>';
                    html += '</td>';
                    html += '<td>';
                    html += '<input class="form-control " value="' + reOrderQty + '" placeholder="Re-Order Qty"  name="stock_opening_module_group[' + p + '][reOrderQty]" type="text"/>';
                    html += '</td>';
                    html += '<td>';
                    html += '<input class="form-control " value="' + maxStkQty + '" placeholder="Max Stk Qty" name="stock_opening_module_group[' + p + '][maxStkQty]" type="text"/>';
                    html += '</td>';
                    html += '<td>';
                    html += '<input class="form-control amountfocus" value="' + masterPack + '" placeholder="Master Pack"name="stock_opening_module_group[' + p + '][masterPack]" type="text"/>';
                    html += '</td>';
                    html += "<td><a onclick='remove_OpStockArr(" + p + ");' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                    html += '</tr>';
                }
                $(".stock_repeat_row tbody tr").not('tr#insert_product').remove();
                $('tr#insert_product').before(html);
                $(".unitselect2").select2({
                    placeholder: "Select Unit",
                    allowClear: true,
                });
                $('#prdt_id0').focus();
                // $('.adjustmentstable tr:nth-first-child(2)').find('.selectproductfocus').focus()
                $('.loader').hide();
            } else {
                swal({
                    title: 'Oops!',
                    text: 'No Pending Description',
                    buttons: false,
                    timer: 1500
                })
                $(".stock_repeat_row tbody tr").not('tr#insert_product').remove();
                $('tr#insert_product').before(html);
                $('.stockdescpritiondetail').hide();
                $('#sevid').hide();
            }
        }
    })

}
function remove_OpStockArr(idx) {
    var mrn_id = $('#mrn_id' + idx).val();
    if (mrn_id == null || mrn_id == undefined || mrn_id == '') {
        swal({
            title: 'Oops!',
            text: 'This Product opening stock Entry not exist',
            buttons: false,
            timer: 1500
        })
    } else {
        // var strconfirm = confirm("Are you sure want to delete?");
        swal({
            title: "Confirm",
            text: "Are you Sure you want to delete it?",
            icon: "warning",
            buttons: ["Cancel", "Confirm"],
            dangerMode: true
        }).then(function (isConfirm) {
            if (isConfirm) {
                $.ajax({
                    type: 'GET',
                    url: '/stock_opening_module_rm/delete',
                    dataType: 'json',
                    data:
                    {
                        mrn_id: mrn_id,
                    },
                    success: function (response) {
                        console.log(response);
                        if (response['success'] == true) {
                            location.reload();
                        }
                    }
                });
            }
        })

    }
}

function getBookNo() {
    var c_j_s_p = $("#c_j_s_p").val();
    var Module = $('#c_j_s_p').attr('data-Module');
    if (Module == 'Bill Collection' || Module == 'Cash/Bank') {
        $.ajax({
            type: 'GET',
            url: '/Bill_CollectionEntry/GetBook',
            dataType: 'json',
            data: {
                c_j_s_p: c_j_s_p,
                Module: Module,
            },
            success: function (data) {
                if (data['success']) {
                    // console.log(data);
                    $('#vouc_code').val(data.last);
                    $('#vouc_code_chaq').val(data.last);
                }
            }
        })
    } else {
        $.ajax({
            type: 'GET',
            url: '/Garu_Aavak_Entry/GetBook',
            dataType: 'json',
            data: {
                c_j_s_p: c_j_s_p,
                Module: Module,
            },
            success: function (data) {
                if (data['success']) {
                    $('#vouc_code').val(data.last);
                }
            }
        })
    }
}




// Party Wise Outstanding  #####################################################################################################################################################
$(document).on("click", "#ShowPartyWiseOutStanding", function (event) {
    event.preventDefault();
    var period = $('#dateID').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var buy_cus_name = $('#buy_cus_name').val();
    var Broker = $('#Broker').val();
    var Sale = $('#Sale').val();
    var Division = $('#Division').val();
    var DATE = $('input[name="DATE"]:checked').val();
    var SCREENING = $('input[name="SCREENING"]:checked').val();
    var SUBTOTAL = $('input[name="SUBTOTAL"]:checked').val();

    tot_debit = 0;
    tot_credit = 0;
    total_bal = 0;
    bal = 0;
    $('.loader').show();
    $.ajax({
        type: "POST",
        url: '/cash_ladger/ShowPartyWiseOutStanding',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            buy_cus_name: buy_cus_name,
            Broker: Broker,
            Sale: Sale,
            Division: Division,
            DATE: DATE,
            SCREENING: SCREENING,
        },
        success: function (data) {
            console.log(data);
            if (data['success'] == true) {
                var outstading = data['outstanding'];
                var outstand_opning = data['outstand_opning'];
                var divisionschema = data['divisionschema'];
                if (SCREENING == 'SCREEN') {

                    var htmlout = '<div class="showsearchdata">';
                    htmlout += '<div class="row">';
                    htmlout += '<div class="col-md-12">';
                    htmlout += '<div class="table-responsive">';
                    htmlout += '<table id="userTableOut" class="userTable table table-striped table-bordered table-hover adsearch">';
                    htmlout += '<thead>';
                    htmlout += '<tr>';
                    htmlout += '<th>Division</th>';
                    htmlout += '<th>Party</th>';
                    htmlout += '<th>Broker</th>';
                    htmlout += '<th>Sale Person</th>';
                    htmlout += '<th>Date</th>';
                    htmlout += '<th>Bill No</th>';
                    // htmlout+='<th>Broker</th>';
                    htmlout += '<th>Bill-Amt</th>';
                    htmlout += '<th>Recd-Amt</th>';
                    htmlout += '<th>Disc-Amt</th>';
                    htmlout += '<th>Days</th>';
                    htmlout += '<th>Balance</th>';
                    htmlout += '<th>Cumm-Balance</th>';
                    htmlout += '</tr>';
                    htmlout += '</thead>';
                    htmlout += '<tbody>';
                    var Comm_Balance = 0;
                    $.each(outstading, function (index, value) {
                        htmlout += "<tr>";
                        if (divisionschema._id.toString() == value.div_code.toString()) var divname = divisionschema.div_mast;
                        else var divname = '';
                        htmlout += "<td style='text-align: right'>" + divname + "</td>";
                        var city = '';
                        if (value.cashac_name.CityName == null || value.cashac_name.CityName == '' || value.cashac_name.CityName == undefined) city = '';
                        else city = value.cashac_name.CityName.CityName;
                        htmlout += "<td style='text-align: left'>" + value.cashac_name.ACName + ",\n" + city + "</td>";
                        var brname = '';
                        if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) brname = '';
                        else brname = value.broker_Code.ACName
                        htmlout += "<td style='text-align: left'>" + brname + "</td>";
                        if (value.sl_Person == null || value.sl_Person == '' || value.sl_Person == undefined) slname = '';
                        else slname = value.sl_Person.ACName
                        htmlout += "<td style='text-align: right'>" + slname + "</td>";
                        var data = moment(value.cash_date).format('DD/MM/YYYY');

                        var csh_dt = end_date;
                        var DateObject = moment(csh_dt, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                        var cashdat2 = moment(DateObject).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        var cashdat = moment(value.cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        var dat1 = new Date(cashdat.substr(6, 4), Number(cashdat.substr(3, 2)) - 1, cashdat.substr(0, 2), 0, 0, 0, 0);
                        var dat2 = new Date(cashdat2.substr(6, 4), Number(cashdat2.substr(3, 2)) - 1, cashdat2.substr(0, 2), 0, 0, 0, 0);// moment($('#offerstartdate').val(), "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                        var days = Math.floor((Date.UTC(dat2.getFullYear(), dat2.getMonth(), dat2.getDate()) - Date.UTC(dat1.getFullYear(), dat1.getMonth(), dat1.getDate())) / (1000 * 60 * 60 * 24));

                        htmlout += "<td style='text-align: center'>" + data + "</td>";
                        htmlout += "<td style='text-align: center'>" + value.main_bk + "/" + value.c_j_s_p + "/" + value.vouc_code + "</td>";
                        if (value.Bill_Amount == null || value.Bill_Amount == '' || value.Bill_Amount == undefined) value.Bill_Amount = 0;
                        htmlout += "<td style='text-align: left'>" + parseFloat(value.Bill_Amount).toFixed(2) + "</td>";
                        if (value.Rec_Amount == null || value.Rec_Amount == '' || value.Rec_Amount == undefined) value.Rec_Amount = 0;
                        htmlout += "<td style='text-align: right'>" + parseFloat(value.Rec_Amount).toFixed(2) + "</td>";
                        if (value.Add_Ded_Amt_Tot == null || value.Add_Ded_Amt_Tot == '' || value.Add_Ded_Amt_Tot == undefined) value.Add_Ded_Amt_Tot = 0;
                        htmlout += "<td style='text-align: right'>" + parseFloat(value.Add_Ded_Amt_Tot).toFixed(2) + "</td>";
                        htmlout += "<td style='text-align: right'>" + days + "</td>";
                        htmlout += "<td style='text-align: right'>" + value.outstanding_balance.toFixed(2) + "</td>";
                        // Comm_Balance = parseFloat(Comm_Balance)+parseFloat(value.outstanding_balance);
                        if (value.main_bk == 'OnAcc') {
                            Comm_Balance = parseFloat(Comm_Balance) - parseFloat(value.Rec_Amount);
                        }
                        else Comm_Balance = parseFloat(Comm_Balance) + parseFloat(value.outstanding_balance);
                        htmlout += "<td style='text-align: right'>" + Comm_Balance.toFixed(2) + "</td>";
                        htmlout += "</tr>"
                    });
                    htmlout += '</tbody>';
                    htmlout += '<tfoot>';
                    htmlout += '<tr>';
                    htmlout += '<th class="excludesearchout">Division</th>';
                    htmlout += '<th>Party</th>';
                    htmlout += '<th>Broker</th>';
                    htmlout += '<th>Sale Person</th>';
                    htmlout += '<th>Date</th>';
                    htmlout += '<th>Bill No</th>';
                    // htmlout+='<th>Broker</th>';
                    htmlout += '<th>Bill-Amt</th>';
                    htmlout += '<th>Recd-Amt</th>';
                    htmlout += '<th>Disc-Amt</th>';
                    htmlout += '<th>Days</th>';
                    htmlout += '<th>Balance</th>';
                    htmlout += '<th>Cumm-Balance</th>';
                    htmlout += '</tr>';
                    htmlout += '</tfoot>';
                    htmlout += '</table>';
                    $("#Outstanding").html(htmlout);
                    dattable = jQuery('.userTable').DataTable({
                        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                        "processing": false,
                        "serverSide": false,
                        "colReorder": true,
                        "autoWidth": false,
                        "ordering": false,
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "buttons": [
                            {
                                extend: 'excel',
                                className: 'btn-default btn-excel',
                                exportOptions: {
                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                            },
                            {
                                extend: 'pdf',
                                className: 'btn-default btn-pdf',
                                exportOptions: {

                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                                footer: true,
                                orientation: 'landscape',
                                customize: function (doc) {
                                    doc.content.splice(0, 0, {
                                        margin: [0, 0, 0, 12],
                                        alignment: 'center',
                                        text: 'Soft Sauda'
                                    });
                                },
                                messageBottom: 'Exported from Soft Sauda'
                            },
                            {
                                extend: 'print',
                                className: 'btn-default btn-print',
                                exportOptions: {
                                    modifier: {
                                        page: 'current'
                                    },
                                    columns: "thead th:not(.noExport)"
                                },
                            },
                        ],
                        "order": [1, 'asc'],
                        "columnDefs": [{
                            "className": "actioncell",
                            "orderable": false,
                            "searchable": false,
                            "sortable": false,
                            "targets": [0],
                            "width": "5%"
                        }],
                    })
                    $('#userTable tfoot th').not('.excludesearch').each(function () {
                        var title = $(this).text();
                        $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                        function resizeInput() {
                            var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                            var widthTester = $("<span>" + content + "</span>").hide();
                            widthTester.insertAfter($(this));
                            $(this).css("width", widthTester.width() + "px");
                            widthTester.remove();
                        }
                        $('.resizing-input').focusout(resizeInput).each(resizeInput);
                    });
                    $('#userTable tfoot').insertBefore('#userTable thead');
                    $('#userTableOut tfoot th').not('.excludesearchout').each(function () {
                        var title = $(this).text();
                        $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                        function resizeInput() {
                            var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                            var widthTester = $("<span>" + content + "</span>").hide();
                            widthTester.insertAfter($(this));
                            $(this).css("width", widthTester.width() + "px");
                            widthTester.remove();
                        }
                        $('.resizing-input').focusout(resizeInput).each(resizeInput);
                    });
                    $('#userTableOut tfoot').insertBefore('#userTableOut thead');
                    dattable.columns().every(function () {
                        var that = this;
                        $('input', this.footer()).on('keyup change clear', function () {
                            if (that.search() !== this.value) {
                                that
                                    .search(this.value)
                                    .draw();
                            }
                        });
                    });
                } else {
                    if (SCREENING == 'BROKER_WISE') {
                        // var htmlout = "rohit";
                        var html = '<div class="col-md-12 tableportletprint">';
                        html += '<div class="panel table light " id="tableportlet">';
                        html += '<div class="col-md-12">';
                        html += '<table>';
                        html += '<thead>';
                        html += '<tr>';

                        html += '<td style="font-size:20px;font-family: -webkit-body;border:none;padding: 1px;"><b style="float:left">' + divisionschema.div_mast + '</b></td>';
                        html += '</tr>';
                        html += '<tr>';
                        html += '<td style="font-size:15px;font-family: -webkit-body;text-align: center;border:none;padding: 1px;"><b style="float:left">' + divisionschema.ac_add2 + '</b></td>';
                        html += '</tr>';
                        html += '<tr>';
                        var filterstartdate = moment().tz("Asia/Kolkata").format('DD/MM/YYYY');
                        html += '<td style="font-size:15px;font-family: -webkit-body;text-align: center;border:none;padding: 1px;"><b style="float:left">Brokerwise Outstanding Sales Register Date : ' + end_date + '</b></td>';
                        html += '</tr><br/>';
                        html += '<tr>';

                        html += '<td style="font-size:15px;font-family: -webkit-body;text-align: center;border:none;padding: 1px;"><b style="float:left">Period : ' + start_date + ' - ' + end_date + ' Age as On : ' + end_date + '</b></td>';
                        html += '</tr>';
                        html += '</thead>';
                        html += '</table>';
                        html += '</div>';
                        html += '<div class="panel-body" id="portletbody">';

                        html += '<table border="1px solid" cellspacing="0" width="100%" style="font-family: -webkit-body;" id="outsatdingsummry">';
                        html += '<thead>';
                        html += '<tr>';
                        html += '<th width="20%">Name Of The Customer</th>';
                        html += '<th width="5%">Place</th>';
                        html += '<th width="5%">Bill No</th>';
                        html += '<th width="5%">BillDate</th>';
                        html += '<th width="5%">BalanceDue</th>';
                        html += '<th width="5%">Days</th>';
                        html += '<th width="5%">Broker Ac</th>';
                        html += '<th width="5%">Div Name</th>';
                        html += '</tr>';
                        html += '</thead>';
                        html += '<tbody>';
                        var outstanding_balance = 0;
                        $.each(outstading, function (index, value) {
                            outstanding_balance += parseFloat(value.outstanding_balance);
                            html += "<tr>";
                            html += '<td>' + value.cashac_name.ACName + '</td>';
                            if (value.cashac_name.CityName != null) var citynm = value.cashac_name.CityName.CityName;
                            else var citynm = '';
                            html += '<td>' + citynm + '</td>';
                            html += '<td>' + value.main_bk + "/" + value.c_j_s_p + "/" + value.vouc_code + '</td>';
                            var date = moment(value.cash_date).format('DD/MM/YYYY');
                            html += '<td>' + date + '</td>';
                            html += '<td class="numerals">' + parseFloat(value.outstanding_balance).toFixed(2) + '</td>';

                            var csh_dt = end_date;
                            var DateObject = moment(csh_dt, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                            var cashdat2 = moment(DateObject).tz("Asia/Kolkata").format('DD/MM/YYYY');
                            var cashdat = moment(value.cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                            var dat1 = new Date(cashdat.substr(6, 4), Number(cashdat.substr(3, 2)) - 1, cashdat.substr(0, 2), 0, 0, 0, 0);
                            var dat2 = new Date(cashdat2.substr(6, 4), Number(cashdat2.substr(3, 2)) - 1, cashdat2.substr(0, 2), 0, 0, 0, 0);// moment($('#offerstartdate').val(), "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                            var days = Math.floor((Date.UTC(dat2.getFullYear(), dat2.getMonth(), dat2.getDate()) - Date.UTC(dat1.getFullYear(), dat1.getMonth(), dat1.getDate())) / (1000 * 60 * 60 * 24));

                            html += '<td class="numerals">' + days + '</td>';
                            if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) brname = '';
                            else brname = value.broker_Code.ACName;
                            if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) var address = '';
                            else var address = value.broker_Code.Address1;
                            if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) var MobileNo = '';
                            else var MobileNo = value.broker_Code.MobileNo;
                            if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) var MobileNo = '';
                            else var code = value.broker_Code.ACCode;

                            console.log(address);
                            if (address == null || address == '' || address == undefined) address = '';
                            if (code == null || code == '' || code == undefined) code = '';
                            if (MobileNo == null || MobileNo == '' || MobileNo == undefined) MobileNo = '';
                            html += '<td style="text-transform: uppercase;" align="left"><div style="width:100%;text-align:left">Broker :&nbsp;&nbsp;' + code + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + brname + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + address + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + MobileNo + '</div></td>';
                            value.div_code
                            if (divisionschema._id.toString() == value.div_code.toString()) var divname = divisionschema.div_mast;
                            else var divname = '';
                            html += '<td style="text-transform: uppercase;" align="left"><div style="width:100%;text-align:left">Firm : ' + divname + '</div></td>';
                            html += "</tr>";
                        });
                        html += '</tbody>';
                        html += "<tr>";
                        html += '<th style="border-right:0px solid"></th>';
                        html += '<th colspan="3" style="border-left:0px solid;border-right:0px solid">Firm Ughrani Totals</th>';
                        html += "<td style='border-left:0px solid;border-right:0px solid' class='numerals'><b>" + parseFloat(outstanding_balance).toFixed(2) + "</b></td>";
                        html += '<th style="border-left:0px solid;"></th>';
                        html += "</tr>";
                        html += "<tr>";
                        html += '<th style="border-right:0px solid"></th>';
                        html += '<th colspan="3" style="border-left:0px solid;border-right:0px solid">Broker Ughrani Totals</th>';
                        html += "<td style='border-left:0px solid;border-right:0px solid' class='numerals'><b>" + parseFloat(outstanding_balance).toFixed(2) + "</b></td>";
                        html += '<th style="border-left:0px solid;"></th>';
                        html += "</tr>";
                        html += '</table>';
                        html += '<div class="col-md-12">';
                        html += '<a class="btn btn-default blue hidden-print margin-bottom-4" onclick="javascript:window.print();"> Print';
                        html += '<i class="fa fa-print"></i>';
                        html += '</a>';
                        html += '</div>';
                        html += '</div>';

                        html += '</div>';

                        html += '</div>';
                        $("#Outstanding").html(html);
                        $('#outsatdingsummry').DataTable({
                            "dom": "Bfrtip",
                            "ordering": false,
                            "paging": false,
                            "searching": false,
                            "info": false,
                            order: [[6, 'desc'], [7, 'desc']],
                            rowGroup: {
                                dataSrc: [6, 7]
                            },
                            "buttons": [
                                {
                                    extend: 'excel',
                                    className: 'btn-default btn-excel',
                                    exportOptions: {
                                        modifier: {
                                            page: 'current'
                                        },
                                        columns: "thead th:not(.noExport)"
                                    },
                                },
                                {
                                    extend: 'pdf',
                                    className: 'btn-default btn-pdf',
                                    exportOptions: {

                                        modifier: {
                                            page: 'current'
                                        },
                                        columns: "thead th:not(.noExport)"
                                    },
                                    footer: true,
                                    orientation: 'landscape',
                                    customize: function (doc) {
                                        doc.content.splice(0, 0, {
                                            margin: [0, 0, 0, 12],
                                            alignment: 'center',
                                            text: 'Soft Sauda'
                                        });
                                    },
                                    messageBottom: 'Exported from Soft Sauda'
                                },
                                {
                                    extend: 'print',
                                    className: 'btn-default btn-print',
                                    exportOptions: {
                                        modifier: {
                                            page: 'current'
                                        },
                                        columns: "thead th:not(.noExport)"
                                    },
                                },
                            ],
                            columnDefs: [{
                                targets: [6, 7],
                                visible: false
                            }]
                        });
                    } else {
                        if (SCREENING == 'SALES_MAN_WISE') {
                            var html = '<div class="col-md-12 tableportletprint">';
                            html += '<div class="panel table light " id="tableportlet">';
                            html += '<div class="col-md-12">';
                            html += '<table>';
                            html += '<thead>';
                            html += '<tr>';

                            html += '<td style="font-size:20px;font-family: -webkit-body;border:none;padding: 1px;"><b style="float:left">' + divisionschema.div_mast + '</b></td>';
                            html += '</tr>';
                            html += '<tr>';
                            html += '<td style="font-size:15px;font-family: -webkit-body;text-align: center;border:none;padding: 1px;"><b style="float:left">' + divisionschema.ac_add2 + '</b></td>';
                            html += '</tr>';
                            html += '<tr>';
                            var filterstartdate = moment().tz("Asia/Kolkata").format('DD/MM/YYYY');
                            html += '<td style="font-size:15px;font-family: -webkit-body;text-align: center;border:none;padding: 1px;"><b style="float:left">Brokerwise Outstanding Sales Register Date : ' + end_date + '</b></td>';
                            html += '</tr><br/>';
                            html += '<tr>';

                            html += '<td style="font-size:15px;font-family: -webkit-body;text-align: center;border:none;padding: 1px;"><b style="float:left">Period : ' + start_date + ' - ' + end_date + ' Age as On : ' + end_date + '</b></td>';
                            html += '</tr>';
                            html += '</thead>';
                            html += '</table>';
                            html += '</div>';
                            html += '<div class="panel-body" id="portletbody">';

                            html += '<table border="1px solid" cellspacing="0" width="100%" style="font-family: -webkit-body;" id="outsatdingsummrysales">';
                            html += '<thead>';
                            html += '<tr>';
                            html += '<th width="20%">Name Of The Customer</th>';
                            html += '<th width="5%">Place</th>';
                            html += '<th width="5%">Bill No</th>';
                            html += '<th width="5%">BillDate</th>';
                            html += '<th width="5%">BalanceDue</th>';
                            html += '<th width="5%">Days</th>';
                            html += '<th width="5%">Broker Ac</th>';
                            html += '<th width="5%">Div Name</th>';
                            html += '</tr>';
                            html += '</thead>';
                            html += '<tbody>';
                            var outstanding_balance = 0;
                            $.each(outstading, function (index, value) {
                                outstanding_balance += parseFloat(value.outstanding_balance);
                                html += "<tr>";
                                html += '<td>' + value.cashac_name.ACName + '</td>';
                                if (value.cashac_name.CityName != null) var citynm = value.cashac_name.CityName.CityName;
                                else var citynm = '';
                                html += '<td>' + citynm + '</td>';
                                html += '<td>' + value.main_bk + "/" + value.c_j_s_p + "/" + value.vouc_code + '</td>';
                                var date = moment(value.cash_date).format('DD/MM/YYYY');
                                html += '<td>' + date + '</td>';
                                html += '<td class="numerals">' + parseFloat(value.outstanding_balance).toFixed(2) + '</td>';

                                var csh_dt = end_date;
                                var DateObject = moment(csh_dt, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                                var cashdat2 = moment(DateObject).tz("Asia/Kolkata").format('DD/MM/YYYY');
                                var cashdat = moment(value.cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                                var dat1 = new Date(cashdat.substr(6, 4), Number(cashdat.substr(3, 2)) - 1, cashdat.substr(0, 2), 0, 0, 0, 0);
                                var dat2 = new Date(cashdat2.substr(6, 4), Number(cashdat2.substr(3, 2)) - 1, cashdat2.substr(0, 2), 0, 0, 0, 0);// moment($('#offerstartdate').val(), "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                                var days = Math.floor((Date.UTC(dat2.getFullYear(), dat2.getMonth(), dat2.getDate()) - Date.UTC(dat1.getFullYear(), dat1.getMonth(), dat1.getDate())) / (1000 * 60 * 60 * 24));

                                html += '<td class="numerals">' + days + '</td>';
                                if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) brcode = '';
                                else brcode = value.broker_Code.ACCode
                                html += '<td class="numerals">' + brcode + '</td>';
                                if (value.sl_Person == null || value.sl_Person == '' || value.sl_Person == undefined) slname = '';
                                else slname = value.sl_Person.ACName
                                if (value.sl_Person == null || value.sl_Person == '' || value.sl_Person == undefined) var address = '';
                                else var address = value.sl_Person.Address1;
                                if (value.sl_Person == null || value.sl_Person == '' || value.broker_Code == undefined) var MobileNo = '';
                                else var MobileNo = value.sl_Person.MobileNo;
                                if (value.sl_Person == null || value.sl_Person == '' || value.broker_Code == undefined) var MobileNo = '';
                                else var code = value.sl_Person.ACCode;

                                if (address == null || address == '' || address == undefined) address = '';
                                if (MobileNo == null || MobileNo == '' || MobileNo == undefined) MobileNo = '';
                                if (code == null || code == '' || code == undefined) code = '';

                                // console.log(address);
                                html += '<td style="text-transform: uppercase;"align="left"><div style="width:100%;text-align:left">S/Man : &nbsp;&nbsp;' + code + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + slname + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + address + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + MobileNo + '</div></td>';
                                value.div_code
                                // if(divisionschema._id.toString()==value.div_code.toString())var divname=divisionschema.div_mast;
                                // else var divname='';
                                // html+='<td style="text-transform: uppercase;">'+divname+'</td>';
                                html += "</tr>";
                            });
                            html += '</tbody>';
                            html += "<tr>";
                            html += '<th style="border-right:0px solid"></th>';
                            html += '<th colspan="3" style="border-left:0px solid;border-right:0px solid">Firm Ughrani Totals</th>';
                            html += "<td style='border-left:0px solid;border-right:0px solid' class='numerals'><b>" + parseFloat(outstanding_balance).toFixed(2) + "</b></td>";
                            html += '<th style="border-left:0px solid;border-right:0px solid"></th>';
                            html += '<th style="border-left:0px solid;"></th>';
                            html += "</tr>";
                            html += "<tr>";
                            html += '<th style="border-right:0px solid"></th>';
                            html += '<th colspan="3" style="border-left:0px solid;border-right:0px solid">Broker Ughrani Totals</th>';
                            html += "<td style='border-left:0px solid;border-right:0px solid' class='numerals'><b>" + parseFloat(outstanding_balance).toFixed(2) + "</b></td>";
                            html += '<th style="border-left:0px solid;border-right:0px solid"></th>';
                            html += '<th style="border-left:0px solid;"></th>';
                            html += "</tr>";
                            html += '</table>';
                            html += '<div class="col-md-12">';
                            html += '<a class="btn btn-default blue hidden-print margin-bottom-4" onclick="javascript:window.print();"> Print';
                            html += '<i class="fa fa-print"></i>';
                            html += '</a>';
                            html += '</div>';
                            html += '</div>';

                            html += '</div>';

                            html += '</div>';
                            $("#Outstanding").html(html);
                            $('#outsatdingsummrysales').DataTable({
                                "ordering": false,
                                "paging": false,
                                "searching": false,
                                "info": false,
                                order: [6, 'desc'],
                                rowGroup: {
                                    dataSrc: [7]
                                },
                                columnDefs: [{
                                    targets: [7],
                                    visible: false
                                }]
                            });
                        } else {
                            if (SCREENING == 'SUBTOTAL') {
                                var html = '<div class="col-md-12 tableportletprint" style="padding-top: 0%; margin-top: 0%">';
                                html += '<div class="panel table light " id="tableportlet">';
                                html += '<div class="col-md-12">';
                                html += '<table>';
                                // html+='<thead>';
                                // html+='<tr>';
                                // html+='<td style="font-size:20px;font-family: -webkit-body;border:none;padding: 1px;"><b style="float:left">'+divisionschema.div_mast+'</b></td>';
                                // html+='</tr>';
                                // html+='<tr>';
                                // html+='<td style="font-size:15px;font-family: -webkit-body;text-align: center;border:none;padding: 1px;"><b style="float:left">'+divisionschema.ac_add2+'</b></td>';
                                // html+='</tr>';
                                // html+='<tr>';
                                // var filterstartdate = moment().tz("Asia/Kolkata").format('DD/MM/YYYY');
                                // html+='<td style="font-size:15px;font-family: -webkit-body;text-align: center;border:none;padding: 1px;"><b style="float:left">Brokerwise Outstanding Sales Register Date : '+end_date+'</b></td>';
                                // html+='</tr><br/>';
                                // html+='<tr>';
                                // html+='<td style="font-size:15px;font-family: -webkit-body;text-align: center;border:none;padding: 1px;"><b style="float:left">Period : '+start_date+' - ' +end_date+' Age as On : '+end_date+'</b></td>';
                                // html+='</tr>';
                                // html+='</thead>';
                                html += '</table>';
                                html += '</div>';
                                html += '<div class="panel-body" id="portletbody">';
                                html += '<table border="1px solid" cellspacing="0" width="100%" style="font-family: -webkit-body;" id="outsatdingsummrsub">';
                                html += '<thead>';
                                html += '<tr>';
                                html += '<th width="20%"style="border-bottom:none;border-right:none;border-top:none"></th>';
                                html += '<th width="5%" style="border-bottom:none;border-right:none;border-left:none;border-top:none"></th>';
                                html += '<th width="5%" style="border-bottom:none;border-right:none;border-left:none;border-top:none"></th>';
                                html += '<th width="5%" style="border-bottom:none;border-right:none;border-left:none;border-top:none"></th>';
                                html += '<th width="5%" style="border-bottom:none;border-right:none;border-left:none;border-top:none"></th>';
                                html += '<th width="5%" style="border-bottom:none;border-left:none;border-top:none"></th>';
                                html += '<th width="5%" style="border-bottom:none"></th>';
                                html += '</tr>';
                                html += '</thead>';
                                html += '<tbody>';
                                // var outstanding_balance = 0;
                                $.each(outstading, function (index, value) {
                                    outstanding_balance += parseFloat(value.outstanding_balance);
                                    html += "<tr>";
                                    html += '<td style="padding:1px;font-size:12px">' + value.cashac_name.ACName + '</td>';
                                    if (value.cashac_name.CityName != null) var citynm = value.cashac_name.CityName.CityName;
                                    else var citynm = '';
                                    html += '<td>' + citynm + '</td>';
                                    html += '<td>' + value.main_bk + "/" + value.c_j_s_p + "/" + value.vouc_code + '</td>';
                                    var date = moment(value.cash_date).format('DD/MM/YYYY');
                                    html += '<td>' + date + '</td>';
                                    html += '<td class="numerals">' + parseFloat(value.outstanding_balance).toFixed(2) + '</td>';

                                    var csh_dt = end_date;
                                    var DateObject = moment(csh_dt, "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                                    var cashdat2 = moment(DateObject).tz("Asia/Kolkata").format('DD/MM/YYYY');
                                    var cashdat = moment(value.cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                                    var dat1 = new Date(cashdat.substr(6, 4), Number(cashdat.substr(3, 2)) - 1, cashdat.substr(0, 2), 0, 0, 0, 0);
                                    var dat2 = new Date(cashdat2.substr(6, 4), Number(cashdat2.substr(3, 2)) - 1, cashdat2.substr(0, 2), 0, 0, 0, 0);// moment($('#offerstartdate').val(), "DD/MM/YYYY hh:mm a").tz("Asia/Kolkata");
                                    var days = Math.floor((Date.UTC(dat2.getFullYear(), dat2.getMonth(), dat2.getDate()) - Date.UTC(dat1.getFullYear(), dat1.getMonth(), dat1.getDate())) / (1000 * 60 * 60 * 24));

                                    html += '<td class="numerals">' + days + '</td>';
                                    if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) brname = '';
                                    else brname = value.broker_Code.ACName;
                                    if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) var address = '';
                                    else var address = value.broker_Code.Address1;
                                    if (value.broker_Code == null || value.broker_Code == '' || value.broker_Code == undefined) var MobileNo = '';
                                    else var MobileNo = value.broker_Code.MobileNo;
                                    // <span>'+address+'</span><span>'+MobileNo+'</span>
                                    html += '<td style="padding:1px;font-size:14px">' + brname + '_</td>';
                                    value.div_code
                                    if (divisionschema._id.toString() == value.div_code.toString()) var divname = divisionschema.div_mast;
                                    else var divname = '';
                                    // html+='<td style="text-transform: uppercase;">'+divname+'</td>';
                                    html += "</tr>";
                                });
                                html += '</tbody>';
                                // html+="<tr>";
                                // html+='<th style="border-right:0px solid"></th>'; 
                                // html+='<th colspan="3" style="border-left:0px solid;border-right:0px solid">Firm Ughrani Totals</th>';
                                // html+="<td style='border-left:0px solid;border-right:0px solid' class='numerals'><b>"+parseFloat(outstanding_balance).toFixed(2)+"</b></td>"; 
                                // html+='<th style="border-left:0px solid;"></th>'; 
                                // html+="</tr>";  
                                // html+="<tr>";
                                // html+='<th style="border-right:0px solid"></th>'; 
                                // html+='<th colspan="3" style="border-left:0px solid;border-right:0px solid">Broker Ughrani Totals</th>';
                                // html+="<td style='border-left:0px solid;border-right:0px solid' class='numerals'><b>"+parseFloat(outstanding_balance).toFixed(2)+"</b></td>"; 
                                // html+='<th style="border-left:0px solid;"></th>'; 
                                // html+="</tr>";     
                                html += '</table>';
                                html += '<div class="col-md-12">';
                                html += '<a class="btn btn-default blue hidden-print margin-bottom-4" onclick="javascript:window.print();"> Print';
                                html += '<i class="fa fa-print"></i>';
                                html += '</a>';
                                html += '</div>';
                                html += '</div>';
                                html += '</div>';
                                html += '</div>';
                                $("#Outstanding").html(html);
                                var table = $('#outsatdingsummrsub').DataTable({
                                    "searching": false,
                                    "paging": false,
                                    "info": false,
                                    "columnDefs": [
                                        { "visible": false, "targets": 6 }
                                    ],
                                    "order": [[6, 'asc']],
                                    "displayLength": 25,
                                    "drawCallback": function (settings) {
                                        var api = this.api();
                                        var rows = api.rows({ page: 'current' }).nodes();
                                        var last = null;
                                        var tot = 0;
                                        var intVal = function (i) {
                                            return typeof i === 'string' ?
                                                i.replace(/[\$,]/g, '') * 1 :
                                                typeof i === 'number' ?
                                                    i : 0;
                                        };
                                        total = [];
                                        api.column(6, { page: 'current' }).data().each(function (group, i) {
                                            group_assoc = group.replace(/ /g, '_');
                                            if (typeof total[group_assoc] != 'undefined') {
                                                total[group_assoc] = total[group_assoc] + intVal(api.column(4).data()[i]);
                                            } else {
                                                total[group_assoc] = intVal(api.column(4).data()[i]);
                                            }
                                            if (last !== group) {
                                                $(rows).eq(i).before(
                                                    '<tr class="group" style="text-transform: uppercase;"><td colspan="4" style="font-size:15px;border-right:none;border-top:none"></br></br>'
                                                    + '<b>' + divisionschema.div_mast + '</b></br>'
                                                    + '<b>' + divisionschema.ac_add2 + '</b></br>'
                                                    + 'Brokerwise Outstanding Sales Register Date : ' + end_date + '</br>'
                                                    + '<b style="font-size:20px;">Broker : ' + group + '</b></br>'
                                                    + 'Period : ' + start_date + ' - ' + end_date + ' Age as On : ' + end_date + '</td>'
                                                    + '<td colspan="2" style="border-left:none;border-top:none" valign="bottom" class="' + group_assoc + '"></td>'
                                                    + '</tr>'
                                                    + '<tr class="group" style="text-transform: uppercase;">'
                                                    + '<td style="font-size:15px">Name Of The Customer</td>'
                                                    + '<td style="text-align: right;font-size:15px" class="">Place</td>'
                                                    + '<td style="text-align: right;font-size:15px" class="">Bill No</td>'
                                                    + '<td style="text-align: right;font-size:15px" class="">Bill Date</td>'
                                                    + '<td style="text-align: right;font-size:15px" class="">Balance Due</td>'
                                                    + '<td style="text-align: right;font-size:15px" class="">Days</td>'
                                                    + '</tr>'
                                                );
                                                last = group;
                                            }
                                        });
                                        for (var key in total) {
                                            var totamt = total[key].toFixed(2)
                                            console.log(totamt);
                                            $("." + key).html("Firm Ughrani Totals: " + totamt);
                                        }
                                    }
                                });
                                // $('#outsatdingsummrsub').DataTable( {
                                //     "ordering": false,
                                //     "paging": false, 
                                //     "searching": false,
                                //     "info": false,
                                //     order: [[6, 'desc'], [7, 'desc']],
                                //     rowGroup: {
                                //         dataSrc: [ 6, 7 ]
                                //     },
                                //     columnDefs: [ {
                                //         targets: [ 6, 7 ],
                                //         visible: false
                                //     } ]
                                // } );
                            }
                        }
                    }
                }


                $('.loader').hide();
            }
        }
    });
});
function DatePeriod(type) {
    if (type == 'AS_ON') {
        $('#dateID').removeClass('contractrange');
        $('#dateID').addClass('BillDate');
    }
    if (type == 'PERIODIC') {
        $('#dateID').removeClass('BillDate');
        $('#dateID').addClass('contractrange');
    }
}
$(document).on("click", "#getselesentry", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var party_Code = $('#party_Code').val();
    var checkvaluname = $("#pending:checked").val();
    if (checkvaluname) {
        var pending = 'pending'
    }
    else {
        var pending = 'all'
    }
    // alert(pending);
    $('.loader').show();
    $.ajax({
        type: "POST",
        url: '/do_entry/getsalesentrylist',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            party_Code: party_Code,
            pending: pending,
        },
        success: function (data) {
            if (data['success'] == true) {
                var GaruAavak = data['GaruAavak'];
                var html = '<div class="row"><div class="col-md-12">';
                html += '<div class="panel panel-primary table light " id="tableportlet">';
                html += '<div class="panel-heading">';
                html += 'DO ENTRY';
                html += '</div>';
                html += '<div class="panel-body" id="portletbody">';
                html += '<table class="product_detail_table dttable table table-striped table-bordered table-hover" id="product_detail_table">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>Sno</th>';
                html += '<th>Idn No</th>';
                html += '<th>Date</th>';
                html += '<th width="5%">DO No</th>';
                html += '<th>DO Date</th>';
                html += '<th>Party Name</th>';
                html += '<th>Broker Name</th>';
                html += '<th>SL Person</th>';
                html += '<th>Item Details</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                var i = 0;
                $.each(GaruAavak, function (index, value) {
                    if (((pending == "pending" && (value.do_No == undefined || value.do_No == '' || value.do_No == null)) || (pending == "all"))) {
                        i++;
                        html += '<tr>';
                        html += '<td>' + i + '</td>';
                        html += '<td>' + value.vouc_code + '/' + value.c_j_s_p + '</td>';
                        var entry_Date = moment(value.entry_Date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        html += '<td>' + entry_Date + '</td>';
                        if (value.do_No != null) var do_No = value.do_No;
                        else var do_No = '';
                        html += '<td><input type="text" value="' + do_No + '" name="do_No" id="do_No" oninput=billnoupdate("' + value._id + '","' + i + '",this.value) class="form-control"><span style="display:none">' + do_No + '</span></td>';
                        var bill_Date = moment(value.do_Date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        html += '<td><input type="text" name="bill_Date" value="' + bill_Date + '" id="bill_Date' + i + '" onchange=dodatepdate("' + value._id + '","' + i + '",this.value) autocomplete="off" class="form-control datemask datepickerc"></td>';
                        if (value.party_Code != null) var party_code = value.party_Code.ACName;
                        else var party_code = '';
                        html += '<td>' + party_code + '</td>';
                        if (value.broker_Code != null) var broker_Code = value.broker_Code.ACName;
                        else var broker_Code = '';
                        html += '<td>' + broker_Code + '</td>';
                        if (value.sl_Person != null) var sl_Person = value.sl_Person.ACName;
                        else var sl_Person = '';
                        html += '<td>' + sl_Person + '</td>';
                        var Item_Detail = 0;
                        if (value.Item_Detail == null || value.Item_Detail == [] || value.Item_Detail == undefined) {
                            html += '<td></td>';
                        }
                        else {
                            html += '<td>';
                            for (let i = 0; i < value.Item_Detail.length; i++) {
                                html += '' + value.Item_Detail[i].Item + ',';
                            }
                            html += '</td>';
                        }
                        html += '</tr>';
                    }
                })
                html += '</tbody>';
                html += '<tfoot>';
                html += ' <tr>';
                html += '<th>Sno</th>';
                html += '<th>Idn No</th>';
                html += ' <th>Date</th>';
                html += '<th>Bill No</th>';
                html += '<th>Date</th>';
                html += ' <th>Party Name</th>';
                html += '<th>Broker Name</th>';
                html += '<th>SL Person</th>';
                html += '<th>Item Details</th>';
                html += '</tr>';
                html += '</tfoot>';
                html += '</table>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                $('.getsaleslist').html(html);
                $('.datepickerc').datepicker({ format: 'dd/mm/yyyy', autoclose: true })
                // $('.datemask').inputmask("99/99/9999");
                $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                    function resizeInput() {
                        var content =
                            $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }

                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });

                // moving tfoot below head th row
                $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
                table = jQuery('.product_detail_table').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "lengthChange": true,
                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                    "colReorder": true,
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel'
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print'
                        },
                    ],
                    "columnDefs": [
                        {
                            "className": "actioncell",
                            "orderable": false,
                            "searchable": false,
                            "sortable": false,
                            "targets": [0]
                        }
                    ],
                    "order": [1, 'asc'],
                    initComplete: function () {
                        var api = this.api();
                        api.columns().every(function () {
                            var that = this;

                            $('input', this.footer()).on('keyup change', function () {
                                if (that.search() !== this.value) {
                                    that
                                        .column($(this).parent().index() + ':visible')
                                        .search(this.value)
                                        .draw();
                                }
                            });
                        });
                    }
                });
                $('.loader').hide();
            }
        }
    });
});
function billnoupdate(id, srno, value) {
    $.ajax({
        type: "POST",
        url: '/do_entry/donumberupdate',
        dataType: 'json',
        data: {
            id: id,
            value: value,
        },
        success: function (data) {
            if (data['success'] == true) {
            }
        }
    })
}
function dodatepdate(id, srno) {
    var value = $("#bill_Date" + srno).val();
    $.ajax({
        type: "POST",
        url: '/do_entry/dodateupdate',
        dataType: 'json',
        data: {
            id: id,
            value: value,
        },
        success: function (data) {
            if (data['success'] == true) {
            }
        }
    })
}

// sales register
$(document).on("click", "#getselesregister", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var party_Code = $('#party_Code').val();
    var Broker = $('#Broker').val();
    var Sale = $('#Sale').val();
    var Division = $('#Division').val();
    var SCREENING = $('input[name="SCREENING"]:checked').val();
    // alert(SCREENING);
    $('.loader').show();
    $.ajax({
        type: "POST",
        url: '/sales_register/getsalesentrylist',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            party_Code: party_Code,
            Broker: Broker,
            Sale: Sale,
            Division: Division,
            SCREENING: SCREENING,
        },
        success: function (data) {
            if (data['success'] == true) {
                var GaruAavak = data['GaruAavak'];
                var dividmast = data['dividmast'];
                if (SCREENING == "AS_ON") {
                    var html = '<div class="row"><div class="col-md-12">';
                    html += '<div class="panel panel-primary table light " id="tableportlet">';
                    html += '<div class="panel-heading">';
                    html += 'DATE WISE';
                    html += '</div>';
                    html += '<div class="panel-body" id="portletbody">';
                    html += '<table class="product_detail_table dttable table table-striped table-bordered table-hover" id="product_detail_table">';
                    html += '<thead>';
                    html += '<tr>';
                    html += '<th>Sno</th>';
                    html += '<th>Entry No</th>';
                    html += '<th>Date</th>';
                    html += '<th width="5%">DO No</th>';
                    html += '<th>DO Date</th>';
                    html += '<th>Party Name</th>';
                    html += '<th>Station</th>';
                    html += '<th>Broker Name</th>';
                    html += '<th>SL Person</th>';
                    html += '<th>Amount</th>';
                    html += '</tr>';
                    html += '</thead>';
                    html += '<tbody>';
                    var i = 0;
                    var amount = 0;
                    $.each(GaruAavak, function (index, value) {
                        if (value.main_bk == "Sale") {
                            i++;
                            html += '<tr>';
                            html += '<td>' + i + '</td>';
                            html += '<td>' + value.vouc_code + '/' + value.c_j_s_p + '</td>';
                            var entry_Date = moment(value.entry_Date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                            html += '<td>' + entry_Date + '</td>';
                            if (value.do_No != null) var do_No = value.do_No;
                            else var do_No = '';
                            html += '<td>' + do_No + '</td>';
                            var do_Date = moment(value.do_Date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                            html += '<td>' + do_Date + '</td>';
                            if (value.party_Code != null) var party_code = value.party_Code.ACName;
                            else var party_code = '';
                            html += '<td>' + party_code + '</td>';
                            if (value.party_Code != null && value.party_Code.CityName != null) var partycityname = value.party_Code.CityName.CityName;
                            else var partycityname = '';
                            html += '<td>' + partycityname + '</td>';
                            if (value.broker_Code != null) var broker_Code = value.broker_Code.ACName;
                            else var broker_Code = '';
                            html += '<td>' + broker_Code + '</td>';
                            if (value.sl_Person != null) var sl_Person = value.sl_Person.ACName;
                            else var sl_Person = '';
                            html += '<td>' + sl_Person + '</td>';
                            if (value.gross_Amt != null) var gross_Amt = value.gross_Amt;
                            else var gross_Amt = '';
                            amount += parseFloat(value.gross_Amt)
                            html += '<td class="numerals">' + parseFloat(gross_Amt).toFixed(2) + '</td>';
                            html += '</tr>';
                        }
                    })
                    html += '</tbody>';
                    html += '<tr>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th>Total</th>';
                    html += '<th class="numerals">' + amount.toFixed(2) + '</th>';
                    html += '</tr>';
                    html += '<tfoot>';
                    html += ' <tr>';
                    html += '<th>Sno</th>';
                    html += '<th>Entry No</th>';
                    html += ' <th>Date</th>';
                    html += '<th>Bill No</th>';
                    html += '<th>Date</th>';
                    html += ' <th>Party Name</th>';
                    html += '<th>Station</th>';
                    html += '<th>Broker Name</th>';
                    html += '<th>SL Person</th>';
                    html += '<th>Amount</th>';
                    html += '</tr>';
                    html += '</tfoot>';
                    html += '</table>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                    $('.getsaleslist').html(html);
                    $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                        var title = $(this).text();
                        $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                        function resizeInput() {
                            var content =
                                $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
                            var widthTester = $("<span>" + content + "</span>").hide();
                            widthTester.insertAfter($(this));
                            $(this).css("width", widthTester.width() + "px");
                            widthTester.remove();
                        }

                        $('.resizing-input').focusout(resizeInput).each(resizeInput);
                    });
                    // moving tfoot below head th row
                    $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
                    table = jQuery('.product_detail_table').DataTable({
                        "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                        "lengthChange": true,
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "colReorder": true,
                        "buttons": [
                            {
                                extend: 'excel',
                                className: 'btn-default btn-excel',
                                footer: true,
                            },
                            {
                                extend: 'pdf',
                                className: 'btn-default btn-pdf',
                                footer: true,
                            },
                            {
                                extend: 'print',
                                className: 'btn-default btn-print',
                                footer: true,
                            },
                        ],
                        // "columnDefs": [
                        //     {
                        //         "className": "actioncell",
                        //         "orderable": false,
                        //         "searchable": false,
                        //         "sortable": false,
                        //         "targets": [0]
                        //     }
                        // ],
                        "order": [1, 'asc'],
                        initComplete: function () {
                            var api = this.api();
                            api.columns().every(function () {
                                var that = this;

                                $('input', this.footer()).on('keyup change', function () {
                                    if (that.search() !== this.value) {
                                        that
                                            .column($(this).parent().index() + ':visible')
                                            .search(this.value)
                                            .draw();
                                    }
                                });
                            });
                        }
                    });
                    $('.loader').hide();
                } else {
                    if (SCREENING == "ITEM_WISE") {
                        var html = '<div class="row"><div class="col-md-12">';
                        html += '<div class="panel panel-primary table light " id="tableportlet">';
                        html += '<div class="panel-heading">';
                        html += 'DETAILED';
                        html += '</div>';
                        html += '<div class="panel-body" id="portletbody">';
                        html += '<table class="product_detail_table dttable table table-striped table-bordered table-hover" id="product_detail_table">';
                        html += '<thead>';
                        html += '<tr>';
                        html += '<th>Name</th>';
                        html += '<th>Station</th>';
                        html += '<th>GSTIN</th>';
                        html += '<th>BillNo</th>';
                        html += '<th>BillDate</th>';
                        html += '<th>PlaceofSupply</th>';
                        html += '<th>HSNCode</th>';
                        html += '<th>Code</th>';
                        html += '<th>Item Title</th>';
                        html += '<th>Qty</th>';
                        html += '<th>Wght</th>';
                        html += '<th>Rate</th>';
                        html += '<th>ProductAmt</th>';
                        html += '<th>TaxOn</th>';
                        html += '<th>TaxRate</th>';
                        html += '<th>TaxAmount</th>';
                        html += '<th>TotalAmt</th>';
                        html += '<th>SGST</th>';
                        html += '<th>CGST</th>';
                        html += '<th>IGST</th>';
                        html += '<th>BillAmount</th>';
                        html += '</tr>';
                        html += '</thead>';
                        html += '<tbody>';
                        var i = 0;
                        var amountot = 0;
                        var netamountot = 0;
                        var qty = 0;
                        var wght = 0;
                        var taxontot = 0;
                        var taxamountot = 0;
                        var sgstamtot = 0;
                        var cgstamtot = 0;
                        var igstamtot = 0;
                        var taxratetot = 0;
                        var grossamtot = 0;
                        var indeid = GaruAavak[0]['gross_Amt'];
                        $.each(GaruAavak, function (indexval, value) {
                            if (value.main_bk == "Sale") {
                                var add_details = value.add_details;
                                var garu_Aavak_Group = value.garu_Aavak_Group;

                                if (value.gross_Amt != null) var gross_Amt = value.gross_Amt;
                                else var gross_Amt = 0;
                                grossamtot += parseFloat(gross_Amt);

                                $.each(garu_Aavak_Group, function (indexgrp, valuegrp) {
                                    if (value.party_Code != null) var party_code = value.party_Code.ACName;
                                    else var party_code = '';
                                    if (value.party_Code != null && value.party_Code.CityName != null) var partycityname = value.party_Code.CityName.CityName;
                                    else var partycityname = '';
                                    if (value.party_Code != null && value.party_Code.GSTIN != null) var gstin = value.party_Code.GSTIN;
                                    else var gstin = '';
                                    if (value.party_Code != null && value.party_Code.StateName != null) var partystatename = value.party_Code.StateName.StateName;
                                    else var partystatename = '';
                                    if (value.party_Code != null && value.party_Code.StateName != null && value.party_Code.StateName.StateCode != undefined) var StateCode = value.party_Code.StateName.StateCode;
                                    else var StateCode = '';
                                    if (value.party_Code != null && value.party_Code.StateName != null) var partystateid = value.party_Code.StateName._id;
                                    else var partystateid = '';
                                    ////multiple
                                    if (valuegrp.qntty != null) var qntty = valuegrp.qntty;
                                    else var qntty = 0;
                                    if (valuegrp.net_Wt != null) var net_Wt = valuegrp.net_Wt;
                                    else var net_Wt = 0;
                                    if (valuegrp.rate != null) var rate = valuegrp.rate;
                                    else var rate = 0;
                                    if (valuegrp.GST != null && valuegrp.GST != '') var GST = valuegrp.GST;
                                    else var GST = 0;
                                    if (valuegrp.amount != null) var amount = valuegrp.amount;
                                    else var amount = 0;
                                    if (valuegrp.net_Amount != null) var net_Amount = valuegrp.net_Amount;
                                    else var net_Amount = 0;
                                    if (valuegrp.Item_SGST != null) var SGSTot = valuegrp.Item_SGST;
                                    else var SGSTot = 0;
                                    if (valuegrp.Item_IGST != null) var IGSTot = valuegrp.Item_IGST;
                                    else var IGSTot = 0;
                                    if (valuegrp.Item_CGST != null) var ScGSTot = valuegrp.Item_CGST;
                                    else var ScGSTot = 0;
                                    if (indexval > 0) {
                                        if (value.gross_Amt != indeid) {

                                            var grossval = gross_Amt;
                                            net_Amount = net_Amount;
                                            SGSTot = SGSTot;
                                            IGSTot = IGSTot;
                                            ScGSTot = ScGSTot;
                                            var taxamount = parseFloat(SGSTot + ScGSTot + IGSTot);
                                            var taxon = parseFloat(net_Amount) - parseFloat(taxamount);
                                            sgstamtot += parseFloat(SGSTot);
                                            cgstamtot += parseFloat(ScGSTot);
                                            igstamtot += parseFloat(IGSTot);

                                            indeid = value.gross_Amt;
                                        } else {
                                            var grossval = 0;
                                            net_Amount = 0;
                                            SGSTot = 0;
                                            IGSTot = 0;
                                            ScGSTot = 0;
                                            var taxamount = parseFloat(0);
                                            var taxon = parseFloat(0) - parseFloat(0);
                                            sgstamtot += parseFloat(0);
                                            cgstamtot += parseFloat(0);
                                            igstamtot += parseFloat(0);
                                        }
                                    }
                                    else {
                                        if (indexgrp > 0) {
                                            var grossval = 0;
                                            var taxamount = 0;
                                            net_Amount = 0;
                                            SGSTot = 0;
                                            IGSTot = 0;
                                            ScGSTot = 0;
                                            var taxon = 0;
                                            sgstamtot += parseFloat(0);
                                            cgstamtot += parseFloat(0);
                                            igstamtot += parseFloat(0);
                                        }
                                        else {
                                            var grossval = gross_Amt;
                                            net_Amount = net_Amount;
                                            SGSTot = SGSTot;
                                            IGSTot = IGSTot;
                                            ScGSTot = ScGSTot;
                                            var taxamount = parseFloat(SGSTot + ScGSTot + IGSTot);
                                            var taxon = parseFloat(net_Amount) - parseFloat(taxamount);
                                            sgstamtot += parseFloat(SGSTot);
                                            cgstamtot += parseFloat(ScGSTot);
                                            igstamtot += parseFloat(IGSTot);
                                        }

                                    }
                                    // sgstamtot+= parseFloat(SGST);
                                    qty += parseFloat(qntty);
                                    wght += parseFloat(net_Wt);
                                    html += '<tr>';
                                    html += '<td nowrap="">' + party_code + '</td>';
                                    html += '<td nowrap="">' + partycityname + '</td>';
                                    html += '<td>' + gstin + '</td>';
                                    var do_Date = moment(value.do_Date).tz("Asia/Kolkata").format('DD-MM-YYYY');
                                    html += '<td>' + value.c_j_s_p + '/' + value.vouc_code + '</td>';
                                    html += '<td>' + do_Date + '</td>';
                                    html += '<td nowrap="">' + StateCode + ' ' + partystatename + '</td>';
                                    if (valuegrp.item_Code_Desc != null && valuegrp.item_Code_Desc.apmc_code != undefined) var hsncode = valuegrp.item_Code_Desc.apmc_code;
                                    else var hsncode = '';
                                    if (valuegrp.item_Code_Desc != null) var itemcode = valuegrp.item_Code_Desc.item_code;
                                    else var itemcode = '';
                                    if (valuegrp.item_Code_Desc != null) var itemtitle = valuegrp.item_Code_Desc.item_title;
                                    else var itemtitle = '';
                                    html += '<td>' + hsncode + '</td>';
                                    html += '<td nowrap="">' + itemcode + '</td>';
                                    html += '<td nowrap="">' + itemtitle + '</td>';
                                    html += '<td class="numerals">' + qntty + '</td>';
                                    html += '<td class="numerals">' + net_Wt + '</td>';
                                    html += '<td class="numerals">' + rate + '</td>';
                                    amountot += parseFloat(amount);
                                    html += '<td class="numerals">' + amount + '</td>';
                                    taxontot += parseFloat(taxon);
                                    html += '<td class="numerals">' + taxon.toFixed(2) + '</td>';
                                    taxratetot += parseFloat(GST);
                                    html += '<td class="numerals">' + GST + '</td>';
                                    taxamountot += parseFloat(taxamount);
                                    html += '<td class="numerals">' + taxamount.toFixed(2) + '</td>';
                                    netamountot += parseFloat(net_Amount);
                                    html += '<td class="numerals">' + net_Amount + '</td>';

                                    html += '<td class="numerals">' + SGSTot.toFixed(2) + '</td>';
                                    html += '<td class="numerals">' + ScGSTot.toFixed(2) + '</td>';
                                    html += '<td class="numerals">' + IGSTot.toFixed(2) + '</td>';

                                    html += '<td class="numerals">' + grossval + '</td>';
                                    html += '</tr>';
                                    i++;
                                })
                            }

                        })
                        html += '</tbody>';
                        html += '<tr>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th class="numerals">' + qty.toFixed(2) + '</th>';
                        html += '<th class="numerals">' + wght.toFixed(2) + '</th>';
                        html += '<th class="numerals"></th>';
                        html += '<th class="numerals">' + amountot.toFixed(2) + '</th>';
                        html += '<th class="numerals">' + taxontot.toFixed(2) + '</th>';
                        html += '<th class="numerals"></th>';
                        html += '<th class="numerals">' + taxamountot.toFixed(2) + '</th>';
                        html += '<th class="numerals">' + netamountot.toFixed(2) + '</th>';
                        html += '<th class="numerals">' + sgstamtot.toFixed(2) + '</th>';
                        html += '<th class="numerals">' + cgstamtot.toFixed(2) + '</th>';
                        html += '<th class="numerals">' + igstamtot.toFixed(2) + '</th>';
                        html += '<th class="numerals">' + grossamtot.toFixed(2) + '</th>';
                        html += '</tr>';
                        html += '</tr>';
                        html += '<tfoot>';
                        html += ' <tr>';
                        html += '<th>Name</th>';
                        html += '<th>Station</th>';
                        html += '<th>GSTIN</th>';
                        html += '<th>BillNo</th>';
                        html += '<th>BillDate</th>';
                        html += '<th>PlaceofSupply</th>';
                        html += '<th>HSNCode</th>';
                        html += '<th>Code</th>';
                        html += '<th>Item Title</th>';
                        html += '<th>Qty</th>';
                        html += '<th>Wght</th>';
                        html += '<th>Rate</th>';
                        html += '<th>ProductAmt</th>';
                        html += '<th>TaxOn</th>';
                        html += '<th>TaxRate</th>';
                        html += '<th>TaxAmount</th>';
                        html += '<th>TotalAmt</th>';
                        html += '<th>SGST</th>';
                        html += '<th>CGST</th>';
                        html += '<th>IGST</th>';
                        html += '<th>BillAmount</th>';
                        html += '</tr>';
                        html += '</tfoot>';
                        html += '</table>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        $('.getsaleslist').html(html);
                        $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                            var title = $(this).text();
                            $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                            function resizeInput() {
                                var content =
                                    $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
                                var widthTester = $("<span>" + content + "</span>").hide();
                                widthTester.insertAfter($(this));
                                $(this).css("width", widthTester.width() + "px");
                                widthTester.remove();
                            }

                            $('.resizing-input').focusout(resizeInput).each(resizeInput);
                        });
                        // moving tfoot below head th row
                        $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
                        table = jQuery('.product_detail_table').DataTable({
                            "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                            "lengthChange": true,
                            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                            "colReorder": true,
                            "buttons": [
                                {
                                    extend: 'excel',
                                    className: 'btn-default btn-excel',
                                    footer: true,
                                },
                                {
                                    extend: 'pdf',
                                    className: 'btn-default btn-pdf',
                                    footer: true,
                                },
                                {
                                    extend: 'print',
                                    className: 'btn-default btn-print',
                                    footer: true,
                                },
                            ],
                            "order": [1, 'asc'],
                            initComplete: function () {
                                var api = this.api();
                                api.columns().every(function () {
                                    var that = this;

                                    $('input', this.footer()).on('keyup change', function () {
                                        if (that.search() !== this.value) {
                                            that
                                                .column($(this).parent().index() + ':visible')
                                                .search(this.value)
                                                .draw();
                                        }
                                    });
                                });
                            }
                        });
                        $('.loader').hide();
                    } else {
                        if (SCREENING == "ITEM_SUMMARY") {
                            var html = '<div class="row"><div class="col-md-12">';
                            html += '<div class="panel panel-primary table light " id="tableportlet">';
                            html += '<div class="panel-heading">';
                            html += 'ITEM SUMMARY';
                            html += '</div>';
                            html += '<div class="panel-body" id="portletbody">';
                            html += '<table class="product_detail_table dttable table table-striped table-bordered table-hover" id="product_detail_table">';
                            html += '<thead>';
                            html += '<tr>';
                            html += '<th>Item Code</th>';
                            html += '<th>Qty</th>';
                            html += '<th>Pack</th>';
                            html += '<th>Wght</th>';
                            html += '<th>Amount</th>';
                            html += '</tr>';
                            html += '</thead>';
                            html += '<tbody>';
                            var itemarr = [];
                            $.each(GaruAavak, function (index, value) {
                                if (value.main_bk == "Sale") {
                                    var garu_Aavak_Group = value.garu_Aavak_Group;
                                    var fnd = false;
                                    // itemarr = [];
                                    $.each(garu_Aavak_Group, function (indexgrp, valuegrp) {
                                        if (valuegrp.qntty != null) var qnttys = valuegrp.qntty;
                                        else var qnttys = 0;
                                        if (valuegrp.net_Wt != null) var net_Wt = valuegrp.net_Wt;
                                        else var net_Wt = 0;
                                        if (valuegrp.pkng != null) var pkng = valuegrp.pkng;
                                        else var pkng = 0;
                                        if (valuegrp.net_Amount != null) var net_Amount = valuegrp.net_Amount;
                                        else var net_Amount = 0;
                                        if (valuegrp.item_Code_Desc != null) var item_Code_Desc = valuegrp.item_Code_Desc.item_code;
                                        else var item_Code_Desc = '';
                                        for (var k = 0, l = itemarr.length; k < l; k++) {
                                            if (itemarr[k]['itemcode'].toString() == item_Code_Desc.toString()) {
                                                itemarr[k]['qntty'] = itemarr[k]['qntty'] + parseFloat(qnttys);
                                                itemarr[k]['net_Wt'] = itemarr[k]['net_Wt'] + parseFloat(net_Wt);
                                                itemarr[k]['pkng'] = itemarr[k]['pkng'] + parseFloat(pkng);
                                                itemarr[k]['net_Amount'] = itemarr[k]['net_Amount'] + parseFloat(net_Amount);
                                                fnd = true;
                                            }
                                        }
                                        if (fnd == false) {
                                            var obj = {
                                                "itemcode": item_Code_Desc,
                                                "qntty": qnttys,
                                                "net_Wt": net_Wt,
                                                "pkng": pkng,
                                                "net_Amount": net_Amount,
                                            };
                                            itemarr.push(obj);
                                        }
                                    })
                                }
                            })
                            var qtytot = 0;
                            var pkngtot = 0;
                            var net_Wtot = 0;
                            var net_Amountot = 0;
                            for (var k = 0, l = itemarr.length; k < l; k++) {
                                qtytot += parseFloat(itemarr[k]['qntty']);
                                pkngtot += parseFloat(itemarr[k]['pkng']);
                                net_Wtot += parseFloat(itemarr[k]['net_Wt']);
                                net_Amountot += parseFloat(itemarr[k]['net_Amount']);
                                html += '<tr>';
                                html += '<td>' + itemarr[k]['itemcode'] + '</td>';
                                html += '<td class="numerals">' + parseFloat(itemarr[k]['qntty']).toFixed(2) + '</td>';
                                html += '<td class="numerals">' + parseFloat(itemarr[k]['pkng']).toFixed(2) + '</td>';
                                html += '<td class="numerals">' + parseFloat(itemarr[k]['net_Wt']).toFixed(2) + '</td>';
                                html += '<td class="numerals">' + parseFloat(itemarr[k]['net_Amount']).toFixed(2) + '</td>';
                                html += '</tr>';
                            }
                            html += '</tbody>';
                            html += '<tr>';
                            html += '<th></th>';
                            html += '<th class="numerals">' + parseFloat(qtytot).toFixed(2) + '</th>';
                            // '+parseFloat(pkngtot).toFixed(2)+'
                            html += '<th class="numerals"></th>';
                            html += '<th class="numerals">' + parseFloat(net_Wtot).toFixed(2) + '</th>';
                            html += '<th class="numerals">' + parseFloat(net_Amountot).toFixed(2) + '</th>';
                            html += '</tr>';
                            html += '<tfoot>';
                            html += ' <tr>';
                            html += '<th>Item Code</th>';
                            html += '<th>Qty</th>';
                            html += '<th>Pack</th>';
                            html += '<th>Wght</th>';
                            html += '<th>Amount</th>';
                            html += '</tr>';
                            html += '</tfoot>';
                            html += '</table>';
                            html += '</div>';
                            html += '</div>';
                            html += '</div>';
                            html += '</div>';
                            html += '</div>';
                            $('.getsaleslist').html(html);
                            $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                                var title = $(this).text();
                                $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                                function resizeInput() {
                                    var content =
                                        $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
                                    var widthTester = $("<span>" + content + "</span>").hide();
                                    widthTester.insertAfter($(this));
                                    $(this).css("width", widthTester.width() + "px");
                                    widthTester.remove();
                                }

                                $('.resizing-input').focusout(resizeInput).each(resizeInput);
                            });
                            // moving tfoot below head th row
                            $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
                            table = jQuery('.product_detail_table').DataTable({
                                "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                                "lengthChange": true,
                                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                                "colReorder": true,
                                "buttons": [
                                    {
                                        extend: 'excel',
                                        className: 'btn-default btn-excel',
                                        footer: true,
                                    },
                                    {
                                        extend: 'pdf',
                                        className: 'btn-default btn-pdf',
                                        footer: true,
                                    },
                                    {
                                        extend: 'print',
                                        className: 'btn-default btn-print',
                                        footer: true,
                                    },
                                ],
                                // "columnDefs": [
                                //     {
                                //         "className": "actioncell",
                                //         "orderable": false,
                                //         "searchable": false,
                                //         "sortable": false,
                                //         "targets": [0]
                                //     }
                                // ],
                                "order": [1, 'asc'],
                                initComplete: function () {
                                    var api = this.api();
                                    api.columns().every(function () {
                                        var that = this;

                                        $('input', this.footer()).on('keyup change', function () {
                                            if (that.search() !== this.value) {
                                                that
                                                    .column($(this).parent().index() + ':visible')
                                                    .search(this.value)
                                                    .draw();
                                            }
                                        });
                                    });
                                }
                            });
                            $('.loader').hide();
                        } else {
                            if (SCREENING == "HSN_OUT") {
                                var html = '<div class="row"><div class="col-md-12">';
                                html += '<div class="panel panel-primary table light " id="tableportlet">';
                                html += '<div class="panel-heading">';
                                html += 'HSN OUT';
                                html += '</div>';
                                html += '<div class="panel-body" id="portletbody">';
                                html += '<table class="product_detail_table dttable table table-striped table-bordered table-hover" id="product_detail_table">';
                                html += '<thead>';
                                html += '<tr>';
                                html += '<th>NO</th>';
                                html += '<th>NATURE</th>';
                                html += '<th>HSNCODE</th>';
                                html += '<th>DESCRIPT</th>';
                                html += '<th>UQC</th>';
                                html += '<th>BAGS</th>';
                                html += '<th>NETWEIGHT</th>';
                                html += '<th>BILLAMOUNT</th>';
                                html += '<th>TAXABLE</th>';
                                html += '<th>IGST</th>';
                                html += '<th>CGST</th>';
                                html += '<th>SGST</th>';
                                html += '</tr>';
                                html += '</thead>';
                                html += '<tbody>';
                                var itemarr = [];
                                var indeid = GaruAavak[0]['gross_Amt'];
                                $.each(GaruAavak, function (indexval, value) {
                                    if (value.main_bk == "Sale") {
                                        var add_details = value.add_details;
                                        var garu_Aavak_Group = value.garu_Aavak_Group;
                                        if (value.party_Code != null) var party_code = value.party_Code.ACName;
                                        else var party_code = '';
                                        if (value.party_Code != null && value.party_Code.StateName != null) var partystateid = value.party_Code.StateName._id;
                                        else var partystateid = '';
                                        if (value.gross_Amt != null) var gross_Amt = value.gross_Amt;
                                        else var gross_Amt = 0;
                                        var main_bk = value.main_bk;
                                        var fnd = false;
                                        $.each(garu_Aavak_Group, function (indexgrp, valuegrp) {
                                            if (indexval > 0) {
                                                if (value.gross_Amt != indeid) {
                                                    var grossval = gross_Amt;
                                                    indeid = value.gross_Amt;
                                                } else {
                                                    var grossval = 0;
                                                }
                                            }
                                            else {
                                                if (indexgrp > 0) {
                                                    var grossval = 0;
                                                }
                                                else {
                                                    var grossval = gross_Amt;
                                                }
                                            }
                                            if (valuegrp.qntty != null) var qntty = valuegrp.qntty;
                                            else var qntty = 0;
                                            if (valuegrp.net_Wt != null) var net_Wt = valuegrp.net_Wt;
                                            else var net_Wt = 0;
                                            if (valuegrp.pkng != null) var pkng = valuegrp.pkng;
                                            else var pkng = 0;
                                            if (valuegrp.net_Amount != null) var net_Amount = valuegrp.net_Amount;
                                            else var net_Amount = 0;
                                            if (valuegrp.item_Code_Desc != null) var item_Code_Desc = valuegrp.item_Code_Desc.item_code;
                                            else var item_Code_Desc = '';
                                            if (valuegrp.item_Code_Desc != null && valuegrp.item_Code_Desc.apmc_code != undefined) var hsncode = valuegrp.item_Code_Desc.apmc_code;
                                            else var hsncode = '';
                                            if (valuegrp.item_Code_Desc != null && valuegrp.item_Code_Desc.unit_nm != null) var unit = valuegrp.item_Code_Desc.unit_nm.SKUName;
                                            else var unit = '';
                                            if (valuegrp.Item_SGST != null) var SGSTot = valuegrp.Item_SGST;
                                            else var SGSTot = 0;
                                            if (valuegrp.Item_IGST != null) var IGSTot = valuegrp.Item_IGST;
                                            else var IGSTot = 0;
                                            if (valuegrp.Item_CGST != null) var ScGSTot = valuegrp.Item_CGST;
                                            else var ScGSTot = 0;
                                            for (var k = 0, l = itemarr.length; k < l; k++) {
                                                if (itemarr[k]['itemcode'].toString() == item_Code_Desc.toString()) {
                                                    itemarr[k]['qntty'] = itemarr[k]['qntty'] + parseFloat(qntty);
                                                    itemarr[k]['net_Wt'] = itemarr[k]['net_Wt'] + parseFloat(net_Wt);
                                                    itemarr[k]['pkng'] = itemarr[k]['pkng'] + parseFloat(pkng);
                                                    itemarr[k]['net_Amount'] = itemarr[k]['net_Amount'] + parseFloat(net_Amount);
                                                    itemarr[k]['SGSTot'] = itemarr[k]['SGSTot'] + parseFloat(SGSTot);
                                                    itemarr[k]['IGSTot'] = itemarr[k]['IGSTot'] + parseFloat(IGSTot);
                                                    itemarr[k]['ScGSTot'] = itemarr[k]['ScGSTot'] + parseFloat(ScGSTot);
                                                    fnd = true;
                                                }
                                            }
                                            if (fnd == false) {
                                                var obj = {
                                                    "itemcode": item_Code_Desc,
                                                    "hsncode": hsncode,
                                                    "partystateid": partystateid,
                                                    "gross_Amt": grossval,
                                                    "qntty": qntty,
                                                    "net_Wt": net_Wt,
                                                    "pkng": pkng,
                                                    "net_Amount": net_Amount,
                                                    "main_bk": main_bk,
                                                    "unit": unit,
                                                    "SGSTot": SGSTot,
                                                    "IGSTot": IGSTot,
                                                    "ScGSTot": ScGSTot,
                                                };
                                                itemarr.push(obj);
                                            }
                                        })
                                    }
                                })
                                var qtytot = 0;
                                var net_Wtot = 0;
                                var net_Amountot = 0;
                                var billamtot = 0;
                                var indexing = 0;
                                var sgstamtot = 0;
                                var cgstamtot = 0;
                                var igstamtot = 0;
                                // console.log(itemarr)
                                for (var k = 0, l = itemarr.length; k < l; k++) {
                                    indexing++;
                                    var SGSTot = itemarr[k]['SGSTot'];
                                    var ScGSTot = itemarr[k]['ScGSTot'];
                                    var IGSTot = itemarr[k]['IGSTot'];
                                    html += '<tr>';
                                    html += '<td>' + indexing + '</td>';
                                    if (itemarr[k]['main_bk'] == "Sale") {
                                        var mainbk = "Sales"
                                    } else {
                                        if (itemarr[k]['main_bk'] == "GAE") {
                                            var mainbk = "Purchases"
                                        } else {
                                            var mainbk = itemarr[k]['main_bk'];
                                        }
                                    }
                                    html += '<td>' + mainbk + '</td>';
                                    html += '<td>' + itemarr[k]['hsncode'] + '</td>';
                                    html += '<td>' + itemarr[k]['itemcode'] + '</td>';
                                    html += '<td>' + itemarr[k]['unit'] + '</td>';
                                    qtytot += parseFloat(itemarr[k]['qntty']);
                                    html += '<td class="numerals">' + itemarr[k]['qntty'] + '</td>';
                                    net_Wtot += parseFloat(itemarr[k]['net_Wt']);
                                    html += '<td class="numerals">' + itemarr[k]['net_Wt'] + '</td>';
                                    var taxamount = parseFloat(SGSTot + ScGSTot + IGSTot);
                                    sgstamtot += parseFloat(SGSTot);
                                    cgstamtot += parseFloat(ScGSTot);
                                    igstamtot += parseFloat(IGSTot);
                                    billamtot += parseFloat(itemarr[k]['gross_Amt']);
                                    html += '<td class="numerals">' + parseFloat(itemarr[k]['gross_Amt']).toFixed(2) + '</td>';
                                    net_Amountot += parseFloat(taxamount);
                                    html += '<td class="numerals">' + parseFloat(taxamount).toFixed(2) + '</td>';
                                    html += '<td class="numerals">' + parseFloat(IGSTot).toFixed(2) + '</td>';
                                    html += '<td class="numerals">' + parseFloat(ScGSTot).toFixed(2) + '</td>';
                                    html += '<td class="numerals">' + parseFloat(SGSTot).toFixed(2) + '</td>';
                                    html += '</tr>';
                                }
                                html += '</tbody>';
                                html += '<tr>';
                                html += '<th></th>';
                                html += '<th></th>';
                                html += '<th></th>';
                                html += '<th></th>';
                                html += '<th></th>';
                                html += '<th class="numerals">' + parseFloat(qtytot).toFixed(2) + '</th>';
                                html += '<th class="numerals">' + parseFloat(net_Wtot).toFixed(2) + '</th>';
                                html += '<th class="numerals">' + parseFloat(billamtot).toFixed(2) + '</th>';
                                html += '<th class="numerals">' + parseFloat(net_Amountot).toFixed(2) + '</th>';
                                html += '<th class="numerals">' + parseFloat(igstamtot).toFixed(2) + '</th>';
                                html += '<th class="numerals">' + parseFloat(cgstamtot).toFixed(2) + '</th>';
                                html += '<th class="numerals">' + parseFloat(sgstamtot).toFixed(2) + '</th>';
                                html += '</tr>';
                                html += '<tfoot>';
                                html += '<tr>';
                                html += '<th>NO</th>';
                                html += '<th>NATURE</th>';
                                html += '<th>HSNCODE</th>';
                                html += '<th>DESCRIPT</th>';
                                html += '<th>UQC</th>';
                                html += '<th>BAGS</th>';
                                html += '<th>NETWEIGHT</th>';
                                html += '<th>BILLAMOUNT</th>';
                                html += '<th>TAXABLE</th>';
                                html += '<th>IGST</th>';
                                html += '<th>CGST</th>';
                                html += '<th>SGST</th>';
                                html += '</tr>';
                                html += '</tfoot>';
                                html += '</table>';
                                html += '</div>';
                                html += '</div>';
                                html += '</div>';
                                html += '</div>';
                                html += '</div>';
                                $('.getsaleslist').html(html);
                                $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                                    var title = $(this).text();
                                    $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                                    function resizeInput() {
                                        var content =
                                            $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
                                        var widthTester = $("<span>" + content + "</span>").hide();
                                        widthTester.insertAfter($(this));
                                        $(this).css("width", widthTester.width() + "px");
                                        widthTester.remove();
                                    }

                                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                                });
                                // moving tfoot below head th row
                                $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
                                table = jQuery('.product_detail_table').DataTable({
                                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                                    "lengthChange": true,
                                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                                    "colReorder": true,
                                    "buttons": [
                                        {
                                            extend: 'excel',
                                            className: 'btn-default btn-excel',
                                            footer: true,
                                        },
                                        {
                                            extend: 'pdf',
                                            className: 'btn-default btn-pdf',
                                            footer: true,
                                        },
                                        {
                                            extend: 'print',
                                            className: 'btn-default btn-print',
                                            footer: true,
                                        },
                                    ],
                                    // "columnDefs": [
                                    //     {
                                    //         "className": "actioncell",
                                    //         "orderable": false,
                                    //         "searchable": false,
                                    //         "sortable": false,
                                    //         "targets": [0]
                                    //     }
                                    // ],
                                    "order": [1, 'asc'],
                                    initComplete: function () {
                                        var api = this.api();
                                        api.columns().every(function () {
                                            var that = this;

                                            $('input', this.footer()).on('keyup change', function () {
                                                if (that.search() !== this.value) {
                                                    that
                                                        .column($(this).parent().index() + ':visible')
                                                        .search(this.value)
                                                        .draw();
                                                }
                                            });
                                        });
                                    }
                                });
                                $('.loader').hide();
                            } else {
                                if (SCREENING == "TAXABLE") {
                                    var html = '<div class="row"><div class="col-md-12">';
                                    html += '<div class="panel panel-primary table light " style="border-color: white;" id="tableportlet">';
                                    html += '<div class="panel-heading hidden-print">';
                                    html += 'TAXABLE';
                                    html += '</div>';
                                    html += '<div class="panel-body" id="portletbody">';
                                    html += '<table class="product_detail_table dttable table table-bordered" id="product_detail_table">';
                                    html += '<thead>';
                                    html += '<tr>';
                                    html += '<th>NATURE</th>';
                                    html += '<th>TAXABLE</th>';
                                    html += '<th>CGST</th>';
                                    html += '<th>SGST</th>';
                                    html += '<th>IGST</th>';
                                    html += '<th>GSTAMT</th>';
                                    html += '<th>NONTAXABLE</th>';
                                    html += '<th>BILLAMOUNT</th>';
                                    html += '</tr>';
                                    html += '</thead>';
                                    html += '<tbody>';
                                    var rdarr = [];
                                    var urdrdarr = [];
                                    var salreturdrdarr = [];
                                    var salretrdarr = [];
                                    var salintrestrdarr = [];
                                    var salintresturdrdarr = [];
                                    var receiptsrd = [];
                                    var receiptsurd = [];
                                    var indeid = GaruAavak[0]['gross_Amt'];
                                    $.each(GaruAavak, function (indexval, value) {
                                        var add_details = value.add_details;
                                        var garu_Aavak_Group = value.garu_Aavak_Group;
                                        if (value.party_Code != null && value.party_Code.GSTIN != '' && value.party_Code.GSTIN != undefined) var gstin = value.party_Code.GSTIN;
                                        else var gstin = '';
                                        if (value.gross_Amt != null) var gross_Amt = value.gross_Amt;
                                        else var gross_Amt = 0;
                                        $.each(garu_Aavak_Group, function (indexgrp, valuegrp) {
                                            if (value.party_Code != null) var party_code = value.party_Code.ACName;
                                            else var party_code = '';
                                            if (value.party_Code != null && value.party_Code.StateName != null) var partystateid = value.party_Code.StateName._id;
                                            else var partystateid = '';
                                            ////multiple
                                            if (valuegrp.GST != null && valuegrp.GST != '') var GST = valuegrp.GST;
                                            else var GST = 0;
                                            if (valuegrp.net_Amount != null) var net_Amount = valuegrp.net_Amount;
                                            else var net_Amount = 0;
                                            if (valuegrp.Item_SGST != null) var SGSTot = valuegrp.Item_SGST;
                                            else var SGSTot = 0;
                                            if (valuegrp.Item_IGST != null) var IGSTot = valuegrp.Item_IGST;
                                            else var IGSTot = 0;
                                            if (valuegrp.Item_CGST != null) var ScGSTot = valuegrp.Item_CGST;
                                            else var ScGSTot = 0;
                                            var taxamount = parseFloat(SGSTot + ScGSTot + IGSTot);
                                            if (indexval > 0) {
                                                if (value.gross_Amt != indeid) {
                                                    var grossval = gross_Amt;
                                                    indeid = value.gross_Amt;
                                                } else {
                                                    var grossval = 0;
                                                }
                                            }
                                            else {
                                                if (indexgrp > 0) {
                                                    var grossval = 0;
                                                }
                                                else {
                                                    var grossval = gross_Amt;
                                                }

                                            }
                                            if (value.main_bk == "Sale") {
                                                if (gstin == '' || gstin == null || gstin == undefined) {
                                                    var obj = {
                                                        "net_Amount": net_Amount,
                                                        "CGST": ScGSTot,
                                                        "SGST": SGSTot,
                                                        "IGST": IGSTot,
                                                        "taxamount": taxamount,
                                                        "NONTAXABLE": 0.00,
                                                        "billamt": grossval,
                                                    };
                                                    urdrdarr.push(obj);
                                                } else {
                                                    var obj = {
                                                        "net_Amount": net_Amount,
                                                        "CGST": ScGSTot,
                                                        "SGST": SGSTot,
                                                        "IGST": IGSTot,
                                                        "taxamount": taxamount,
                                                        "NONTAXABLE": 0.00,
                                                        "billamt": grossval,
                                                    };
                                                    rdarr.push(obj);
                                                }
                                            } else {
                                                if (value.main_bk == "Salereturn") {
                                                    if (gstin == '' || gstin == null || gstin == undefined) {
                                                        var obj = {
                                                            "net_Amount": net_Amount,
                                                            "CGST": ScGSTot,
                                                            "SGST": SGSTot,
                                                            "IGST": IGSTot,
                                                            "taxamount": taxamount,
                                                            "NONTAXABLE": 0.00,
                                                            "billamt": grossval,
                                                        };
                                                        salreturdrdarr.push(obj);
                                                    } else {
                                                        var obj = {
                                                            "net_Amount": net_Amount,
                                                            "CGST": ScGSTot,
                                                            "SGST": SGSTot,
                                                            "IGST": IGSTot,
                                                            "taxamount": taxamount,
                                                            "NONTAXABLE": 0.00,
                                                            "billamt": grossval,
                                                        };
                                                        salretrdarr.push(obj);
                                                    }
                                                } else {
                                                    if (value.main_bk == "saleinterst") {
                                                        if (gstin == '' || gstin == null || gstin == undefined) {
                                                            var obj = {
                                                                "net_Amount": net_Amount,
                                                                "CGST": ScGSTot,
                                                                "SGST": SGSTot,
                                                                "IGST": IGSTot,
                                                                "taxamount": taxamount,
                                                                "NONTAXABLE": 0.00,
                                                                "billamt": grossval,
                                                            };
                                                            salintresturdrdarr.push(obj);
                                                        } else {
                                                            var obj = {
                                                                "net_Amount": net_Amount,
                                                                "CGST": ScGSTot,
                                                                "SGST": SGSTot,
                                                                "IGST": IGSTot,
                                                                "taxamount": taxamount,
                                                                "NONTAXABLE": 0.00,
                                                                "billamt": grossval,
                                                            };
                                                            salintrestrdarr.push(obj);
                                                        }
                                                    } else {

                                                        if (value.main_bk == "receipts") {
                                                            if (gstin == '' || gstin == null || gstin == undefined) {
                                                                var obj = {
                                                                    "net_Amount": net_Amount,
                                                                    "CGST": ScGSTot,
                                                                    "SGST": SGSTot,
                                                                    "IGST": IGSTot,
                                                                    "taxamount": taxamount,
                                                                    "NONTAXABLE": 0.00,
                                                                    "billamt": grossval,
                                                                };
                                                                receiptsurd.push(obj);
                                                            } else {
                                                                var obj = {
                                                                    "net_Amount": net_Amount,
                                                                    "CGST": ScGSTot,
                                                                    "SGST": SGSTot,
                                                                    "IGST": IGSTot,
                                                                    "taxamount": taxamount,
                                                                    "NONTAXABLE": 0.00,
                                                                    "billamt": grossval,
                                                                };
                                                                receiptsrd.push(obj);
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        });
                                    });
                                    ////urd
                                    var netamturd = 0;
                                    var CGSTurd = 0;
                                    var SGSTurd = 0;
                                    var igsturd = 0;
                                    var taxamturd = 0;
                                    var nontaxamturd = 0;
                                    var billamturd = 0;
                                    for (var k = 0, l = urdrdarr.length; k < l; k++) {
                                        netamturd += parseFloat(urdrdarr[k]['net_Amount']);
                                        CGSTurd += parseFloat(urdrdarr[k]['CGST']);
                                        SGSTurd += parseFloat(urdrdarr[k]['SGST']);
                                        igsturd += parseFloat(urdrdarr[k]['IGST']);
                                        taxamturd += parseFloat(urdrdarr[k]['taxamount']);
                                        nontaxamturd += parseFloat(urdrdarr[k]['NONTAXABLE']);
                                        billamturd += parseFloat(urdrdarr[k]['billamt']);
                                    }
                                    ////end urd
                                    ////rd
                                    var netamtrd = 0;
                                    var CGSTrd = 0;
                                    var SGSTrd = 0;
                                    var igstrd = 0;
                                    var taxamtrd = 0;
                                    var nontaxamtrd = 0;
                                    var billamtrd = 0;
                                    for (var k = 0, l = rdarr.length; k < l; k++) {
                                        netamtrd += parseFloat(rdarr[k]['net_Amount']);
                                        CGSTrd += parseFloat(rdarr[k]['CGST']);
                                        SGSTrd += parseFloat(rdarr[k]['SGST']);
                                        igstrd += parseFloat(rdarr[k]['IGST']);
                                        taxamtrd += parseFloat(rdarr[k]['taxamount']);
                                        nontaxamtrd += parseFloat(rdarr[k]['NONTAXABLE']);
                                        billamtrd += parseFloat(rdarr[k]['billamt']);
                                    }
                                    ////end rd
                                    ///sales return urd 
                                    var saleretnetamturd = 0;
                                    var saleretCGSTurd = 0;
                                    var saleretSGSTurd = 0;
                                    var saleretigsturd = 0;
                                    var salerettaxamturd = 0;
                                    var saleretnontaxamturd = 0;
                                    var saleretbillamturd = 0;
                                    for (var k = 0, l = salreturdrdarr.length; k < l; k++) {
                                        saleretnetamturd += parseFloat(salreturdrdarr[k]['net_Amount']);
                                        saleretCGSTurd += parseFloat(salreturdrdarr[k]['CGST']);
                                        saleretSGSTurd += parseFloat(salreturdrdarr[k]['SGST']);
                                        saleretigsturd += parseFloat(salreturdrdarr[k]['IGST']);
                                        salerettaxamturd += parseFloat(salreturdrdarr[k]['taxamount']);
                                        saleretnontaxamturd += parseFloat(salreturdrdarr[k]['NONTAXABLE']);
                                        saleretbillamturd += parseFloat(salreturdrdarr[k]['billamt']);
                                    }
                                    ////end  sales return urd

                                    ///sales return rd 
                                    var saleretnetamtrd = 0;
                                    var saleretCGSTrd = 0;
                                    var saleretSGSTrd = 0;
                                    var saleretigstrd = 0;
                                    var salerettaxamtrd = 0;
                                    var saleretnontaxamtrd = 0;
                                    var saleretbillamtrd = 0;
                                    for (var k = 0, l = salretrdarr.length; k < l; k++) {
                                        saleretnetamtrd += parseFloat(salretrdarr[k]['net_Amount']);
                                        saleretCGSTrd += parseFloat(salretrdarr[k]['CGST']);
                                        saleretSGSTrd += parseFloat(salretrdarr[k]['SGST']);
                                        saleretigstrd += parseFloat(salretrdarr[k]['IGST']);
                                        salerettaxamtrd += parseFloat(salretrdarr[k]['taxamount']);
                                        saleretnontaxamtrd += parseFloat(salretrdarr[k]['NONTAXABLE']);
                                        saleretbillamtrd += parseFloat(salretrdarr[k]['billamt']);
                                    }
                                    ////end  sales return rd 
                                    ////sale interest urd
                                    var salintrestnetamturd = 0;
                                    var salintrestCGSTurd = 0;
                                    var salintrestSGSTurd = 0;
                                    var salintrestigsturd = 0;
                                    var salintresttaxamturd = 0;
                                    var salintrestnontaxamturd = 0;
                                    var salintrestbillamturd = 0;
                                    for (var k = 0, l = salintresturdrdarr.length; k < l; k++) {
                                        salintrestnetamturd += parseFloat(salintresturdrdarr[k]['net_Amount']);
                                        salintrestCGSTurd += parseFloat(salintresturdrdarr[k]['CGST']);
                                        salintrestSGSTurd += parseFloat(salintresturdrdarr[k]['SGST']);
                                        salintrestigsturd += parseFloat(salintresturdrdarr[k]['IGST']);
                                        salintresttaxamturd += parseFloat(salintresturdrdarr[k]['taxamount']);
                                        salintrestnontaxamturd += parseFloat(salintresturdrdarr[k]['NONTAXABLE']);
                                        salintrestbillamturd += parseFloat(salintresturdrdarr[k]['billamt']);
                                    }
                                    ///end sale interest urd
                                    //// sale interest rd
                                    var salintrestnetamtrd = 0;
                                    var salintrestCGSTrd = 0;
                                    var salintrestSGSTrd = 0;
                                    var salintrestigstrd = 0;
                                    var salintresttaxamtrd = 0;
                                    var salintrestnontaxamtrd = 0;
                                    var salintrestbillamtrd = 0;
                                    for (var k = 0, l = salintrestrdarr.length; k < l; k++) {
                                        salintrestnetamtrd += parseFloat(salintrestrdarr[k]['net_Amount']);
                                        salintrestCGSTrd += parseFloat(salintrestrdarr[k]['CGST']);
                                        salintrestSGSTrd += parseFloat(salintrestrdarr[k]['SGST']);
                                        salintrestigstrd += parseFloat(salintrestrdarr[k]['IGST']);
                                        salintresttaxamtrd += parseFloat(salintrestrdarr[k]['taxamount']);
                                        salintrestnontaxamtrd += parseFloat(salintrestrdarr[k]['NONTAXABLE']);
                                        salintrestbillamtrd += parseFloat(salintrestrdarr[k]['billamt']);
                                    }
                                    ////end sale interest rd\

                                    // Receipts urd
                                    var receiptsnetamturd = 0;
                                    var receiptsCGSTurd = 0;
                                    var receiptsSGSTurd = 0;
                                    var receiptsigsturd = 0;
                                    var receiptstaxamturd = 0;
                                    var receiptsnontaxamturd = 0;
                                    var receiptsbillamturd = 0;
                                    for (var k = 0, l = receiptsurd.length; k < l; k++) {
                                        receiptsnetamturd += parseFloat(receiptsurd[k]['net_Amount']);
                                        receiptsCGSTurd += parseFloat(receiptsurd[k]['CGST']);
                                        receiptsSGSTurd += parseFloat(receiptsurd[k]['SGST']);
                                        receiptsigsturd += parseFloat(receiptsurd[k]['IGST']);
                                        receiptstaxamturd += parseFloat(receiptsurd[k]['taxamount']);
                                        receiptsnontaxamturd += parseFloat(receiptsurd[k]['NONTAXABLE']);
                                        receiptsbillamturd += parseFloat(receiptsurd[k]['billamt']);
                                    }
                                    ///end Receipts urd
                                    // Receipts rd
                                    var receiptsnetamtrd = 0;
                                    var receiptsCGSTrd = 0;
                                    var receiptsSGSTrd = 0;
                                    var receiptsigstrd = 0;
                                    var receiptstaxamtrd = 0;
                                    var receiptsnontaxamtrd = 0;
                                    var receiptsbillamtrd = 0;
                                    for (var k = 0, l = receiptsrd.length; k < l; k++) {
                                        receiptsnetamtrd += parseFloat(receiptsrd[k]['net_Amount']);
                                        receiptsCGSTrd += parseFloat(receiptsrd[k]['CGST']);
                                        receiptsSGSTrd += parseFloat(receiptsrd[k]['SGST']);
                                        receiptsigstrd += parseFloat(receiptsrd[k]['IGST']);
                                        receiptstaxamtrd += parseFloat(receiptsrd[k]['taxamount']);
                                        receiptsnontaxamtrd += parseFloat(receiptsrd[k]['NONTAXABLE']);
                                        receiptsbillamtrd += parseFloat(receiptsrd[k]['billamt']);
                                    }
                                    //end Receipts rd

                                    html += '<tr>';
                                    html += '<td style="color: blue;">Taxable Supplies</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td style="color: blue;">*** Supplies to URD ***</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT

                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>Sales</td>';
                                    html += '<td class="numerals">' + parseFloat(netamturd).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(CGSTurd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(SGSTurd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(igsturd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(taxamturd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(nontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(billamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>Other Receipts</td>';
                                    html += '<td class="numerals">' + parseFloat(receiptsnetamturd).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(receiptsCGSTurd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(receiptsSGSTurd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(receiptsigsturd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(receiptstaxamturd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(receiptsnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(receiptsbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>-------------------------</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    var grossurdtaxablamt = parseFloat(netamturd) + parseFloat(receiptsnetamturd);
                                    var grossurdCGSTurd = parseFloat(CGSTurd) + parseFloat(receiptsCGSTurd);
                                    var grossurdSGSTurd = parseFloat(SGSTurd) + parseFloat(receiptsSGSTurd);
                                    var grossurdigsturd = parseFloat(igsturd) + parseFloat(receiptsigsturd);
                                    var grossurdtaxamturd = parseFloat(taxamturd) + parseFloat(receiptstaxamturd);
                                    var grossurdnontaxamturd = parseFloat(nontaxamturd) + parseFloat(receiptsnontaxamturd);
                                    var grossurdbillamturd = parseFloat(billamturd) + parseFloat(receiptsbillamturd);
                                    html += '<td>Gross Supplies</td>';
                                    html += '<td class="numerals">' + parseFloat(grossurdtaxablamt).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(grossurdCGSTurd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(grossurdSGSTurd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(grossurdigsturd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(grossurdtaxamturd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(grossurdnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(grossurdbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>Sales Return (CRN)</td>';
                                    html += '<td class="numerals">' + parseFloat(saleretnetamturd).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(saleretCGSTurd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(saleretSGSTurd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(saleretigsturd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(salerettaxamturd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(saleretnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(saleretbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>Interest (DRN)</td>';
                                    html += '<td class="numerals">' + parseFloat(salintrestnetamturd).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(salintrestCGSTurd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(salintrestSGSTurd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(salintrestigsturd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(salintresttaxamturd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(salintrestnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(salintrestbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>-------------------------</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '</tr>';
                                    var netsupliesnetamturd = parseFloat(grossurdtaxablamt) - parseFloat(saleretnetamturd) + parseFloat(salintrestnetamturd)
                                    var netsupliescgsturd = parseFloat(grossurdCGSTurd) - parseFloat(saleretCGSTurd) + parseFloat(salintrestCGSTurd)
                                    var netsupliessgsturd = parseFloat(grossurdSGSTurd) - parseFloat(saleretSGSTurd) + parseFloat(salintrestSGSTurd)
                                    var netsupliesigsturd = parseFloat(grossurdigsturd) - parseFloat(saleretigsturd) + parseFloat(salintresttaxamturd)
                                    var netsupliesgstamturd = parseFloat(grossurdtaxamturd) - parseFloat(salerettaxamturd) + parseFloat(salintresttaxamturd)
                                    var netsupliesnontaxamturd = parseFloat(grossurdnontaxamturd) - parseFloat(saleretnontaxamturd) + parseFloat(salintrestnontaxamturd)
                                    var netsupliesbillamturd = parseFloat(grossurdbillamturd) - parseFloat(saleretbillamturd) + parseFloat(salintrestbillamturd)
                                    html += '<tr>';
                                    html += '<td style="color: blue;">Net Supplies</td>';
                                    html += '<td class="numerals">' + parseFloat(netsupliesnetamturd).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(netsupliescgsturd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(netsupliessgsturd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(netsupliesigsturd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(netsupliesgstamturd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(netsupliesnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(netsupliesbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>=========================</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '<tr>';
                                    html += '<td style="color: blue;">*** Supplies to RD ***</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>Sales</td>';
                                    html += '<td class="numerals">' + parseFloat(netamtrd).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(CGSTrd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(SGSTrd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(igstrd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(taxamtrd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(nontaxamtrd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(billamtrd).toFixed(2) + '</td>';//BILLAMOUN
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>Other Receipts</td>';
                                    html += '<td class="numerals">' + parseFloat(receiptsnetamtrd).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(receiptsCGSTrd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(receiptsSGSTrd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(receiptsigstrd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(receiptstaxamtrd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(receiptsnontaxamtrd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(receiptsbillamtrd).toFixed(2) + '</td>';//BILLAMOUN
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>-------------------------</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '</tr>';
                                    var grossrdnettaxblamt = parseFloat(netamtrd) + parseFloat(receiptsnetamtrd);
                                    var grossrdcgstamt = parseFloat(CGSTrd) + parseFloat(receiptsCGSTrd);
                                    var grossrdsgstamt = parseFloat(SGSTrd) + parseFloat(receiptsSGSTrd);
                                    var grossrdigstamt = parseFloat(igstrd) + parseFloat(receiptsigstrd);
                                    var grossrdtaxgstamt = parseFloat(taxamtrd) + parseFloat(receiptstaxamtrd);
                                    var grossrdnontaxamt = parseFloat(nontaxamtrd) + parseFloat(receiptsnontaxamtrd);
                                    var grossrdbllamt = parseFloat(billamtrd) + parseFloat(receiptsbillamtrd);
                                    html += '<tr>';
                                    html += '<td style="color: blue;">Gross Supplies</td>';
                                    html += '<td class="numerals">' + parseFloat(grossrdnettaxblamt).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(grossrdcgstamt).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(grossrdsgstamt).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(grossrdigstamt).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(grossrdtaxgstamt).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(grossrdnontaxamt).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(grossrdbllamt).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>Sales Return (CRN)</td>';
                                    html += '<td class="numerals">' + parseFloat(saleretnetamtrd).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(saleretCGSTrd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(saleretSGSTrd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(saleretigstrd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(salerettaxamtrd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(saleretnontaxamtrd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(saleretbillamtrd).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>Interest (DRN)</td>';
                                    html += '<td class="numerals">' + parseFloat(salintrestnetamtrd).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(salintrestCGSTrd).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(salintrestSGSTrd).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(salintrestigstrd).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(salintresttaxamtrd).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(salintrestnontaxamtrd).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(salintrestbillamtrd).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>-------------------------</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '</tr>';
                                    var netsuppliesrdtaxamt = parseFloat(grossrdnettaxblamt) - parseFloat(saleretnetamtrd) + parseFloat(salintrestnetamtrd);
                                    var netsuppliesrdCGSTamt = parseFloat(grossrdcgstamt) - parseFloat(saleretCGSTrd) + parseFloat(salintrestCGSTrd);
                                    var netsuppliesrdSGSTamt = parseFloat(grossrdsgstamt) - parseFloat(saleretSGSTrd) + parseFloat(salintrestSGSTrd);
                                    var netsuppliesrdIGSTamt = parseFloat(grossrdigstamt) - parseFloat(saleretigstrd) + parseFloat(salintrestigstrd);
                                    var netsuppliesrdGSTAMTamt = parseFloat(grossrdtaxgstamt) - parseFloat(salerettaxamtrd) + parseFloat(salintresttaxamtrd);
                                    var netsuppliesrdNONTAXABLEamt = parseFloat(grossrdnontaxamt) - parseFloat(saleretnontaxamtrd) + parseFloat(salintrestnontaxamtrd);
                                    var netsuppliesrdBILLAMOUNTamt = parseFloat(grossrdbllamt) - parseFloat(saleretbillamtrd) + parseFloat(salintrestbillamtrd);
                                    html += '<tr>';
                                    html += '<td style="color: blue;">Net Supplies</td>';
                                    html += '<td class="numerals">' + parseFloat(netsuppliesrdtaxamt).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(netsuppliesrdCGSTamt).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(netsuppliesrdSGSTamt).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(netsuppliesrdIGSTamt).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(netsuppliesrdGSTAMTamt).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(netsuppliesrdNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(netsuppliesrdBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>=========================</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td style="color: blue;">*** Total Supplies ***</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    var totsupplieselstaxamt = parseFloat(grossurdtaxablamt) + parseFloat(grossrdnettaxblamt);
                                    var totsupplieselsCGSTamt = parseFloat(grossurdCGSTurd) + parseFloat(grossrdcgstamt);
                                    var totsupplieselsSGSTamt = parseFloat(grossurdSGSTurd) + parseFloat(grossrdsgstamt);
                                    var totsupplieselsIGSTamt = parseFloat(grossurdigsturd) + parseFloat(grossrdigstamt);
                                    var totsupplieselsGSTAMTamt = parseFloat(grossurdtaxamturd) + parseFloat(grossrdtaxgstamt);
                                    var totsupplieselsNONTAXABLEamt = parseFloat(grossurdnontaxamturd) + parseFloat(grossrdnontaxamt);
                                    var totsupplieselsBILLAMOUNTamt = parseFloat(grossurdbillamturd) + parseFloat(grossrdbllamt);
                                    html += '<td>Sales</td>';
                                    html += '<td class="numerals">' + parseFloat(totsupplieselstaxamt).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(totsupplieselsCGSTamt).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(totsupplieselsSGSTamt).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(totsupplieselsIGSTamt).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(totsupplieselsGSTAMTamt).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(totsupplieselsNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(totsupplieselsBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    var othtottaxblamt = parseFloat(receiptsnetamturd) + parseFloat(receiptsnetamtrd);
                                    var othtotCGSTamt = parseFloat(receiptsCGSTurd) + parseFloat(receiptsCGSTrd);
                                    var othtotSGSTamt = parseFloat(receiptsSGSTurd) + parseFloat(receiptsSGSTrd);
                                    var othtotIGSTamt = parseFloat(receiptsigsturd) + parseFloat(receiptsigstrd);
                                    var othtotGSTAMTamt = parseFloat(receiptstaxamturd) + parseFloat(receiptstaxamtrd);
                                    var othtotNONTAXABLEamt = parseFloat(receiptsnontaxamturd) + parseFloat(receiptsnontaxamtrd);
                                    var othtotBILLAMOUNTamt = parseFloat(receiptsbillamturd) + parseFloat(receiptsbillamtrd);
                                    html += '<td>Other Receipts</td>';
                                    html += '<td class="numerals">' + parseFloat(othtottaxblamt).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(othtotCGSTamt).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(othtotSGSTamt).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(othtotIGSTamt).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(othtotGSTAMTamt).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(othtotNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(othtotBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    html += '<td>-------------------------</td>';
                                    html += '<td class="numerals"></td>';//TAXABLE
                                    html += '<td class="numerals"></td>';//CGST
                                    html += '<td class="numerals"></td>';//SGST
                                    html += '<td class="numerals"></td>';//IGST
                                    html += '<td class="numerals"></td>';//GSTAMT
                                    html += '<td class="numerals"></td>';//NONTAXABLE
                                    html += '<td class="numerals"></td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    var totgrossnettaxamt = parseFloat(grossurdtaxablamt) + parseFloat(grossrdnettaxblamt);
                                    var totgrossCGSTamt = parseFloat(grossurdCGSTurd) + parseFloat(grossrdcgstamt);
                                    var totgrossSGSTamt = parseFloat(grossurdSGSTurd) + parseFloat(grossrdsgstamt);
                                    var totgrossIGSTamt = parseFloat(grossurdigsturd) + parseFloat(grossrdigstamt);
                                    var totgrossGSTAMTamt = parseFloat(grossurdtaxamturd) + parseFloat(grossrdtaxgstamt);
                                    var totgrossNONTAXABLEamt = parseFloat(grossurdnontaxamturd) + parseFloat(grossrdnontaxamt);
                                    var totgrossBILLAMOUNTamt = parseFloat(grossurdbillamturd) + parseFloat(grossrdbllamt);
                                    html += '<td>Gross Supplies</td>';
                                    html += '<td class="numerals">' + parseFloat(totgrossnettaxamt).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(totgrossCGSTamt).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(totgrossSGSTamt).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(totgrossIGSTamt).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(totgrossGSTAMTamt).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(totgrossNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(totgrossBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    var saleretotnetamt = parseFloat(saleretnetamturd) + parseFloat(saleretnetamtrd);
                                    var saleretotCGSTamt = parseFloat(saleretCGSTurd) + parseFloat(saleretCGSTrd);
                                    var saleretotSGSTamt = parseFloat(saleretSGSTurd) + parseFloat(saleretSGSTrd);
                                    var saleretotIGSTamt = parseFloat(saleretigsturd) + parseFloat(saleretigstrd);
                                    var saleretotGSTAMTamt = parseFloat(salerettaxamturd) + parseFloat(salerettaxamtrd);
                                    var saleretotNONTAXABLEamt = parseFloat(saleretnontaxamturd) + parseFloat(saleretnontaxamtrd);
                                    var saleretotBILLAMOUNTamt = parseFloat(saleretbillamturd) + parseFloat(saleretbillamtrd);
                                    html += '<td>Sales Return (CRN)</td>';
                                    html += '<td class="numerals">' + parseFloat(saleretotnetamt).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(saleretotCGSTamt).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(saleretotSGSTamt).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(saleretotIGSTamt).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(saleretotGSTAMTamt).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(saleretotNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(saleretotBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    var intrstotTAXABLEamt = parseFloat(salintrestnetamtrd) + parseFloat(salintrestnetamturd);
                                    var intrstotCGSTamt = parseFloat(salintrestCGSTrd) + parseFloat(salintrestCGSTurd);
                                    var intrstotSGSTamt = parseFloat(salintrestSGSTrd) + parseFloat(salintrestSGSTurd);
                                    var intrstotIGSTamt = parseFloat(salintrestigstrd) + parseFloat(salintrestigsturd);
                                    var intrstotGSTAMTamt = parseFloat(salintresttaxamtrd) + parseFloat(salintresttaxamturd);
                                    var intrstotNONTAXABLEamt = parseFloat(salintrestnontaxamtrd) + parseFloat(salintrestnontaxamturd);
                                    var intrstotBILLAMOUNTamt = parseFloat(salintrestbillamtrd) + parseFloat(salintrestbillamturd);
                                    html += '<tr>';
                                    html += '<td>Interest (DRN)</td>';
                                    html += '<td class="numerals">' + parseFloat(intrstotTAXABLEamt).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(intrstotCGSTamt).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(intrstotSGSTamt).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(intrstotIGSTamt).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(intrstotGSTAMTamt).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(intrstotNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(intrstotBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '<tr>';
                                    var netsuppliestotTAXABLEamt = parseFloat(totgrossnettaxamt) - parseFloat(saleretotnetamt) + parseFloat(intrstotTAXABLEamt);
                                    var netsuppliestotCGSTamt = parseFloat(totgrossCGSTamt) - parseFloat(saleretotCGSTamt) + parseFloat(intrstotCGSTamt);
                                    var netsuppliestotSGSTamt = parseFloat(totgrossSGSTamt) - parseFloat(saleretotSGSTamt) + parseFloat(intrstotSGSTamt);
                                    var netsuppliestotIGSTamt = parseFloat(totgrossIGSTamt) - parseFloat(saleretotIGSTamt) + parseFloat(intrstotIGSTamt);
                                    var netsuppliestotIGSTAMTamt = parseFloat(totgrossGSTAMTamt) - parseFloat(saleretotGSTAMTamt) + parseFloat(intrstotGSTAMTamt);
                                    var netsuppliestotINONTAXABLEamt = parseFloat(totgrossNONTAXABLEamt) - parseFloat(saleretotNONTAXABLEamt) + parseFloat(intrstotNONTAXABLEamt);
                                    var netsuppliestotBILLAMOUNTamt = parseFloat(totgrossBILLAMOUNTamt) - parseFloat(saleretotBILLAMOUNTamt) + parseFloat(intrstotBILLAMOUNTamt);
                                    html += '<td>Net Supplies</td>';
                                    html += '<td class="numerals">' + parseFloat(netsuppliestotTAXABLEamt).toFixed(2) + '</td>';//TAXABLE
                                    html += '<td class="numerals">' + parseFloat(netsuppliestotCGSTamt).toFixed(2) + '</td>';//CGST
                                    html += '<td class="numerals">' + parseFloat(netsuppliestotSGSTamt).toFixed(2) + '</td>';//SGST
                                    html += '<td class="numerals">' + parseFloat(netsuppliestotIGSTamt).toFixed(2) + '</td>';//IGST
                                    html += '<td class="numerals">' + parseFloat(netsuppliestotIGSTAMTamt).toFixed(2) + '</td>';//GSTAMT
                                    html += '<td class="numerals">' + parseFloat(netsuppliestotINONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                    html += '<td class="numerals">' + parseFloat(netsuppliestotBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                    html += '</tr>';
                                    html += '</tbody>';
                                    html += '<tr class="hidden-print">';
                                    html += '<th colspan="8" style="text-align: center;">';
                                    html += '<a class="btn btn-default blue hidden-print margin-bottom-4" onclick="javascript:window.print();"> Print<i class="fa fa-print"></i></a>';
                                    html += '</th>';
                                    html += '</tr>';
                                    html += '</table>';
                                    html += '</div>';
                                    html += '</div>';
                                    html += '</div>';
                                    html += '</div>';
                                    html += '</div>';
                                    $('.getsaleslist').html(html);
                                } else {
                                    if (SCREENING == "TAX_FREE") {
                                        var html = '<div class="row"><div class="col-md-12">';
                                        html += '<div class="panel panel-primary table light " style="border-color: white;" id="tableportlet">';
                                        html += '<div class="panel-heading hidden-print">';
                                        html += 'TAX FREE';
                                        html += '</div>';
                                        html += '<div class="panel-body" id="portletbody">';
                                        html += '<table class="product_detail_table dttable table table-bordered" id="product_detail_table">';
                                        html += '<thead>';
                                        html += '<tr>';
                                        html += '<th>NATURE</th>';
                                        html += '<th>TAXABLE</th>';
                                        // html+='<th>CGST</th>';
                                        // html+='<th>SGST</th>';
                                        // html+='<th>IGST</th>';
                                        // html+='<th>GSTAMT</th>';
                                        html += '<th>NONTAXABLE</th>';
                                        html += '<th>BILLAMOUNT</th>';
                                        html += '</tr>';
                                        html += '</thead>';
                                        html += '<tbody>';
                                        var rdarr = [];
                                        var urdrdarr = [];
                                        var salreturdrdarr = [];
                                        var salretrdarr = [];
                                        var salintrestrdarr = [];
                                        var salintresturdrdarr = [];
                                        var receiptsrd = [];
                                        var receiptsurd = [];
                                        var indeid = GaruAavak[0]['gross_Amt'];
                                        $.each(GaruAavak, function (indexval, value) {
                                            var add_details = value.add_details;
                                            var garu_Aavak_Group = value.garu_Aavak_Group;
                                            if (value.party_Code != null && value.party_Code.GSTIN != '' && value.party_Code.GSTIN != undefined) var gstin = value.party_Code.GSTIN;
                                            else var gstin = '';
                                            if (value.gross_Amt != null) var gross_Amt = value.gross_Amt;
                                            else var gross_Amt = 0;
                                            $.each(garu_Aavak_Group, function (indexgrp, valuegrp) {
                                                if (value.party_Code != null) var party_code = value.party_Code.ACName;
                                                else var party_code = '';
                                                if (value.party_Code != null && value.party_Code.StateName != null) var partystateid = value.party_Code.StateName._id;
                                                else var partystateid = '';
                                                ////multiple
                                                if (valuegrp.GST != null && valuegrp.GST != '') var GST = valuegrp.GST;
                                                else var GST = 0;
                                                if (valuegrp.net_Amount != null) var net_Amount = valuegrp.net_Amount;
                                                else var net_Amount = 0;
                                                if (valuegrp.Item_SGST != null) var SGSTot = valuegrp.Item_SGST;
                                                else var SGSTot = 0;
                                                if (valuegrp.Item_IGST != null) var IGSTot = valuegrp.Item_IGST;
                                                else var IGSTot = 0;
                                                if (valuegrp.Item_CGST != null) var ScGSTot = valuegrp.Item_CGST;
                                                else var ScGSTot = 0;
                                                // $.each(add_details, function(indexadd, valueadd) {
                                                //     if(valueadd.particular_add.toString()=="5e427b89369a9216c86d5486"){
                                                //         SGSTot = valueadd.particular_amount;
                                                //     }if(valueadd.particular_add.toString()=="5e427b89369a9216c86d5485"){
                                                //         ScGSTot = valueadd.particular_amount;
                                                // }
                                                //     if(valueadd.particular_add.toString()=="5e427b89369a9216c86d5484"){
                                                //         IGSTot = valueadd.particular_amount;  
                                                //     }
                                                // })

                                                if (SGSTot == 0 && IGSTot == 0 && ScGSTot == 0) {
                                                    var taxamount = parseFloat(SGSTot + ScGSTot + IGSTot);
                                                    if (indexval > 0) {
                                                        if (value.gross_Amt != indeid) {
                                                            var grossval = gross_Amt;
                                                            indeid = value.gross_Amt;
                                                        } else {
                                                            var grossval = 0;
                                                        }
                                                    }
                                                    else {
                                                        if (indexgrp > 0) {
                                                            var grossval = 0;
                                                        }
                                                        else {
                                                            var grossval = gross_Amt;
                                                        }

                                                    }
                                                    if (value.main_bk == "Sale") {
                                                        if (gstin == '' || gstin == null || gstin == undefined) {
                                                            var obj = {
                                                                "net_Amount": net_Amount,
                                                                "CGST": ScGSTot,
                                                                "SGST": SGSTot,
                                                                "IGST": IGSTot,
                                                                "taxamount": taxamount,
                                                                "NONTAXABLE": 0.00,
                                                                "billamt": grossval,
                                                            };
                                                            urdrdarr.push(obj);
                                                        } else {
                                                            var obj = {
                                                                "net_Amount": net_Amount,
                                                                "CGST": ScGSTot,
                                                                "SGST": SGSTot,
                                                                "IGST": IGSTot,
                                                                "taxamount": taxamount,
                                                                "NONTAXABLE": 0.00,
                                                                "billamt": grossval,
                                                            };
                                                            rdarr.push(obj);
                                                        }
                                                    } else {
                                                        if (value.main_bk == "Salereturn") {
                                                            if (gstin == '' || gstin == null || gstin == undefined) {
                                                                var obj = {
                                                                    "net_Amount": net_Amount,
                                                                    "CGST": ScGSTot,
                                                                    "SGST": SGSTot,
                                                                    "IGST": IGSTot,
                                                                    "taxamount": taxamount,
                                                                    "NONTAXABLE": 0.00,
                                                                    "billamt": grossval,
                                                                };
                                                                salreturdrdarr.push(obj);
                                                            } else {
                                                                var obj = {
                                                                    "net_Amount": net_Amount,
                                                                    "CGST": ScGSTot,
                                                                    "SGST": SGSTot,
                                                                    "IGST": IGSTot,
                                                                    "taxamount": taxamount,
                                                                    "NONTAXABLE": 0.00,
                                                                    "billamt": grossval,
                                                                };
                                                                salretrdarr.push(obj);
                                                            }
                                                        } else {
                                                            if (value.main_bk == "saleinterst") {
                                                                if (gstin == '' || gstin == null || gstin == undefined) {
                                                                    var obj = {
                                                                        "net_Amount": net_Amount,
                                                                        "CGST": ScGSTot,
                                                                        "SGST": SGSTot,
                                                                        "IGST": IGSTot,
                                                                        "taxamount": taxamount,
                                                                        "NONTAXABLE": 0.00,
                                                                        "billamt": grossval,
                                                                    };
                                                                    salintresturdrdarr.push(obj);
                                                                } else {
                                                                    var obj = {
                                                                        "net_Amount": net_Amount,
                                                                        "CGST": ScGSTot,
                                                                        "SGST": SGSTot,
                                                                        "IGST": IGSTot,
                                                                        "taxamount": taxamount,
                                                                        "NONTAXABLE": 0.00,
                                                                        "billamt": grossval,
                                                                    };
                                                                    salintrestrdarr.push(obj);
                                                                }
                                                            } else {

                                                                if (value.main_bk == "receipts") {
                                                                    if (gstin == '' || gstin == null || gstin == undefined) {
                                                                        var obj = {
                                                                            "net_Amount": net_Amount,
                                                                            "CGST": ScGSTot,
                                                                            "SGST": SGSTot,
                                                                            "IGST": IGSTot,
                                                                            "taxamount": taxamount,
                                                                            "NONTAXABLE": 0.00,
                                                                            "billamt": grossval,
                                                                        };
                                                                        receiptsurd.push(obj);
                                                                    } else {
                                                                        var obj = {
                                                                            "net_Amount": net_Amount,
                                                                            "CGST": ScGSTot,
                                                                            "SGST": SGSTot,
                                                                            "IGST": IGSTot,
                                                                            "taxamount": taxamount,
                                                                            "NONTAXABLE": 0.00,
                                                                            "billamt": grossval,
                                                                        };
                                                                        receiptsrd.push(obj);
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }

                                            });
                                        });
                                        ////urd
                                        var netamturd = 0;
                                        var CGSTurd = 0;
                                        var SGSTurd = 0;
                                        var igsturd = 0;
                                        var taxamturd = 0;
                                        var nontaxamturd = 0;
                                        var billamturd = 0;
                                        for (var k = 0, l = urdrdarr.length; k < l; k++) {
                                            netamturd += parseFloat(urdrdarr[k]['net_Amount']);
                                            CGSTurd += parseFloat(urdrdarr[k]['CGST']);
                                            SGSTurd += parseFloat(urdrdarr[k]['SGST']);
                                            igsturd += parseFloat(urdrdarr[k]['IGST']);
                                            taxamturd += parseFloat(urdrdarr[k]['taxamount']);
                                            nontaxamturd += parseFloat(urdrdarr[k]['NONTAXABLE']);
                                            billamturd += parseFloat(urdrdarr[k]['billamt']);
                                        }
                                        ////end urd
                                        ////rd
                                        var netamtrd = 0;
                                        var CGSTrd = 0;
                                        var SGSTrd = 0;
                                        var igstrd = 0;
                                        var taxamtrd = 0;
                                        var nontaxamtrd = 0;
                                        var billamtrd = 0;
                                        for (var k = 0, l = rdarr.length; k < l; k++) {
                                            netamtrd += parseFloat(rdarr[k]['net_Amount']);
                                            CGSTrd += parseFloat(rdarr[k]['CGST']);
                                            SGSTrd += parseFloat(rdarr[k]['SGST']);
                                            igstrd += parseFloat(rdarr[k]['IGST']);
                                            taxamtrd += parseFloat(rdarr[k]['taxamount']);
                                            nontaxamtrd += parseFloat(rdarr[k]['NONTAXABLE']);
                                            billamtrd += parseFloat(rdarr[k]['billamt']);
                                        }
                                        ////end rd
                                        ///sales return urd 
                                        var saleretnetamturd = 0;
                                        var saleretCGSTurd = 0;
                                        var saleretSGSTurd = 0;
                                        var saleretigsturd = 0;
                                        var salerettaxamturd = 0;
                                        var saleretnontaxamturd = 0;
                                        var saleretbillamturd = 0;
                                        for (var k = 0, l = salreturdrdarr.length; k < l; k++) {
                                            saleretnetamturd += parseFloat(salreturdrdarr[k]['net_Amount']);
                                            saleretCGSTurd += parseFloat(salreturdrdarr[k]['CGST']);
                                            saleretSGSTurd += parseFloat(salreturdrdarr[k]['SGST']);
                                            saleretigsturd += parseFloat(salreturdrdarr[k]['IGST']);
                                            salerettaxamturd += parseFloat(salreturdrdarr[k]['taxamount']);
                                            saleretnontaxamturd += parseFloat(salreturdrdarr[k]['NONTAXABLE']);
                                            saleretbillamturd += parseFloat(salreturdrdarr[k]['billamt']);
                                        }
                                        ////end  sales return urd

                                        ///sales return rd 
                                        var saleretnetamtrd = 0;
                                        var saleretCGSTrd = 0;
                                        var saleretSGSTrd = 0;
                                        var saleretigstrd = 0;
                                        var salerettaxamtrd = 0;
                                        var saleretnontaxamtrd = 0;
                                        var saleretbillamtrd = 0;
                                        for (var k = 0, l = salretrdarr.length; k < l; k++) {
                                            saleretnetamtrd += parseFloat(salretrdarr[k]['net_Amount']);
                                            saleretCGSTrd += parseFloat(salretrdarr[k]['CGST']);
                                            saleretSGSTrd += parseFloat(salretrdarr[k]['SGST']);
                                            saleretigstrd += parseFloat(salretrdarr[k]['IGST']);
                                            salerettaxamtrd += parseFloat(salretrdarr[k]['taxamount']);
                                            saleretnontaxamtrd += parseFloat(salretrdarr[k]['NONTAXABLE']);
                                            saleretbillamtrd += parseFloat(salretrdarr[k]['billamt']);
                                        }
                                        ////end  sales return rd 
                                        ////sale interest urd
                                        var salintrestnetamturd = 0;
                                        var salintrestCGSTurd = 0;
                                        var salintrestSGSTurd = 0;
                                        var salintrestigsturd = 0;
                                        var salintresttaxamturd = 0;
                                        var salintrestnontaxamturd = 0;
                                        var salintrestbillamturd = 0;
                                        for (var k = 0, l = salintresturdrdarr.length; k < l; k++) {
                                            salintrestnetamturd += parseFloat(salintresturdrdarr[k]['net_Amount']);
                                            salintrestCGSTurd += parseFloat(salintresturdrdarr[k]['CGST']);
                                            salintrestSGSTurd += parseFloat(salintresturdrdarr[k]['SGST']);
                                            salintrestigsturd += parseFloat(salintresturdrdarr[k]['IGST']);
                                            salintresttaxamturd += parseFloat(salintresturdrdarr[k]['taxamount']);
                                            salintrestnontaxamturd += parseFloat(salintresturdrdarr[k]['NONTAXABLE']);
                                            salintrestbillamturd += parseFloat(salintresturdrdarr[k]['billamt']);
                                        }
                                        ///end sale interest urd
                                        //// sale interest rd
                                        var salintrestnetamtrd = 0;
                                        var salintrestCGSTrd = 0;
                                        var salintrestSGSTrd = 0;
                                        var salintrestigstrd = 0;
                                        var salintresttaxamtrd = 0;
                                        var salintrestnontaxamtrd = 0;
                                        var salintrestbillamtrd = 0;
                                        for (var k = 0, l = salintrestrdarr.length; k < l; k++) {
                                            salintrestnetamtrd += parseFloat(salintrestrdarr[k]['net_Amount']);
                                            salintrestCGSTrd += parseFloat(salintrestrdarr[k]['CGST']);
                                            salintrestSGSTrd += parseFloat(salintrestrdarr[k]['SGST']);
                                            salintrestigstrd += parseFloat(salintrestrdarr[k]['IGST']);
                                            salintresttaxamtrd += parseFloat(salintrestrdarr[k]['taxamount']);
                                            salintrestnontaxamtrd += parseFloat(salintrestrdarr[k]['NONTAXABLE']);
                                            salintrestbillamtrd += parseFloat(salintrestrdarr[k]['billamt']);
                                        }
                                        ////end sale interest rd\

                                        // Receipts urd
                                        var receiptsnetamturd = 0;
                                        var receiptsCGSTurd = 0;
                                        var receiptsSGSTurd = 0;
                                        var receiptsigsturd = 0;
                                        var receiptstaxamturd = 0;
                                        var receiptsnontaxamturd = 0;
                                        var receiptsbillamturd = 0;
                                        for (var k = 0, l = receiptsurd.length; k < l; k++) {
                                            receiptsnetamturd += parseFloat(receiptsurd[k]['net_Amount']);
                                            receiptsCGSTurd += parseFloat(receiptsurd[k]['CGST']);
                                            receiptsSGSTurd += parseFloat(receiptsurd[k]['SGST']);
                                            receiptsigsturd += parseFloat(receiptsurd[k]['IGST']);
                                            receiptstaxamturd += parseFloat(receiptsurd[k]['taxamount']);
                                            receiptsnontaxamturd += parseFloat(receiptsurd[k]['NONTAXABLE']);
                                            receiptsbillamturd += parseFloat(receiptsurd[k]['billamt']);
                                        }
                                        ///end Receipts urd
                                        // Receipts rd
                                        var receiptsnetamtrd = 0;
                                        var receiptsCGSTrd = 0;
                                        var receiptsSGSTrd = 0;
                                        var receiptsigstrd = 0;
                                        var receiptstaxamtrd = 0;
                                        var receiptsnontaxamtrd = 0;
                                        var receiptsbillamtrd = 0;
                                        for (var k = 0, l = receiptsrd.length; k < l; k++) {
                                            receiptsnetamtrd += parseFloat(receiptsrd[k]['net_Amount']);
                                            receiptsCGSTrd += parseFloat(receiptsrd[k]['CGST']);
                                            receiptsSGSTrd += parseFloat(receiptsrd[k]['SGST']);
                                            receiptsigstrd += parseFloat(receiptsrd[k]['IGST']);
                                            receiptstaxamtrd += parseFloat(receiptsrd[k]['taxamount']);
                                            receiptsnontaxamtrd += parseFloat(receiptsrd[k]['NONTAXABLE']);
                                            receiptsbillamtrd += parseFloat(receiptsrd[k]['billamt']);
                                        }
                                        //end Receipts rd

                                        html += '<tr>';
                                        html += '<td style="color: blue;">Taxable Supplies</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td style="color: blue;">*** Supplies to URD ***</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT

                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>Sales</td>';
                                        html += '<td class="numerals">' + parseFloat(netamturd).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(CGSTurd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(SGSTurd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(igsturd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(taxamturd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(nontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(billamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>Other Receipts</td>';
                                        html += '<td class="numerals">' + parseFloat(receiptsnetamturd).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(receiptsCGSTurd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(receiptsSGSTurd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(receiptsigsturd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(receiptstaxamturd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(receiptsnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(receiptsbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>-------------------------</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        var grossurdtaxablamt = parseFloat(netamturd) + parseFloat(receiptsnetamturd);
                                        var grossurdCGSTurd = parseFloat(CGSTurd) + parseFloat(receiptsCGSTurd);
                                        var grossurdSGSTurd = parseFloat(SGSTurd) + parseFloat(receiptsSGSTurd);
                                        var grossurdigsturd = parseFloat(igsturd) + parseFloat(receiptsigsturd);
                                        var grossurdtaxamturd = parseFloat(taxamturd) + parseFloat(receiptstaxamturd);
                                        var grossurdnontaxamturd = parseFloat(nontaxamturd) + parseFloat(receiptsnontaxamturd);
                                        var grossurdbillamturd = parseFloat(billamturd) + parseFloat(receiptsbillamturd);
                                        html += '<td>Gross Supplies</td>';
                                        html += '<td class="numerals">' + parseFloat(grossurdtaxablamt).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(grossurdCGSTurd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(grossurdSGSTurd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(grossurdigsturd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(grossurdtaxamturd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(grossurdnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(grossurdbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>Sales Return (CRN)</td>';
                                        html += '<td class="numerals">' + parseFloat(saleretnetamturd).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(saleretCGSTurd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(saleretSGSTurd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(saleretigsturd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(salerettaxamturd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(saleretnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(saleretbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>Interest (DRN)</td>';
                                        html += '<td class="numerals">' + parseFloat(salintrestnetamturd).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(salintrestCGSTurd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(salintrestSGSTurd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(salintrestigsturd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(salintresttaxamturd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(salintrestnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(salintrestbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>-------------------------</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '</tr>';
                                        var netsupliesnetamturd = parseFloat(grossurdtaxablamt) - parseFloat(saleretnetamturd) + parseFloat(salintrestnetamturd)
                                        var netsupliescgsturd = parseFloat(grossurdCGSTurd) - parseFloat(saleretCGSTurd) + parseFloat(salintrestCGSTurd)
                                        var netsupliessgsturd = parseFloat(grossurdSGSTurd) - parseFloat(saleretSGSTurd) + parseFloat(salintrestSGSTurd)
                                        var netsupliesigsturd = parseFloat(grossurdigsturd) - parseFloat(saleretigsturd) + parseFloat(salintresttaxamturd)
                                        var netsupliesgstamturd = parseFloat(grossurdtaxamturd) - parseFloat(salerettaxamturd) + parseFloat(salintresttaxamturd)
                                        var netsupliesnontaxamturd = parseFloat(grossurdnontaxamturd) - parseFloat(saleretnontaxamturd) + parseFloat(salintrestnontaxamturd)
                                        var netsupliesbillamturd = parseFloat(grossurdbillamturd) - parseFloat(saleretbillamturd) + parseFloat(salintrestbillamturd)
                                        html += '<tr>';
                                        html += '<td style="color: blue;">Net Supplies</td>';
                                        html += '<td class="numerals">' + parseFloat(netsupliesnetamturd).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(netsupliescgsturd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(netsupliessgsturd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(netsupliesigsturd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(netsupliesgstamturd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(netsupliesnontaxamturd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(netsupliesbillamturd).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>=========================</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '<tr>';
                                        html += '<td style="color: blue;">*** Supplies to RD ***</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>Sales</td>';
                                        html += '<td class="numerals">' + parseFloat(netamtrd).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(CGSTrd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(SGSTrd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(igstrd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(taxamtrd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(nontaxamtrd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(billamtrd).toFixed(2) + '</td>';//BILLAMOUN
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>Other Receipts</td>';
                                        html += '<td class="numerals">' + parseFloat(receiptsnetamtrd).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(receiptsCGSTrd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(receiptsSGSTrd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(receiptsigstrd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(receiptstaxamtrd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(receiptsnontaxamtrd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(receiptsbillamtrd).toFixed(2) + '</td>';//BILLAMOUN
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>-------------------------</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '</tr>';
                                        var grossrdnettaxblamt = parseFloat(netamtrd) + parseFloat(receiptsnetamtrd);
                                        var grossrdcgstamt = parseFloat(CGSTrd) + parseFloat(receiptsCGSTrd);
                                        var grossrdsgstamt = parseFloat(SGSTrd) + parseFloat(receiptsSGSTrd);
                                        var grossrdigstamt = parseFloat(igstrd) + parseFloat(receiptsigstrd);
                                        var grossrdtaxgstamt = parseFloat(taxamtrd) + parseFloat(receiptstaxamtrd);
                                        var grossrdnontaxamt = parseFloat(nontaxamtrd) + parseFloat(receiptsnontaxamtrd);
                                        var grossrdbllamt = parseFloat(billamtrd) + parseFloat(receiptsbillamtrd);
                                        html += '<tr>';
                                        html += '<td style="color: blue;">Gross Supplies</td>';
                                        html += '<td class="numerals">' + parseFloat(grossrdnettaxblamt).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(grossrdcgstamt).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(grossrdsgstamt).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(grossrdigstamt).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(grossrdtaxgstamt).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(grossrdnontaxamt).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(grossrdbllamt).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>Sales Return (CRN)</td>';
                                        html += '<td class="numerals">' + parseFloat(saleretnetamtrd).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(saleretCGSTrd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(saleretSGSTrd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(saleretigstrd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(salerettaxamtrd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(saleretnontaxamtrd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(saleretbillamtrd).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>Interest (DRN)</td>';
                                        html += '<td class="numerals">' + parseFloat(salintrestnetamtrd).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(salintrestCGSTrd).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(salintrestSGSTrd).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(salintrestigstrd).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(salintresttaxamtrd).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(salintrestnontaxamtrd).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(salintrestbillamtrd).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>-------------------------</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '</tr>';
                                        var netsuppliesrdtaxamt = parseFloat(grossrdnettaxblamt) - parseFloat(saleretnetamtrd) + parseFloat(salintrestnetamtrd);
                                        var netsuppliesrdCGSTamt = parseFloat(grossrdcgstamt) - parseFloat(saleretCGSTrd) + parseFloat(salintrestCGSTrd);
                                        var netsuppliesrdSGSTamt = parseFloat(grossrdsgstamt) - parseFloat(saleretSGSTrd) + parseFloat(salintrestSGSTrd);
                                        var netsuppliesrdIGSTamt = parseFloat(grossrdigstamt) - parseFloat(saleretigstrd) + parseFloat(salintrestigstrd);
                                        var netsuppliesrdGSTAMTamt = parseFloat(grossrdtaxgstamt) - parseFloat(salerettaxamtrd) + parseFloat(salintresttaxamtrd);
                                        var netsuppliesrdNONTAXABLEamt = parseFloat(grossrdnontaxamt) - parseFloat(saleretnontaxamtrd) + parseFloat(salintrestnontaxamtrd);
                                        var netsuppliesrdBILLAMOUNTamt = parseFloat(grossrdbllamt) - parseFloat(saleretbillamtrd) + parseFloat(salintrestbillamtrd);
                                        html += '<tr>';
                                        html += '<td style="color: blue;">Net Supplies</td>';
                                        html += '<td class="numerals">' + parseFloat(netsuppliesrdtaxamt).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(netsuppliesrdCGSTamt).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(netsuppliesrdSGSTamt).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(netsuppliesrdIGSTamt).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(netsuppliesrdGSTAMTamt).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(netsuppliesrdNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(netsuppliesrdBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>=========================</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td style="color: blue;">*** Total Supplies ***</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        var totsupplieselstaxamt = parseFloat(grossurdtaxablamt) + parseFloat(grossrdnettaxblamt);
                                        var totsupplieselsCGSTamt = parseFloat(grossurdCGSTurd) + parseFloat(grossrdcgstamt);
                                        var totsupplieselsSGSTamt = parseFloat(grossurdSGSTurd) + parseFloat(grossrdsgstamt);
                                        var totsupplieselsIGSTamt = parseFloat(grossurdigsturd) + parseFloat(grossrdigstamt);
                                        var totsupplieselsGSTAMTamt = parseFloat(grossurdtaxamturd) + parseFloat(grossrdtaxgstamt);
                                        var totsupplieselsNONTAXABLEamt = parseFloat(grossurdnontaxamturd) + parseFloat(grossrdnontaxamt);
                                        var totsupplieselsBILLAMOUNTamt = parseFloat(grossurdbillamturd) + parseFloat(grossrdbllamt);
                                        html += '<td>Sales</td>';
                                        html += '<td class="numerals">' + parseFloat(totsupplieselstaxamt).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(totsupplieselsCGSTamt).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(totsupplieselsSGSTamt).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(totsupplieselsIGSTamt).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(totsupplieselsGSTAMTamt).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(totsupplieselsNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(totsupplieselsBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        var othtottaxblamt = parseFloat(receiptsnetamturd) + parseFloat(receiptsnetamtrd);
                                        var othtotCGSTamt = parseFloat(receiptsCGSTurd) + parseFloat(receiptsCGSTrd);
                                        var othtotSGSTamt = parseFloat(receiptsSGSTurd) + parseFloat(receiptsSGSTrd);
                                        var othtotIGSTamt = parseFloat(receiptsigsturd) + parseFloat(receiptsigstrd);
                                        var othtotGSTAMTamt = parseFloat(receiptstaxamturd) + parseFloat(receiptstaxamtrd);
                                        var othtotNONTAXABLEamt = parseFloat(receiptsnontaxamturd) + parseFloat(receiptsnontaxamtrd);
                                        var othtotBILLAMOUNTamt = parseFloat(receiptsbillamturd) + parseFloat(receiptsbillamtrd);
                                        html += '<td>Other Receipts</td>';
                                        html += '<td class="numerals">' + parseFloat(othtottaxblamt).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(othtotCGSTamt).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(othtotSGSTamt).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(othtotIGSTamt).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(othtotGSTAMTamt).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(othtotNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(othtotBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td>-------------------------</td>';
                                        html += '<td class="numerals"></td>';//TAXABLE
                                        // html+='<td class="numerals"></td>';//CGST
                                        // html+='<td class="numerals"></td>';//SGST
                                        // html+='<td class="numerals"></td>';//IGST
                                        // html+='<td class="numerals"></td>';//GSTAMT
                                        html += '<td class="numerals"></td>';//NONTAXABLE
                                        html += '<td class="numerals"></td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        var totgrossnettaxamt = parseFloat(grossurdtaxablamt) + parseFloat(grossrdnettaxblamt);
                                        var totgrossCGSTamt = parseFloat(grossurdCGSTurd) + parseFloat(grossrdcgstamt);
                                        var totgrossSGSTamt = parseFloat(grossurdSGSTurd) + parseFloat(grossrdsgstamt);
                                        var totgrossIGSTamt = parseFloat(grossurdigsturd) + parseFloat(grossrdigstamt);
                                        var totgrossGSTAMTamt = parseFloat(grossurdtaxamturd) + parseFloat(grossrdtaxgstamt);
                                        var totgrossNONTAXABLEamt = parseFloat(grossurdnontaxamturd) + parseFloat(grossrdnontaxamt);
                                        var totgrossBILLAMOUNTamt = parseFloat(grossurdbillamturd) + parseFloat(grossrdbllamt);
                                        html += '<td>Gross Supplies</td>';
                                        html += '<td class="numerals">' + parseFloat(totgrossnettaxamt).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(totgrossCGSTamt).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(totgrossSGSTamt).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(totgrossIGSTamt).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(totgrossGSTAMTamt).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(totgrossNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(totgrossBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        var saleretotnetamt = parseFloat(saleretnetamturd) + parseFloat(saleretnetamtrd);
                                        var saleretotCGSTamt = parseFloat(saleretCGSTurd) + parseFloat(saleretCGSTrd);
                                        var saleretotSGSTamt = parseFloat(saleretSGSTurd) + parseFloat(saleretSGSTrd);
                                        var saleretotIGSTamt = parseFloat(saleretigsturd) + parseFloat(saleretigstrd);
                                        var saleretotGSTAMTamt = parseFloat(salerettaxamturd) + parseFloat(salerettaxamtrd);
                                        var saleretotNONTAXABLEamt = parseFloat(saleretnontaxamturd) + parseFloat(saleretnontaxamtrd);
                                        var saleretotBILLAMOUNTamt = parseFloat(saleretbillamturd) + parseFloat(saleretbillamtrd);
                                        html += '<td>Sales Return (CRN)</td>';
                                        html += '<td class="numerals">' + parseFloat(saleretotnetamt).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(saleretotCGSTamt).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(saleretotSGSTamt).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(saleretotIGSTamt).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(saleretotGSTAMTamt).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(saleretotNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(saleretotBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        var intrstotTAXABLEamt = parseFloat(salintrestnetamtrd) + parseFloat(salintrestnetamturd);
                                        var intrstotCGSTamt = parseFloat(salintrestCGSTrd) + parseFloat(salintrestCGSTurd);
                                        var intrstotSGSTamt = parseFloat(salintrestSGSTrd) + parseFloat(salintrestSGSTurd);
                                        var intrstotIGSTamt = parseFloat(salintrestigstrd) + parseFloat(salintrestigsturd);
                                        var intrstotGSTAMTamt = parseFloat(salintresttaxamtrd) + parseFloat(salintresttaxamturd);
                                        var intrstotNONTAXABLEamt = parseFloat(salintrestnontaxamtrd) + parseFloat(salintrestnontaxamturd);
                                        var intrstotBILLAMOUNTamt = parseFloat(salintrestbillamtrd) + parseFloat(salintrestbillamturd);
                                        html += '<tr>';
                                        html += '<td>Interest (DRN)</td>';
                                        html += '<td class="numerals">' + parseFloat(intrstotTAXABLEamt).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(intrstotCGSTamt).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(intrstotSGSTamt).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(intrstotIGSTamt).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(intrstotGSTAMTamt).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(intrstotNONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(intrstotBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '<tr>';
                                        var netsuppliestotTAXABLEamt = parseFloat(totgrossnettaxamt) - parseFloat(saleretotnetamt) + parseFloat(intrstotTAXABLEamt);
                                        var netsuppliestotCGSTamt = parseFloat(totgrossCGSTamt) - parseFloat(saleretotCGSTamt) + parseFloat(intrstotCGSTamt);
                                        var netsuppliestotSGSTamt = parseFloat(totgrossSGSTamt) - parseFloat(saleretotSGSTamt) + parseFloat(intrstotSGSTamt);
                                        var netsuppliestotIGSTamt = parseFloat(totgrossIGSTamt) - parseFloat(saleretotIGSTamt) + parseFloat(intrstotIGSTamt);
                                        var netsuppliestotIGSTAMTamt = parseFloat(totgrossGSTAMTamt) - parseFloat(saleretotGSTAMTamt) + parseFloat(intrstotGSTAMTamt);
                                        var netsuppliestotINONTAXABLEamt = parseFloat(totgrossNONTAXABLEamt) - parseFloat(saleretotNONTAXABLEamt) + parseFloat(intrstotNONTAXABLEamt);
                                        var netsuppliestotBILLAMOUNTamt = parseFloat(totgrossBILLAMOUNTamt) - parseFloat(saleretotBILLAMOUNTamt) + parseFloat(intrstotBILLAMOUNTamt);
                                        html += '<td>Net Supplies</td>';
                                        html += '<td class="numerals">' + parseFloat(netsuppliestotTAXABLEamt).toFixed(2) + '</td>';//TAXABLE
                                        // html+='<td class="numerals">'+parseFloat(netsuppliestotCGSTamt).toFixed(2)+'</td>';//CGST
                                        // html+='<td class="numerals">'+parseFloat(netsuppliestotSGSTamt).toFixed(2)+'</td>';//SGST
                                        // html+='<td class="numerals">'+parseFloat(netsuppliestotIGSTamt).toFixed(2)+'</td>';//IGST
                                        // html+='<td class="numerals">'+parseFloat(netsuppliestotIGSTAMTamt).toFixed(2)+'</td>';//GSTAMT
                                        html += '<td class="numerals">' + parseFloat(netsuppliestotINONTAXABLEamt).toFixed(2) + '</td>';//NONTAXABLE
                                        html += '<td class="numerals">' + parseFloat(netsuppliestotBILLAMOUNTamt).toFixed(2) + '</td>';//BILLAMOUNT
                                        html += '</tr>';
                                        html += '</tbody>';
                                        html += '<tr class="hidden-print">';
                                        html += '<th colspan="8" style="text-align: center;">';
                                        html += '<a class="btn btn-default blue hidden-print margin-bottom-4" onclick="javascript:window.print();"> Print<i class="fa fa-print"></i></a>';
                                        html += '</th>';
                                        html += '</tr>';
                                        html += '</table>';
                                        html += '</div>';
                                        html += '</div>';
                                        html += '</div>';
                                        html += '</div>';
                                        html += '</div>';
                                        $('.getsaleslist').html(html);
                                    } else {
                                        if (SCREENING == "HSN_INW") {
                                            var html = '<div class="row"><div class="col-md-12">';
                                            html += '<div class="panel panel-primary table light " id="tableportlet">';
                                            html += '<div class="panel-heading hidden-print">';
                                            html += 'HSN INW';
                                            html += '</div>';
                                            html += '<div class="panel-body" id="portletbody">';
                                            html += '<table style="width:100%" class="product_detail_table display dttable table table-striped table-bordered table-hover" id="product_detail_table">';
                                            html += '<thead>';
                                            html += '<tr>';
                                            html += '<th>NATURE</th>';
                                            html += '<th>HSNCODE</th>';
                                            html += '<th>DESCRIP</th>';
                                            html += '<th>BAGS</th>';
                                            html += '<th>NETWT</th>';
                                            html += '<th>UQC</th>';
                                            html += '<th>INVAMT</th>';
                                            html += '<th>TAXABLE</th>';
                                            html += '<th>IGST</th>';
                                            html += '<th>CGST</th>';
                                            html += '<th>SGST</th>';
                                            html += '</tr>';
                                            html += '</thead>';
                                            html += '<tbody>';
                                            var itemarr = [];
                                            var indeid = GaruAavak[0]['gross_Amt'];
                                            $.each(GaruAavak, function (indexval, value) {
                                                if (value.main_bk == "GAE") {
                                                    var garu_Aavak_Group = value.garu_Aavak_Group;
                                                    var add_details = value.add_details;
                                                    if (value.party_Code != null) var party_code = value.party_Code.ACName;
                                                    else var party_code = '';
                                                    if (value.party_Code != null && value.party_Code.StateName != null) var partystateid = value.party_Code.StateName._id;
                                                    else var partystateid = '';
                                                    if (value.gross_Amt != null) var gross_Amt = value.gross_Amt;
                                                    else var gross_Amt = 0;
                                                    var main_bk = value.main_bk;
                                                    itemarr = [];
                                                    var fnd = false;
                                                    $.each(garu_Aavak_Group, function (indexgrp, valuegrp) {
                                                        if (indexval > 0) {
                                                            if (value.gross_Amt != indeid) {
                                                                var grossval = gross_Amt;
                                                                indeid = value.gross_Amt;
                                                            } else {
                                                                var grossval = 0;
                                                            }
                                                        }
                                                        else {
                                                            if (indexgrp > 0) {
                                                                var grossval = 0;
                                                            }
                                                            else {
                                                                var grossval = gross_Amt;
                                                            }
                                                        }
                                                        if (valuegrp.qntty != null) var qntty = valuegrp.qntty;
                                                        else var qntty = 0;
                                                        if (valuegrp.net_Wt != null) var net_Wt = valuegrp.net_Wt;
                                                        else var net_Wt = 0;
                                                        if (valuegrp.pkng != null) var pkng = valuegrp.pkng;
                                                        else var pkng = 0;
                                                        if (valuegrp.net_Amount != null) var net_Amount = valuegrp.net_Amount;
                                                        else var net_Amount = 0;
                                                        if (valuegrp.item_Code_Desc != null) var item_Code_Desc = valuegrp.item_Code_Desc.item_code;
                                                        else var item_Code_Desc = '';
                                                        if (valuegrp.item_Code_Desc != null && valuegrp.item_Code_Desc.apmc_code != undefined) var hsncode = valuegrp.item_Code_Desc.apmc_code;
                                                        else var hsncode = '';
                                                        if (valuegrp.item_Code_Desc != null && valuegrp.item_Code_Desc.unit_nm != null) var unit = valuegrp.item_Code_Desc.unit_nm.SKUName;
                                                        else var unit = '';
                                                        if (valuegrp.GST != null && valuegrp.GST != '') var GST = valuegrp.GST;
                                                        else var GST = 0;
                                                        for (var k = 0, l = itemarr.length; k < l; k++) {
                                                            if (itemarr[k]['itemcode'].toString() == item_Code_Desc.toString()) {
                                                                itemarr[k]['qntty'] = itemarr[k]['qntty'] + parseFloat(qntty);
                                                                itemarr[k]['net_Wt'] = itemarr[k]['net_Wt'] + parseFloat(net_Wt);
                                                                itemarr[k]['pkng'] = itemarr[k]['pkng'] + parseFloat(pkng);
                                                                itemarr[k]['net_Amount'] = itemarr[k]['net_Amount'] + parseFloat(net_Amount);
                                                                fnd = true;
                                                            }
                                                        }
                                                        if (fnd == false) {
                                                            var obj = {
                                                                "itemcode": item_Code_Desc,
                                                                "hsncode": hsncode,
                                                                "partystateid": partystateid,
                                                                "gross_Amt": grossval,
                                                                "qntty": qntty,
                                                                "net_Wt": net_Wt,
                                                                "pkng": pkng,
                                                                "net_Amount": net_Amount,
                                                                "main_bk": main_bk,
                                                                "unit": unit,
                                                                "GST": GST,
                                                                "add_details": add_details,
                                                            };
                                                            itemarr.push(obj);
                                                        }
                                                    })
                                                }
                                            })

                                            var qtytot = 0;
                                            var net_Wtot = 0;
                                            var net_Amountot = 0;
                                            var billamtot = 0;
                                            var indexing = 0;
                                            var sgstamtot = 0;
                                            var cgstamtot = 0;
                                            var igstamtot = 0;
                                            var taxamtot = 0;
                                            for (var k = 0, l = itemarr.length; k < l; k++) {
                                                indexing++;
                                                net_Amountot += parseFloat(itemarr[k]['net_Amount']);
                                                var SGSTot = 0;
                                                var ScGSTot = 0;
                                                var IGSTot = 0;
                                                $.each(itemarr[k]['add_details'], function (indexadd, valueadd) {
                                                    if (valueadd.particular_add.toString() == "5e4d2a1fcfdaab1924f967cf") {
                                                        SGSTot = valueadd.particular_amount;
                                                    } if (valueadd.particular_add.toString() == "5e4d2a1fcfdaab1924f967ce") {
                                                        ScGSTot = valueadd.particular_amount;
                                                    }
                                                    if (valueadd.particular_add.toString() == "5e4d2a1fcfdaab1924f967cd") {
                                                        IGSTot = valueadd.particular_amount;
                                                    }
                                                })
                                                var taxamount = parseFloat(SGSTot + ScGSTot + IGSTot);
                                                sgstamtot += parseFloat(SGSTot);
                                                cgstamtot += parseFloat(ScGSTot);
                                                igstamtot += parseFloat(IGSTot);
                                                billamtot += parseFloat(itemarr[k]['gross_Amt']);
                                                taxamtot += parseFloat(taxamount);
                                                html += ' <tr>';
                                                if (itemarr[k]['main_bk'] == "Sale") {
                                                    var mainbk = "Sales"
                                                } else {
                                                    if (itemarr[k]['main_bk'] == "GAE") {
                                                        var mainbk = "Purchases"
                                                    } else {
                                                        var mainbk = itemarr[k]['main_bk'];
                                                    }
                                                }
                                                html += '<td>' + mainbk + '</td>';
                                                html += '<td>' + itemarr[k]['hsncode'] + '</td>';
                                                html += '<td>' + itemarr[k]['itemcode'] + '</td>';
                                                qtytot += parseFloat(itemarr[k]['qntty']);
                                                html += '<td class="numerals">' + itemarr[k]['qntty'] + '</td>';
                                                net_Wtot += parseFloat(itemarr[k]['net_Wt']);
                                                html += '<td class="numerals">' + itemarr[k]['net_Wt'] + '</td>';
                                                html += '<td>' + itemarr[k]['unit'] + '</td>';
                                                html += '<td class="numerals">' + parseFloat(itemarr[k]['gross_Amt']).toFixed(2) + '</td>';
                                                html += '<td class="numerals">' + parseFloat(taxamount).toFixed(2) + '</td>';
                                                html += '<td class="numerals">' + parseFloat(IGSTot).toFixed(2) + '</td>';
                                                html += '<td class="numerals">' + parseFloat(ScGSTot).toFixed(2) + '</td>';
                                                html += '<td class="numerals">' + parseFloat(SGSTot).toFixed(2) + '</td>';
                                                html += '</tr>';
                                            }

                                            html += '</tbody>';
                                            html += ' <tr>';
                                            html += '<th></th>';
                                            html += '<th></th>';
                                            html += '<th></th>';
                                            html += '<th class="numerals">' + parseFloat(qtytot).toFixed(2) + '</th>';
                                            html += '<th class="numerals">' + parseFloat(net_Wtot).toFixed(2) + '</th>';
                                            html += '<th></th>';
                                            html += '<th class="numerals">' + parseFloat(billamtot).toFixed(2) + '</th>';
                                            html += '<th class="numerals">' + parseFloat(taxamtot).toFixed(2) + '</th>';
                                            html += '<th class="numerals">' + parseFloat(igstamtot).toFixed(2) + '</th>';
                                            html += '<th class="numerals">' + parseFloat(cgstamtot).toFixed(2) + '</th>';
                                            html += '<th class="numerals">' + parseFloat(sgstamtot).toFixed(2) + '</th>';
                                            html += '</tr>';
                                            html += '<tfoot>';
                                            html += ' <tr>';
                                            html += '<th>NATURE</th>';
                                            html += '<th>HSNCODE</th>';
                                            html += '<th>DESCRIP</th>';
                                            html += '<th>BAGS</th>';
                                            html += '<th>NETWT</th>';
                                            html += '<th>UQC</th>';
                                            html += '<th>INVAMT</th>';
                                            html += '<th>TAXABLE</th>';
                                            html += '<th>IGST</th>';
                                            html += '<th>CGST</th>';
                                            html += '<th>SGST</th>';
                                            html += '</tr>';
                                            html += '</tfoot>';
                                            html += '</table>';
                                            html += '</div>';
                                            html += '</div>';
                                            html += '</div>';
                                            html += '</div>';
                                            html += '</div>';
                                            $('.getsaleslist').html(html);
                                            $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                                                var title = $(this).text();
                                                $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                                                function resizeInput() {
                                                    var content =
                                                        $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
                                                    var widthTester = $("<span>" + content + "</span>").hide();
                                                    widthTester.insertAfter($(this));
                                                    $(this).css("width", widthTester.width() + "px");
                                                    widthTester.remove();
                                                }

                                                $('.resizing-input').focusout(resizeInput).each(resizeInput);
                                            });
                                            // moving tfoot below head th row
                                            $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
                                            table = jQuery('.product_detail_table').DataTable({
                                                "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                                                "lengthChange": true,
                                                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                                                "colReorder": true,
                                                "buttons": [
                                                    {
                                                        extend: 'excel',
                                                        className: 'btn-default btn-excel',
                                                        footer: true,
                                                    },
                                                    {
                                                        extend: 'pdf',
                                                        className: 'btn-default btn-pdf',
                                                        footer: true,
                                                    },
                                                    {
                                                        extend: 'print',
                                                        className: 'btn-default btn-print',
                                                        // exportOptions: {
                                                        //     modifier: {
                                                        //         page: 'current'
                                                        //     }
                                                        // }
                                                    },
                                                ],
                                                // "columnDefs": [
                                                //     {
                                                //         "className": "actioncell",
                                                //         "orderable": false,
                                                //         "searchable": false,
                                                //         "sortable": false,
                                                //         "targets": [0]
                                                //     }
                                                // ],
                                                "order": [0, 'asc'],
                                                initComplete: function () {
                                                    var api = this.api();
                                                    api.columns().every(function () {
                                                        var that = this;

                                                        $('input', this.footer()).on('keyup change', function () {
                                                            if (that.search() !== this.value) {
                                                                that
                                                                    .column($(this).parent().index() + ':visible')
                                                                    .search(this.value)
                                                                    .draw();
                                                            }
                                                        });
                                                    });
                                                }
                                            });
                                            $('.loader').hide();
                                        } else {
                                            if (SCREENING == "FORM_3") {
                                                var filenamepath = data['filenamepath'];
                                                // var a = document.createElement('a');
                                                // var url = filenamepath;
                                                // a.href = url;
                                                // a.download = url;
                                                // document.body.append(a);
                                                // a.click();
                                                // a.remove();
                                                // window.URL.revokeObjectURL(url);
                                                $('.loader').hide();
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }

            }
        }
    });
});

// Bank Recncilatio ######################################################
function ChqClearDate(idx, UC) {
    var UC = $('#Cheq_Clear' + idx).text();
    if (UC == 'Cleared') {
        var Cheq_Clear_Date = '';
        var id = $('#Cheq_Clear' + idx).attr('data-id');
        $.ajax({
            type: "POST",
            url: '/bank_reconcilition/Update_Cheq_Clear_Date',
            dataType: 'json',
            data: {
                Cheq_Clear_Date: Cheq_Clear_Date,
                id: id
            },
            success: function (data) {
                $('#Cheq_Clear_Date' + idx).val(Cheq_Clear_Date)
                $('#Cheq_Clear' + idx).text('Un-Cleared')
            }
        });
    }
    if (UC == 'Un-Cleared') {
        var data = moment(new Date()).format('DD/MM/YYYY');
        var Cheq_Clear_Date = data;
        var id = $('#Cheq_Clear' + idx).attr('data-id');
        $.ajax({
            type: "POST",
            url: '/bank_reconcilition/Update_Cheq_Clear_Date',
            dataType: 'json',
            data: {
                Cheq_Clear_Date: Cheq_Clear_Date,
                id: id
            },
            success: function (data) {
                $('#Cheq_Clear_Date' + idx).val(Cheq_Clear_Date)
                $('#Cheq_Clear' + idx).text('Cleared')
            }
        });
    }
}

// Bank Recncilation #########################################################################################################################################
$(document).on("keydown", "#getselesentrybank", function (event) {
    if (event.keyCode == 13) $(this).click();
})
$(document).on("click", "#getselesentrybank", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var bankid = $('#bankid').val();
    var Old = $('input[name="Old"]:checked').val();
    var Chq = $('input[name="chq"]:checked').val();
    var d_c = $('input[name="d_c"]:checked').val();
    $('.loader').show();
    $.ajax({
        type: "POST",
        url: '/bank_reconcilition/getsalesentrylistcb',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            bankid: bankid,
            Old: Old,
            Chq: Chq,
            d_c: d_c
        },
        success: function (data) {
            if (data['success'] == true) {
                var transdata = data['transdata'];
                var html = '<div class="row"><div class="col-md-12">';
                html += '<div class="panel panel-primary table light " id="tableportlet">';
                html += '<div class="panel-heading">';
                html += 'Reconciliation';
                html += '</div>';
                html += '<div class="panel-body" id="portletbody">';
                html += '<table class="product_detail_table dttable table table-striped table-bordered table-hover" id="product_detail_table">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>Sno</th>';
                html += '<th>Date</th>';
                html += '<th>VoucherNo</th>';
                html += '<th>Narration</th>';
                html += '<th width="5%">Cheque No</th>';
                html += '<th>Debit</th>';
                html += '<th>Credit</th>';
                html += '<th>Status</th>';
                html += '<th>Cleared On</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                var i = 0;
                console.log(transdata)
                $.each(transdata, function (index, value) {
                    if (transdata) {
                        i++;
                        html += '<tr>';
                        html += '<td>' + i + '</td>';
                        var entry_Date = moment(value.cash_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        html += '<td>' + entry_Date + '</td>';
                        html += '<td>' + value.vouc_code + '/' + value.main_bk + '/' + value.c_j_s_p + '</td>';
                        html += '<td>' + value.cash_narrone + ' ' + value.cash_narrtwo + '</td>';
                        if (value.main_bk == 'CB' || value.main_bk == 'OPBR') html += '<td>' + value.cash_chequeno + '</td>';
                        if (value.main_bk == 'BC') html += '<td>' + value.Chq_No + '</td>';
                        if (value.main_bk == 'CB' || value.main_bk == 'OPBR') {
                            if (value.d_c == 'D') html += '<td>' + value.cash_amount + '</td>';
                            else html += '<td>' + 0 + '</td>';
                            if (value.d_c == 'C') html += '<td>' + value.cash_amount + '</td>';
                            else html += '<td>' + 0 + '</td>';
                        }
                        if (value.main_bk == 'BC') {
                            if (value.d_c == 'D') html += '<td>' + value.Cheq_Amt + '</td>';
                            else html += '<td>' + 0 + '</td>';
                            if (value.d_c == 'C') html += '<td>' + value.Cheq_Amt + '</td>';
                            else html += '<td>' + 0 + '</td>';
                        }
                        if (value.Cheq_Clear_Date == '' || value.Cheq_Clear_Date == null || value.Cheq_Clear_Date == undefined) {
                            html += '<td><a id="Cheq_Clear' + i + '" data-id="' + value._id + '" onclick=ChqClearDate(' + i + ',"U")>Un-Cleared</a></td>';
                            var bill_Date = '';
                        }
                        else {
                            html += '<td><a id="Cheq_Clear' + i + '" data-id="' + value._id + '" onclick=ChqClearDate(' + i + ',"C")>Cleared</a></td>';
                            var bill_Date = moment(value.Cheq_Clear_Date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        }
                        //onchange=dodatepdate("'+value._id+'","'+i+'",this.value)
                        html += '<td><input type="text" name="Cheq_Clear_Date" value="' + bill_Date + '" id="Cheq_Clear_Date' + i + '" autocomplete="off" class="form-control datemask datepickerc"></td>';
                        html += '</tr>';
                    }
                })
                html += '</tbody>';
                html += '<tfoot>';
                html += ' <tr>';
                html += '<th>Sno</th>';
                html += '<th>Date</th>';
                html += '<th>VoucherNo</th>';
                html += '<th>Narration</th>';
                html += '<th width="5%">Cheque No</th>';
                html += '<th>Debit</th>';
                html += '<th>Credit</th>';
                html += '<th>Status</th>';
                html += '<th>Cleared On</th>';
                html += '</tr>';
                html += '</tfoot>';
                html += '</table>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                $('.getsaleslist').html(html);
                $('.datepickerc').datepicker({ format: 'dd/mm/yyyy', autoclose: true })
                // $('.datemask').inputmask("99/99/9999");
                $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                    function resizeInput() {
                        var content =
                            $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }

                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });

                // moving tfoot below head th row
                $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
                table = jQuery('.product_detail_table').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "lengthChange": true,
                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                    "colReorder": true,
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel'
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print'
                        },
                    ],
                    "columnDefs": [
                        {
                            "className": "actioncell",
                            "orderable": false,
                            "searchable": false,
                            "sortable": false,
                            "targets": [0]
                        }
                    ],
                    "order": [1, 'asc'],
                    initComplete: function () {
                        var api = this.api();
                        api.columns().every(function () {
                            var that = this;

                            $('input', this.footer()).on('keyup change', function () {
                                if (that.search() !== this.value) {
                                    that
                                        .column($(this).parent().index() + ':visible')
                                        .search(this.value)
                                        .draw();
                                }
                            });
                        });
                    }
                });
                $('.loader').hide();
            }
        }
    });
});

// Bank Slip #########################################################################################################################################
$(document).on("keydown", "#ShowBankSlip", function (event) {
    if (event.keyCode == 13) $(this).click();
})
$(document).on("click", "#ShowBankSlip", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var bankid = $('#bankid').val();
    var BankName = $('#bankid').text();
    var Drawer = $('input[name="Drawer"]:checked').val();
    $('.loader').show();
    $.ajax({
        type: "POST",
        url: '/bank_reconcilition/ShowBankSlip',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            bankid: bankid,
        },
        success: function (data) {
            if (data['success'] == true) {
                var transdata = data['transdata'];
                var div = data['div'];
                var html = '<div class="row"><div class="col-md-12">';
                html += '<div class="panel panel-primary table light " id="tableportlet">';
                html += '<div class="panel-heading">';
                html += 'Bank Slip';
                html += '</div>';
                html += '<div class="panel-body" id="portletbody">';
                html += '<table class="product_detail_table tabler dttable table table-striped table-bordered table-hover" id="product_detail_table">';
                html += '<thead>';
                html += '<tr>';
                if (Drawer == 'With Drawer') {
                    html += '<th>Name of The Drawer</th>';
                }
                html += '<th>Sno</th>';
                html += '<th>Date</th>';
                html += '<th>Chq No</th>';
                html += '<th>Clrg-Code</th>';
                html += '<th>Name of Drawee Bank</th>';
                html += '<th>Branch</th>';
                html += '<th>Amount</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                var i = 0;
                console.log(transdata)
                $.each(transdata, function (index, value) {
                    if (transdata) {
                        i++;
                        html += '<tr>';
                        if (Drawer == 'With Drawer') {
                            html += '<td style="text-align:left">' + value.cashac_name.ACName + '</td>';
                        }
                        html += '<td style="text-align:center">' + i + '</td>';
                        var entry_Date = moment(value.deposit_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        html += '<td style="text-align:center">' + entry_Date + '</td>';
                        if (value.main_bk == 'CB') html += '<td style="text-align:center">' + value.cash_chequeno + '</td>';
                        if (value.main_bk == 'BC') html += '<td style="text-align:center">' + value.Chq_No + '</td>';

                        if (value.main_bk == 'BC') {
                            var aa = value.Drawee_Bank;
                            if (value.Drawee_Bank == null || value.Drawee_Bank == '' || value.Drawee_Bank == undefined) aa = '';
                            else aa = value.Drawee_Bank.micrCode;
                            html += '<td style="text-align:center">' + aa + '</td>';
                        }
                        if (value.main_bk == 'CB') html += '<td></td>';

                        if (value.main_bk == 'BC') {
                            var aa = value.Drawee_Bank;
                            if (value.Drawee_Bank == null || value.Drawee_Bank == '' || value.Drawee_Bank == undefined) aa = '';
                            else aa = value.Drawee_Bank.bankName;
                            html += '<td>' + aa + '</td>';
                        }
                        if (value.main_bk == 'CB') html += '<td></td>';

                        if (value.main_bk == 'BC') {
                            var aa = value.Drawee_Bank;
                            if (value.Drawee_Bank == null || value.Drawee_Bank == '' || value.Drawee_Bank == undefined) aa = '';
                            else aa = value.Drawee_Bank.branchName;
                            html += '<td>' + aa + '</td>';
                        }
                        if (value.main_bk == 'CB') html += '<td></td>';

                        if (value.main_bk == 'CB') {
                            html += '<td style="text-align:right">' + value.cash_amount + '</td>';
                        }
                        if (value.main_bk == 'BC') {
                            html += '<td style="text-align:right">' + value.Cheq_Amt + '</td>';
                        }

                        html += '</tr>';
                    }
                })
                html += '</tbody>';
                html += '<tfoot>';
                html += ' <tr>';
                if (Drawer == 'With Drawer') {
                    html += '<th>Name of The Drawer</th>';
                }
                html += '<th>Sno</th>';
                html += '<th>Date</th>';
                html += '<th>Chq No</th>';
                html += '<th>Clrg-Code</th>';
                html += '<th style="">Name of Drawee Bank</th>';
                html += '<th>Branch</th>';
                html += '<th>Amount</th>';
                html += '</tr>';
                html += '</tfoot>';
                html += '</table>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                $('.getsaleslist').html(html);
                $('.datepickerc').datepicker({ format: 'dd/mm/yyyy', autoclose: true })
                // $('.datemask').inputmask("99/99/9999");
                $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                    function resizeInput() {
                        var content =
                            $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }

                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });

                // moving tfoot below head th row
                $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
                table = jQuery('.product_detail_table').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "lengthChange": true,
                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                    "colReorder": true,
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel'
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print',
                            title: '<center style="font-size:15px">Current A/C pay-in-slip</br><b style="margin-top:5px">' + BankName + '</b></br>'
                                + 'Paid in to the credit of the Current Account of</br>' + div.div_mast + '</center>'
                                + '<b style="font-size:15px;float:left">Current A/C No : ' + div.bank2 + '</b>'
                                + '<b style="font-size:15px;float:right">Date : </b>',
                        },
                    ],
                    "columnDefs": [
                        {
                            "className": "actioncell",
                            "orderable": false,
                            "searchable": false,
                            "sortable": false,
                            "targets": [0]
                        }
                    ],
                    "order": [1, 'asc'],
                    initComplete: function () {
                        var api = this.api();
                        api.columns().every(function () {
                            var that = this;

                            $('input', this.footer()).on('keyup change', function () {
                                if (that.search() !== this.value) {
                                    that
                                        .column($(this).parent().index() + ':visible')
                                        .search(this.value)
                                        .draw();
                                }
                            });
                        });
                    }
                });
                $('.loader').hide();
            }
        }
    });
});

// Chaq Return Ragister #########################################################################################################################################
$(document).on("keydown", "#ShowChaqReturnRegister", function (event) {
    if (event.keyCode == 13) $(this).click();
})
$(document).on("click", "#ShowChaqReturnRegister", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    // var bankid = $('#bankid').val();
    // var BankName = $('#bankid').text();
    $('.loader').show();
    $.ajax({
        type: "POST",
        url: '/bank_reconcilition/ShowChaqReturnRegister',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            // bankid: bankid,
        },
        success: function (data) {
            if (data['success'] == true) {
                var transdata = data['transdata'];
                var div = data['div'];
                var html = '<div class="row"><div class="col-md-12">';
                html += '<div class="panel panel-primary table light " id="tableportlet">';
                html += '<div class="panel-heading">';
                html += 'Chaq Return Register';
                html += '</div>';
                html += '<div class="panel-body" id="portletbody">';
                html += '<table class="product_detail_table tabler dttable table table-striped table-bordered table-hover" id="product_detail_table">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>Name of Party</th>';
                html += '<th>Sno</th>';
                html += '<th>Date</th>';
                html += '<th>Chq No</th>';
                html += '<th>Clrg-Code</th>';
                html += '<th>Name of Drawee Bank</th>';
                html += '<th>Branch</th>';
                html += '<th>Amount</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                var i = 0;
                console.log(transdata)
                $.each(transdata, function (index, value) {
                    if (transdata) {
                        i++;
                        html += '<tr>';
                        html += '<td style="text-align:left">' + value.cashac_name.ACName + '</td>';
                        html += '<td style="text-align:center">' + i + '</td>';
                        var entry_Date = moment(value.deposit_date).tz("Asia/Kolkata").format('DD/MM/YYYY');
                        html += '<td style="text-align:center">' + entry_Date + '</td>';
                        if (value.main_bk == 'CB') html += '<td style="text-align:center">' + value.cash_chequeno + '</td>';
                        if (value.main_bk == 'BC') html += '<td style="text-align:center">' + value.Chq_No + '</td>';

                        if (value.main_bk == 'BC') {
                            var aa = value.Drawee_Bank;
                            if (value.Drawee_Bank == null || value.Drawee_Bank == '' || value.Drawee_Bank == undefined) aa = '';
                            else aa = value.Drawee_Bank.micrCode;
                            html += '<td style="text-align:center">' + aa + '</td>';
                        }
                        if (value.main_bk == 'CB') html += '<td></td>';

                        if (value.main_bk == 'BC') {
                            var aa = value.Drawee_Bank;
                            if (value.Drawee_Bank == null || value.Drawee_Bank == '' || value.Drawee_Bank == undefined) aa = '';
                            else aa = value.Drawee_Bank.bankName;
                            html += '<td>' + aa + '</td>';
                        }
                        if (value.main_bk == 'CB') html += '<td></td>';

                        if (value.main_bk == 'BC') {
                            var aa = value.Drawee_Bank;
                            if (value.Drawee_Bank == null || value.Drawee_Bank == '' || value.Drawee_Bank == undefined) aa = '';
                            else aa = value.Drawee_Bank.branchName;
                            html += '<td>' + aa + '</td>';
                        }
                        if (value.main_bk == 'CB') html += '<td></td>';

                        if (value.main_bk == 'CB') {
                            html += '<td style="text-align:right">' + value.cash_amount + '</td>';
                        }
                        if (value.main_bk == 'BC') {
                            html += '<td style="text-align:right">' + value.Cheq_Amt + '</td>';
                        }
                        html += '</tr>';
                    }
                })
                html += '</tbody>';
                html += '<tfoot>';
                html += ' <tr>';
                html += '<th>Name of Party</th>';
                html += '<th>Sno</th>';
                html += '<th>Date</th>';
                html += '<th>Chq No</th>';
                html += '<th>Clrg-Code</th>';
                html += '<th style="">Name of Drawee Bank</th>';
                html += '<th>Branch</th>';
                html += '<th>Amount</th>';
                html += '</tr>';
                html += '</tfoot>';
                html += '</table>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                $('.getShowChaqReturnRegister').html(html);
                $('.datepickerc').datepicker({ format: 'dd/mm/yyyy', autoclose: true })
                // $('.datemask').inputmask("99/99/9999");
                $('#product_detail_table tfoot th').not('.excludesearch').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text"  class="form-control resizing-input" placeholder="Search " autocomplete="false" />');
                    function resizeInput() {
                        var content =
                            $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder").length;
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }

                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });

                // moving tfoot below head th row
                $('#product_detail_table tfoot').insertBefore('#product_detail_table thead');
                table = jQuery('.product_detail_table').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "lengthChange": true,
                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                    "colReorder": true,
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel'
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print',
                            // title: '<center style="font-size:15px">Current A/C pay-in-slip</br><b style="margin-top:5px">'+BankName+'</b></br>'
                            // +'Paid in to the credit of the Current Account of</br>'+div.div_mast+'</center>'
                            // +'<b style="font-size:15px;float:left">Current A/C No : '+div.bank2+'</b>'
                            // +'<b style="font-size:15px;float:right">Date : </b>',
                        },
                    ],
                    "columnDefs": [
                        {
                            "className": "actioncell",
                            "orderable": false,
                            "searchable": false,
                            "sortable": false,
                            "targets": [0]
                        }
                    ],
                    "order": [1, 'asc'],
                    initComplete: function () {
                        var api = this.api();
                        api.columns().every(function () {
                            var that = this;

                            $('input', this.footer()).on('keyup change', function () {
                                if (that.search() !== this.value) {
                                    that
                                        .column($(this).parent().index() + ':visible')
                                        .search(this.value)
                                        .draw();
                                }
                            });
                        });
                    }
                });
                $('.loader').hide();
            }
        }
    });
});

// Tax Voucher #############################################################################################################################################
function getAccountData() {
    var Account = $('#Deductee').val();
    $.ajax({
        type: 'GET',
        url: '/Tax_Voucher/AccountData',
        dataType: 'json',
        data: {
            Account: Account,
        },
        success: function (data) {
            if (data['success']) {
                var Account = data['Account'];
                $('#GSTIN').val(Account.GSTIN);
                $('#bill_No').focus();
            }
        }
    });
}
function setSameAmtInTdsOn() {
    $('#TDS_On').val($('#Basic_Amt').val());
}
function getTaxMasterData() {
    var TaxType = $('#Tax_Type').val();
    $.ajax({
        type: 'GET',
        url: '/Tax_Voucher/getTaxMasterData',
        dataType: 'json',
        data: {
            TaxType: TaxType,
        },
        success: function (data) {
            if (data['success']) {
                var TaxType = data['TaxType'];
                $('#TDS_Per').val(TaxType.tx_TDS);
                $('#GST_Per').val(TaxType.tx_GST)
                $('#Narration').focus();
            }
        }
    });
}
async function createTaxEntry(e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        createTaxEntryOnClick();
    }
}
function showCreateTaxEntryReset() {
    var values = $("input[name='TaxVouchArrIndex']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    for (let i = 0; i <= idx; i++) {
        $('#debit' + i).val(0);
        $('#credit' + i).val(0);
        $('#cash_narrone' + i).val('');
        $('#accountName' + i).val('');
    }
    $('#TaxVoucherArrTable').remove();
}
async function createTaxEntryOnClick() {
    var TaxType = $('#Tax_Type').val();
    var party = $("#Deductee").val();
    if (TaxType != null) {
        $.ajax({
            type: 'GET',
            url: '/Tax_Voucher/getTaxMasterData',
            dataType: 'json',
            data: {
                TaxType: TaxType,
            },
            success: function (data) {
                if (data['success']) {
                    var TaxType = data['TaxType'];
                    $.ajax({
                        type: 'GET',
                        url: '/Garu_Aavak_Entry/chackstate/' + party,
                        dataType: 'json',
                        success: function (data) {
                            var ExpenseAc_Id = $('#ExpenseAc').val();
                            var ExpenseAc_Name = $('#ExpenseAc option:selected').html();
                            var Deductee_Id = $('#Deductee').val();
                            var Deductee_Name = $('#Deductee option:selected').html();
                            var Basic_Amt = $('#Basic_Amt').val();
                            var TDS_Per = $('#TDS_Per').val();
                            var GST_Per = $('#GST_Per').val();
                            var TDS_AcName = '';
                            var TDS_Acid = '';
                            if (TaxType.tx_TDSAC != null) {
                                TDS_Acid = TaxType.tx_TDSAC._id;
                                TDS_AcName = TaxType.tx_TDSAC.ACName;
                            }
                            var tx_SGSTR_AcName = '';
                            var tx_SGSTR_Acid = '';
                            if (TaxType.tx_SGSTR != null) {
                                tx_SGSTR_Acid = TaxType.tx_SGSTR._id;
                                tx_SGSTR_AcName = TaxType.tx_SGSTR.ACName;
                            }
                            var tx_SGSTP_AcName = '';
                            var tx_SGSTP_Acid = '';
                            if (TaxType.tx_SGSTP != null) {
                                tx_SGSTP_Acid = TaxType.tx_SGSTP._id;
                                tx_SGSTP_AcName = TaxType.tx_SGSTP.ACName;
                            }
                            var tx_CGSTR_AcName = '';
                            var tx_CGSTR_Acid = '';
                            if (TaxType.tx_CGSTR != null) {
                                tx_CGSTR_Acid = TaxType.tx_CGSTR._id;
                                tx_CGSTR_AcName = TaxType.tx_CGSTR.ACName;
                            }
                            var tx_CGSTP_AcName = '';
                            var tx_CGSTP_Acid = '';
                            if (TaxType.tx_CGSTP != null) {
                                tx_CGSTP_Acid = TaxType.tx_CGSTP._id;
                                tx_CGSTP_AcName = TaxType.tx_CGSTP.ACName;
                            }
                            var tx_IGSTR_AcName = '';
                            var tx_IGSTR_Acid = '';
                            if (TaxType.tx_IGSTR != null) {
                                tx_IGSTR_Acid = TaxType.tx_IGSTR._id;
                                tx_IGSTR_AcName = TaxType.tx_IGSTR.ACName;
                            }
                            var tx_IGSTP_AcName = '';
                            var tx_IGSTP_Acid = '';
                            if (TaxType.tx_IGSTP != null) {
                                tx_IGSTP_Acid = TaxType.tx_IGSTP._id;
                                tx_IGSTP_AcName = TaxType.tx_IGSTP.ACName;
                            }

                            var html = '';
                            var Count = 1;
                            html += '<table class="table tabler table-bordered adsearch" id="TaxVoucherArrTable">';
                            html += '<thead>';
                            html += '<tr>';
                            html += '<th style="width:8px;">Sno</th>';
                            html += '<th style="width:40em;">Account</th>';
                            html += '<th>Amount</th>';
                            html += '<th>Amount</th>';
                            html += '<th style="width:20em;">Remark</th>';
                            html += '<th>Delete</th>';
                            html += '</tr>';
                            html += '</thead>';
                            html += '<tbody>';

                            var totAmt = 0;
                            if (tx_SGSTP_AcName == '' && tx_CGSTP_AcName == '' && tx_IGSTP_AcName == '') {
                                var gstAmt = Basic_Amt * GST_Per / 100;
                                totAmt = parseFloat(Basic_Amt) + parseFloat(gstAmt)
                            }
                            if (tx_SGSTP_AcName != '' && tx_CGSTP_AcName != '' && tx_IGSTP_AcName != '') {
                                totAmt = Basic_Amt
                            }
                            //Expense
                            var index = 0;
                            var remark1 = (Deductee_Name).trim() + ' ' + Basic_Amt;
                            html += '<tr id="deleteTaxVouchArr' + index + '">';
                            html += '<td style="text-align:center">' + (Count++) + '</td>';
                            html += '<td><input type="text" class="form-control" id="accountName' + index + '" value="' + (ExpenseAc_Name).trim() + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + ExpenseAc_Id + '"></td>';
                            html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + Basic_Amt + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                            html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                            html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark1 + '" style="text-align:left"></td>';
                            html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                            html += '</tr>';

                            //deductee
                            index = index + 1;
                            var remark2 = (ExpenseAc_Name).trim() + ' ' + Basic_Amt;
                            html += '<tr id="deleteTaxVouchArr' + index + '">';
                            html += '<td style="text-align:center">' + (Count++) + '</td>';
                            html += '<td><input type="text" class="form-control" id="accountName' + index + '" value="' + (Deductee_Name).trim() + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + Deductee_Id + '"></td>';
                            html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                            html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + totAmt + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                            html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark2 + '" style="text-align:left"></td>';
                            html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                            html += '</tr>';

                            //TDS
                            if (TDS_Per > 0) {
                                index = index + 1;
                                var remark3 = TDS_AcName + ' @' + TDS_Per;
                                html += '<tr id="deleteTaxVouchArr' + index + '">';
                                html += '<td style="text-align:center">' + (Count++) + '</td>';
                                html += '<td><input type="text" class="form-control" id="accountName' + index + '" value="' + (Deductee_Name).trim() + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + Deductee_Id + '"></td>';
                                html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + (Basic_Amt * TDS_Per / 100) + '" oninput="calCrDrAmtInTaxVouc()" data-Tds="TDS" onkeydown="calTDSdebit(' + index + ')"></td>';
                                html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()" data-Tds="TDS" onkeydown="calTDScredit(' + index + ')"></td>';
                                html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark3 + '" style="text-align:left"></td>';
                                html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                                html += '</tr>';
                                var TDS_Amount = Basic_Amt * TDS_Per / 100;
                                if (TDS_Amount == '' || TDS_Amount == null || TDS_Amount == isNaN(TDS_Amount)) $('#TDS_Amt').val(0);
                                else $('#TDS_Amt').val(TDS_Amount);
                                index = index + 1;
                                var remark4 = (Deductee_Name).trim() + ' @' + TDS_Per;
                                html += '<tr id="deleteTaxVouchArr' + index + '">';
                                html += '<td style="text-align:center">' + (Count++) + '</td>';
                                html += '<td><input class="form-control" id="accountName' + index + '" value="' + TDS_AcName + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + TDS_Acid + '"></td>';
                                html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()" data-Tds="TDS" onkeydown="calTDSdebit(' + index + ')"></td>';
                                html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + (Basic_Amt * TDS_Per / 100) + '" oninput="calCrDrAmtInTaxVouc()" data-Tds="TDS" onkeydown="calTDScredit(' + index + ')"></td>';
                                html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark4 + '" style="text-align:left"></td>';
                                html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                                html += '</tr>';

                                var NetPayAmt = parseFloat(totAmt) - parseFloat(Basic_Amt * TDS_Per / 100);
                                $('#cash_amount').val(NetPayAmt);
                            }
                            //GST
                            if (GST_Per > 0) {
                                if (data['success'] == 'true') {
                                    if (tx_SGSTR_AcName != '') {
                                        index = index + 1;
                                        var remark5 = tx_SGSTR_AcName + ' @' + (GST_Per / 2);
                                        html += '<tr id="deleteTaxVouchArr' + index + '">';
                                        html += '<td style="text-align:center">' + (Count++) + '</td>';
                                        html += '<td><input class="form-control" id="accountName' + index + '" value="' + tx_SGSTR_AcName + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + tx_SGSTR_Acid + '"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + (Basic_Amt * (GST_Per / 2) / 100) + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark5 + '" style="text-align:left"></td>';
                                        html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                                        html += '</tr>';
                                    }
                                    if (tx_CGSTR_AcName != '') {
                                        index = index + 1;
                                        var remark7 = tx_CGSTR_AcName + ' @' + (GST_Per / 2);
                                        html += '<tr id="deleteTaxVouchArr' + index + '">';
                                        html += '<td style="text-align:center">' + (Count++) + '</td>';
                                        html += '<td><input class="form-control" id="accountName' + index + '" value="' + tx_CGSTR_AcName + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + tx_CGSTR_Acid + '"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + (Basic_Amt * (GST_Per / 2) / 100) + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark7 + '" style="text-align:left"></td>';
                                        html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                                        html += '</tr>';
                                    }

                                    if (tx_SGSTP_AcName != '') {
                                        index = index + 1;
                                        var remark6 = tx_SGSTP_AcName + ' @' + (GST_Per / 2);
                                        html += '<tr id="deleteTaxVouchArr' + index + '">';
                                        html += '<td style="text-align:center">' + (Count++) + '</td>';
                                        html += '<td><input class="form-control" id="accountName' + index + '" value="' + tx_SGSTP_AcName + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + tx_SGSTP_Acid + '"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + (Basic_Amt * (GST_Per / 2) / 100) + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark6 + '" style="text-align:left"></td>';
                                        html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                                        html += '</tr>';
                                    }
                                    if (tx_CGSTP_AcName != '') {
                                        index = index + 1;
                                        var remark8 = tx_CGSTP_AcName + ' @' + (GST_Per / 2);
                                        html += '<tr id="deleteTaxVouchArr' + index + '">';
                                        html += '<td style="text-align:center">' + (Count++) + '</td>';
                                        html += '<td><input class="form-control" id="accountName' + index + '" value="' + tx_CGSTP_AcName + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + tx_CGSTP_Acid + '"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + (Basic_Amt * (GST_Per / 2) / 100) + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark8 + '" style="text-align:left"></td>';
                                        html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                                        html += '</tr>';
                                    }

                                }
                                if (data['success'] == 'false') {
                                    if (tx_IGSTR_AcName != '') {
                                        index = index + 1;
                                        var remark9 = tx_IGSTR_AcName + ' @' + GST_Per;
                                        html += '<tr id="deleteTaxVouchArr' + index + '">';
                                        html += '<td style="text-align:center">' + (Count++) + '</td>';
                                        html += '<td><input class="form-control" id="accountName' + index + '" value="' + tx_IGSTR_AcName + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + tx_IGSTR_Acid + '"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + (Basic_Amt * GST_Per / 100) + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark9 + '" style="text-align:left"></td>';
                                        html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                                        html += '</tr>';
                                    }

                                    if (tx_IGSTP_AcName != '') {
                                        index = index + 1;
                                        var remark10 = tx_IGSTP_AcName + ' @' + GST_Per;
                                        html += '<tr id="deleteTaxVouchArr' + index + '">';
                                        html += '<td style="text-align:center">' + (Count++) + '</td>';
                                        html += '<td><input class="form-control" id="accountName' + index + '" value="' + tx_IGSTP_AcName + '" readonly><input type="hidden" name="Tax_Voucher_Arr[' + index + '][cashac_name]" id="cashac_name' + index + '" value="' + tx_IGSTP_Acid + '"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][debit]" id="debit' + index + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + index + '][credit]" id="credit' + index + '" value="' + (Basic_Amt * GST_Per / 100) + '" oninput="calCrDrAmtInTaxVouc()"></td>';
                                        html += '<td><input type="text"   class="form-control" name="Tax_Voucher_Arr[' + index + '][cash_narrone]" id="cash_narrone' + index + '" value="' + remark10 + '" style="text-align:left"></td>';
                                        html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + index + "'><a onclick='deleteTaxVouchArr(" + index + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                                        html += '</tr>';
                                    }
                                }
                            }
                            html += '<tr id="AddBeforeTaxVoucher"></tr>';
                            html += '</tbody>';
                            html += '<tfoot>';
                            html += '<tr>';
                            html += '<td style="text-align:center"></td>';
                            html += '<td></td>';
                            html += '<td><input type="number" class="form-control" name="Tot_Debit" id="Tot_Debit" readonly></td>';
                            html += '<td><input type="number" class="form-control" name="Tot_Credit" id="Tot_Credit" readonly></td>';
                            html += '<td></td>';
                            html += '<td></td>';
                            html += '</tr>';
                            html += '</tfoot>';
                            html += '</table>';
                            $('#showCreateTaxEntry').html(html);
                            var Tot_debit = 0;
                            var Tot_credit = 0;
                            // setTimeout(function () {
                            for (let i = 0; i < 10; i++) {
                                var debit = $('#debit' + i).val();
                                var credit = $('#credit' + i).val();
                                if (debit == null || debit == '' || debit == undefined || isNaN(debit)) debit = 0;
                                if (credit == null || credit == '' || credit == undefined || isNaN(credit)) credit = 0;
                                Tot_debit = Tot_debit + parseFloat(debit);
                                Tot_credit = Tot_credit + parseFloat(credit);
                            }
                            $('#Tot_Debit').val(Tot_debit.toFixed(2));
                            $('#Tot_Credit').val(Tot_credit.toFixed(2));
                            // }, 2000);

                            $('#cash_narrone' + index).addClass('amountfocus');
                            $('#cash_narrone' + index).focus();
                        }
                    });
                }
            }
        });
    } else {
        swal({
            title: "Tax Voucher",
            text: "Please Select Tax Voucher",
            icon: "warning",
            timer: 1000,
            buttons: false
        })
    }
}
// function setNetPayAmount(TDSAmt){
//     var deducteeAmt = $('#credit1').val();
//     if(deducteeAmt == null || deducteeAmt == '' || deducteeAmt== undefined || isNaN(deducteeAmt))deducteeAmt = 0;
//     var NetPayAmt = parseFloat(deducteeAmt)-parseFloat(TDSAmt)
//     $('#cash_amount').val(NetPayAmt)
// }
// function calTDSdebit(index){
//     setTimeout(function () {
//         $('#TDS_Amt').val($('#debit'+index).val());
//         setNetPayAmount($('#debit'+index).val())
//     }, 1000);
// }
// function calTDScredit(index){
//     setTimeout(function () {
//         $('#TDS_Amt').val($('#credit'+index).val());
//         setNetPayAmount($('#credit'+index).val())
//     }, 1000);
// }
function calCrDrAmtInTaxVouc() {
    var Tot_debit = 0;
    var Tot_credit = 0;
    var prev_Tds = $('#TDS_Amt').val();
    var count = 0;
    var values = $("input[name='TaxVouchArrIndex']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var lastidxTax = parseInt(idx) + 1;
    for (let i = 0; i < lastidxTax; i++) {
        var debit = $('#debit' + i).val();
        var credit = $('#credit' + i).val();
        if (debit == null || debit == '' || debit == undefined || isNaN(debit)) debit = 0;
        if (credit == null || credit == '' || credit == undefined || isNaN(credit)) credit = 0;
        if (count == 0) {
            if ($('#debit' + i).attr('data-tds') == 'TDS') {
                $('#TDS_Amt').val(debit);
                count = count + 1;
                var deducteeAmt = $('#credit1').val();
                if (deducteeAmt == null || deducteeAmt == '' || deducteeAmt == undefined || isNaN(deducteeAmt)) deducteeAmt = 0;
                var NetPayAmt = parseFloat(deducteeAmt) - parseFloat(debit);
                $('#cash_amount').val(NetPayAmt)
            }
        }
        // if(debit>prev_Tds){
        //     if($('#debit'+i).attr('data-tds') == 'TDS')$('#TDS_Amt').val(debit);
        //     prev_Tds = debit;
        // }
        // if(credit>prev_Tds){
        //     if($('#credit'+i).attr('data-tds') == 'TDS')$('#TDS_Amt').val(credit);
        //     prev_Tds = credit;
        // }
        Tot_debit = Tot_debit + parseFloat(debit);
        Tot_credit = Tot_credit + parseFloat(credit);
    }
    $('#Tot_Debit').val(Tot_debit.toFixed(2));
    $('#Tot_Credit').val(Tot_credit.toFixed(2));
}

$(document).on('click', '.addTaxVoucher', function () {
    var values = $("input[name='TaxVouchArrIndex']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var lastidxTax = parseInt(idx) + 1;
    var html = '';
    html += '<tr id="deleteTaxVouchArr' + lastidxTax + '">';
    html += '<td style="text-align:center">' + (lastidxTax + 1) + '</td>';
    html += '<td><select class="form-control AllAccount selectproductfocus productplace" name="Tax_Voucher_Arr[' + lastidxTax + '][cashac_name]" id="cashac_name' + lastidxTax + '" style="width:100%"></select></td>';
    html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + lastidxTax + '][debit]" id="debit' + lastidxTax + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
    html += '<td><input type="number" class="form-control" name="Tax_Voucher_Arr[' + lastidxTax + '][credit]" id="credit' + lastidxTax + '" value="' + 0 + '" oninput="calCrDrAmtInTaxVouc()"></td>';
    html += '<td><input type="text"   class="form-control amountfocus" name="Tax_Voucher_Arr[' + lastidxTax + '][cash_narrone]" id="cash_narrone' + lastidxTax + '" style="text-align:left"></td>';
    html += "<td><input type='hidden' name='TaxVouchArrIndex' value='" + lastidxTax + "'><a onclick='deleteTaxVouchArr(" + lastidxTax + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
    html += '</tr>';
    $(html).insertBefore("#AddBeforeTaxVoucher");
    $('.AllAccount').select2({
        placeholder: 'Please Select',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/AllAccount',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
})
$(document).on('click', '.delete_Tax_Voucher', function () {
    let id = $(this).attr('data-id');
    swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'GET',
                url: '/Tax_Voucher/delete/' + id,
                success: function (response) {

                    window.location.href = '/Tax_Voucher/Tax_Voucher_List';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    })
});
function deleteTaxVouchArr(idx) {
    swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            if ($('#Trans_Entry_id' + idx).val() == '' || $('#Trans_Entry_id' + idx).val() == null || $('#Trans_Entry_id' + idx).val() == undefined) {
                $('#deleteTaxVouchArr' + idx).remove();
            } else {
                var id = $('#Trans_Entry_id' + idx).val();
                $.ajax({
                    type: 'GET',
                    url: '/Tax_Voucher/delete_Trans_Entry/' + id,
                    success: function (response) {
                        $('#deleteTaxVouchArr' + idx).remove();
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            }

        }
    })
}

// Tds Challan #########################################################################################################################################################################
$(document).on("keydown", "#ShowTds_Challan_List", function (event) {
    $(this).click()
})
$(document).on("click", "#ShowTds_Challan_List", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);

    var division = $('#Division').val();
    var challan_No = $("input[name='challan_No']:checked").val();
    var party = $('#party').val();
    var Tax_Type = $('#Tax_Type').val();
    $('.loader').show();
    $.ajax({
        type: "GET",
        url: '/Tax_Voucher/ShowTds_Challan_List',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            party: party,
            Tax_Type: Tax_Type,
            challan_No: challan_No,
            division: division,
        },
        success: function (data) {
            if (data['success'] == true) {
                if (data.Tax_Voucher == '' || data.Tax_Voucher == null) $('.loader').hide();
                var html = '<div class="showsearchdata">';
                html += '<div class="row">';
                html += '<div class="col-md-12">';
                html += '<div class="table-responsive">';
                html += '<div class="row" style="margin-bottom:10px;margin-left:3px;"><button class="btn btn-success" onclick="UpdateTaxVoucherModal()">Update</button></div>'
                html += '<table id="userTable" class="userTable table table-striped table-bordered table-hover adsearch">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>Select</th>';
                html += '<th>Yr</th>';
                html += '<th>Book</th>';
                html += '<th>Entry No</th>';
                html += '<th>Date</th>';
                html += '<th>Party Name</th>';
                html += '<th>Station</th>';
                html += '<th>TDS Ac</th>';
                html += '<th>Bill Amt</th>';
                html += '<th>TDS Amount</th>';
                html += '<th>Chl No</th>';
                html += '<th>Chl Dt</th>';
                html += '<th>Bank</th>';
                html += '<th>Bsr Code</th>';
                html += '<th>Chq No</th>';
                html += '<th>Chq Dt</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                $.each(data.Tax_Voucher, function (index, value) {
                    html += "<tr>";
                    html += "<td style='text-align: center'><input type='checkbox' name='UpdateTaxVoucherCheckbox' id='UpdateTaxVoucherCheckbox" + index + "' data-TDS='" + (value.Basic_Amt * value.TDS_Per / 100) + "' value='" + value._id + "'></td>";
                    html += "<td style='text-align: center'>" + moment(value.entry_Date).format('YY') + "</td>";
                    html += "<td style='text-align: center'>" + value.c_j_s_p + "</td>";
                    html += "<td style='text-align: center'>" + value.vouc_code + "</td>";
                    html += "<td style='text-align: center'>" + moment(value.entry_Date).format('DD/MM/YYYY') + "</td>";
                    html += "<td style='text-align: left'>" + value.Deductee.ACName + "</td>";
                    html += "<td style='text-align: left'>" + value.Deductee.CityName.CityName + "</td>";
                    html += "<td style='text-align: left'>" + value.Tax_Type.tx_TDSAC.ACName + "</td>";
                    html += "<td style='text-align: right'>" + value.Basic_Amt + "</td>";
                    if (value.TDS_Amt == null || value.TDS_Amt == '' || value.TDS_Amt == undefined) value.TDS_Amt = 0;
                    html += "<td style='text-align: right'>" + value.TDS_Amt + "</td>"; //TDS Amount
                    var challan_no = '';
                    if (value.challan_no == null || value.challan_no == '' || value.challan_no == undefined) challan_no = '';
                    else challan_no = value.challan_no;
                    html += "<td style='text-align: left'>" + challan_no + "</td>";
                    var challan_date = '';
                    if (value.challan_date == null || value.challan_date == '' || value.challan_date == undefined) challan_date = '';
                    else challan_date = moment(value.challan_date).format('DD/MM/YYYY');
                    html += "<td style='text-align: left'>" + challan_date + "</td>";
                    var BankName = '';
                    if (value.Bank == null || value.Bank == '' || value.Bank == undefined) BankName = '';
                    else BankName = value.Bank.ACName;
                    html += "<td style='text-align: left'>" + BankName + "</td>";
                    var BSR_Code = '';
                    if (value.BSR_Code == null || value.BSR_Code == '' || value.BSR_Code == undefined) BSR_Code = '';
                    else BSR_Code = value.BSR_Code;
                    html += "<td style='text-align: left'>" + BSR_Code + "</td>";
                    var Chq_No = '';
                    if (value.Chq_No == null || value.Chq_No == '' || value.Chq_No == undefined) Chq_No = '';
                    else Chq_No = value.Chq_No;
                    html += "<td style='text-align: left'>" + Chq_No + "</td>";
                    var Chq_Date = '';
                    if (value.Chq_Date == null || value.Chq_Date == '' || value.Chq_Date == undefined) Chq_Date = '';
                    else Chq_Date = value.Chq_Date;
                    html += "<td style='text-align: left'>" + Chq_Date + "</td>";
                    html += "</tr>"
                });
                html += '</tbody>';
                html += '<tfoot>';
                html += '<tr>';
                html += '<th class="excludesearch"></th>';
                html += '<th>Yr</th>';
                html += '<th>Book</th>';
                html += '<th>Entry No</th>';
                html += '<th>Date</th>';
                html += '<th>Party Name</th>';
                html += '<th>Station</th>';
                html += '<th>TDS Ac</th>';
                html += '<th>Bill Amt</th>';
                html += '<th>TDS Amount</th>';
                html += '<th>Chl No</th>';
                html += '<th>Chl Dt</th>';
                html += '<th>Bank</th>';
                html += '<th>Bsr Code</th>';
                html += '<th>Chq No</th>';
                html += '<th>Chq Dt</th>';
                html += '</tfoot>';
                html += '</table>';
                $("#TDS_Challan_list").html(html);

                dattable = jQuery('.userTable').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "processing": false,
                    "serverSide": false,
                    "colReorder": true,
                    "autoWidth": false,
                    "ordering": false,
                    "paging": false,
                    // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf',
                            exportOptions: {

                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                            footer: true,
                            orientation: 'landscape',
                            customize: function (doc) {
                                doc.content.splice(0, 0, {
                                    margin: [0, 0, 0, 12],
                                    alignment: 'center',
                                    text: 'Soft Sauda'
                                });
                            },
                            messageBottom: 'Exported from Soft Sauda'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                    ],
                    "order": [1, 'asc'],
                    "columnDefs": [{
                        "className": "actioncell",
                        "orderable": false,
                        "searchable": false,
                        "sortable": false,
                        "targets": [0],
                        "width": "5%"
                    }],
                })
                $('#userTable tfoot th').not('.excludesearch').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                    function resizeInput() {
                        var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }
                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });
                $('#userTable tfoot').insertBefore('#userTable thead');
                dattable.columns().every(function () {
                    var that = this;
                    $('input', this.footer()).on('keyup change clear', function () {
                        if (that.search() !== this.value) {
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                });
                $('.loader').hide();
            }
        }
    });
});
$(document).on("click", "#ShowTds_Challan_List_Return", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);

    var division = $('#Division').val();
    var challan_No = $("input[name='challan_No']:checked").val();
    var party = $('#party').val();
    var Tax_Type = $('#Tax_Type').val();
    $('.loader').show();
    $.ajax({
        type: "GET",
        url: '/Tax_Voucher/ShowTds_Challan_List',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            party: party,
            Tax_Type: Tax_Type,
            challan_No: challan_No,
            division: division,
        },
        success: function (data) {
            if (data['success'] == true) {
                if (data.Tax_Voucher == '' || data.Tax_Voucher == null) $('.loader').hide();
                var html = '<div class="showsearchdata">';
                html += '<div class="row">';
                html += '<div class="col-md-12">';
                html += '<div class="table-responsive">';
                html += '<div class="row" style="margin-bottom:10px;margin-left:3px;"><button class="btn btn-success" onclick="UpdateTaxVoucherModal()">Update</button></div>'
                html += '<table id="userTable" class="userTable table table-striped table-bordered table-hover adsearch">';
                html += '<thead>';
                html += '<tr>';
                html += '<th></th>';
                html += '<th>Challan</br>Serial</br>No</th>';
                html += '<th>Section</br>Code</th>';
                html += '<th>Deductee</br>Code</th>';
                html += '<th>Permanent</br>Account Number(PAN)</br>of deductee</th>';
                html += '<th>Deductee</br>Ref. No. /</br>PAN Ref. No.</th>';
                html += '<th>Name of Deductee</th>';
                html += '<th>Deductee</br>Address1</th>';
                html += '<th>Deductee</br>Address2</th>';
                html += '<th>Deductee</br>Address3</th>';
                html += '<th>Deductee</br>Address4</th>';
                html += '<th>Deductee</br>Address5</th>';
                html += '<th>Deductee</br>State</th>';
                html += '<th>Deductee</br>Pin</th>';
                html += '<th>Amount of</br>Payment</th>';
                html += '<th>Date on</br>which Amount</br>paid / credited</th>';
                html += '<th>Rate at</br>which Tax</br>deducted</th>';
                html += '<th>Surcharge</br>Rate</th>';
                html += '<th>Education</br>Cess Rate</th>';
                html += '<th>Secondary &</br>Higher Education</br>Cess Rate</th>';
                html += '<th>Paid by</br>Book Entry</th>';
                html += '<th>Amount of</br>Tax deducted</th>';
                html += '<th>Surcharge</br>Amount</th>';
                html += '<th>Education</br>Cess Amount</th>';
                html += '<th>Secondary &</br>Higher Education</br>Cess Amount</th>';
                html += '<th>Total Tax</br>Deposited</th>';
                html += '<th>Date on</br>which tax</br>deducted</th>';
                html += '<th>Reason for</br>Non-deduction/Lower</br>Deduction/Deduction at</br>Higher Rate, if any</th>';
                html += '<th>Certificate number</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                $.each(data.Tax_Voucher, function (index, value) {
                    html += "<tr>";
                    html += "<td style='text-align: center'>" + (index + 1) + "</td>";
                    if (value.challan_no == null || value.challan_no == '' || value.challan_no == undefined) value.challan_no = '';
                    html += "<td style='text-align: center'>" + value.challan_no + "</td>";
                    if (value.Tax_Type == null || value.Tax_Type == '' || value.Tax_Type == undefined) var SecCode = '';
                    else var SecCode = value.Tax_Type.tx_ScCode;
                    html += "<td style='text-align: center'>" + SecCode + "</td>";
                    if (value.Deductee == null || value.Deductee == '' || value.Deductee == undefined) var Deductee_Code = '';
                    else var Deductee_Code = value.Deductee.ACCode;
                    html += "<td style='text-align: center'>" + Deductee_Code + "</td>";
                    html += "<td style='text-align: center'>" + 0 + "</td>";//deductee ac no
                    if (value.Deductee == null || value.Deductee == '' || value.Deductee == undefined) var Deductee_PanNumber = '';
                    else var Deductee_PanNumber = value.Deductee.PanNumber;
                    html += "<td style='text-align: left'>" + Deductee_PanNumber + "</td>";
                    if (value.Deductee == null || value.Deductee == '' || value.Deductee == undefined) var Deductee_Name = '';
                    else var Deductee_Name = value.Deductee.ACName;
                    html += "<td style='text-align: left'>" + value.Deductee.ACName + "</td>";
                    if (value.Deductee == null || value.Deductee == '' || value.Deductee == undefined) var Deductee_Add1 = '';
                    else var Deductee_Add1 = value.Deductee.Address1;
                    html += "<td style='text-align: left'>" + Deductee_Add1 + "</td>";
                    if (value.Tax_Type == null || value.Tax_Type == '' || value.Tax_Type == undefined) var Deductee_Add2 = '';
                    else var Deductee_Add2 = value.Deductee.ac_add2;
                    html += "<td style='text-align: right'>" + Deductee_Add2 + "</td>";
                    if (value.Deductee == null || value.Deductee == '' || value.Deductee == undefined) var Deductee_Add3 = '';
                    else var Deductee_Add3 = value.Deductee.Area;
                    html += "<td style='text-align: right'>" + Deductee_Add3 + "</td>"; //
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    var Deductee_State = '';
                    if (value.Deductee == null || value.Deductee == '' || value.Deductee == undefined) var Deductee_City = '';
                    else {
                        if (value.Deductee.CityName == null || value.Deductee.CityName == '' || value.Deductee.CityName == undefined) var Deductee_City = '';
                        else {
                            var Deductee_City = value.Deductee.CityName.CityName;
                        }
                        if (value.Deductee.CityName.StateName == null || value.Deductee.CityName.StateName == '' || value.Deductee.CityName.StateName == undefined) Deductee_State = '';
                        else {
                            Deductee_State = value.Deductee.CityName.StateName.StateName;
                        }
                    }
                    html += "<td style='text-align: right'>" + Deductee_City + "</td>";
                    html += "<td style='text-align: right'>" + Deductee_State + "</td>";

                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>" + value.Basic_Amt + "</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    if (value.TDS_Amt == null || value.TDS_Amt == '' || value.TDS_Amt == undefined) value.TDS_Amt = 0;
                    html += "<td style='text-align: right'>" + value.TDS_Amt + "</td>"; //Amount Of Tax Deduct
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>" + value.TDS_Amt + "</td>"; // Total Tax Deposit
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "<td style='text-align: right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>";
                    html += "</tr>"
                });
                html += '</tbody>';
                html += '<tfoot>';
                html += '<tr>';
                html += '<th class="excludesearch"></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '</tr>';
                html += '</tfoot>';
                html += '<table>';
                $("#TDS_Challan_list").html(html);
                dattable = jQuery('.userTable').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "processing": false,
                    "serverSide": false,
                    "colReorder": true,
                    "autoWidth": false,
                    "ordering": false,
                    "paging": false,
                    // "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf',
                            exportOptions: {

                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                            footer: true,
                            orientation: 'landscape',
                            customize: function (doc) {
                                doc.content.splice(0, 0, {
                                    margin: [0, 0, 0, 12],
                                    alignment: 'center',
                                    text: 'Soft Sauda'
                                });
                            },
                            messageBottom: 'Exported from Soft Sauda'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                    ],
                    "order": [1, 'asc'],
                    "columnDefs": [{
                        "className": "actioncell",
                        "orderable": false,
                        "searchable": false,
                        "sortable": false,
                        "targets": [0],
                        "width": "5%"
                    }],
                })
                $('#userTable tfoot th').not('.excludesearch').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                    function resizeInput() {
                        var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }
                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });
                $('#userTable tfoot').insertBefore('#userTable thead');
                dattable.columns().every(function () {
                    var that = this;
                    $('input', this.footer()).on('keyup change clear', function () {
                        if (that.search() !== this.value) {
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                });
                $('.loader').hide();
            }
        }
    });
});
function UpdateTaxVoucherModal() {
    var checked = $('td input:checked');
    var Tax_Voucher_Entry_id = [];
    var TDS_Amt = 0;
    checked.each(function (x, y) {
        Tax_Voucher_Entry_id.push($(y).val());
        TDS_Amt = TDS_Amt + parseFloat($(y).attr('data-TDS'));
    })
    if (Tax_Voucher_Entry_id == [] || Tax_Voucher_Entry_id == '' || Tax_Voucher_Entry_id == null) {
        swal({
            title: "TDS Challan",
            text: "Please Check Atleast One",
            icon: "warning",
            timer: 1000,
            buttons: false
        })
    } else {
        $('#UpdateTaxVoucherModal').modal('show');
        setTimeout(function () {
            $('#challan_no').focus();
            $('#Selected_Amt_Of_Bills').val(TDS_Amt);
        }, 500);
    }
}
$(document).on('keydown', '.UpdateTaxVoucherCheckbox', function (e) {
    if (e.keyCode == 13) $('#UpdateTaxVoucherCheckbox').click();
});
$(document).on('click', '.UpdateTaxVoucherCheckbox', function (e) {
    var checked = $('td input:checked');
    var Tax_Voucher_Entry_id = [];
    checked.each(function (x, y) {
        Tax_Voucher_Entry_id.push($(y).val());
    })
    if ($('#UpdateTaxVoucherForm').valid()) {
        var challan_no = $('#challan_no').val();
        var challan_date = $('#challan_date').val();
        var Bank = $('#Bank').val();
        var BSR_Code = $('#BSR_Code').val();
        var Chq_No = $('#Chq_No').val();
        var Chq_Date = $('#Chq_Date').val();
        var Selected_Amt_Of_Bills = $('#Selected_Amt_Of_Bills').val();
        $.ajax({
            type: "POST",
            url: '/Tax_Voucher/UpdateTaxVoucherCheckbox',
            dataType: 'json',
            data: {
                Tax_Voucher_Entry_id: Tax_Voucher_Entry_id,
                challan_no: challan_no,
                challan_date: challan_date,
                Bank: Bank,
                BSR_Code: BSR_Code,
                Chq_No: Chq_No,
                Chq_Date: Chq_Date,
                Selected_Amt_Of_Bills: Selected_Amt_Of_Bills,
            },
            success: function (data) {
                if (data['success'] == true) {
                    $('#UpdateTaxVoucherModal').modal('hide');
                    swal({
                        title: "TDS Challan",
                        text: "Saucessfully Update",
                        icon: "warning",
                        timer: 1000,
                        buttons: false
                    })
                }
            }
        });
    } else {
        swal({
            title: "TDS Challan",
            text: "Please Fill Required Field",
            icon: "warning",
            timer: 1000,
            buttons: false
        })
    }
})

// Tax Register ########################################################################################################################################################################
$(document).on("keydown", "#Show_Tax_Register", function (event) {
    $(this).click()
})
$(document).on("click", "#Show_Tax_Register", function (event) {
    event.preventDefault();
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);

    // var division = $('#Division').val();
    // var challan_No = $("input[name='challan_No']:checked").val();
    // var party = $('#party').val();
    // var Tax_Type = $('#Tax_Type').val();
    $('.loader').show();
    $.ajax({
        type: "GET",
        url: '/Tax_Voucher/Show_Tax_Register',
        dataType: 'json',
        data: {
            start_date: start_date,
            end_date: end_date,
            // party: party,
            // Tax_Type:Tax_Type,
            // challan_No:challan_No,
            // division:division,
        },
        success: function (data) {
            console.log(data);
            if (data['success'] == true) {
                if (data.Tax_Register == '' || data.Tax_Register == null) $('.loader').hide();
                var html = '<div class="showsearchdata">';
                html += '<div class="row">';
                html += '<div class="col-md-12">';
                html += '<div class="table-responsive">';
                html += '<table id="userTable" class="userTable table table-striped table-bordered table-hover adsearch">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>Date</th>';
                html += '<th>Vouch No</th>';
                html += '<th>Particulars</th>';
                html += '<th>Debit Amt</th>';
                html += '<th>Credit Amt</th>';
                html += '<th>Narration</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                var entry_no = data.Tax_Register[0].vouc_code;
                $.each(data.Tax_Register, function (index, value) {
                    html += "<tr>";
                    html += "<td style='text-align: center'>" + moment(value.cash_date).format('DD/MM/YYYY') + "</td>";
                    html += "<td style='text-align: center'>" + value.vouc_code + "</td>";
                    html += "<td style='text-align: left'>" + value.cashac_name.ACName + "</td>";
                    if (value.cash_amount == null || value.cash_amount == '' || value.cash_amount == undefined) value.cash_amount = 0;
                    if (value.d_c == 'D') html += "<td style='text-align: left'>" + value.cash_amount + "</td>";
                    else html += "<td style='text-align: left'>--</td>";
                    if (value.d_c == 'C') html += "<td style='text-align: left'>" + value.cash_amount + "</td>";
                    else html += "<td style='text-align: left'>--</td>";
                    html += "<td style='text-align: left'>" + value.cash_remarks + "</td>";
                    html += "</tr>";
                });
                html += '</tbody>';
                html += '<tfoot>';
                html += '<tr>';
                html += '<th class="excludesearch"></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '<th></th>';
                html += '</tfoot>';
                html += '</table>';
                $("#Tax_Register_List").html(html);

                dattable = jQuery('.userTable').DataTable({
                    "dom": "<'row'<'col-md-4 col-sm-12 col-xs-12'B><'col-md-4 col-sm-6 col-xs-12'l><'col-md-4 col-sm-6 col-xs-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
                    "processing": false,
                    "serverSide": false,
                    "colReorder": true,
                    "autoWidth": false,
                    "ordering": false,
                    "searching": false,
                    "paging": false,
                    "info": false,
                    "columnDefs": [
                        { "visible": false, "targets": 5 }
                    ],
                    "buttons": [
                        {
                            extend: 'excel',
                            className: 'btn-default btn-excel',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                        {
                            extend: 'pdf',
                            className: 'btn-default btn-pdf',
                            exportOptions: {

                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                            footer: true,
                            orientation: 'landscape',
                            customize: function (doc) {
                                doc.content.splice(0, 0, {
                                    margin: [0, 0, 0, 12],
                                    alignment: 'center',
                                    text: 'Soft Sauda'
                                });
                            },
                            messageBottom: 'Exported from Soft Sauda'
                        },
                        {
                            extend: 'print',
                            className: 'btn-default btn-print',
                            exportOptions: {
                                modifier: {
                                    page: 'current'
                                },
                                columns: "thead th:not(.noExport)"
                            },
                        },
                    ],
                    "order": [1, 'asc'],
                    "drawCallback": function (settings) {
                        var api = this.api();
                        var rows = api.rows({ page: 'current' }).nodes();
                        var last = null;
                        var tot = 0;
                        var intVal = function (i) {
                            return typeof i === 'string' ?
                                i.replace(/[\$,]/g, '') * 1 :
                                typeof i === 'number' ?
                                    i : 0;
                        };
                        total = [];
                        api.column(5, { page: 'current' }).data().each(function (group, i) {
                            group_assoc = group.replace(/ /g, '_');
                            if (typeof total[group_assoc] != 'undefined') {
                                total[group_assoc] = total[group_assoc] + intVal(api.column(1).data()[i]);
                            } else {
                                total[group_assoc] = intVal(api.column(1).data()[i]);
                            }
                            if (last !== group) {
                                $(rows).eq(i).before(
                                    '<tr class="group" style="text-transform: uppercase;"><td colspan="6" style="font-size:15px;border-right:none;border-top:none;text-align:right" ></br></td>' // '+group+' class="'+group_assoc+'"
                                    + '</tr>'
                                );
                                last = group;
                            }
                        });
                        for (var key in total) {
                            var totamt = total[key].toFixed(2)
                            $("." + key).html("Firm Ughrani Totals: " + totamt);
                        }
                    },
                    "columnDefs": [{
                        "className": "actioncell",
                        "orderable": false,
                        "searchable": false,
                        "sortable": false,
                        "targets": [0],
                        "width": "5%"
                    }],
                })
                $('#userTable tfoot th').not('.excludesearch').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text" class="form-control resizing-input" placeholder="Search ' + title + '" autocomplete="false" />');
                    function resizeInput() {
                        var content = $(this).val().length > 0 ? $(this).val() : $(this).prop("placeholder");
                        var widthTester = $("<span>" + content + "</span>").hide();
                        widthTester.insertAfter($(this));
                        $(this).css("width", widthTester.width() + "px");
                        widthTester.remove();
                    }
                    $('.resizing-input').focusout(resizeInput).each(resizeInput);
                });
                $('#userTable tfoot').insertBefore('#userTable thead');
                dattable.columns().every(function () {
                    var that = this;
                    $('input', this.footer()).on('keyup change clear', function () {
                        if (that.search() !== this.value) {
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                });
                $('.loader').hide();
            }
        }
    });
});

function FindOpeningOutstanding() {
    $.ajax({
        type: "GET",
        url: '/op_os_module/FindOpeningOutstanding',
        dataType: 'json',
        success: function (data) {
            if (data['success'] == true) {

            }
        }
    })
}

// Sale Return #########################################################################################################################################################################
function OutStandingModelInSR(e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        OutStandingModelInSROnClick();
    }
}
function OutStandingModelInSROnClick(amt) {
    var cashamount = $('#gross_Amt').val();
    if (amt == 'Diffrence_Amount') {
        var tot_Amt = $('#gross_Amt').val();
        if (tot_Amt == null || tot_Amt == '' || isNaN(tot_Amt)) tot_Amt = 0;
        var Rec_Amt = 0;
        var outSaveArr = JSON.parse($('#outSaveArr').val());
        for (let i = 0; i < outSaveArr.length; i++) {
            var Rec_Amount = outSaveArr[i].ReceiveAmt;
            if (Rec_Amount == null || Rec_Amount == '' || Rec_Amount == undefined || isNaN(Rec_Amount)) Rec_Amount = 0;
            Rec_Amt = Rec_Amt + parseFloat(Rec_Amount);
        }
        cashamount = parseFloat(tot_Amt) - parseFloat(Rec_Amt);
    }
    var party = $('#party_Code').val();
    if (cashamount != '' && party != '') {
        $('#totReceiveAmt').val(0);
        var party = $('#party_Code').val();
        var d_c = 'C';
        $.ajax({
            type: 'GET',
            url: '/cash_bank/getOut',
            dataType: 'json',
            data: {
                party: party,
                d_c: d_c
            },
            success: function (data) {
                console.log(data)
                var i, j, result, sau;
                result = '';
                html = '';
                if (data['success'] == true) {
                    var somast = data['accnametyp'];
                    var division = data['division'];
                    $('#OutStandingModelInSR').modal('show');
                    html += '<tr>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th>';
                    html += '<input type="number" class="form-control" name="EnterAmt" value="' + cashamount + '" id="EnterAmt" style="text-align:center" readonly>';
                    html += '<input type="hidden" value="' + cashamount + '" id="EnterAmt_hidden">';
                    html += '</th>';
                    html += '<th></th>';
                    html += '</tr>';
                    html += '<tr>';
                    html += '<th>Date</th>';
                    html += '<th>Entry no</th>';
                    html += '<th>Amount</th>';
                    html += '<th>Panding Amount</th>';
                    html += '<th>Receive Amount</th>';
                    html += '<th>Balance</th>';
                    html += '</tr>';
                    $('#OutStandingModelHead').html(html);
                    var totPandingAmt = 0;
                    if (somast != '') {
                        $.each(somast, function (index, value) {
                            result += '<tr>';
                            result += '<div id="delivery-' + index + '">';
                            result += '<td>';
                            var dat = moment(value.cash_date).format('DD/MM/YYYY');
                            result += '<input type="text" value="' + dat + '" name="outArray[' + index + '][cash_date]"';
                            result += 'id="Bill_Date' + index + '" readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '<input type="hidden" value="' + value.main_bk + '" name="outArray[' + index + '][main_bk]" id="main_bk' + index + '">';
                            result += '<input type="hidden" value="' + value.c_j_s_p + '" name="outArray[' + index + '][c_j_s_p]" id="c_j_s_p' + index + '">';
                            result += '<input type="hidden" value="' + value.c_j_s_p + '" id="c_j_s_p_Name' + index + '">';
                            // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray['+index+'][c_j_s_p]" id="c_j_s_p'+index+'">';
                            result += '<input type="hidden" value="' + value.co_code + '" name="outArray[' + index + '][co_code]" id="co_code' + index + '">';
                            result += '<input type="hidden" value="' + value.div_code + '" name="outArray[' + index + '][div_code]" id="div_code' + index + '">';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="hidden" value="' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]"';
                            result += 'id="vouc_code' + index + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '<input type="text" class="form-control" value="' + value.main_bk + '/' + value.c_j_s_p + '/' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]" readonly>';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="hidden" value="' + value.Bill_Amount + '" name="outArray[' + index + '][Bill_Amount]" id="Bill_Amount' + index + '">';
                            result += '<input type="text" value="' + value.cash_amount + '" name="outArray[' + index + '][cash_amount]"';
                            result += 'id="Amount' + index + '" readonly="true"';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '<input type="hidden" value="' + value.cashac_name + '" name="outArray[' + index + '][party_id]"';
                            result += 'id="party_id' + index + '"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '<input type="hidden" value="' + value._id + '" name="outArray[' + index + '][out_id]"';
                            result += 'id="out_id' + index + '"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '</td>';

                            result += '<td>';
                            var out = 0;
                            out = value.outstanding_balance;
                            if (out == undefined || out == null) out = '';
                            totPandingAmt = parseFloat(totPandingAmt) + parseFloat(out)
                            result += '<input type="text" value="' + out + '" name="outArray[' + index + '][outstanding_amount]" readonly="true"';
                            result += 'id="outstanding_amount' + index + '"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += '>';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="text" value="' + 0 + '" name="outArray[' + index + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + index + ')"';
                            result += 'id="ReceiveAmt' + index + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                            result += 'class="form-control "style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';

                            result += '<td>'; '+value.order_price+'
                            result += '<input type="text" name="outArray[' + index + '][BalanceAmt]"';
                            result += 'id="BalanceAmt' + index + '" onkeydown="CashBankOutFocusNext(' + index + ',event)"';
                            result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                            result += '>';
                            result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                            result += '</td>';

                            result += '</div>';
                            result += '</tr>';
                            glbidx = j;
                        });
                    }
                    result += '<tr>';
                    result += '<td>';
                    var dat = $('#offerstartdate').val();
                    result += '<input type="text" value="' + dat + '" name="outArray[' + somast.length + '][cash_date]"';
                    result += 'id="Bill_Date' + somast.length + '" readonly="true" class="form-control "style="text-align: -webkit-right;">';
                    result += '<input type="hidden" value="SB" name="outArray[' + somast.length + '][main_bk]" id="main_bk' + somast.length + '">';
                    result += '<input type="hidden" value="OnAcc" name="outArray[' + somast.length + '][c_j_s_p]" id="c_j_s_p' + somast.length + '">';
                    result += '<input type="hidden" value="OnaAcc" id="c_j_s_p_Name' + somast.length + '">';
                    // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray[0][c_j_s_p]" id="c_j_s_p0">';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][co_code]" id="co_code' + somast.length + '">';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][div_code]" id="div_code' + somast.length + '">';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="text" value="ONA ACC" class="form-control" readonly="true">';
                    result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][vouc_code]"';
                    result += 'id="vouc_code' + somast.length + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][Bill_Amount]" id="Bill_Amount' + somast.length + '">';
                    result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][cash_amount]"';
                    result += 'id="Amount' + somast.length + '" readonly="true"';
                    result += 'class="form-control " style="text-align: -webkit-right;"';
                    result += 'required>';
                    result += '<input type="hidden" value="' + party + '" name="outArray[' + somast.length + '][party_id]"';
                    result += 'id="party_id' + somast.length + '"';
                    result += 'class="form-control " style="text-align: -webkit-right"';
                    result += '>';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][out_id]"';
                    result += 'id="out_id' + somast.length + '"';
                    result += 'class="form-control " style="text-align: -webkit-right"';
                    result += '>';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][outstanding_amount]" readonly="true"';
                    result += 'id="outstanding_amount' + somast.length + '"';
                    result += 'class="form-control" style="text-align: -webkit-right;"';
                    result += '>';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + somast.length + ')"';
                    result += 'id="ReceiveAmt' + somast.length + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                    result += 'class="form-control "style="text-align: -webkit-right;"';
                    result += 'required>';
                    result += '</td>';

                    result += '<td>'; '+value.order_price+'
                    result += '<input type="text" name="outArray[' + somast.length + '][BalanceAmt]"';
                    result += 'id="BalanceAmt' + somast.length + '"';
                    result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                    result += '>';
                    result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                    result += '</td>';
                    result += '</tr>';

                    $('.out_repeat_row').html(result);
                    $('#ReceiveAmt0').focus();
                    $('#totPandingAmt').val(totPandingAmt.toFixed(2));
                    $('#ReceiveAmt0').val($('#EnterAmt').val());
                    $("input").focus(function () {
                        $(this).select();
                    });
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'Not Set In Group Master For Maintain Outstanding',
                        buttons: false,
                        timer: 1500
                    })
                }
            }
        });
    } else {
        if (e.keyCode == 13) {
            e.preventDefault();
        }
    }
}
function calOutStandingInSR(len) {
    var EnterAmt_hidden = $('#EnterAmt_hidden').val();
    for (let i = 0; i <= len; i++) {
        var amt = $('#Amount' + i).val();
        var recamt = $('#ReceiveAmt' + i).val();
        if (recamt == '' || recamt == null || recamt == undefined) recamt = 0;
        var out = $('#outstanding_amount' + i).val();
        EnterAmt_hidden = parseFloat(EnterAmt_hidden) - parseFloat(recamt);
        if (EnterAmt_hidden < 0) {
            alert('Totle Adjust Amount Should Be Equal To Entred Amount');
            $('#EnterAmt').css({ "backgroundColor": "red", "color": "black" });
        } else {
            $('#EnterAmt').css({ "backgroundColor": "rgb(211, 253, 122)", "color": "black" });
        }
        var balamt = parseFloat(out) - parseFloat(recamt);
        $('#BalanceAmt' + i).val(balamt.toFixed(2));
    }
    $('#EnterAmt').val(EnterAmt_hidden.toFixed(2));
}
async function calEnterAmtInSR(len, e, index) {
    if (e.keyCode == 13) {
        var amt = await calOutStandingInSR(len);
        setTimeout(function () {
            if ($('#EnterAmt').val() > 0) {
                $('#ReceiveAmt' + (index + 1)).val($('#EnterAmt').val());
                $('#ReceiveAmt' + (index + 1)).focus();
            } else {
                $('#GetOutStInSRBtnId').focus();
                $('#GetOutStInPRBtnId').focus();
                $('#GetOutStInCNBtnId').focus();
                $('#GetOutStInJEBtnId').focus();
            }
        }, 100);
    }
}
$(document).on('keydown', '#GetOutStInSRBtnId', function (e) {
    if (e.keyCode == 13) {
        GetOutStInSR()
    }
})
function GetOutStInSR() {
    outArray = [];
    $('#OutStandingModel').modal('hide');
    var len = $('#outLength').val();
    for (let i = 0; i <= len; i++) {
        var Add_Ded_Amt_Tot = 0;
        var Less_Ded_Amt_Tot = 0
        console.log(i, $('#ReceiveAmt' + i).val());
        if ($('#ReceiveAmt' + i).val() > 0) {
            outArray[i] = {
                'cashac_name': $('#party_Code').val(), 'cash_amount': $('#gross_Amt').val(), 'cash_narrone': 'Sales Return', 'cash_narrtwo': '',
                'cash_date': $('#offerstartdate').val(), 'vouc_code': $('#vouc_code' + i).val(), 'Bill_Amt': $('#Amount' + i).val(), 'out_id': $('#out_id' + i).val(), 'BalanceAmt': $('#BalanceAmt' + i).val(),
                'ReceiveAmt': $('#ReceiveAmt' + i).val(), 'outstanding_amount': $('#outstanding_amount' + i).val(), 'main_bk': $('#main_bk' + i).val(), 'c_j_s_p': $('#c_j_s_p' + i).val(),
                'div_code': $('#div_code' + i).val(), 'co_code': $('#co_code' + i).val(), 'Add_Ded_Amt_Tot': Add_Ded_Amt_Tot, 'Less_Ded_Amt_Tot': Less_Ded_Amt_Tot
            };
        }
    }
    console.log('outArray', outArray);
    var OutFinArr = [];
    for (let o = 0; o < outArray.length; o++) {
        if (outArray[o] == [] || outArray[o] == null || outArray[o] == '') flag = 1;
        else OutFinArr.push(outArray[o]);
    }
    outArray = OutFinArr;
    console.log('OutFinArr', outArray);
    $('#outSaveArr').val(JSON.stringify(outArray));
    $('#OutStandingModelInSR').modal('hide');
    setTimeout(function () {
        $('#SaleReturnSubBtn').focus();
    }, 100);
}
$(document).on('click', '.delete_SaleReturnEntry', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'DELETE',
                url: '/Sales_Return_Entry/delete/' + id,
                success: function (response) {
                    $('.loader').hide();
                    window.location.href = '/Sales_Return_Entry/Sales_Return_Entry_List';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    })
});

// Purchase Return ######################################################################################################################################################################
function OutStandingModelInPR(e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        OutStandingModelInPROnClick();
    }
}
function OutStandingModelInPROnClick(amt) {
    var cashamount = $('#gross_Amt').val();
    if (amt == 'Diffrence_Amount') {
        var tot_Amt = $('#gross_Amt').val();
        if (tot_Amt == null || tot_Amt == '' || isNaN(tot_Amt)) tot_Amt = 0;
        var Rec_Amt = 0;
        var outSaveArr = JSON.parse($('#outSaveArr').val());
        for (let i = 0; i < outSaveArr.length; i++) {
            var Rec_Amount = outSaveArr[i].ReceiveAmt;
            if (Rec_Amount == null || Rec_Amount == '' || Rec_Amount == undefined || isNaN(Rec_Amount)) Rec_Amount = 0;
            Rec_Amt = Rec_Amt + parseFloat(Rec_Amount);
        }
        cashamount = parseFloat(tot_Amt) - parseFloat(Rec_Amt);
    }
    var party = $('#party_Code').val();
    if (cashamount != '' && party != '') {
        $('#totReceiveAmt').val(0);
        var party = $('#party_Code').val();
        var d_c = 'D';
        $.ajax({
            type: 'GET',
            url: '/cash_bank/getOut',
            dataType: 'json',
            data: {
                party: party,
                d_c: d_c
            },
            success: function (data) {
                console.log(data)
                var i, j, result, sau;
                result = '';
                html = '';
                if (data['success'] == true) {
                    var somast = data['accnametyp'];
                    var division = data['division'];
                    $('#OutStandingModelInPR').modal('show');
                    html += '<tr>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th>';
                    html += '<input type="number" class="form-control" name="EnterAmt" value="' + cashamount + '" id="EnterAmt" style="text-align:center" readonly>';
                    html += '<input type="hidden" value="' + cashamount + '" id="EnterAmt_hidden">';
                    html += '</th>';
                    html += '<th></th>';
                    html += '</tr>';
                    html += '<tr>';
                    html += '<th>Date</th>';
                    html += '<th>Entry no</th>';
                    html += '<th>Amount</th>';
                    html += '<th>Panding Amount</th>';
                    html += '<th>Receive Amount</th>';
                    html += '<th>Balance</th>';
                    html += '</tr>';
                    $('#OutStandingModelHead').html(html);
                    var totPandingAmt = 0;
                    if (somast != '') {
                        $.each(somast, function (index, value) {
                            result += '<tr>';
                            result += '<div id="delivery-' + index + '">';
                            result += '<td>';
                            var dat = moment(value.cash_date).format('DD/MM/YYYY');
                            result += '<input type="text" value="' + dat + '" name="outArray[' + index + '][cash_date]"';
                            result += 'id="cash_date' + index + '" readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '<input type="hidden" value="' + value.main_bk + '" name="outArray[' + index + '][main_bk]" id="main_bk' + index + '">';
                            result += '<input type="hidden" value="' + value.c_j_s_p + '" name="outArray[' + index + '][c_j_s_p]" id="c_j_s_p' + index + '">';
                            result += '<input type="hidden" value="' + value.c_j_s_p + '" id="c_j_s_p_Name' + index + '">';
                            // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray['+index+'][c_j_s_p]" id="c_j_s_p'+index+'">';
                            result += '<input type="hidden" value="' + value.co_code + '" name="outArray[' + index + '][co_code]" id="co_code' + index + '">';
                            result += '<input type="hidden" value="' + value.div_code + '" name="outArray[' + index + '][div_code]" id="div_code' + index + '">';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="hidden" value="' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]"';
                            result += 'id="vouc_code' + index + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '<input type="text" class="form-control" value="' + value.main_bk + '/' + value.c_j_s_p + '/' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]" readonly>';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="hidden" value="' + value.Bill_Amount + '" name="outArray[' + index + '][Bill_Amount]" id="Bill_Amount' + index + '">';
                            result += '<input type="text" value="' + value.cash_amount + '" name="outArray[' + index + '][cash_amount]"';
                            result += 'id="Amount' + index + '" readonly="true"';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '<input type="hidden" value="' + value.cashac_name + '" name="outArray[' + index + '][party_id]"';
                            result += 'id="party_id' + index + '"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '<input type="hidden" value="' + value._id + '" name="outArray[' + index + '][out_id]"';
                            result += 'id="out_id' + index + '"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '</td>';

                            result += '<td>';
                            var out = 0;
                            out = value.outstanding_balance;
                            if (out == undefined || out == null) out = '';
                            totPandingAmt = parseFloat(totPandingAmt) + parseFloat(out)
                            result += '<input type="text" value="' + out + '" name="outArray[' + index + '][outstanding_amount]" readonly="true"';
                            result += 'id="outstanding_amount' + index + '"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += '>';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="text" value="' + 0 + '" name="outArray[' + index + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + index + ')"';
                            result += 'id="ReceiveAmt' + index + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                            result += 'class="form-control "style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';

                            result += '<td>'; '+value.order_price+'
                            result += '<input type="text" name="outArray[' + index + '][BalanceAmt]"';
                            result += 'id="BalanceAmt' + index + '" onkeydown="CashBankOutFocusNext(' + index + ',event)"';
                            result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                            result += '>';
                            result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                            result += '</td>';

                            result += '</div>';
                            result += '</tr>';
                            glbidx = j;
                        });
                    }
                    result += '<tr>';
                    result += '<td>';
                    var dat = $('#offerstartdate').val();
                    result += '<input type="text" value="' + dat + '" name="outArray[' + somast.length + '][cash_date]"';
                    result += 'id="cash_date0" readonly="true" class="form-control "style="text-align: -webkit-right;">';
                    result += '<input type="hidden" value="PB" name="outArray[' + somast.length + '][main_bk]" id="main_bk' + somast.length + '">';
                    result += '<input type="hidden" value="OnAcc" name="outArray[' + somast.length + '][c_j_s_p]" id="c_j_s_p' + somast.length + '">';
                    result += '<input type="hidden" value="OnaAcc" id="c_j_s_p_Name' + somast.length + '">';
                    // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray[0][c_j_s_p]" id="c_j_s_p0">';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][co_code]" id="co_code' + somast.length + '">';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][div_code]" id="div_code' + somast.length + '">';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="text" value="ONA ACC" class="form-control" readonly="true">';
                    result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][vouc_code]"';
                    result += 'id="vouc_code' + somast.length + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][Bill_Amount]" id="Bill_Amount' + somast.length + '">';
                    result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][cash_amount]"';
                    result += 'id="Amount' + somast.length + '" readonly="true"';
                    result += 'class="form-control " style="text-align: -webkit-right;"';
                    result += 'required>';
                    result += '<input type="hidden" value="' + party + '" name="outArray[' + somast.length + '][party_id]"';
                    result += 'id="party_id' + somast.length + '"';
                    result += 'class="form-control " style="text-align: -webkit-right"';
                    result += '>';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][out_id]"';
                    result += 'id="out_id' + somast.length + '"';
                    result += 'class="form-control " style="text-align: -webkit-right"';
                    result += '>';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][outstanding_amount]" readonly="true"';
                    result += 'id="outstanding_amount' + somast.length + '"';
                    result += 'class="form-control" style="text-align: -webkit-right;"';
                    result += '>';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + somast.length + ')"';
                    result += 'id="ReceiveAmt' + somast.length + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                    result += 'class="form-control "style="text-align: -webkit-right;"';
                    result += 'required>';
                    result += '</td>';

                    result += '<td>'; '+value.order_price+'
                    result += '<input type="text" name="outArray[' + somast.length + '][BalanceAmt]"';
                    result += 'id="BalanceAmt' + somast.length + '"';
                    result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                    result += '>';
                    result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                    result += '</td>';
                    result += '</tr>';
                    $('.out_repeat_row').html(result);
                    $('#ReceiveAmt0').focus();
                    $('#totPandingAmt').val(totPandingAmt.toFixed(2));
                    $('#ReceiveAmt0').val($('#EnterAmt').val());
                    $("input").focus(function () {
                        $(this).select();
                    });
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'Not Set In Group Master For Maintain Outstanding',
                        buttons: false,
                        timer: 1500
                    })
                }
            }
        });
    } else {
        if (e.keyCode == 13) {

        }
    }
}
$(document).on('keydown', '#GetOutStInPRBtnId', function (e) {
    if (e.keyCode == 13) {
        GetOutStInPR()
    }
})
function GetOutStInPR() {
    outArray = [];
    $('#OutStandingModel').modal('hide');
    var len = $('#outLength').val();
    for (let i = 0; i <= len; i++) {
        var Add_Ded_Amt_Tot = 0;
        var Less_Ded_Amt_Tot = 0
        console.log(i, $('#ReceiveAmt' + i).val());
        if ($('#ReceiveAmt' + i).val() > 0) {
            outArray[i] = {
                'cashac_name': $('#party_Code').val(), 'cash_amount': $('#gross_Amt').val(), 'cash_narrone': 'Sales Return', 'cash_narrtwo': '',
                'cash_date': $('#offerstartdate').val(), 'vouc_code': $('#vouc_code' + i).val(), 'Bill_Amt': $('#Amount' + i).val(), 'out_id': $('#out_id' + i).val(), 'BalanceAmt': $('#BalanceAmt' + i).val(),
                'ReceiveAmt': $('#ReceiveAmt' + i).val(), 'outstanding_amount': $('#outstanding_amount' + i).val(), 'main_bk': $('#main_bk' + i).val(), 'c_j_s_p': $('#c_j_s_p' + i).val(),
                'div_code': $('#div_code' + i).val(), 'co_code': $('#co_code' + i).val(), 'Add_Ded_Amt_Tot': Add_Ded_Amt_Tot, 'Less_Ded_Amt_Tot': Less_Ded_Amt_Tot
            };
        }
    }
    console.log('outArray', outArray);
    var OutFinArr = [];
    for (let o = 0; o < outArray.length; o++) {
        if (outArray[o] == [] || outArray[o] == null || outArray[o] == '') flag = 1;
        else OutFinArr.push(outArray[o]);
    }
    outArray = OutFinArr;
    console.log('OutFinArr', outArray);
    $('#outSaveArr').val(JSON.stringify(outArray));
    $('#OutStandingModelInPR').modal('hide');
    setTimeout(function () {
        $('#PurReturnSubBtn').focus();
    }, 100);
}
$(document).on('click', '.delete_PurchaseReturnEntry', function () {
    $('.loader').show();
    let id = $(this).attr('data-id');
    swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'DELETE',
                url: '/Purchase_Return_Entry/delete/' + id,
                success: function (response) {
                    $('.loader').hide();
                    window.location.href = '/Purchase_Return_Entry/Purchase_Return_Entry_List';
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    })
});

// Missing Book No (Entry Number) Find #################################################################################################################################################
function getBookInMissingNo(mod) {
    $.ajax({
        type: "GET",
        url: '/voucher_type_master/getBookInMissingNo',
        dataType: 'json',
        data: {
            module: mod,
        },
        success: function (data) {
            console.log(data)
            if (data['success'] == true) {
                var book = data['vouchMast'];
                var html = '';
                if (book == [] || book == null || book == '' || book == undefined) {

                } else {
                    html += '<table class="table table-striped table-bordered table-hover">';
                    html += '<thead>';
                    html += '<tr>';
                    html += '<td style="font-size:18px;text-align:center">';
                    html += '' + book[0].Module + '';
                    html += '</td>';
                    html += '</tr>';
                    html += '</thead>';
                    for (let i = 0; i < book.length; i++) {
                        html += '<tr>';
                        html += '<td>';
                        html += '<a onclick="takeMissingNoBook(\'' + book[i].Vo_book + '\',\'' + book[i].Module + '\')">' + book[i].Vo_book + '</a>';
                        html += '</td>';
                        html += '</tr>';
                    }
                    html += '</table>';
                }

                $('#getBookInMissingNo').html(html);
            }
        }
    });
}
function takeMissingNoBook(book, modul) {
    $('#Book').val(book);
    $('#Module').val(modul);
}
function getMissingNo() {
    var period = $('#contractrange').val();
    var start_date = period.substr(0, 10);
    var end_date = period.substr(14, 10);
    var Book = $('#Book').val();
    var Module = $('#Module').val();
    var From = $('#From').val();
    var To = $('#To').val();
    if (Book != null && Module != null) {
        $.ajax({
            type: "GET",
            url: '/voucher_type_master/getMissingNo',
            dataType: 'json',
            data: {
                start_date: start_date,
                end_date: end_date,
                Book: Book,
                Module: Module,
                From: From,
                To: To
            },
            success: function (data) {
                if (data['success'] == true) {
                    console.log(data);
                    var html = '';
                    html += '<table class="table table-striped table-bordered table-hover">';
                    for (let i = 0; i < data.Missing_Number_Arr.length; i++) {
                        html += '<tr>';
                        html += '<td>';
                        html += '' + data.Missing_Number_Arr[i] + '';
                        html += '</td>';
                        html += '</tr>';
                    }
                    html += '</table>';
                    $('#MissingnumberShow').html(html);
                } else {
                    swal({
                        title: "Missing Number",
                        text: "Data Not Found",
                        icon: "warning",
                        timer: 800,
                        buttons: false
                    })
                }
            },
        });
    } else {
        swal({
            title: "Missing Number",
            text: "Please Select Module/Book",
            icon: "warning",
            timer: 800,
            buttons: false
        })
    }
}

// Credit Note #########################################################################################################################################################################
function getPartyDetail() {
    var party = $('#Credit_AC').val();
    if ($('#Form').val() == 'Debit_Note_Form' || $('#Form').val() == 'Debit_Note_Update_Form') {
        party = $('#Debit_AC').val()
    }
    if (party == null || party == '' || party == undefined) {

    } else {
        $.ajax({
            type: 'GET',
            url: '/Credit_Note/getPartyDetail',
            dataType: 'json',
            data: {
                party: party,
            },
            success: function (data) {
                console.log(data);
                if (data['success'] == true) {
                    $('#CreditAcGroupName').val(data['party'].GroupName.GroupName);
                    var outstanding = data['accnametyp'];
                    var tot_Out_Bal = 0;
                    if (outstanding != null) {
                        for (let i = 0; i < outstanding.length; i++) {
                            if (outstanding[i].outstanding_balance == null || outstanding[i].outstanding_balance == '' || outstanding[i].outstanding_balance == undefined || isNaN(outstanding[i].outstanding_balance == null)) outstanding[i].outstanding_balance = 0;
                            tot_Out_Bal = tot_Out_Bal + parseFloat(outstanding[i].outstanding_balance);
                        }
                    }
                    $('#O_S_Bal').val(tot_Out_Bal.toFixed(2));
                }
            }
        });
        calGstInCNDN()
    }
}// Debit Not Ok 
function calAmountInCNDN() {
    var values = $("input[name='cashtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var tot_Amt = $('#Amount').val();
    if (tot_Amt == null || tot_Amt == '' || tot_Amt == undefined) tot_Amt = 0;
    for (let i = 0; i <= idx; i++) {
        var amount = $('#Amount' + i).val();
        if (amount == null || amount == '' || amount == undefined) amount = 0;
        tot_Amt = parseFloat(tot_Amt) + parseFloat(amount);
    }
    $('#totcash_amt').val(tot_Amt);
}// Debit Not Ok
function calGstInCNDN() {
    var Amt = $('#Amount').val();
    var Gst = $('#GST').val();
    if (Amt == null || Amt == '' || isNaN(Amt)) Amt = 0;
    if (Gst == null || Gst == '' || isNaN(Gst)) Gst = 0;
    if (Amt > 0 && Gst > 0) {
        var GstAmount = Amt * Gst / 100;
        var Module = 'Credit Note';
        if ($('#Form').val() == 'Debit_Note_Form') {
            Module = 'Debit Note'
        }
        party = $("#Credit_AC").val();
        $.ajax({
            type: 'GET',
            url: '/Credit_Note/AddLessMaster/' + Module,
            dataType: 'json',
            success: function (data) {
                if (data['success']) {
                    if (data['addlessmast'] == null || data['addlessmast'] == '' || data['addlessmast'] == []) {

                    } else {
                        var AddLessMaster = data['addlessmast'].Add_Less_Parameter_Master_Array;
                        // var values = $("input[name='cashtrn']")
                        //         .map(function(){return $(this).val();}).get();
                        // var idx = values[values.length-1]
                        for (let i = 0; i < AddLessMaster.length; i++) {
                            if (AddLessMaster[i].Calculation == 'IGST' || AddLessMaster[i].Calculation == 'CGST' || AddLessMaster[i].Calculation == 'SGST') {
                                $("#Amount" + AddLessMaster[i].Order).val(0);
                                $("#Rate" + AddLessMaster[i].Order).val(0);
                            }
                        }
                        $.ajax({
                            type: 'GET',
                            url: '/Garu_Aavak_Entry/chackstate/' + party,
                            dataType: 'json',
                            success: function (data) {
                                if (data['success'] == 'true') {
                                    if (GstAmount == null || GstAmount == '') {
                                        for (let i = 0; i < AddLessMaster.length; i++) {
                                            if (AddLessMaster[i].Calculation == 'IGST') {
                                                $("#Amount" + AddLessMaster[i].Order).val(0);
                                                $("#Rate" + AddLessMaster[i].Order).val(0);
                                            }
                                        }
                                    } else {
                                        var tot_taxvalue = GstAmount / 2;
                                        for (let i = 0; i < AddLessMaster.length; i++) {
                                            if (AddLessMaster[i].Calculation == 'SGST' || AddLessMaster[i].Calculation == 'CGST') {
                                                $("#Amount" + AddLessMaster[i].Order).val(tot_taxvalue.toFixed(2));
                                                $("#Rate" + AddLessMaster[i].Order).val((Gst / 2).toFixed(1));
                                            }
                                        }
                                    }
                                }
                                if (data['success'] == 'false') {
                                    if (GstAmount == null || GstAmount == '') {
                                        for (let i = 0; i < AddLessMaster.length; i++) {
                                            if (AddLessMaster[i].Calculation == 'SGST' || AddLessMaster[i].Calculation == 'CGST') {
                                                $("#Amount" + AddLessMaster[i].Order).val(0);
                                                $("#Rate" + AddLessMaster[i].Order).val(0);
                                            }
                                        }
                                    } else {
                                        var tot_taxvalue = parseFloat(GstAmount);
                                        for (let i = 0; i < AddLessMaster.length; i++) {
                                            if (AddLessMaster[i].Calculation == 'IGST') {
                                                $("#Amount" + AddLessMaster[i].Order).val(tot_taxvalue.toFixed(2));
                                                $("#Rate" + AddLessMaster[i].Order).val(Gst);
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
            }
        });
    }
    setTimeout(function () { calAmountInCNDN() }, 200);
}// Debit Not Ok
function OutStandingModelInCN(e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        OutStandingModelInCNOnClick();
    }
}
function OutStandingModelInCNOnClick(amt) {
    var cashamount = 0;
    if (amt == 'Diffrence_Amount') {
        var tot_Amt = $('#totcash_amt').val();
        if (tot_Amt == null || tot_Amt == '' || isNaN(tot_Amt)) tot_Amt = 0;
        var Rec_Amt = 0;
        var outSaveArr = JSON.parse($('#outSaveArr').val());
        for (let i = 0; i < outSaveArr.length; i++) {
            var Rec_Amount = outSaveArr[i].ReceiveAmt;
            if (Rec_Amount == null || Rec_Amount == '' || Rec_Amount == undefined || isNaN(Rec_Amount)) Rec_Amount = 0;
            Rec_Amt = Rec_Amt + parseFloat(Rec_Amount);
        }
        cashamount = parseFloat(tot_Amt) - parseFloat(Rec_Amt);
    }
    else cashamount = $('#totcash_amt').val();
    var party = $('#Credit_AC').val();
    var groupname = $('#CreditAcGroupName').val();
    if (groupname != null) groupname = groupname.toUpperCase();
    if (groupname.search('DEBTOR') > 0) {
        if ((cashamount != '') && (party != '')) {
            $('#totReceiveAmt').val(0);
            // var party = $('#Credit_AC').val();
            var d_c = 'C';
            $.ajax({
                type: 'GET',
                url: '/cash_bank/getOut',
                dataType: 'json',
                data: {
                    party: party,
                    d_c: d_c
                },
                success: function (data) {
                    console.log(data)
                    var i, j, result, sau;
                    result = '';
                    html = '';
                    if (data['success'] == true) {
                        var somast = data['accnametyp'];
                        var division = data['division'];
                        $('#OutStandingModelInCN').modal('show');
                        html += '<tr>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th>';
                        html += '<input type="number" class="form-control" name="EnterAmt" value="' + cashamount + '" id="EnterAmt" style="text-align:center" readonly>';
                        html += '<input type="hidden" value="' + cashamount + '" id="EnterAmt_hidden">';
                        html += '</th>';
                        html += '<th></th>';
                        html += '</tr>';
                        html += '<tr>';
                        html += '<th>Date</th>';
                        html += '<th>Entry no</th>';
                        html += '<th>Amount</th>';
                        html += '<th>Panding Amount</th>';
                        html += '<th>Receive Amount</th>';
                        html += '<th>Balance</th>';
                        html += '</tr>';
                        $('#OutStandingModelHead').html(html);
                        var totPandingAmt = 0;
                        if (somast != '') {
                            $.each(somast, function (index, value) {
                                result += '<tr>';
                                result += '<div id="delivery-' + index + '">';
                                result += '<td>';
                                var dat = moment(value.cash_date).format('DD/MM/YYYY');
                                result += '<input type="text" value="' + dat + '" name="outArray[' + index + '][cash_date]"  id="Bill_Date' + index + '"';
                                result += 'readonly="true" class="form-control "style="text-align: -webkit-right;">';
                                result += '<input type="hidden" value="' + value.main_bk + '" name="outArray[' + index + '][main_bk]" id="main_bk' + index + '">';
                                result += '<input type="hidden" value="' + value.c_j_s_p + '" name="outArray[' + index + '][c_j_s_p]" id="c_j_s_p' + index + '">';
                                result += '<input type="hidden" value="' + value.c_j_s_p + '" id="c_j_s_p_Name' + index + '">';
                                // result +=  '<input type="hidden" value="'+moment(value.cash_date).format('DD/MM/YYYY')+'" name="outArray['+index+'][Bill_Date]" id="Bill_Date'+index+'">';
                                result += '<input type="hidden" value="' + value.co_code + '" name="outArray[' + index + '][co_code]" id="co_code' + index + '">';
                                result += '<input type="hidden" value="' + value.div_code + '" name="outArray[' + index + '][div_code]" id="div_code' + index + '">';
                                result += '</td>';

                                result += '<td>';
                                result += '<input type="hidden" value="' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]"';
                                result += 'id="vouc_code' + index + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                                result += '<input type="text" class="form-control" value="' + value.main_bk + '/' + value.c_j_s_p + '/' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]" readonly>';
                                result += '</td>';

                                result += '<td>';
                                result += '<input type="hidden" value="' + value.Bill_Amount + '" name="outArray[' + index + '][Bill_Amount]" id="Bill_Amount' + index + '">';
                                result += '<input type="text" value="' + value.cash_amount + '" name="outArray[' + index + '][cash_amount]"';
                                result += 'id="Cash_Amount' + index + '" readonly="true"';
                                result += 'class="form-control " style="text-align: -webkit-right;"';
                                result += 'required>';
                                result += '<input type="hidden" value="' + value.cashac_name + '" name="outArray[' + index + '][party_id]"';
                                result += 'id="party_id' + index + '"';
                                result += 'class="form-control " style="text-align: -webkit-right"';
                                result += '>';
                                result += '<input type="hidden" value="' + value._id + '" name="outArray[' + index + '][out_id]"';
                                result += 'id="out_id' + index + '"';
                                result += 'class="form-control " style="text-align: -webkit-right"';
                                result += '>';
                                result += '</td>';

                                result += '<td>';
                                var out = 0;
                                out = value.outstanding_balance;
                                if (out == undefined || out == null) out = '';
                                totPandingAmt = parseFloat(totPandingAmt) + parseFloat(out)
                                result += '<input type="text" value="' + out + '" name="outArray[' + index + '][outstanding_amount]" readonly="true"';
                                result += 'id="outstanding_amount' + index + '"';
                                result += 'class="form-control" style="text-align: -webkit-right;"';
                                result += '>';
                                result += '</td>';

                                result += '<td>';
                                result += '<input type="text" value="' + 0 + '" name="outArray[' + index + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + index + ')"';
                                result += 'id="ReceiveAmt' + index + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                                result += 'class="form-control "style="text-align: -webkit-right;"';
                                result += 'required>';
                                result += '</td>';

                                result += '<td>'; '+value.order_price+'
                                result += '<input type="text" name="outArray[' + index + '][BalanceAmt]"';
                                result += 'id="BalanceAmt' + index + '" onkeydown="CashBankOutFocusNext(' + index + ',event)"';
                                result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                                result += '>';
                                result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                                result += '</td>';

                                result += '</div>';
                                result += '</tr>';
                            });
                        }
                        result += '<tr>';
                        result += '<td>';
                        var dat = $('#offerstartdate').val();
                        result += '<input type="text" value="' + dat + '" name="outArray[' + somast.length + '][cash_date]" id="Bill_Date' + somast.length + '"';
                        result += 'readonly="true" class="form-control "style="text-align: -webkit-right;">';
                        result += '<input type="hidden" value="" name="outArray[' + somast.length + '][main_bk]" id="main_bk' + somast.length + '">';
                        result += '<input type="hidden" value="OnAcc" name="outArray[' + somast.length + '][c_j_s_p]" id="c_j_s_p' + somast.length + '">';
                        result += '<input type="hidden" value="OnaAcc" id="c_j_s_p_Name' + somast.length + '">';
                        // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray[0][c_j_s_p]" id="c_j_s_p0">';
                        result += '<input type="hidden" value="" name="outArray[' + somast.length + '][co_code]" id="co_code' + somast.length + '">';
                        result += '<input type="hidden" value="" name="outArray[' + somast.length + '][div_code]" id="div_code' + somast.length + '">';
                        result += '</td>';

                        result += '<td>';
                        result += '<input type="text" value="ONA ACC" class="form-control" readonly="true">';
                        result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][vouc_code]"';
                        result += 'id="vouc_code' + somast.length + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                        result += '</td>';

                        result += '<td>';
                        result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][Bill_Amount]" id="Bill_Amount' + somast.length + '">';
                        result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][cash_amount]"';
                        result += 'id="Cash_Amount' + somast.length + '" readonly="true"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '<input type="hidden" value="' + party + '" name="outArray[' + somast.length + '][party_id]"';
                        result += 'id="party_id' + somast.length + '"';
                        result += 'class="form-control " style="text-align: -webkit-right"';
                        result += '>';
                        result += '<input type="hidden" value="" name="outArray[' + somast.length + '][out_id]"';
                        result += 'id="out_id' + somast.length + '"';
                        result += 'class="form-control " style="text-align: -webkit-right"';
                        result += '>';
                        result += '</td>';

                        result += '<td>';
                        result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][outstanding_amount]" readonly="true"';
                        result += 'id="outstanding_amount' + somast.length + '"';
                        result += 'class="form-control" style="text-align: -webkit-right;"';
                        result += '>';
                        result += '</td>';

                        result += '<td>';
                        result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + somast.length + ')"';
                        result += 'id="ReceiveAmt' + somast.length + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                        result += 'class="form-control "style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '</td>';

                        result += '<td>'; '+value.order_price+'
                        result += '<input type="text" name="outArray[' + somast.length + '][BalanceAmt]"';
                        result += 'id="BalanceAmt' + somast.length + '"';
                        result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                        result += '>';
                        result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                        result += '</td>';
                        result += '</tr>';

                        $('.out_repeat_row').html(result);
                        $('#ReceiveAmt0').focus();
                        $('#totPandingAmt').val(totPandingAmt.toFixed(2));
                        $('#ReceiveAmt0').val($('#EnterAmt').val());
                        $("input").focus(function () {
                            $(this).select();
                        });
                    } else {
                        swal({
                            title: 'Oops!',
                            text: 'Not Set In Group Master For Maintain Outstanding',
                            buttons: false,
                            timer: 1500
                        })
                    }
                }
            });
        } else {
            if (e.keyCode == 13) {
                e.preventDefault();
                if ($('#cashac_name' + aaaaaa).val() == '') {
                    setTimeout(function () { $('#cashac_name' + aaaaaa).focus(); }, 100);
                }
                if ($('#cashamount' + aaaaaa).val() == '') {
                    setTimeout(function () { $('#cashamount' + aaaaaa).focus(); }, 100);
                }
            }
        }
    }
}
$(document).on('keydown', '#GetOutStInCNBtnId', function (e) {
    if (e.keyCode == 13) {
        GetOutStInCN('Save_OutEntry');
    }
})// Debit Not Ok // Sale Return
function GetOutStInCN(notfocus) {
    outArray = [];
    if (notfocus == 'Save_OutEntry' || notfocus == 'notfocus') {
        var len = $('#outLength').val();
        if (len == null || len == undefined || isNaN(len)) len = 0;
        for (let i = 0; i <= len; i++) {
            if ($('#ReceiveAmt' + i).val() > 0) {
                outArray[i] = {
                    'cashac_name': $('#Credit_AC').val(), 'cash_amount': $('#ReceiveAmt' + i).val(), 'cash_narrone': 'Credit Note', 'cash_narrtwo': '',
                    'cash_date': $('#offerstartdate').val(), 'vouc_code': $('#vouc_code' + i).val(), 'Bill_Amt': $('#Bill_Amount' + i).val(), 'out_id': $('#out_id' + i).val(), 'BalanceAmt': $('#BalanceAmt' + i).val(),
                    'ReceiveAmt': $('#ReceiveAmt' + i).val(), 'outstanding_amount': $('#outstanding_amount' + i).val(), 'main_bk': $('#main_bk' + i).val(), 'c_j_s_p': $('#c_j_s_p' + i).val(),
                    'div_code': $('#div_code' + i).val(), 'co_code': $('#co_code' + i).val(), 'Bill_Date': $('#Bill_Date' + i).val()
                };
            }
        }
    }
    var OutFinArr = [];
    if (outArray == null || outArray == []) {
    } else {
        for (let o = 0; o < outArray.length; o++) {
            if (outArray[o] == [] || outArray[o] == null || outArray[o] == '') flag = 1;
            else OutFinArr.push(outArray[o]);
        }
    }
    // console.log('OutFinArr Before',OutFinArr);
    if ($('#Form').val() == 'Credit_Note_Update_Form' || $('#Form').val() == 'Debit_Note_Update_Form' || $('#Form').val() == 'Sales_Return_Update_Form' || $('#Form').val() == 'Purchase_Return_Update_Form') {
        var values = $("input[name='OutArrCount']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1];
        for (let i = 0; i <= idx; i++) {
            if ($('#Rec_Amount_in_Prev' + i).val() > 0) {
                arr = {
                    'cashac_name': $('#cashac_name_in_Prev' + i).val(), 'cash_amount': $('#Rec_Amount_in_Prev' + i).val(), 'vouc_code': $('#vouc_code_in_Prev' + i).val(),
                    'Bill_Amt': $('#Bill_Amount_in_Prev' + i).val(), 'out_id': $('#outstanding_id_in_Prev' + i).val(), 'BalanceAmt': $('#outstanding_balance_in_Prev' + i).val(),
                    'ReceiveAmt': $('#Rec_Amount_in_Prev' + i).val(), 'outstanding_amount': $('#Rec_Amount_in_Prev' + i).val(), 'main_bk': $('#op_main_bk_in_Prev' + i).val(),
                    'c_j_s_p': $('#op_c_j_s_p_in_Prev' + i).val(), 'div_code': $('#op_div_code_in_Prev' + i).val(), 'co_code': $('#op_co_code_in_Prev' + i).val(),
                    'Bill_Date': $('#Bill_Date_in_Prev' + i).val(), 'OutEntry_id': $('#outentry_id_in_Prev' + i).val(),
                };
                OutFinArr.push(arr);
            }
        }
    }
    outArray = OutFinArr;
    console.log('OutFinArr', outArray);
    $('#outSaveArr').val(JSON.stringify(outArray));

    if ($('#Form').val() == 'Sales_Return_Update_Form' || $('#Form').val() == 'Purchase_Return_Update_Form') {
        if ($('#Form').val() == 'Sales_Return_Update_Form') $('#OutStandingModelInSR').modal('hide');
        if ($('#Form').val() == 'Purchase_Return_Update_Form') $('#OutStandingModelInPR').modal('hide');
        setTimeout(function () {
            if (notfocus == 'notfocus') flag = 1;
            else $('#gross_Amt').focus();
        }, 100);
    }
    if ($('#Form').val() == 'Credit_Note_Update_Form' || $('#Form').val() == 'Debit_Note_Update_Form') {
        $('#OutStandingModelInCN').modal('hide');
        setTimeout(function () {
            if (notfocus == 'notfocus') flag = 1;
            else $('#cash_remarks').focus();
        }, 100);
    }
}// Debit Not Ok // Sale Return
function OutArrTrDel(idx, id) {
    swal({
        title: "Confirm",
        text: "Are you Sure you want to delete it?",
        icon: "warning",
        buttons: ["Cancel", "Confirm"],
        dangerMode: true
    }).then(async function (isConfirm) {
        if (isConfirm) {
            $.ajax({
                type: 'GET',
                url: '/Credit_Note/DelOutEntry',
                dataType: 'json',
                data: {
                    id: id,
                },
                success: function (data) {
                    if (data['success']) {

                    }
                }
            });
            alert('SuccesFully Delete')
            $('#OutArrTr' + idx).remove();
            var a = await GetOutStInCN('Save_OutEntry');
        }
    })
}// Debit Not Ok // Sale Return
$(document).on('keydown', '#UpdateCreditNoteBTN', function (e) {
    if (e.keyCode == 13) UpdateCreditNote();
})// Debit Not Ok // Sale Return
async function UpdateCreditNote() {
    var tot_Amt = $('#totcash_amt').val();
    if ($('#Form').val() == 'Sales_Return_Update_Form') tot_Amt = $('#gross_Amt').val();
    if ($('#Form').val() == 'Purchase_Return_Update_Form') tot_Amt = $('#gross_Amt').val();
    if (tot_Amt == null || tot_Amt == '' || isNaN(tot_Amt)) tot_Amt = 0;
    var Rec_Amt = 0;
    var outSaveArr = JSON.parse($('#outSaveArr').val());
    for (let i = 0; i < outSaveArr.length; i++) {
        var Rec_Amount = outSaveArr[i].ReceiveAmt;
        if (Rec_Amount == null || Rec_Amount == '' || Rec_Amount == undefined || isNaN(Rec_Amount)) Rec_Amount = 0;
        Rec_Amt = Rec_Amt + parseFloat(Rec_Amount);
    };
    if ($('#outSaveArr').val() == null || $('#outSaveArr').val() == '') {
        if ($('#Credit_Note_Update_Form').valid()) $('#Credit_Note_Update_Form').submit();
    } else {
        var diff = parseFloat(tot_Amt) - parseFloat(Rec_Amt)
        if (diff > 0.50) {
            var Diffrence = 'Diffrence_Amount';
            alert('Total Amount ' + tot_Amt + ' is Greater Than Adjust Amount ' + Rec_Amt + ' Diffrence ' + diff + '')
            if ($('#Form').val() == 'Credit_Note_Update_Form') OutStandingModelInCNOnClick(Diffrence);
            if ($('#Form').val() == 'Debit_Note_Update_Form') OutStandingModelInDNOnClick(Diffrence);
            if ($('#Form').val() == 'Sales_Return_Update_Form') OutStandingModelInSROnClick(Diffrence);
            if ($('#Form').val() == 'Purchase_Return_Update_Form') OutStandingModelInPROnClick(Diffrence);
        } else {
            if (diff < 0) {
                alert('Adjust Amount ' + Rec_Amt + ' is Greater Than Total Amount ' + tot_Amt + ' Diffrence ' + diff + '')
                // OutStandingModelInCNOnClick()
            } else {
                var a = await GetOutStInCN('Save_OutEntry');
                if ($('#Form').val() == 'Credit_Note_Update_Form' || $('#Form').val() == 'Debit_Note_Update_Form') if ($('#Credit_Note_Update_Form').valid()) $('#Credit_Note_Update_Form').submit();
                if ($('#Form').val() == 'Sales_Return_Update_Form') if ($('#Sales_Return_Update_Form').valid()) $('#Sales_Return_Update_Form').submit();
                if ($('#Form').val() == 'Purchase_Return_Update_Form') if ($('#Purchase_Return_Update_Form').valid()) $('#Purchase_Return_Update_Form').submit();
            }
        }
    }
}// Debit Not Ok // Sale Return
async function calOutBalAmt() {
    var notfocus = 'notfocus';
    aa = await GetOutStInCN(notfocus);
    var values = $("input[name='OutArrCount']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    var tot_Amt = $('#totcash_amt').val();
    var tot_rec_Amt = 0;
    for (let i = 0; i <= idx; i++) {
        var Rec_Amount_Prev = $('#Rec_Amount_Prev' + i).val();
        var outstanding_balance = $('#outstanding_balance_Prev' + i).val();
        var op_c_j_s_p = $('#op_c_j_s_p_in_Prev' + i).val();
        var Rec_Amount = $('#Rec_Amount_in_Prev' + i).val();
        if (Rec_Amount_Prev == null || Rec_Amount_Prev == '' || Rec_Amount_Prev == undefined || isNaN(Rec_Amount_Prev)) Rec_Amount_Prev = 0;
        if (outstanding_balance == null || outstanding_balance == '' || outstanding_balance == undefined || isNaN(outstanding_balance)) outstanding_balance = 0;
        if (Rec_Amount == null || Rec_Amount == '' || Rec_Amount == undefined || isNaN(Rec_Amount)) Rec_Amount = 0
        tot_rec_Amt = tot_rec_Amt + parseFloat(Rec_Amount);
        if (tot_rec_Amt > tot_Amt) {
            alert('Adjust Amount ' + tot_rec_Amt + ' is Greater Than Totel Amount ' + tot_Amt + '');
            $('#Rec_Amount_in_Prev' + i).css({ "backgroundColor": "red", "color": "black" });
        } else {
            $('#Rec_Amount_in_Prev' + i).css({ "backgroundColor": "rgb(211, 253, 122)", "color": "black" });
            var bal = 0;
            if (op_c_j_s_p == 'OnAcc') {
                bal = Rec_Amount;
            } else {
                bal = parseFloat(Rec_Amount_Prev) + parseFloat(outstanding_balance);
                bal = bal - parseFloat(Rec_Amount);
            }
            $('#outstanding_balance_in_Prev' + i).val(bal);
        }
    }
    // aa = await GetOutStInCN();
}// Debit Not Ok // Sale Return
function focusOnCashRemark(e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        $('#cash_remarks').focus();
    }
}// Debit Not Ok

// Debit Note #####################################################################################################################################
function OutStandingModelInDN(e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        OutStandingModelInDNOnClick();
    }
}
function OutStandingModelInDNOnClick(amt) {
    var cashamount = 0;
    if (amt == 'Diffrence_Amount') {
        var tot_Amt = $('#totcash_amt').val();
        if (tot_Amt == null || tot_Amt == '' || isNaN(tot_Amt)) tot_Amt = 0;
        var Rec_Amt = 0;
        var outSaveArr = JSON.parse($('#outSaveArr').val());
        for (let i = 0; i < outSaveArr.length; i++) {
            var Rec_Amount = outSaveArr[i].ReceiveAmt;
            if (Rec_Amount == null || Rec_Amount == '' || Rec_Amount == undefined || isNaN(Rec_Amount)) Rec_Amount = 0;
            Rec_Amt = Rec_Amt + parseFloat(Rec_Amount);
        }
        cashamount = parseFloat(tot_Amt) - parseFloat(Rec_Amt);
    }
    else cashamount = $('#totcash_amt').val();
    var party = $('#Debit_AC').val();
    var groupname = $('#CreditAcGroupName').val();
    if (groupname != null) groupname = groupname.toUpperCase();
    if (groupname.search('CREDITOR') > 0) {
        if ((cashamount != '') && (party != '')) {
            $('#totReceiveAmt').val(0);
            // var party = $('#Credit_AC').val();
            var d_c = 'D';
            $.ajax({
                type: 'GET',
                url: '/cash_bank/getOut',
                dataType: 'json',
                data: {
                    party: party,
                    d_c: d_c
                },
                success: function (data) {
                    var i, j, result, sau;
                    result = '';
                    html = '';
                    if (data['success'] == true) {
                        var somast = data['accnametyp'];
                        var division = data['division'];
                        $('#OutStandingModelInCN').modal('show');
                        html += '<tr>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th></th>';
                        html += '<th>';
                        html += '<input type="number" class="form-control" name="EnterAmt" value="' + cashamount + '" id="EnterAmt" style="text-align:center" readonly>';
                        html += '<input type="hidden" value="' + cashamount + '" id="EnterAmt_hidden">';
                        html += '</th>';
                        html += '<th></th>';
                        html += '</tr>';
                        html += '<tr>';
                        html += '<th>Date</th>';
                        html += '<th>Entry no</th>';
                        html += '<th>Amount</th>';
                        html += '<th>Panding Amount</th>';
                        html += '<th>Receive Amount</th>';
                        html += '<th>Balance</th>';
                        html += '</tr>';
                        $('#OutStandingModelHead').html(html);
                        var totPandingAmt = 0;
                        if (somast != '') {
                            $.each(somast, function (index, value) {
                                result += '<tr>';
                                result += '<div id="delivery-' + index + '">';
                                result += '<td>';
                                var dat = moment(value.cash_date).format('DD/MM/YYYY');
                                result += '<input type="text" value="' + dat + '" name="outArray[' + index + '][cash_date]"  id="Bill_Date' + index + '"';
                                result += 'readonly="true" class="form-control "style="text-align: -webkit-right;">';
                                result += '<input type="hidden" value="' + value.main_bk + '" name="outArray[' + index + '][main_bk]" id="main_bk' + index + '">';
                                result += '<input type="hidden" value="' + value.c_j_s_p + '" name="outArray[' + index + '][c_j_s_p]" id="c_j_s_p' + index + '">';
                                result += '<input type="hidden" value="' + value.c_j_s_p + '" id="c_j_s_p_Name' + index + '">';
                                // result +=  '<input type="hidden" value="'+moment(value.cash_date).format('DD/MM/YYYY')+'" name="outArray['+index+'][Bill_Date]" id="Bill_Date'+index+'">';
                                result += '<input type="hidden" value="' + value.co_code + '" name="outArray[' + index + '][co_code]" id="co_code' + index + '">';
                                result += '<input type="hidden" value="' + value.div_code + '" name="outArray[' + index + '][div_code]" id="div_code' + index + '">';
                                result += '</td>';

                                result += '<td>';
                                result += '<input type="hidden" value="' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]"';
                                result += 'id="vouc_code' + index + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                                result += '<input type="text" class="form-control" value="' + value.main_bk + '/' + value.c_j_s_p + '/' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]" readonly>';
                                result += '</td>';

                                result += '<td>';
                                result += '<input type="hidden" value="' + value.Bill_Amount + '" name="outArray[' + index + '][Bill_Amount]" id="Bill_Amount' + index + '">';
                                result += '<input type="text" value="' + value.cash_amount + '" name="outArray[' + index + '][cash_amount]"';
                                result += 'id="Cash_Amount' + index + '" readonly="true"';
                                result += 'class="form-control " style="text-align: -webkit-right;"';
                                result += 'required>';
                                result += '<input type="hidden" value="' + value.cashac_name + '" name="outArray[' + index + '][party_id]"';
                                result += 'id="party_id' + index + '"';
                                result += 'class="form-control " style="text-align: -webkit-right"';
                                result += '>';
                                result += '<input type="hidden" value="' + value._id + '" name="outArray[' + index + '][out_id]"';
                                result += 'id="out_id' + index + '"';
                                result += 'class="form-control " style="text-align: -webkit-right"';
                                result += '>';
                                result += '</td>';

                                result += '<td>';
                                var out = 0;
                                out = value.outstanding_balance;
                                if (out == undefined || out == null) out = '';
                                totPandingAmt = parseFloat(totPandingAmt) + parseFloat(out)
                                result += '<input type="text" value="' + out + '" name="outArray[' + index + '][outstanding_amount]" readonly="true"';
                                result += 'id="outstanding_amount' + index + '"';
                                result += 'class="form-control" style="text-align: -webkit-right;"';
                                result += '>';
                                result += '</td>';

                                result += '<td>';
                                result += '<input type="text" value="' + 0 + '" name="outArray[' + index + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + index + ')"';
                                result += 'id="ReceiveAmt' + index + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                                result += 'class="form-control "style="text-align: -webkit-right;"';
                                result += 'required>';
                                result += '</td>';

                                result += '<td>'; '+value.order_price+'
                                result += '<input type="text" name="outArray[' + index + '][BalanceAmt]"';
                                result += 'id="BalanceAmt' + index + '" onkeydown="CashBankOutFocusNext(' + index + ',event)"';
                                result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                                result += '>';
                                result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                                result += '</td>';

                                result += '</div>';
                                result += '</tr>';
                            });
                        }
                        result += '<tr>';
                        result += '<td>';
                        var dat = $('#offerstartdate').val();
                        result += '<input type="text" value="' + dat + '" name="outArray[' + somast.length + '][cash_date]" id="Bill_Date' + somast.length + '"';
                        result += 'readonly="true" class="form-control "style="text-align: -webkit-right;">';
                        result += '<input type="hidden" value="" name="outArray[' + somast.length + '][main_bk]" id="main_bk' + somast.length + '">';
                        result += '<input type="hidden" value="OnAcc" name="outArray[' + somast.length + '][c_j_s_p]" id="c_j_s_p' + somast.length + '">';
                        result += '<input type="hidden" value="OnaAcc" id="c_j_s_p_Name' + somast.length + '">';
                        // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray[0][c_j_s_p]" id="c_j_s_p0">';
                        result += '<input type="hidden" value="" name="outArray[' + somast.length + '][co_code]" id="co_code' + somast.length + '">';
                        result += '<input type="hidden" value="" name="outArray[' + somast.length + '][div_code]" id="div_code' + somast.length + '">';
                        result += '</td>';

                        result += '<td>';
                        result += '<input type="text" value="ONA ACC" class="form-control" readonly="true">';
                        result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][vouc_code]"';
                        result += 'id="vouc_code' + somast.length + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                        result += '</td>';

                        result += '<td>';
                        result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][Bill_Amount]" id="Bill_Amount' + somast.length + '">';
                        result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][cash_amount]"';
                        result += 'id="Cash_Amount' + somast.length + '" readonly="true"';
                        result += 'class="form-control " style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '<input type="hidden" value="' + party + '" name="outArray[' + somast.length + '][party_id]"';
                        result += 'id="party_id' + somast.length + '"';
                        result += 'class="form-control " style="text-align: -webkit-right"';
                        result += '>';
                        result += '<input type="hidden" value="" name="outArray[' + somast.length + '][out_id]"';
                        result += 'id="out_id' + somast.length + '"';
                        result += 'class="form-control " style="text-align: -webkit-right"';
                        result += '>';
                        result += '</td>';

                        result += '<td>';
                        result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][outstanding_amount]" readonly="true"';
                        result += 'id="outstanding_amount' + somast.length + '"';
                        result += 'class="form-control" style="text-align: -webkit-right;"';
                        result += '>';
                        result += '</td>';

                        result += '<td>';
                        result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + somast.length + ')"';
                        result += 'id="ReceiveAmt' + somast.length + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                        result += 'class="form-control "style="text-align: -webkit-right;"';
                        result += 'required>';
                        result += '</td>';

                        result += '<td>'; '+value.order_price+'
                        result += '<input type="text" name="outArray[' + somast.length + '][BalanceAmt]"';
                        result += 'id="BalanceAmt' + somast.length + '"';
                        result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                        result += '>';
                        result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                        result += '</td>';
                        result += '</tr>';

                        $('.out_repeat_row').html(result);
                        $('#ReceiveAmt0').focus();
                        $('#totPandingAmt').val(totPandingAmt.toFixed(2));
                        $('#ReceiveAmt0').val($('#EnterAmt').val());
                        $("input").focus(function () {
                            $(this).select();
                        });
                    } else {
                        swal({
                            title: 'Oops!',
                            text: 'Not Set In Group Master For Maintain Outstanding',
                            buttons: false,
                            timer: 1500
                        })
                    }
                }
            });
        } else {
            if (e.keyCode == 13) {
                e.preventDefault();
                if ($('#cashac_name' + aaaaaa).val() == '') {
                    setTimeout(function () { $('#cashac_name' + aaaaaa).focus(); }, 100);
                }
                if ($('#cashamount' + aaaaaa).val() == '') {
                    setTimeout(function () { $('#cashamount' + aaaaaa).focus(); }, 100);
                }
            }
        }
    }
}


// Journal Entry ##################################################################################################################################
function journalDrCrCheck(idx) {
    var cashtypejv = $('#cashtypejv' + idx).val();
    if (cashtypejv == "Debit") {
        $('#cashamountjv' + idx).prop("readOnly", false);
        $('#cashamountjv' + idx).removeClass("nofocus");

        $('#cashamountcr' + idx).prop("readOnly", true);
        $('#cashamountcr' + idx).addClass("nofocus");
    }
    if (cashtypejv == "Credit") {
        $('#cashamountcr' + idx).prop("readOnly", false);
        $('#cashamountcr' + idx).removeClass("nofocus");

        $('#cashamountjv' + idx).prop("readOnly", true);
        $('#cashamountjv' + idx).addClass("nofocus");
    }
}
$(document).on('click', '.addjournal', function () {
    var values = $("input[name='jourtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    var amountd = 0;
    var amountc = 0;
    for (i = 0; i <= idx; i++) {
        var dramt = $("#cashamountjv" + i).val();
        var cramt = $("#cashamountcr" + i).val();
        if (dramt == null || dramt == '' || dramt == undefined || isNaN(dramt)) dramt = 0;
        if (cramt == null || cramt == '' || cramt == undefined || isNaN(cramt)) cramt = 0;
        amountd = amountd + parseFloat(dramt);
        amountc = amountc + parseFloat(cramt);
    }
    var Diff = parseFloat(amountd) - parseFloat(amountc);
    if (Diff == null || Diff == '' || Diff == undefined || isNaN(Diff)) Diff = 0;
    lstidx = parseInt(idx) + 1;
    var newdiv = document.createElement('div');
    new_div = "<tr class='contract_wrapper' id='rohit" + lstidx + "'>";
    if ($('#Form').val() == 'journalEntry_Update_Form') {
        new_div += '<td></td>';
    }
    new_div += '<td>';
    new_div += '<input type="hidden" name="jourtrn" value="' + lstidx + '" id="jourtrn ' + lstidx + '"';
    new_div += 'class="form-control" style="width: 102px;text-align: -webkit-right;"/>';
    new_div += '<select class="form-control  productplace selectproductfocus prbank select2"  name="cash_type" onchange="journalDrCrCheck(' + lstidx + ')" id="cashtypejv' + lstidx + '" placeholder="Select Type"';
    new_div += 'style="width: 150px;text-align: -webkit-right;">';
    new_div += '<option value=""></option>';
    if (Diff == 0) {
        new_div += '<option value="Debit">Debit</option>';
        new_div += '<option value="Credit">Credit</option>';
    }
    if (Diff > 0) {
        new_div += '<option value="Debit">Debit</option>';
        new_div += '<option value="Credit" selected>Credit</option>';
    }
    if (Diff < 0) {
        new_div += '<option value="Debit" selected>Debit</option>';
        new_div += '<option value="Credit">Credit</option>';
    }

    new_div += '</select>';
    new_div += '</td>';
    new_div += '<td>';
    new_div += '<select name="cashac_name" id="cashac_name' + lstidx + '" class="form-control AllAccountWithOutCashBank"';
    new_div += 'required>';
    new_div += ' <option value=""></option>';
    new_div += '</select>';
    new_div += '</td>';
    new_div += '<td>';
    new_div += '<input type="text" name="cash_debitamount" required oninput="calJournal(' + lstidx + ')" id="cashamountjv' + lstidx + '" onkeydown="OutStandingModelInJournalEntry(event,\'' + lstidx + '\')"';
    if (Diff == 0) {
        new_div += 'value="' + 0 + '" class="form-control"';
    }
    if (Diff > 0) {
        new_div += 'value="' + 0 + '" class="form-control nofocus" readonly="true"';
    }
    if (Diff < 0) {
        new_div += 'value="' + Diff + '" class="form-control"';
    }
    new_div += 'style="text-align: -webkit-right;"/>';
    new_div += '</td>';
    new_div += '<td>';
    new_div += '<input type="text" name="cash_creditamount" required oninput="calJournal(' + lstidx + ')" id="cashamountcr' + lstidx + '" onkeydown="OutStandingModelInJournalEntry(event,\'' + lstidx + '\')"';
    if (Diff == 0) {
        new_div += 'value="' + 0 + '" class="form-control"';
    }
    if (Diff > 0) {
        new_div += 'value="' + Diff + '" class="form-control"';
    }
    if (Diff < 0) {
        new_div += 'value="' + 0 + '" class="form-control nofocus" readonly="true"';
    }
    new_div += 'class="form-control" style="text-align: -webkit-right;" />';
    new_div += '</td>';
    new_div += '<td>';
    new_div += '<input type="text" name="cash_narrone" id="cashremark' + lstidx + '"';
    new_div += 'class="form-control"  style="">';
    new_div += '<input type="hidden" name="outSaveArr" id="outSaveArr' + lstidx + '">';
    new_div += '</td>';
    new_div += '<td>';
    new_div += '<input type="text" name="cash_narrtwo" id="cashnarrtwo' + lstidx + '"';
    new_div += 'class="form-control amountfocus" style="">';
    new_div += '</td>';
    new_div += "<td> <a onclick='delJournalEntryArr(" + lstidx + ")'  style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td></tr>";

    $(new_div).insertBefore("#contract_div");
    $(".productplace").select2({
        placeholder: "Select type",
        allowClear: true,
    });
    $('.AllAccountWithOutCashBank').select2({
        placeholder: 'Please Select A/c',
        allowClear: true,
        ajax: {
            type: "GET",
            url: '/Garu_Aavak_Entry/AllAccountWithOutCashBank',
            dataType: 'json',
            data: function (term) {
                return {
                    term: term
                };
            },
            success: function (data) {
            },
        },
        templateResult: formatcity,
        escapeMarkup: function (m) { return m; }
    });
    $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus();
    calJournal(1)
});
function delJournalEntryArr(idx) {
    swal({
        icon: 'warning',
        title: "Sure",
        text: 'Are you sure you want to delete it?',
        buttons: true,
        dangerMode: true
    }).then((willDelete) => {
        if (willDelete) {
            $('#rohit' + idx).remove();
            calJournal(1)
        }
    });
}
function calJournal(callback) {
    var values = $("input[name='jourtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    var amountd = 0;
    var amountc = 0;
    for (i = 0; i <= idx; i++) {
        var dramt = $("#cashamountjv" + i).val();
        var cramt = $("#cashamountcr" + i).val();
        if (dramt == null || dramt == '' || dramt == undefined || isNaN(dramt)) dramt = 0;
        if (cramt == null || cramt == '' || cramt == undefined || isNaN(cramt)) cramt = 0;
        amountd = amountd + parseFloat(dramt);
        amountc = amountc + parseFloat(cramt);
    }
    $("#totcash_amtdr").val((amountd).toFixed(2));
    $("#totcash_amtcr").val((amountc).toFixed(2));
    if (amountd == amountc) $('.save-journal').show();
    else $('.save-journal').hide();
}
function OutStandingModelInJournalEntry(e, idx) {
    if (e.keyCode == 13) {
        e.preventDefault();
        var aa = '';
        OutStandingModelInJournalEntryOnClick(idx, aa);
    }
}
function OutStandingModelInJournalEntryOnClick(idx, amt) {
    var cashamount = 0;
    var button_index = idx;
    var party = $('#cashac_name' + idx).val();
    if (amt == 'Diffrence_Amount') {
        var tot_Amt = 0;
        if ($('#cashtypejv' + button_index).val() == 'Debit') tot_Amt = $('#cashamountjv' + button_index).val();
        if ($('#cashtypejv' + button_index).val() == 'Credit') tot_Amt = $('#cashamountcr' + button_index).val();

        if (tot_Amt == null || tot_Amt == '' || isNaN(tot_Amt)) tot_Amt = 0;
        var Rec_Amt = 0;
        var outSaveArr = JSON.parse($('#outSaveArr' + button_index).val());
        for (let i = 0; i < outSaveArr.length; i++) {
            var Rec_Amount = outSaveArr[i].ReceiveAmt;
            if (Rec_Amount == null || Rec_Amount == '' || Rec_Amount == undefined || isNaN(Rec_Amount)) Rec_Amount = 0;
            Rec_Amt = Rec_Amt + parseFloat(Rec_Amount);
        }
        cashamount = parseFloat(tot_Amt) - parseFloat(Rec_Amt);
    }
    else {
        cashamount = $('#cashamountjv' + button_index).val();
        if (cashamount == null || cashamount == '' || cashamount == undefined) cashamount = 0;
        if (cashamount == 0) cashamount = $('#cashamountcr' + button_index).val();
    }
    if ((cashamount != '') && (party != '')) {
        $('#totReceiveAmt').val(0);
        var d_c = '';
        if ($('#cashtypejv' + button_index).val() == 'Debit') d_c = 'D';
        else d_c = 'C';
        $.ajax({
            type: 'GET',
            url: '/cash_bank/getOut',
            dataType: 'json',
            data: {
                party: party,
                d_c: d_c
            },
            success: function (data) {
                console.log(data)
                var i, j, result, sau;
                result = '';
                html = '';
                if (data['success'] == true) {
                    var somast = data['accnametyp'];
                    var division = data['division'];
                    $('#OutStandingModelInJournalEntry').modal('show');
                    html += '<tr>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th></th>';
                    html += '<th>';
                    html += '<input type="number" class="form-control" name="EnterAmt" value="' + cashamount + '" id="EnterAmt" style="text-align:center" readonly>';
                    html += '<input type="hidden" value="' + cashamount + '" id="EnterAmt_hidden">';
                    html += '</th>';
                    html += '<th></th>';
                    html += '</tr>';
                    html += '<tr>';
                    html += '<th>Date</th>';
                    html += '<th>Entry no</th>';
                    html += '<th>Amount</th>';
                    html += '<th>Panding Amount</th>';
                    html += '<th>Receive Amount</th>';
                    html += '<th>Balance</th>';
                    html += '</tr>';
                    $('#OutStandingModelHead').html(html);
                    var totPandingAmt = 0;
                    if (somast != '') {
                        $.each(somast, function (index, value) {
                            result += '<tr>';
                            result += '<div id="delivery-' + index + '">';
                            result += '<td>';
                            var dat = moment(value.cash_date).format('DD/MM/YYYY');
                            result += '<input type="text" value="' + dat + '" name="outArray[' + index + '][cash_date]"  id="Bill_Date' + index + '"';
                            result += 'readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '<input type="hidden" value="' + value.main_bk + '" name="outArray[' + index + '][main_bk]" id="main_bk' + index + '">';
                            result += '<input type="hidden" value="' + value.c_j_s_p + '" name="outArray[' + index + '][c_j_s_p]" id="c_j_s_p' + index + '">';
                            result += '<input type="hidden" value="' + value.c_j_s_p + '" id="c_j_s_p_Name' + index + '">';
                            // result +=  '<input type="hidden" value="'+moment(value.cash_date).format('DD/MM/YYYY')+'" name="outArray['+index+'][Bill_Date]" id="Bill_Date'+index+'">';
                            result += '<input type="hidden" value="' + value.co_code + '" name="outArray[' + index + '][co_code]" id="co_code' + index + '">';
                            result += '<input type="hidden" value="' + value.div_code + '" name="outArray[' + index + '][div_code]" id="div_code' + index + '">';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="hidden" value="' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]"';
                            result += 'id="vouc_code' + index + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                            result += '<input type="text" class="form-control" value="' + value.main_bk + '/' + value.c_j_s_p + '/' + value.vouc_code + '" name="outArray[' + index + '][vouc_code]" readonly>';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="hidden" value="' + value.Bill_Amount + '" name="outArray[' + index + '][Bill_Amount]" id="Bill_Amount' + index + '">';
                            result += '<input type="text" value="' + value.cash_amount + '" name="outArray[' + index + '][cash_amount]"';
                            result += 'id="Cash_Amount' + index + '" readonly="true"';
                            result += 'class="form-control " style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '<input type="hidden" value="' + value.cashac_name + '" name="outArray[' + index + '][party_id]"';
                            result += 'id="party_id' + index + '"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '<input type="hidden" value="' + value._id + '" name="outArray[' + index + '][out_id]"';
                            result += 'id="out_id' + index + '"';
                            result += 'class="form-control " style="text-align: -webkit-right"';
                            result += '>';
                            result += '</td>';

                            result += '<td>';
                            var out = 0;
                            out = value.outstanding_balance;
                            if (out == undefined || out == null) out = '';
                            totPandingAmt = parseFloat(totPandingAmt) + parseFloat(out)
                            result += '<input type="text" value="' + out + '" name="outArray[' + index + '][outstanding_amount]" readonly="true"';
                            result += 'id="outstanding_amount' + index + '"';
                            result += 'class="form-control" style="text-align: -webkit-right;"';
                            result += '>';
                            result += '</td>';

                            result += '<td>';
                            result += '<input type="text" value="' + 0 + '" name="outArray[' + index + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + index + ')"';
                            result += 'id="ReceiveAmt' + index + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                            result += 'class="form-control "style="text-align: -webkit-right;"';
                            result += 'required>';
                            result += '</td>';

                            result += '<td>'; '+value.order_price+'
                            result += '<input type="text" name="outArray[' + index + '][BalanceAmt]"';
                            result += 'id="BalanceAmt' + index + '" onkeydown="CashBankOutFocusNext(' + index + ',event)"';
                            result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                            result += '>';
                            result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                            result += '</td>';

                            result += '</div>';
                            result += '</tr>';
                        });
                    }
                    result += '<tr>';
                    result += '<td>';
                    var dat = $('#offerstartdate').val();
                    result += '<input type="text" value="' + dat + '" name="outArray[' + somast.length + '][cash_date]" id="Bill_Date' + somast.length + '"';
                    result += 'readonly="true" class="form-control "style="text-align: -webkit-right;">';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][main_bk]" id="main_bk' + somast.length + '">';
                    result += '<input type="hidden" value="OnAcc" name="outArray[' + somast.length + '][c_j_s_p]" id="c_j_s_p' + somast.length + '">';
                    result += '<input type="hidden" value="OnaAcc" id="c_j_s_p_Name' + somast.length + '">';
                    // result +=  '<input type="hidden" value="'+value.c_j_s_p+'" name="outArray[0][c_j_s_p]" id="c_j_s_p0">';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][co_code]" id="co_code' + somast.length + '">';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][div_code]" id="div_code' + somast.length + '">';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="text" value="ONA ACC" class="form-control" readonly="true">';
                    result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][vouc_code]"';
                    result += 'id="vouc_code' + somast.length + '"  readonly="true" class="form-control "style="text-align: -webkit-right;">';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="hidden" value="' + 0 + '" name="outArray[' + somast.length + '][Bill_Amount]" id="Bill_Amount' + somast.length + '">';
                    result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][cash_amount]"';
                    result += 'id="Cash_Amount' + somast.length + '" readonly="true"';
                    result += 'class="form-control " style="text-align: -webkit-right;"';
                    result += 'required>';
                    result += '<input type="hidden" value="' + party + '" name="outArray[' + somast.length + '][party_id]"';
                    result += 'id="party_id' + somast.length + '"';
                    result += 'class="form-control " style="text-align: -webkit-right"';
                    result += '>';
                    result += '<input type="hidden" value="" name="outArray[' + somast.length + '][out_id]"';
                    result += 'id="out_id' + somast.length + '"';
                    result += 'class="form-control " style="text-align: -webkit-right"';
                    result += '>';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][outstanding_amount]" readonly="true"';
                    result += 'id="outstanding_amount' + somast.length + '"';
                    result += 'class="form-control" style="text-align: -webkit-right;"';
                    result += '>';
                    result += '</td>';

                    result += '<td>';
                    result += '<input type="text" value="' + 0 + '" name="outArray[' + somast.length + '][ReceiveAmt]" onkeydown="calEnterAmtInSR(' + somast.length + ',event,' + somast.length + ')"';
                    result += 'id="ReceiveAmt' + somast.length + '" oninput="calOutStandingInSR(' + somast.length + ')"';
                    result += 'class="form-control "style="text-align: -webkit-right;"';
                    result += 'required>';
                    result += '</td>';

                    result += '<td>'; '+value.order_price+'
                    result += '<input type="text" name="outArray[' + somast.length + '][BalanceAmt]"';
                    result += 'id="BalanceAmt' + somast.length + '"';
                    result += 'class="form-control" style="text-align: -webkit-right;" readonly="true"';
                    result += '>';
                    result += '<input type="hidden" id="outLength" value="' + somast.length + '">';
                    result += '</td>';
                    result += '</tr>';

                    $('.out_repeat_row').html(result);
                    var save = 'Save_OutEntry';
                    var button = '<button type="button" class="btn btn-primary" id="GetOutStInJEBtnId" onclick="GetOutStInJE(' + button_index + ',\'' + save + '\')">Save</button>';
                    $('#OutstandingModelSaveButton').html(button);
                    $('#ReceiveAmt0').focus();
                    $('#totPandingAmt').val(totPandingAmt.toFixed(2));
                    $('#ReceiveAmt0').val($('#EnterAmt').val());
                    $("input").focus(function () {
                        $(this).select();
                    });
                    return 1;
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'Not Set In Group Master For Maintain Outstanding',
                        buttons: false,
                        timer: 1500
                    })
                }
            }
        });
    } else {
        if (e.keyCode == 13) {
            e.preventDefault();
            if ($('#cashac_name' + aaaaaa).val() == '') {
                setTimeout(function () { $('#cashac_name' + aaaaaa).focus(); }, 100);
            }
            if ($('#cashamount' + aaaaaa).val() == '') {
                setTimeout(function () { $('#cashamount' + aaaaaa).focus(); }, 100);
            }
        }
    }
}
function GetOutStInJE(index, notfocus) {
    outArray = [];
    if (notfocus == 'Save_OutEntry' || notfocus == 'notfocus') {
        var len = $('#outLength').val();
        if (len == null || len == undefined || isNaN(len)) len = 0;
        for (let i = 0; i <= len; i++) {
            if ($('#ReceiveAmt' + i).val() > 0) {
                outArray[i] = {
                    'cashac_name': $('#Credit_AC').val(), 'cash_amount': $('#ReceiveAmt' + i).val(), 'cash_narrone': $('#cashremark' + index).val(), 'cash_narrtwo': $('#cashnarrtwo' + index).val(),
                    'cash_date': $('#offerstartdate').val(), 'vouc_code': $('#vouc_code' + i).val(), 'Bill_Amt': $('#Bill_Amount' + i).val(), 'out_id': $('#out_id' + i).val(), 'BalanceAmt': $('#BalanceAmt' + i).val(),
                    'ReceiveAmt': $('#ReceiveAmt' + i).val(), 'outstanding_amount': $('#outstanding_amount' + i).val(), 'main_bk': $('#main_bk' + i).val(), 'c_j_s_p': $('#c_j_s_p' + i).val(),
                    'div_code': $('#div_code' + i).val(), 'co_code': $('#co_code' + i).val(), 'Bill_Date': $('#Bill_Date' + i).val()
                };
            }
        }
    }
    var OutFinArr = [];
    if (outArray == null || outArray == []) {
    } else {
        for (let o = 0; o < outArray.length; o++) {
            if (outArray[o] == [] || outArray[o] == null || outArray[o] == '') flag = 1;
            else OutFinArr.push(outArray[o]);
        }
    }
    if ($('#Form').val() == 'journalEntry_Update_Form') {
        var values = $("input[name='OutArrCount']")
            .map(function () { return $(this).val(); }).get();
        var idx = values[values.length - 1];
        var cash_amount = 0;
        if ($('#cashtypejv' + index).val() == 'Debit') cash_amount = $('#cashamountjv' + index).val();
        if ($('#cashtypejv' + index).val() == 'Credit') cash_amount = $('#cashamountcr' + index).val();
        for (let i = 0; i <= idx; i++) {
            if ($('#Rec_Amount_in_Prev' + i).val() > 0) {
                var arr = {
                    'cashac_name': $('#cashac_name' + index).val(), 'cash_chequeno': '', 'cash_chequedate': '', 'cash_amount': cash_amount, 'cash_narrone': $('#cashremark' + index).val(), 'cash_narrtwo': $('#cashnarrtwo' + index).val(),
                    'cash_date': $('#offerstartdate').val(), 'vouc_code': $('#Bill_vouc_code' + i).val(), 'Bill_Amt': $('#Bill_Amount_in_Prev' + i).val(), 'out_id': $('#oustanding_id' + i).val(), 'BalanceAmt': $('#outstanding_balance_in_Prev' + i).val(),
                    'ReceiveAmt': $('#Rec_Amount_in_Prev' + i).val(), 'outstanding_amount': $('#Rec_Amount_in_Prev' + i).val(), 'main_bk': $('#Bill_main_bk' + i).val(), 'c_j_s_p': $('#Bill_c_j_s_p' + i).val(),
                    'div_code': $('#Bill_div_code' + i).val(), 'co_code': $('#Bill_co_code' + i).val(), 'Bill_Date': $('#Bill_Date' + i).val(),
                    'OutEntry_id': $('#OutEntryId' + i).val()
                };
                OutFinArr.push(arr);
            }
        }
    }
    outArray = OutFinArr;
    console.log('OutFinArr', outArray);
    $('#outSaveArr' + index).val(JSON.stringify(outArray));

    $('#OutStandingModelInJournalEntry').modal('hide');
    if ($('#Form').val() == 'journalEntry_Update_Form') {
        setTimeout(function () {
            if (notfocus == 'notfocus') flag = 1;
            else $('#cash_remarks').focus();
        }, 100);
    } else {
        setTimeout(function () {
            if (notfocus == 'notfocus') flag = 1;
            else $('#cashremark' + index).focus();
        }, 100);
    }
}
function showAdjustEntryInJVUpdate(idx) {
    var cashBankId = $('#maincashid' + idx).val();
    $.ajax({
        type: 'GET',
        url: '/cash_bank/showAdjustEntryInCbUpdate',
        dataType: 'json',
        data: {
            cashBankId: cashBankId,
            Module: 'JV'
        },
        success: function (data) {
            if (data['success']) {
                console.log(data['outstandingEntry']);
                var outstandingEntry = data['outstandingEntry'];
                var html = '';
                html += '<div class="row" style="width: 100%;background-color: dodgerblue;margin-left:1px" align="center"><h4 style="color: white">Outstanding Entry</h4></div>';
                html += '<table class="table tabler table-bordered adsearch">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>Delete</th>';
                html += '<th>Date</th>';
                html += '<th>Entry No</th>';
                html += '<th>Type</th>';
                html += '<th>Bill Amount</th>';
                html += '<th style="width:5em">Receive Amount</th>';
                html += '<th style="width:5em">Balance</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                for (let i = 0; i < outstandingEntry.length; i++) {
                    html += '<tr id="OutArrTr' + i + '">';
                    html += "<td>";
                    html += '<input type="hidden" name="OutArrCount" value="' + i + '" id="cashtrn"/>';
                    html += '<a onclick="OutArrTrDel(' + i + ',\'' + outstandingEntry[i]._id + '\')" style="cursor:pointer;"><i class="fa fa-times" style="font-size: 20px;color: red;margin-left:12px;"></i></a>';
                    html += "<input type='hidden' id='OutEntryId" + i + "'        value='" + outstandingEntry[i]._id + "' data-recAmt='" + outstandingEntry[i].Rec_Amount + "' data-addAmt='" + outstandingEntry[i].Add_Ded_Amt_Tot + "' data-lessAmt='" + outstandingEntry[i].Less_Ded_Amt_Tot + "'>";
                    html += "<input type='hidden' id='oustanding_id" + i + "'     value='" + outstandingEntry[i].outstanding_id + "'>";
                    html += "<input type='hidden' id='CashBank_id" + i + "'       value='" + outstandingEntry[i].CashBank_id + "'>";
                    html += "<input type='hidden' id='Bill_vouc_code" + i + "'    value='" + outstandingEntry[i].vouc_code + "'>";
                    html += "<input type='hidden' id='Entry_c_j_s_p" + i + "'     value='" + outstandingEntry[i].c_j_s_p + "'>";
                    html += "<input type='hidden' id='Bill_c_j_s_p" + i + "'      value='" + outstandingEntry[i].op_c_j_s_p + "'>";
                    html += "<input type='hidden' id='Bill_main_bk" + i + "'      value='" + outstandingEntry[i].op_main_bk + "'>";
                    html += "<input type='hidden' id='Bill_co_code" + i + "'      value='" + outstandingEntry[i].op_co_code + "'>";
                    html += "<input type='hidden' id='Bill_div_code" + i + "'     value='" + outstandingEntry[i].op_div_code + "'>";
                    html += "<input type='hidden' id='Bill_Date" + i + "'         value='" + outstandingEntry[i].Bill_Date + "'>";
                    html += "</td>";
                    html += '<td>' + outstandingEntry[i].Bill_Date + '</td>';//moment(outstandingEntry[i].cash_date).format('DD/MM/YYYY')
                    html += '<td style="text-align:center">' + outstandingEntry[i].op_c_j_s_p + '/' + outstandingEntry[i].vouc_code + '</td>';
                    if (outstandingEntry[i].d_c == 'C') html += '<td style="text-align:center">Receipt</td>';
                    if (outstandingEntry[i].d_c == 'D') html += '<td style="text-align:center">Payment</td>';
                    html += '<td style="text-align:right">' + outstandingEntry[i].Bill_Amount + '<input type="hidden" id="Bill_Amount_in_Prev' + i + '" value="' + outstandingEntry[i].Bill_Amount + '"></td>';
                    html += '<td>';
                    html += '<input type="number" id="Rec_Amount_in_Prev' + i + '" value="' + outstandingEntry[i].Rec_Amount + '" oninput="calOutBalAmtInCBUpdate(' + idx + ')">';
                    html += '<input type="hidden" id="Rec_Amount_Prev' + i + '" value="' + outstandingEntry[i].Rec_Amount + '">';
                    html += '</td>';//outstandingEntry[i].Rec_Amount
                    html += '<td>';
                    html += '<input type="number"  id="outstanding_balance_in_Prev' + i + '" value="' + outstandingEntry[i].outstanding_balance + '" readonly>';
                    html += '<input type="hidden"  id="outstanding_balance_Prev' + i + '" value="' + outstandingEntry[i].outstanding_balance + '" readonly>';
                    html += '</td>';
                    html += '</tr>';
                }
                html += '</tbody>';
                html += '</table>';
                $('#showAdjustEntryInCbUpdate').html(html);
                $("input").focus(function () {
                    $(this).select();
                });
                GetOutStInJE(idx, 'notfocus');
            }
        }
    });

}
$(document).on('keydown', '#JVEntryUpdateBtn', function (e) {
    if (e.keyCode == 13) {
        e.preventDefault();
        JVEntryUpdateOnClick()
    }
})
async function JVEntryUpdateOnClick() {
    var values = $("input[name='jourtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    var count = 0;
    for (let i = 0; i <= idx; i++) {
        var Tot_Amt = 0;
        if ($('#cashtypejv' + i).val() == 'Debit') Tot_Amt = $('#cashamountjv' + i).val();
        if ($('#cashtypejv' + i).val() == 'Credit') Tot_Amt = $('#cashamountcr' + i).val();
        if (Tot_Amt > 0) {
            var OutArr = JSON.parse($('#outSaveArr' + i).val());
            var Tot_Adj_Amt = 0;
            if (OutArr == null || OutArr == '' || OutArr == []) {
                var Diffrence = 'Diffrence_Amount';
                var aa = await OutStandingModelInJournalEntryOnClick(i, Diffrence);
                count = count + parseInt(aa);
            } else {
                for (let j = 0; j < OutArr.length; j++) {
                    var recamt = OutArr[j].ReceiveAmt;
                    Tot_Adj_Amt = Tot_Adj_Amt + parseFloat(recamt);
                }
                var diff = parseFloat(Tot_Amt) - parseFloat(Tot_Adj_Amt)
                if (diff > 0.50) {
                    var Diffrence = 'Diffrence_Amount';
                    alert('Total Amount ' + Tot_Amt + ' is Greater Than Adjust Amount ' + Tot_Adj_Amt + ' Diffrence ' + diff + '')
                    if ($('#Form').val() == 'journalEntry_Update_Form') {
                        OutStandingModelInJournalEntryOnClick(i, Diffrence);
                    }
                    count = count + 1;
                    break;
                } else {
                    if (diff < 0) {
                        alert('Adjust Amount ' + Tot_Adj_Amt + ' is Greater Than Total Amount ' + Tot_Amt + ' Diffrence ' + diff + '');
                        count = count + 1;
                        break;
                    }
                }
            }
        }
    }
    if (count == 0) {
        if ($('#Form').val() == 'journalEntry_Update_Form') if ($('#journalEntryUpdate').valid()) $('#journalEntryUpdate').submit();
    }
}

function refreshAdjOutEntryInJV() {
    var values = $("input[name='jourtrn']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1];
    for (let i = 0; i <= idx; i++) {
        var cashBankId = $('#maincashid' + i).val()
        if (cashBankId == null || cashBankId == undefined || cashBankId == '') { }
        else {
            $.ajax({
                type: 'GET',
                url: '/cash_bank/showAdjustEntryInCbUpdate',
                dataType: 'json',
                data: {
                    cashBankId: cashBankId,
                    Module: 'JV'
                },
                success: function (data) {
                    if (data['success']) {
                        console.log(data['outstandingEntry']);
                        var outstandingEntry = data['outstandingEntry'];
                        var outArray = [];
                        var cash_amount = 0;
                        if ($('#cashtypejv' + i).val() == 'Debit') cash_amount = $('#cashamountjv' + i).val();
                        if ($('#cashtypejv' + i).val() == 'Credit') cash_amount = $('#cashamountcr' + i).val();
                        for (let j = 0; j < outstandingEntry.length; j++) {
                            var arr = {
                                'cashac_name': $('#cashac_name' + i).val(), 'cash_chequeno': '', 'cash_chequedate': '', 'cash_amount': cash_amount, 'cash_narrone': $('#cashremark' + i).val(), 'cash_narrtwo': $('#cashnarrtwo' + i).val(),
                                'cash_date': $('#offerstartdate').val(), 'vouc_code': outstandingEntry[j].vouc_code, 'Bill_Amt': outstandingEntry[j].Bill_Amount, 'out_id': outstandingEntry[j].outstanding_id,
                                'BalanceAmt': outstandingEntry[j].outstanding_balance, 'ReceiveAmt': outstandingEntry[j].Rec_Amount, 'outstanding_amount': outstandingEntry[j].outstanding_amount,
                                'main_bk': outstandingEntry[j].op_main_bk, 'c_j_s_p': outstandingEntry[j].op_c_j_s_p, 'div_code': outstandingEntry[j].op_div_code, 'co_code': outstandingEntry[j].op_co_code,
                                'Bill_Date': outstandingEntry[j].Bill_Date, 'OutEntry_id': outstandingEntry[j]._id
                            };
                            outArray.push(arr);
                        }
                        console.log('refreshAdjOutEntry', outArray);
                        $('#outSaveArr' + i).val(JSON.stringify(outArray));
                    }
                }
            });
        }
    }
}


// Bank Reconcilation ###################################################################################################################################################################
function getOpeningEntry() {
    var partyid = $('#partyid').val();
    if (partyid == null || partyid == '') {
        swal({
            title: 'Oops!',
            text: 'Please Select Party',
            buttons: false,
            timer: 800
        })
    } else {
        $.ajax({
            type: "GET",
            url: '/bank_reconcilition/getlistopmodule',
            dataType: 'json',
            data: {
                partyid: partyid,
            },
            success: function (data) {
                console.log(data)
                if (data['success'] == true) {
                    var oposmodule = data['oposmodule'];
                    var html = '';
                    var BankClBal = data['BankClBal'];
                    $('#Closing_Bal_Bank').val(BankClBal.cash_amount);
                    if (BankClBal.d_c == 'C') $('#Bank_d_c').val('Credit').trigger('change');
                    if (BankClBal.d_c == 'D') $('#Bank_d_c').val('Debit').trigger('change');
                    // var html = '<tr><td><input type="hidden" name="update" value="update"><td></tr>';
                    $.each(oposmodule, function (index, value) {
                        counter = index;
                        html += '<tr id="delOpOsArr' + counter + '">';
                        html += '<td>';
                        html += '<input type="hidden" name="opmoduleid[' + counter + ']" id="opmoduleid' + counter + '" value="' + value._id + '">';
                        html += '<input type="hidden" name="OpOsArrNum" id="OpOsArrNum' + counter + '" value="' + counter + '">';
                        html += '<input type="hidden" name="OpOsArrUpdate[' + counter + ']" id="OpOsArrUpdate' + counter + '" value="OpOsArrUpdate">';
                        html += '<input type="text" name="sno[' + counter + ']" id="sno' + counter + '" value="' + (counter + 1) + '" class="form-control selectproductfocus">';
                        html += '</td>';
                        var city = '';
                        if (value.cashac_name.CityName == null || value.cashac_name.CityName == undefined || value.cashac_name.CityName == '') city = '';
                        else city = value.cashac_name.CityName.CityName;
                        html += '<td>';
                        html += '<select name="cashac_name[' + counter + ']" id="cashac_name' + counter + '" style="width: 100%;" class="form-control prbank select2 AllAccountWithOutCashBank">';
                        html += '<option value="' + value.cashac_name._id + '" selected="true">' + value.cashac_name.ACName + ',' + city + '</option>';
                        html += '</select>';
                        html += '</td>';

                        html += '<td>';
                        html += '<input type="text" value="' + value.cash_chequeno + '" required name="cash_chequeno[' + counter + ']" id="cash_chequeno' + counter + '" placeholder="Chq No" class="form-control">';
                        html += '</td>';

                        html += '<td>';
                        var dt = moment(value.cash_date).format('DD/MM/YYYY');//cash_chequedate
                        html += '<input type="text" required value="' + dt + '" name="date[' + counter + ']" class="form-control datemask BillDate" id="date' + counter + '" value="" placeholder="Date">';
                        html += '</td>';

                        html += '<td>';
                        html += '<input type="number" value="' + value.cash_amount + '" name="Amount[' + counter + ']" class="form-control" id="Amount' + counter + '" placeholder="Amount" required>';
                        html += '</td>';

                        html += '<td>';
                        html += '<select name="d_c[' + counter + ']" id="d_c' + counter + '" style="width: 100%;" class="form-control prbank select2Class" placeholder="Please Select">';
                        html += '<option value=""></option>';
                        if (value.d_c == 'D') html += '<option value="Debit" selected>Debit</option>';
                        else html += '<option value="Debit">Debit</option>';
                        if (value.d_c == 'C') html += '<option value="Credit" selected>Credit</option>';
                        else html += '<option value="Credit">Credit</option>';
                        html += '</select>';
                        html += '</td>';
                        html += '<td>';
                        if (counter < oposmodule.length - 1) html += '<input type="text"  value="' + value.cash_remarks + '" name="remarks[' + counter + ']" class="form-control" id="remarks' + counter + '" placeholder="Remarks">';
                        if (counter == oposmodule.length - 1) html += '<input type="text"  value="' + value.cash_remarks + '" name="remarks[' + counter + ']" class="form-control amountfocus" id="remarks' + counter + '" placeholder="Remarks">';
                        html += '</td>';

                        html += "<td><a onclick='delOpeningEntryArr(" + counter + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                        html += '</tr>';
                    });
                    $(".adjustmentstable tbody tr").not('tr#OpOsArrNum').remove();
                    $('tr#OpOsArrNum').before(html);
                    $(".select2Class").select2({
                        placeholder: "Please Select",
                        allowClear: true,
                    });
                    $('.AllAccountWithOutCashBank').select2({
                        placeholder: 'Please Select',
                        allowClear: true,
                        ajax: {
                            type: "GET",
                            url: '/Garu_Aavak_Entry/AllAccountWithOutCashBank',
                            dataType: 'json',
                            data: function (term) {
                                return {
                                    term: term
                                };
                            },
                            success: function (data) {
                            },
                        },
                        templateResult: formatcity,
                        escapeMarkup: function (m) { return m; }
                    });
                    $(".BillDate").datepicker({
                        changeMonth: true,
                        changeYear: true,
                        format: "dd/mm//yyyy",
                        autoclose: true,
                    });
                } else {
                    swal({
                        title: 'Oops!',
                        text: 'There Is No data in OP O/S Module',
                        buttons: false,
                        timer: 1000
                    })
                }
            }
        })
    }
}
$(document).on('click', '.addOpeningEntry', function () {
    var values = $("input[name='OpOsArrNum']")
        .map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    if (lstidx == null || lstidx == '' || isNaN(lstidx)) lstidx = 0;
    var counter = lstidx;
    $.ajax({
        type: 'GET',
        url: '/op_os_module/getBook',
        dataType: 'json',
        data: {
            id: 'cityid'
        },
        success: function (data) {
            if (data['success']) {
                var vouchMast = data['vouchMast'];
                var html = '';
                html += '<tr id="delOpOsArr' + counter + '">';
                html += '<td>';
                // html +='<input type="hidden" name="opmoduleid['+counter+']" id="opmoduleid'+counter+'" value="">';
                html += '<input type="hidden" name="OpOsArrNum" id="OpOsArrNum' + counter + '" value="' + counter + '">';
                html += '<input type="text" name="sno[' + counter + ']" id="sno' + counter + '" value="' + (counter + 1) + '" class="form-control selectproductfocus">';
                html += '</td>';
                html += '<td>';
                html += '<select name="cashac_name[' + counter + ']" id="cashac_name' + counter + '" style="width: 100%;" class="form-control prbank select2 AllAccountWithOutCashBank"></select>';
                html += '</td>';
                html += '<td>';
                html += '<input type="text" name="cash_chequeno[' + counter + ']" id="cash_chequeno' + counter + '" placeholder="Chq No" class="form-control">';
                html += '</td>';
                html += '<td>';//cash_chequedate   
                html += '<input type="text" required name="date" class="form-control datemask BillDate" id="date' + counter + '" value="" placeholder="Date">';
                html += '</td>';
                html += '<td>';
                html += '<input type="number" name="Amount" class="form-control" id="Amount' + counter + '" placeholder="Amount" required>';
                html += '</td>';
                html += '<td>';
                html += '<select name="d_c" id="d_c' + counter + '" style="width: 100%;" class="form-control prbank select2Class" placeholder="Please Select">';
                html += '<option value=""></option>';
                html += '<option value="Debit">Debit</option>';
                html += '<option value="Credit">Credit</option>';
                html += '</select>';
                html += '</td>';
                html += '<td>';
                html += '<input type="text" name="remarks" class="form-control amountfocus" id="remarks' + counter + '" placeholder="Remarks">';
                html += '</td>';

                html += "<td><a onclick='delOpeningEntryArr(" + counter + ")' style='cursor:pointer;'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;'></i></a></td>";
                html += '</tr>';

                $(html).insertBefore("#OpOsArrNum");
                $('.AllAccountWithOutCashBank').select2({
                    placeholder: 'Please Select',
                    allowClear: true,
                    ajax: {
                        type: "GET",
                        url: '/Garu_Aavak_Entry/AllAccountWithOutCashBank',
                        dataType: 'json',
                        data: function (term) {
                            return {
                                term: term
                            };
                        },
                        success: function (data) {
                        },
                    },
                    templateResult: formatcity,
                    escapeMarkup: function (m) { return m; }
                });
                $(".BillDate").datepicker({
                    changeMonth: true,
                    changeYear: true,
                    format: "dd/mm//yyyy",
                    autoclose: true,
                });
                $(".select2Class").select2({
                    placeholder: "Please Select",
                    allowClear: true,
                });
                $('.adjustmentstable tr:nth-last-child(2)').find('.selectproductfocus').focus()
            }
        }
    });
});
function delOpeningEntryArr(idx) {
    var aa = confirm('Are yo sure to want to delete it');
    if (aa == true) {
        var id = $('#opmoduleid' + idx).val();
        if (id == null || id == '' || id == undefined) {

        } else {
            $.ajax({
                type: 'GET',
                url: '/OP_OS_module/delete',
                dataType: 'json',
                data:
                {
                    id: id,
                },
                success: function (response) {
                    console.log(response);
                    if (response['success'] == true) {
                        $('#delOpOsArr' + idx).remove();
                    }
                }
            })
        }
    }
}


// loki on godown transfer note

$(document).on('click', '.addgodowntrnsfr', function () {
    var values = $("input[name='grncntr']").map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    // alert(idx+' == '+lstidx);
    memberp = lstidx;
    counter = lstidx;
    if (counter == limitp) {
        alert("You have reached the limit of adding " + counter + " inputs");
    } else {
   
        // alert('hello'+counter );
                    new_div='';
                    new_div+='<tr id="godowntrnsfr' + counter + '">';
                    new_div+='<td>';
                    new_div+='<input type="text" placeholder="Lot.no" name="grn_group['+counter+'][lot_no]" id="lot_no'+counter+'" class="form-control numerals" style="width:70px" >';
                    new_div+='</td>';
                    new_div+='<td>';
                    new_div+='<input type="hidden" name="grncntr" value='+counter+'>';
                    // new_div+='<input type="hidden" name="grn_group['+counter+'][lot_no]" id="lot_no'+counter+'">';
                    new_div+='<select class="form-control prbank ItenCodeName" name="gtn_product['+counter+'][so_disc]" id="so_disc'+counter+'" style="width:610px" >';
                    new_div+='<option value=""></option>';
                    new_div+='</select>'; 
                    new_div+='</td>';
                    new_div+='<td >';
                    new_div+='<input type="text"  placeholder="Qty" id="stdqty'+counter+'" name="grn_group['+counter+'][actual_qty]" oninput="getgodontrnsfrcala('+counter+')" class="form-control actualamt numerals">';
                    new_div+='</td>';
                    new_div+='<td>';
                    new_div+='<input type="text" class="form-control getfocusqtypurcshasegodown numerals"  oninput="getQtyPackcal('+counter+')" data-id="'+counter+'0" data-index="'+counter+'" placeholder="Pck Qty" name="grn_group['+counter+'][roundup_pckqty]" id="qtyrecadd'+counter+'">';
                    new_div+='</td>';
                    new_div+='<td >';
                    new_div+='<input type="text"  placeholder="Net_Wt" name="grn_group['+counter+'][net_Wt]" id="net_Wt'+counter+'" data-id="'+counter+'" class="form-control Net_Wt amountfocuspgrnselectgodown2 numerals">';
                    new_div+='</td>';

                    // to delete extra row of product
                    new_div += '<td>';
                    new_div += "<a onclick=remove_godowntrnfer('" + counter + "0','" + counter + "') style='cursor:pointer;' class='nofocus'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;margin-top: 10px;'></i></a>";
                    new_div += '</td>';

                    new_div+='</tr>';                              
                   
                    $(new_div).insertBefore("#grn_div");
                    counter++;
                    memberp++;
                    $('.ItenCodeName').select2({
                        placeholder: 'Please select Item',
                        allowClear: true,
                        ajax: {
                            type: "GET",
                            url: '/Garu_Aavak_Entry/ItenCodeName',
                            dataType: 'json',
                            data: function (term) {
                                return {
                                    term: term
                                };
                            },
                            success: function (data) {
                            },
                        },
                        templateResult: formatcity,
                        templateSelection: formatcity,
                        escapeMarkup: function (m) { return m; }
                    })
                    // $('.getproductplacegodown').select2({
                    //     placeholder: 'Please select Product',
                    //     maximumSelectionLength: 3,
                    //     allowClear: true,
                    //     ajax: {
                    //         type: "GET",
                    //         // url: '/bomof_jw/getfgname',
                    //         url: '/pur_order/getproductnamermfgboth',
                    //         dataType: 'json',
                    //         data: function (term) {
                    //             return {
                    //                 term: term
                    //             };
                    //         },
                    //         success: function (data) {
                    //         },
                    //     },
                    //     // templateResult: formatcity,
                    //     // templateSelection: formatcity,
                    //     escapeMarkup: function (m) { return m; }
                    // });
                   
                   
                    $('.adjustmentstable tr:nth-last-child(2)').find('.ItenCodeName').focus();
             
        
    }
});

// for calculating total quantity of products in godown transfer note
function getgodontrnsfrcala(id) {
    var sum = 0;
    // alert('hello');
    $('.actualamt').each(function () {
        if ($(this).val())
        sum += parseFloat($(this).val());
    })
    $('#tot_amtso').val(sum.toFixed(2));
    getQtyPackcal(id);
    getNetQtyTotal();
}

// to calc the qty * pack 
function getQtyPackcal(id) {
    // alert('hello');
    var prod = 0;
    var x =  $('#stdqty'+id+'').val();
    var y =  $('#qtyrecadd'+id+'').val();
    // alert(x+'   '+y);
    prod = x*y;
    if(prod != NaN)
    $('#net_Wt'+id).val((prod/100).toFixed(2));
    
    getNetQtyTotal();
}
// to total net wt
function getNetQtyTotal() {
    var sum = 0;
    // alert('hello');
    $('.Net_Wt').each(function () {
        if ($(this).val())
            sum += parseFloat($(this).val());
            // alert($(this).val());
    })
    $('#net_wt_to').val(sum.toFixed(2));
    // alert('new wt '+sum);
}


// to hide submit button if source and destination is same in godown transfer note
function getsamedestion() {
    var source_warehouse = $('#source_warehouse').val();
    var destination_location = $('#destination_warehouse').val();
    if (destination_location == source_warehouse) {
        alert('You can not enter the same location');
        $('.dlv_load').hide();
    } else {
        $('.dlv_load').show();
    }
}
// to remove rows 
function remove_godowntrnfer(id, mainid) {
    var strconfirm = confirm("Are you sure want to delete?");
    if (strconfirm == true) {
        $("#godowntrnsfr" + mainid).remove();
        // $("#lotgroup" + mainid).remove();

        getgodontrnsfrcala(mainid);
    }
}




// loki adding function to add row in stock adjustment note
$(".itemtypeval").select2({
    allowClear: false,
});

$(document).on('click', '.addstockadjustment', function () {
    var values = $("input[name='grncntr']").map(function () { return $(this).val(); }).get();
    var idx = values[values.length - 1]
    lstidx = parseInt(idx) + 1;
    // alert(idx+' == '+lstidx);
    memberp = lstidx;
    counter = lstidx;
    if (counter == limitp) {
        alert("You have reached the limit of adding " + counter + " inputs");
    } else {
   
        // alert('hello'+counter );
                    new_div='';
                    new_div+='<tr id="godowntrnsfr' + counter + '">';
                    new_div+='<td>';
                    new_div+='<input type="text" placeholder="Lot.no" name="grn_group['+counter+'][lot_no]" id="lot_no'+counter+'" class="form-control numerals" style="width:70px" >';
                    new_div+='</td>';
                    new_div+='<td>';
                    new_div+='<input type="hidden" name="grncntr" value='+counter+'>';
                    // new_div+='<input type="hidden" name="grn_group['+counter+'][lot_no]" id="lot_no'+counter+'">';
                    new_div+='<select class="form-control prbank ItenCodeName" name="grn_group['+counter+'][so_disc]" id="so_disc'+counter+'" style="width:610px" >';
                    new_div+='<option value=""></option>';
                    new_div+='</select>'; 
                    new_div+='</td>';

                    // new_div+='<td>';
                    // new_div+='<select name="grn_group['+counter+'][itemtype]" id="itemtype'+counter+'" class="form-control itemtypeval prbank select2" placeholder="Item Type">';
                    // // new_div+='<option value=""></option>';
                    // new_div+='<option value="+" selected>+</option>';
                    // new_div+='<option value="-">-</option>';
                    // new_div+='</select>';
                    // new_div+='</td>';

                    new_div+='<td >';
                    new_div+='<input type="text"  placeholder="Qty" id="stdqty'+counter+'" name="grn_group['+counter+'][actual_qty]" oninput="getgodontrnsfrcala('+counter+')" class="form-control actualamt numerals">';
                    new_div+='</td>';
                    new_div+='<td>';
                    new_div+='<input type="text" class="form-control getfocusqtypurcshasegodown numerals"  oninput="getQtyPackcal('+counter+')" data-id="'+counter+'0" data-index="'+counter+'" placeholder="Pck Qty" name="grn_group['+counter+'][roundup_pckqty]" id="qtyrecadd'+counter+'">';
                    new_div+='</td>';
                    new_div+='<td >';
                    new_div+='<input type="text"  placeholder="Net_Wt" name="grn_group['+counter+'][net_Wt]" oninput="getNetQtyTotal()"  id="net_Wt'+counter+'" data-id="'+counter+'" class="form-control Net_Wt amountfocuspgrnselectgodown2 numerals">';
                    new_div+='</td>';

                    // to delete extra row of product
                    new_div += '<td>';
                    new_div += "<a onclick=remove_godowntrnfer('" + counter + "0','" + counter + "') style='cursor:pointer;' class='nofocus'><i class='fa fa-times' style='font-size: 20px;color: red;margin-left:12px;margin-top: 10px;'></i></a>";
                    new_div += '</td>';

                    new_div+='</tr>';                              
                   
                    $(new_div).insertBefore("#grn_div");
                    counter++;
                    memberp++;
                    $('.ItenCodeName').select2({
                        placeholder: 'Please select Item',
                        allowClear: true,
                        ajax: {
                            type: "GET",
                            url: '/Garu_Aavak_Entry/ItenCodeName',
                            dataType: 'json',
                            data: function (term) {
                                return {
                                    term: term
                                };
                            },
                            success: function (data) {
                            },
                        },
                        templateResult: formatcity,
                        templateSelection: formatcity,
                        escapeMarkup: function (m) { return m; }
                    })
                   
                   
                    $('.adjustmentstable tr:nth-last-child(2)').find('.ItenCodeName').focus();
             
        
    }
});







